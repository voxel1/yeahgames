(()=>{"use strict";var e,t={2728:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FamobiAPI=void 0;const s=a(i(6756));class n{static addFamobiHandlers(){window.famobi_onPauseRequested=function(){famobi.log("famobi_onPauseRequested"),s.default.instance.pause()},window.famobi_onResumeRequested=function(){famobi.log("famobi_onResumeRequested"),s.default.instance.resume()},window.famobi.onRequest("enableAudio",(function(){s.default.instance.sound.volume=1})),window.famobi.onRequest("disableAudio",(function(){s.default.instance.sound.volume=0}))}}n.handleLevelEndEvent=function(e,t,i){window.famobi?(s.default.instance.pause(),window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"LEVELEND",result:e,score:t}).then((()=>{s.default.instance.resume(),i()})).catch((()=>{}))):i()},n.lastLiveScoreReportTimestamp=0,n._lastLiveScore=-1,n._sendLiveScore=function(e){n.lastLiveScoreReportTimestamp=(new Date).getTime(),window.famobi_analytics.trackEvent("EVENT_LIVESCORE",{liveScore:e})},n.reportLiveScore=function(e){const t=(new Date).getTime();n.lastLiveScoreReportTimestamp=n.lastLiveScoreReportTimestamp||0,t-n.lastLiveScoreReportTimestamp>=1e3?n._sendLiveScore(e):(n._lastLiveScore=e,n._nextReportTimeout||(n._nextReportTimeout=setTimeout((()=>{void 0!==n._lastLiveScore&&(n._sendLiveScore(n._lastLiveScore),n._lastLiveScore=void 0),n._nextReportTimeout=void 0}),1e3-(t-n.lastLiveScoreReportTimestamp))))},t.FamobiAPI=n},8240:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initFamobiMockObject=void 0;t.initFamobiMockObject=()=>{if("undefined"!=typeof famobi||window.famobi)return;const e=(e,t="#bada55",i="#222")=>console.log("%c "+e,`background: ${i}; color: ${t}`);console.warn("Injecting famobi mock object..."),famobi=window.famobi={},famobi.setPreloadProgress=t=>e(`Progress ${t}%`,"#880000","#FFEEEE"),famobi.localStorage=window.localStorage,famobi.log=(...e)=>console.log(...e),famobi.gameReady=function(){e("'Game ready to start' reported","#FFFFFF","#880000")},famobi.getOffsets=()=>({top:0,right:0,bottom:0,left:0}),famobi.onOffsetChange=e=>{},famobi.getCurrentLanguage=()=>"en",famobi.onRequest=function(t,i){e(`famobi.onRequest(${t})`,"#FFFFDD","#5533FF"),famobi.requests=famobi.requests||{},famobi.requests[t]=i,"startGame"===t&&(console.warn("Starting game in 500 ms..."),setTimeout((()=>i()),500))},famobi.triggerRequest=function(t,...i){e(`famobi->request(${t})`,"#FFFFDD","#5533FF"),famobi.requests&&famobi.requests[t]&&famobi.requests[t](...i)},famobi.getVolume=function(){return.5},famobi.playerReady=function(){e("playerReady() reported","#00FF66","#000")},famobi.hasFeature=function(e){return{trackstats:!1,external_start:!1,skip_title:!1,skip_tutorial:!1,forced_mode:!1,auto_quality:!1,external_mute:!0,copyright:!0}[e]||!1},famobi.showInterstitialAd=(e,t)=>{"object"==typeof e?e.callback():t()},famobi.getMoreGamesButtonImage=famobi.getBrandingButtonImage=()=>"https://games.cdn.famobi.com/portal/4638e320-4444-4514-81c4-d80a8c662371/more-games-button/600x253/5a6895c0f28fb.png",famobi.moreGamesLink=famobi.openBrandingLink=()=>e("More games link"),famobi_analytics=window.famobi_analytics={trackEvent:(t,i)=>new Promise(((a,s)=>{e("famobi_analytics.trackEvent("+t+", "+JSON.stringify(i)+")"),"EVENT_LEVELSTART"===t||"EVENT_LEVELRESTART"===t?setTimeout((()=>a()),100):a()})),trackStats:(t,i,a)=>{e("[trackStats] "+t+" x"+(a||1)+" "+JSON.stringify(i||""),"#FFFFFF","#FF00FF")}}}},6756:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i extends Phaser.Game{static get instance(){return this._instance}constructor(e){super(e),i._instance=this}get currentScene(){return this._currentScene}set currentScene(e){this._currentScene=e}}t.default=i},9898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameConfig=void 0,t.GameConfig={GAME_NAME:"chess-classic",STORAGE_KEY:"chess_classic_settings",SAVESLOT_NAME:"chess_classic_slot_",_SCALE:1,_MAX_RENDERER_WIDTH:4096,_MAX_RENDERER_HEIGHT:4096,_GAME_WIDTH:640,_GAME_HEIGHT:960,FONTS:{MAIN:"Franklin Gothic",CALIBRI_GDI:"Calibri GDI",SYSTEM:"system-ui"},SHOW_LOADING_PROGRESS:!0,TRANSITION_SCREEN_COLORS:{DEFAULT:0,BLACK:0,DARK_RED:7015701,LIGHT_BLUE:12647423},TRANSITION_SCREEN_DURATION:{IN:50,OUT:150},SCREEN_FADE_MOVEMENT_DURATION:200,MAX_PORTRAIT_SCREEN_RATIO:1,ENABLE_LOCALIZATION:!1,TOTAL_SAVESLOTS:5,SAVESLOT_PANEL_HEIGHT:77,CHESS_FRAMES_MAP:[0,0,1,2,3,4,5,6,7,8,9,10,11,12],BOARD_WIDTH:640,BOARD_HEIGHT:640,CELL_SIZE:74.85,PLAYER_PAD_WIDTH:125,PLAYER_PAD_MIN_GAP:65,PLAYER_PAD_MAX_GAP_PORTRAIT:100,PLAYER_PAD_MAX_GAP_LANDSCAPE:225,PLAYER_PAD_CAPTURED_FIGURE_SCALE:.5,PLAYER_PAD_CAPTURED_FIGURE_LAYOUT_PORTRAIT:{GAP_X:38,GAP_Y:42},PLAYER_PAD_CAPTURED_FIGURE_LAYOUT_LANDSCAPE:{GAP_X:40,GAP_Y:45},PLAYER_PAD_MAX_FIGURES_IN_A_ROW:8,MIN_CPU_WAIT_TIME:500,FIGURE_MOVEMENT_TWEEN_DURATION:400,CPU_DRAW_PROPOSITION_TIMEOUT:180,MATE_RESULTS_DELAY:1500,getWidth(){return this._GAME_WIDTH*this._SCALE},getHeight(){return this._GAME_HEIGHT*this._SCALE},getScale(){return this._SCALE},debug:{board:!1}}},8394:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BoardSkin=void 0,function(e){e[e.SKIN_1=1]="SKIN_1",e[e.SKIN_2=2]="SKIN_2",e[e.SKIN_3=3]="SKIN_3",e[e.SKIN_4=4]="SKIN_4",e[e.SKIN_5=5]="SKIN_5"}(t.BoardSkin||(t.BoardSkin={}))},8813:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Difficulty=void 0,function(e){e[e.VERY_EASY=1]="VERY_EASY",e[e.EASY=2]="EASY",e[e.MEDIUM=3]="MEDIUM",e[e.HARD=4]="HARD",e[e.VERY_HARD=5]="VERY_HARD",e[e.EXTREME=6]="EXTREME"}(t.Difficulty||(t.Difficulty={}))},1066:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventTypes=void 0,function(e){e.BOARD_SKIN_CHANGED="board:skinChanged",e.FIGURES_SET_CHANGED="figures:skinChanged",e.PVP_VIEW_MODE_CHANGED="pvp:viewChanged",e.HIGHLIGHT_MOVES_TOGGLED="highlightMoves:changed",e.UNDO_FEATURE_AVAILABLE="game:undoAvailable",e.UNDO_TO_MOVE_NUMBER="game:undoToMove",e.CELL_SELECTED="cell:selected",e.FIGURE_CAPTURED="figure:captured",e.TURN_CHANGED="game:turnChanged",e.OFFER_DRAW="game:offerDraw",e.DRAW_OFFER_RESULT="game:drawAccepted",e.SHOW_AI_THINKING_ICON="ai:showThinkingIcon",e.HIDE_AI_THINKING_ICON="ai:hideThinkingIcon",e.REQUEST_UNDO="game:requestUndo"}(t.EventTypes||(t.EventTypes={}))},6099:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigureColor=void 0,function(e){e.WHITE="white",e.BLACK="black"}(t.FigureColor||(t.FigureColor={}))},6447:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigureType=void 0,function(e){e[e.EMPTY=0]="EMPTY",e[e.P4_PAWN=2]="P4_PAWN",e[e.P4_ROOK=4]="P4_ROOK",e[e.P4_KNIGHT=6]="P4_KNIGHT",e[e.P4_BISHOP=8]="P4_BISHOP",e[e.P4_QUEEN=12]="P4_QUEEN",e[e.P4_KING=10]="P4_KING",e[e.P4_EDGE=16]="P4_EDGE"}(t.FigureType||(t.FigureType={}))},953:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FiguresSkin=void 0,function(e){e[e.SET_1=1]="SET_1",e[e.SET_2=2]="SET_2",e[e.SET_3=3]="SET_3",e[e.SET_4=4]="SET_4",e[e.SET_5=5]="SET_5"}(t.FiguresSkin||(t.FiguresSkin={}))},3441:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameMode=void 0,function(e){e.PLAYER_VS_CPU="cpu",e.PLAYER_VS_PLAYER="pvp"}(t.GameMode||(t.GameMode={}))},8353:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameResult=void 0,function(e){e.WHINE_WIN="white-win",e.BLACK_WIN="black-win",e.DRAW="draw"}(t.GameResult||(t.GameResult={}))},993:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Owner=void 0,function(e){e.PLAYER="player",e.OPPONENT="opponent"}(t.Owner||(t.Owner={}))},7401:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PVPViewMode=void 0,function(e){e.MIRRORED="mirrored",e.STRAIGHT="straight"}(t.PVPViewMode||(t.PVPViewMode={}))},9273:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerColorMode=void 0,function(e){e.RANDOM="random",e.WHITE="white",e.BLACK="black"}(t.PlayerColorMode||(t.PlayerColorMode={}))},2149:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResponsivePositionData=void 0;class i{constructor(){this.x=0,this.y=0,this.dx=0,this.dy=0,this.scale=void 0}static clone(e){var t,a,s,n,o;let r=new i;return r.x=e.x,r.y=e.y,r.dx=e.dx,r.dy=e.dy,r.scale=e.scale,e.landscape&&(r.landscape={x:(null!==(t=e.landscape.x)&&void 0!==t?t:e.x)||0,y:(null!==(a=e.landscape.y)&&void 0!==a?a:e.y)||0,dx:(null!==(s=e.landscape.dx)&&void 0!==s?s:e.dx)||0,dy:(null!==(n=e.landscape.dy)&&void 0!==n?n:e.dy)||0,scale:null!==(o=e.landscape.scale)&&void 0!==o?o:e.scale}),r}}t.ResponsivePositionData=i},3825:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scenes=void 0,function(e){e.PRELOAD="preload",e.GAMEPLAY="gameplay"}(t.Scenes||(t.Scenes={}))},7390:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenFadeDirection=void 0,function(e){e.UP="up",e.DOWN="down",e.LEFT="left",e.RIGHT="right"}(t.ScreenFadeDirection||(t.ScreenFadeDirection={}))},3431:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SaveSlotData=void 0;t.SaveSlotData=class{}},7686:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.P4Engine=void 0;class i{static log(...e){i.PRINT_DEBUG_INFO&&console.log("[P4] ",...e)}static parseInt(e,t){return parseInt(""+e,t)}static p4_zero_array(){if(i.P4_USE_TYPED_ARRAYS)return new Int32Array(120);if(0==i.P4_ZEROS.length)for(var e=0;e<120;e++)i.P4_ZEROS[e]=0;return i.P4_ZEROS.slice()}static p4_alphabeta_treeclimber(e,t,a,s,n,o,r,h){var l,c=i.p4_make_move(e,n,o,i.P4_QUEEN),d=1-a,g=i.p4_parse(e,a,c.ep,-s),u=g.length;if(t){var _;for(l=0;l<u;l++){var p=g[l],m=p[0],f=p[1],v=p[2];if(m>i.P4_WIN){r=i.P4_KING_VALUE;break}if((_=-i.p4_alphabeta_treeclimber(e,t-1,d,m,f,v,-h,-r))>r&&(r=_),r>=h)break}r<-i.P4_WIN_NOW&&!i.p4_check_check(e,a)&&(r=e.stalemate_scores[a]),r<-i.P4_WIN&&(r+=i.P4_WIN_DECAY)}else for(;h>r&&-1!=--u;)g[u][0]>r&&(r=g[u][0]);return i.p4_unmake_move(e,c),r}static p4_prepare(e){var t,a,s,n,o,r=e.pieces=[[],[]],h=e.moveno>>1,l=e.board,c=h>50?0:i.parseInt(6*Math.exp(-.07*h)),d=h<12,g=h<5,u=[0,0],_=[0,0],p=[0,0];for(t=20;t<100;t++){var m=14&(o=l[t]),f=1&o;m&&(r[f].push([o,t]),m==i.P4_KING?u[f]=t:(_[f]+=i.P4_VALUES[m],p[f]=Math.max(p[f],i.P4_VALUES[m])))}var v=e.draw_timeout>90||e.current_repetitions>=2;v&&i.log("draw likely",e.current_repetitions,e.draw_timeout),e.values=[[],[]];var S=i.P4_VALUES[i.P4_QUEEN],E=_[0]+_[1]+2*S,y=2*(_[1]+S)/E,P=2*(_[0]+S)/E,M=[y,P],C=4*i.P4_QUEEN/E;for(e.stalemate_scores=[i.parseInt(.5+2*(y-1)*S),i.parseInt(.5+2*(P-1)*S)],t=0;t<i.P4_VALUES.length;t++){var b=i.P4_VALUES[t];b<i.P4_WIN?(e.values[0][t]=i.parseInt(b*y+.5),e.values[1][t]=i.parseInt(b*P+.5)):(e.values[0][t]=b,e.values[1][t]=b)}e.best_pieces=[i.parseInt(p[0]*y+.5),i.parseInt(p[1]*P+.5)];var A=[u[0]%10,u[1]%10],T=[i.parseInt(u[0]/10),i.parseInt(u[1]/10)],w=[[],[]];for(n=3;n<9;n++)for(s=1;s<9;s++)(14&(o=l[t=10*n+s]))==i.P4_PAWN&&(0==(1&o)?w[0][s]=n:void 0===w[1][s]&&(w[1][s]=n));var I=h>=20||E<5*S,O=e.weights;for(n=2;n<10;n++)for(s=1;s<9;s++){t=10*n+s;for(var R=i.P4_CENTRALISING_WEIGHTS[t]*c,L=i.P4_KNIGHT_WEIGHTS[t],G=0;G<2;G++){var N=Math.abs(A[1-G]-s),D=Math.abs(T[1-G]-n),k=Math.abs(A[G]-s),F=(Math.abs(T[G]-n),Math.max(Math.sqrt(N*N+D*D),1)+1),x=M[G],V=x*x*x,B=n==2+7*G,U=n==3+5*G,H=n==5+G,W=n==9-7*G,Y=-5*(g&&B),K=i.parseInt(.3*R)+2*L+Y,z=i.parseInt(.3*R),j=i.parseInt(.6*R)+L+Y;B&&(z+=(4==s||5==s)*(c+!I),z+=(1==s||8==s)*(h>10&&h<20)*-3,z+=(2==s||7==s)*(h>10&&h<20)*-1);var X=i.parseInt(.5*L+R*(.5-g)),Q=2*(d&&B)*c,q=Math.max(2*C,1)*i.P4_BASE_PAWN_WEIGHTS[G?119-t:t];if(g){if(n>=4&&n<=7){var $=1+3*(5==n||6==n);q+=i.parseInt(.1*($+i.p4_random_int(e,4))*R)}4!=s&&5!=s||(q-=3*U,q+=3*H)}W&&(q+=e.values[G][i.P4_QUEEN]-e.values[G][i.P4_PAWN]),q+=4*(3==n&&2==T[G]&&Math.abs(k)<2&&5!=A[G]&&4!=s&&5!=s);var Z=w[1-G];if((null==Z[s]||0==G&&Z[s]<n||1==G&&Z[s]>n)&&(q+=2),I){K+=2*i.parseInt(8*x/F),z+=2*((N<2)+(D<2)),j+=3*(Math.abs(N-D)<2),X+=2*i.parseInt(8/F)+(N*D==0)+(N-D==0);var J=8*C*i.P4_CENTRALISING_WEIGHTS[t];Q+=i.parseInt(150*C/(V*F)+J*V)}if(O[i.P4_PAWN+G][t]=q,O[i.P4_KNIGHT+G][t]=K,O[i.P4_ROOK+G][t]=z,O[i.P4_BISHOP+G][t]=j,O[i.P4_QUEEN+G][t]=X,O[i.P4_KING+G][t]=Q,v&&x<1){var ee=3/V;for(a=2+G;a<14;a+=2)O[a][t]+=i.p4_random_int(e,ee)}}}e.prepared=!0}static p4_maybe_prepare(e){e.prepared||i.p4_prepare(e)}static p4_parse(e,t,a,s){var n,o,r,h,l,c,d,g=e.board,u=1-t,_=10-20*t,p=[],m=[],f=e.pieces[t],v=e.castles>>2*t&3,S=e.values[u],E=e.weights;for(c=f.length-1;c>=0;c--){var y=E[h=g[n=f[c][1]]];if(d=s-y[n],(h&=14)>2){var P=i.P4_MOVES[h];if(2&h){for(l=0;l<8;l++)(r=g[o=n+P[l]])?(17&r)==u&&m.push([d+S[r]+y[o]+E[r][o],n,o]):p.push([d+S[r]+y[o],n,o]);h==i.P4_KING&&v&&(1&v&&g[n-1]+g[n-2]+g[n-3]==0&&i.p4_check_castling(g,n-2,u,_,-1)&&p.push([d+12,n,n-2]),2&v&&g[n+1]+g[n+2]==0&&i.p4_check_castling(g,n,u,_,1)&&p.push([d+13,n,n+2]))}else{var M=P.length;for(l=0;l<M;){var C=P[l++];o=n;do{(r=g[o+=C])?(17&r)==u&&m.push([d+S[r]+y[o]+E[r][o],n,o]):p.push([d+S[r]+y[o],n,o])}while(!r)}}}else{if(!g[o=n+_]){p.push([d+y[o],n,o]);var b=o+_;n*(120-n)<3200&&!g[b]&&p.push([d+y[b],n,b])}(r=g[--o])&&(17&r)==u&&m.push([d+S[r]+y[o]+E[r][o],n,o]),(r=g[o+=2])&&(17&r)==u&&m.push([d+S[r]+y[o]+E[r][o],n,o])}}if(a){var A,T=i.P4_PAWN|t;g[n=a-_-1]==T&&(A=S[i.P4_PAWN]+E[i.P4_PAWN|u][a-_],m.push([s-y[n]+y[a]+A,n,a])),g[n+=2]==T&&(A=S[i.P4_PAWN]+E[i.P4_PAWN|u][a-_],m.push([s-y[n]+y[a]+A,n,a]))}return m.concat(p)}static p4_check_castling(e,t,a,s,n){var o,r,h,l=a+i.P4_KNIGHT,c=i.P4_BISHOP|a,d=i.P4_ROOK|a,g=2|a;for(h=t;h<t+3;h++){o=h;do{r=e[o+=s]}while(!r);if((23&r)==d)return 0;o=h;var u=s-1;do{r=e[o+=u]}while(!r);if((27&r)==c)return 0;o=h,u+=2;do{r=e[o+=u]}while(!r);if((27&r)==c)return 0;if(e[h+s-2]==l||e[h+s+2]==l)return 0}for(h=t+s-1;h<t+s+4;h++)if((r=23&e[h])==g||e[h+s]==l)return 0;o=n<0?t+2:t;do{r=e[o-=n]}while(!r);return(23&r)==d?0:1}static p4_check_check(e,t){var a,s=e.board,n=e.pieces[t],o=n.length;do{a=n[--o]}while(a[0]!=(i.P4_KING|t));var r=a[1],h=1-t,l=10-20*t;if(s[r+l-1]==(i.P4_PAWN|h)||s[r+l+1]==(i.P4_PAWN|h))return!0;var c=i.P4_MOVES[i.P4_KNIGHT],d=i.P4_MOVES[i.P4_KING],g=i.P4_KNIGHT|h,u=i.P4_KING|h;for(o=0;o<8;o++)if(s[r+c[o]]==g||s[r+d[o]]==u)return!0;var _=i.P4_MOVES[i.P4_BISHOP],p=i.P4_MOVES[i.P4_ROOK],m=i.P4_BISHOP|h,f=i.P4_ROOK|h;for(o=0;o<4;o++){var v,S=_[o],E=r;do{v=s[E+=S]}while(!v);if((27&v)==m)return!0;S=p[o],E=r;do{v=s[E+=S]}while(!v);if((23&v)==f)return!0}return!1}static p4_optimise_piece_list(e){for(var t,a,s,n=[i.p4_parse(e,0,0,0),i.p4_parse(e,1,0,0)],o=(e.weights,e.board),r=0;r<2;r++){var h=e.values[r],l=e.pieces[r],c=n[r],d=n[1-r],g=[];for(t=0;t<l.length;t++)g[(a=l[t])[1]]={score:0,piece:a[0],pos:a[1],threatened:0};for(t=c.length-1;t>=0;t--){var u=(_=c[t])[0];if(s=_[1],!o[_[2]])(p=g[s]).score=Math.max(p.score,u)}for(t=d.length-1;t>=0;t--){var _,p;if(void 0!==(p=g[(_=d[t])[2]])){var m=o[_[1]],f=.01*(1+p.piece>3+m<4);p.threatened<f&&(p.threatened=f)}}var v=[];for(t=20;t<100;t++)void 0!==(a=g[t])&&(a.score+=a.threatened*h[a.piece],v.push(a));for(v.sort((function(e,t){return e.score-t.score})),t=0;t<v.length;t++)a=v[t],l[t]=[a.piece,a.pos]}}static p4_findmove(e,t,a,s){i.p4_prepare(e),i.p4_optimise_piece_list(e);e.board;2==arguments.length&&(a=e.to_play,s=e.enpassant);var n,o,r,h=i.p4_parse(e,a,s,0),l=i.P4_MIN_SCORE,c=0,d=0;if(t<=0){for(r=0;r<h.length;r++)n=h[r],h[r][0]>l&&(l=n[0],c=n[1],d=n[2]);return[c,d,l]}for(r=0;r<h.length;r++){var g=(n=h[r])[0],u=n[1],_=n[2];if(g>i.P4_WIN){i.log("XXX taking king! it should never come to this"),l=i.P4_KING_VALUE,c=u,d=_;break}(o=-e.treeclimber(e,t-1,1-a,g,u,_,i.P4_MIN_SCORE,-l))>l&&(l=o,c=u,d=_)}return l<-i.P4_WIN_NOW&&!i.p4_check_check(e,a)&&(l=e.stalemate_scores[a]),[c,d,l]}static p4_make_move(e,t,a,s){var n=e.board,o=n[t],r=n[a];n[a]=o,n[t]=0;var h,l,c,d=14&o,g=1&o,u=o,_=0,p=0,m=0;d==i.P4_PAWN?(60-a)*(60-a)>900?(s|=g,n[a]=s,u=s):1&(t^a)&&0==r?(p=n[c=a-10+20*g],n[c]=0):(t-a)*(t-a)==400&&(m=t+a>>1):d==i.P4_KING&&(t-a)*(t-a)==4&&(_=t-4+7*(t<a),h=t+a>>1,l=g+i.P4_ROOK,n[_]=0,n[h]=l);var f=e.castles;if(f){var v=0,S=2*g,E=70*g,y=t-E,P=a+E;25==y?v|=3<<S:21==y?v|=1<<S:28==y&&(v|=2<<S),91==P?v|=4>>S:98==P&&(v|=8>>S),e.castles&=~v}for(var M=e.pieces.concat(),C=M[g],b=e.pieces[g]=[],A=0;A<C.length;A++){(O=C[A])[0];var T=O[1];T!=t&&T!=_&&b.push(O)}if(b.push([u,a]),l&&b.push([l,h]),r||p){var w=M[1-g];b=e.pieces[1-g]=[];var I=p?c:a;for(A=0;A<w.length;A++){var O;(O=w[A])[1]!=I&&b.push(O)}}return{s:t,e:a,S:o,E:r,ep:m,castles:f,rs:_,re:h,rook:l,ep_position:c,ep_taken:p,pieces:M}}static p4_unmake_move(e,t){var i=e.board;t.ep_position&&(i[t.ep_position]=t.ep_taken),i[t.s]=t.S,i[t.e]=t.E,t.rs&&(i[t.rs]=t.rook,i[t.re]=0),e.pieces=t.pieces,e.castles=t.castles}static p4_insufficient_material(e){var t,a=!1,s=void 0,n=e.board;for(t=20;t<100;t++){var o=14&n[t];if(0!=o&&o!=i.P4_KING)if(o==i.P4_KNIGHT){if(a||void 0!==s)return!1;a=!0}else{if(o!=i.P4_BISHOP)return!1;var r=1&t^1&i.parseInt(t/10);if(a)return!1;if(void 0===s)s=r;else if(s!=r)return!1}}return!0}static p4_get_legal_moves(e,t,a){let s;s=t!=i.parseInt(t)?i.p4_destringify_point(t):t,null==a&&(a=i.P4_QUEEN);let n=e.to_play;i.p4_maybe_prepare(e);let o,r=i.p4_parse(e,n,e.enpassant,0),h=[];for(let t=0;t<r.length;t++)s==r[t][1]&&(o=i.p4_make_move(e,s,r[t][2],a),i.p4_check_check(e,n)||h.push(r[t][2]),i.p4_unmake_move(e,o));return h}static p4_move(e,t,a,s){var n=e.board,o=e.to_play,r=1-o;if(t!=i.parseInt(t))if(void 0===a){var h=i.p4_interpret_movestring(e,t);if(t=h[0],a=h[1],0==t)return{flags:i.P4_MOVE_ILLEGAL,ok:!1};s=h[2]}else t=i.p4_destringify_point(t),a=i.p4_destringify_point(a);void 0===s&&(s=i.P4_QUEEN);n[a];var l,c=n[t],d=!1;i.p4_maybe_prepare(e);var g=i.p4_parse(e,o,e.enpassant,0);for(l=0;l<g.length;l++)if(a==g[l][2]&&t==g[l][1]){d=!0;break}if(!d)return{flags:i.P4_MOVE_ILLEGAL,ok:!1};var u=i.p4_make_move(e,t,a,s);if(i.p4_check_check(e,o))return i.p4_unmake_move(e,u),i.log("in check",u),{flags:i.P4_MOVE_ILLEGAL,ok:!1,string:"in check!"};var _=i.P4_MOVE_FLAG_OK;e.enpassant=u.ep,e.history.push([t,a,s]),u.E||u.ep_position?(e.draw_timeout=0,_|=i.P4_MOVE_FLAG_CAPTURE):(14&c)==i.P4_PAWN?e.draw_timeout=0:e.draw_timeout++,u.rs&&(_|=t>a?i.P4_MOVE_FLAG_CASTLE_QUEEN:i.P4_MOVE_FLAG_CASTLE_KING);var p=i.p4_state2fen(e,!0),m=(e.position_counts[p]||0)+1;e.position_counts[p]=m,e.current_repetitions=m,(e.draw_timeout>100||m>=3||i.p4_insufficient_material(e))&&(_|=i.P4_MOVE_FLAG_DRAW),e.moveno++,e.to_play=r,i.p4_check_check(e,r)&&(_|=i.P4_MOVE_FLAG_CHECK);var f=!0,v=i.p4_parse(e,r,u.ep,0);for(l=0;l<v.length;l++){var S=v[l],E=i.p4_make_move(e,S[1],S[2],i.P4_QUEEN),y=i.p4_check_check(e,r);if(i.p4_unmake_move(e,E),!y){f=!1;break}}f&&(_|=i.P4_MOVE_FLAG_MATE);var P=i.p4_move2string(e,t,a,c,s,_,g);return i.log("successful move",t,a,P,_),e.prepared=!1,{flags:_,string:P,ok:!0}}static p4_move2string(e,t,a,s,n,o,r){var h,l,c,d,g=14&s,u=o&i.P4_MOVE_FLAG_CAPTURE;if(h=i.p4_stringify_point(t),l=i.p4_stringify_point(a),g==i.P4_PAWN)c=u?h.charAt(0)+"x"+l:l,(a>90||a<30)&&(void 0===n&&(n=i.P4_QUEEN),c+="="+i.P4_ENCODE_LUT.charAt(n));else if(g==i.P4_KING&&(t-a)*(t-a)==4)c=a<t?"O-O-O":"O-O";else{var _="",p="",m=i.P4_ENCODE_LUT.charAt(s),f=t%10,v=i.parseInt(t/10),S=[];for(d=0;d<r.length;d++){var E=r[d];a==E[2]&&t!=E[1]&&e.board[E[1]]==s&&S.push(E[1])}if(S.length){for(d=0;d<S.length;d++){var y=S[d],P=y%10,M=i.parseInt(y/10);P==f&&(_=h.charAt(1)),M==v&&(p=h.charAt(0))}""==_&&""==p&&(p=h.charAt(0))}c=m+p+_+(u?"x":"")+l}return o&i.P4_MOVE_FLAG_CHECK?o&i.P4_MOVE_FLAG_MATE?c+="#":c+="+":o&i.P4_MOVE_FLAG_MATE&&(c+=" stalemate"),c}static p4_jump_to_moveno(e,t){i.log("jumping to move",t),void 0===t||t>e.moveno?t=e.moveno:t<0&&(t=e.moveno+t);for(var a,s,n=i.p4_fen2state(e.beginning),o=0;n.moveno<t;){var r=e.history[o++];i.p4_move(n,r[0],r[1],r[2])}for(a in n){var h=n[a];if(a instanceof Array)for((s=e[a]).length=0,o=0;o<h.length;o++)s[o]=h[o];else e[a]=h}e.prepared=!1}static p4_state2fen(e,t){for(var a=e.board,s="",n=9;n>1;n--){for(var o=0,r=1;r<9;r++){var h=a[10*n+r];0==h?o++:(o&&(s+=o.toString()),s+="  PpRrNnBbKkQq".charAt(h),o=0)}o&&(s+=o),n>2&&(s+="/")}if(s+=" "+"wb".charAt(e.to_play)+" ",e.castles)for(var l=[2,"K",1,"Q",8,"k",4,"q"],c=0;c<8;c+=2)e.castles&l[c]&&(s+=l[c+1]);else s+="-";return 0!==e.enpassant?s+=" "+i.p4_stringify_point(e.enpassant):s+=" -",t?s:(s+=" "+e.draw_timeout+" ",s+=1+(e.moveno>>1))}static p4_stringify_point(e){var t=e%10,i=(e-t)/10-1;return" abcdefgh".charAt(t)+i}static p4_destringify_point(e){var t=i.parseInt(e.charAt(0),19)-9,a=i.parseInt(e.charAt(1))+1;if(a>=2&&a<10&&t>=1&&t<9)return 10*a+t}static p4_fen2state(e,t){void 0===t&&(t=i.p4_initialise_state());var a=t.board,s=e.split(" "),n=s[0],o=s[1],r=s[2],h=s[3],l=s[4],c=s[5];void 0===l&&(l=0);for(var d,g,u=90,_=1,p=0;p<n.length;p++)if("/"!=(g=n.charAt(p))){var m=i.P4_PIECE_LUT[g];if(m&&_<9)a[u+_]=m,_++;else for(var f=Math.min(_+i.parseInt(g),9);_<f;_++)a[u+_]=0}else if(_=1,(u-=10)<20)break;t.to_play="b"==o.toLowerCase()?1:0,t.castles=0;var v=a[25]==i.P4_KING,S=a[95]==i.P4_KING+1,E={k:8*(S&&a[98]==i.P4_ROOK+1),q:4*(S&&a[91]==i.P4_ROOK+1),K:2*(v&&a[28]==i.P4_ROOK),Q:1*(v&&a[21]==i.P4_ROOK)};for(d=0;d<r.length;d++){var y=E[g=r.charAt(d)];void 0!==y&&(t.castles|=y,0==y&&console.log("FEN claims castle state "+r+" but pieces are not in place for "+g))}if(t.enpassant="-"!=h?i.p4_destringify_point(h):0,t.draw_timeout=i.parseInt(l),void 0===c){var P,M=0,C=0;for(u=20;u<100;u+=10)for(_=1;_<9;_++)M+=!!(P=15&a[u+_]),_<8&&(C+=!a[u+_+1]!=!P),u<90&&(C+=!a[u+_+10]!=!P);c=Math.max(1,i.parseInt(1.3*(32-M)+1.5*(4-r.length)+(C-16)/5))}return t.moveno=2*(i.parseInt(c)-1)+t.to_play,t.history=[],t.beginning=e,t.prepared=!1,t.position_counts={},t.move=function(e,t,a){return i.p4_move(this,e,t,a)},t.findmove=function(e){return i.p4_findmove(this,e)},t.jump_to_moveno=function(e){return i.p4_jump_to_moveno(this,e)},t}static p4_initialise_state(){var e=i.p4_zero_array();i.P4_CENTRALISING_WEIGHTS=i.p4_zero_array(),i.P4_BASE_PAWN_WEIGHTS=i.p4_zero_array(),i.P4_KNIGHT_WEIGHTS=i.p4_zero_array();for(var t=0;t<120;t++){var a=i.parseInt(t/10),s=t%10,n=Math.abs(s-4.5),o=Math.abs(a-5.5);i.P4_CENTRALISING_WEIGHTS[t]=i.parseInt(6-Math.pow(1.5*(n*n+o*o),.6)),i.P4_KNIGHT_WEIGHTS[t]=i.parseInt((n<2)+1.5*(o<2)+(n<3)+(o<3))-2,i.P4_BASE_PAWN_WEIGHTS[t]=i.parseInt("000012347000".charAt(a)),(a>9||a<2||s<1||s>8)&&(e[t]=16)}var r=[];for(t=0;t<14;t++)r[t]=i.p4_zero_array();var h={board:e,weights:r,history:[],treeclimber:i.p4_alphabeta_treeclimber};return i.p4_random_seed(h,i.P4_DEBUG?1:Date.now()),h}static p4_new_game(){return i.p4_fen2state(i.P4_INITIAL_BOARD)}static p4_interpret_movestring(e,t){var a=[0,0],s=/^[a-h][1-8]$/,n=/^\s*([RNBQK]?[a-h]?[1-8]?)[ :x-]*([a-h][1-8]?)(=[RNBQ])?[!?+#e.p]*\s*$/.exec(t);if(null==n){if(!(n=/^\s*([O0o]-[O0o](-[O0o])?)\s*$/.exec(t)))return a;o=25+70*e.to_play,r=n[2]?o-2:o+2}var o,r,h,l=n[1],c=n[2],d=n[3];return""==l||null==l?(r=i.p4_destringify_point(c),o=i.p4_find_source_point(e,r,"P"+c.charAt(0))):/^[RNBQK]/.test(l)?(r=i.p4_destringify_point(c),o=i.p4_find_source_point(e,r,l)):s.test(l)&&s.test(c)?(o=i.p4_destringify_point(l),r=i.p4_destringify_point(c)):/^[a-h]$/.test(l)&&(r=i.p4_destringify_point(c),o=i.p4_find_source_point(e,r,"P"+l)),0==o?a:(d&&(h=i.P4_PIECE_LUT[d.charAt(1)]),[o,r,h])}static p4_find_source_point(e,t,a){var s,n,o,r,h=e.to_play,l=i.P4_PIECE_LUT[a.charAt(0)];for(l|=h,n=1;n<a.length;n++){var c=a.charAt(n);/[a-h]/.test(c)?r=a.charCodeAt(n)-96:/[1-8]/.test(c)&&(o=1+i.parseInt(c))}var d=[];i.p4_prepare(e);var g=i.p4_parse(e,h,e.enpassant,0);for(n=0;n<g.length;n++){var u=g[n];if(t==u[2]&&(s=u[1],!(e.board[s]!=l||void 0!==r&&r!=s%10||void 0!==o&&o!=i.parseInt(s/10)))){var _=i.p4_make_move(e,s,t,i.P4_QUEEN);i.p4_check_check(e,h)||d.push(s),i.p4_unmake_move(e,_)}}return i.log("finding",a,"that goes to",t,"got",d),0==d.length?0:(d.length>1&&i.log("Engine.p4_find_source_point seems to have failed",e,t,a,d),d[0])}static p4_random_seed(e,t){t&=4294967295,e.rng=i.P4_USE_TYPED_ARRAYS?new Uint32Array(4):[],e.rng[0]=4058668781,e.rng[1]=t,e.rng[2]=t,e.rng[3]=t;for(var a=0;a<20;a++)i.p4_random31(e)}static p4_random31(e){var t=e.rng,i=t[1],a=t[2],s=t[0]-(i<<27|i>>>5);return t[0]=i^(a<<17|a>>>15),t[1]=a+t[3]&4294967295,t[2]=t[3]+s&4294967295,t[3]=s+t[0]&4294967295,2147483647&t[3]}static p4_random_int(e,t){var a,s=t;s--,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16;do{a=i.p4_random31(e)&s}while(a>=t);return a}}i.PRINT_DEBUG_INFO=!1,i.P4_PAWN=2,i.P4_ROOK=4,i.P4_KNIGHT=6,i.P4_BISHOP=8,i.P4_QUEEN=12,i.P4_KING=10,i.P4_EDGE=16,i.P4_MOVES=[[],[],[],[],[1,10,-1,-10],[],[21,19,12,8,-21,-19,-12,-8],[],[11,9,-11,-9],[],[1,10,11,9,-1,-10,-11,-9],[],[1,10,11,9,-1,-10,-11,-9],[]],i.P4_VALUES=[0,0,20,20,100,100,60,60,61,61,8e3,8e3,180,180,0],i.P4_KING_VALUE=i.P4_VALUES[10],i.P4_WIN=i.P4_KING_VALUE>>1,i.P4_WIN_DECAY=300,i.P4_WIN_NOW=i.P4_KING_VALUE-250,i.P4_MAX_SCORE=9999,i.P4_MIN_SCORE=-i.P4_MAX_SCORE,i.P4_CENTRALISING_WEIGHTS=[],i.P4_BASE_PAWN_WEIGHTS=[],i.P4_KNIGHT_WEIGHTS=[],i.P4_DEBUG=0,i.P4_INITIAL_BOARD="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 1 1",i.P4_USE_TYPED_ARRAYS=void 0!==typeof Int32Array,i.P4_PIECE_LUT={P:2,p:3,R:4,r:5,N:6,n:7,B:8,b:9,K:10,k:11,Q:12,q:13},i.P4_ENCODE_LUT="  PPRRNNBBKKQQ",i.P4_ZEROS=[],i.P4_MOVE_FLAG_OK=1,i.P4_MOVE_FLAG_CHECK=2,i.P4_MOVE_FLAG_MATE=4,i.P4_MOVE_FLAG_CAPTURE=8,i.P4_MOVE_FLAG_CASTLE_KING=16,i.P4_MOVE_FLAG_CASTLE_QUEEN=32,i.P4_MOVE_FLAG_DRAW=64,i.P4_MOVE_ILLEGAL=0,i.P4_MOVE_MISSED_MATE=i.P4_MOVE_FLAG_CHECK|i.P4_MOVE_FLAG_MATE,i.P4_MOVE_CHECKMATE=i.P4_MOVE_FLAG_OK|i.P4_MOVE_FLAG_CHECK|i.P4_MOVE_FLAG_MATE,i.P4_MOVE_STALEMATE=i.P4_MOVE_FLAG_OK|i.P4_MOVE_FLAG_MATE,t.P4Engine=i},6512:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundController=void 0;const s=a(i(2260));class n extends s.default.GameObjects.Container{constructor(e){super(e),this.gameplayScene=e,this.buildComponents()}preUpdate(e,t){}buildComponents(){this.background=this.scene.add.tileSprite(0,0,640,1136,"background"),this.background.width=8192,this.add(this.background)}resize(e,t,i){this.background.setPosition(0,0),this.background.setScale(t/i/this.background.height),this.background.width=Math.max(this.background.width,e/i*4)}}t.BackgroundController=n},4191:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ForegroundController=void 0;const s=a(i(2260));class n extends s.default.GameObjects.Container{constructor(e){super(e),this.gameplayScene=e,this.buildComponents()}preUpdate(e,t){}buildComponents(){window.famobi.hasFeature("copyright")&&(this.famobiLogo=this.scene.add.image(0,0,"famobi-logo"),this.famobiLogo.setOrigin(1,1),this.famobiLogo.setScale(.4),this.famobiLogo.setAlpha(.5),this.add(this.famobiLogo))}resize(e,t,i){this.famobiLogo&&this.famobiLogo.setPosition(e/i/2-10,t/i/2-10)}}t.ForegroundController=n},3408:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GameDataManager=void 0;const s=i(9273),n=a(i(2260)),o=i(3441),r=i(7401),h=i(8394),l=i(953),c=i(1066),d=i(8813),g=i(8353),u=i(6099),_=i(9898),p=i(2728);t.GameDataManager=class{constructor(e){this.gameplayScene=e}resetGame(){this.gameplayActive=!1,this.gameFinished=!1,this.gameResult=g.GameResult.DRAW,this._gameTimer=0,this._score=0}startGameplay(){this.playerColor=this.playerColorMode===s.PlayerColorMode.RANDOM?n.default.Utils.Array.GetRandom([u.FigureColor.WHITE,u.FigureColor.BLACK]):this.playerColorMode===s.PlayerColorMode.WHITE?u.FigureColor.WHITE:u.FigureColor.BLACK,this.gameplayActive=!0,this.currentTurnColor=u.FigureColor.WHITE,this._gameTimer=0,this._saveSlotData&&(this.applySavedGameParams(this._saveSlotData),this._saveSlotData=void 0)}useSaveSlotForNextLoad(e){this._saveSlotData=e}clearSavedBoardState(){this._savedBoardState=void 0}applySavedGameParams(e){this._savedBoardState={beginning:e.beginning,history:e.history,moveno:e.moveno},this.gameMode=e.gameMode,this.playerColor=e.playerColor,this.playerColorMode=e.playerColorMode,this._gameTimer=e.duration,this.difficulty=e.difficulty,this.highlightMoves=e.highlightMoves,this.soundEnabled=e.enableSound,this.pvpViewMode=e.pvpViewMode,this.boardSkin=e.boardSkin,this.figuresSet=e.figuresSet,this._score=e.score}finishGameplay(e){this.gameplayActive=!1,this.gameFinished=!0,this.gameResult=e}exitGameplay(){this.gameplayActive=!1,this.gameFinished=!1,this.gameResult=g.GameResult.DRAW}saveGameParamsToStorage(){const e={soundEnabled:this.soundEnabled,pvpViewMode:this.pvpViewMode,playerColorMode:this.playerColorMode,difficulty:this.difficulty,highlightMoves:this.highlightMoves,boardSkin:this.boardSkin,figuresSet:this.figuresSet,score:this._score};window.famobi.localStorage.setItem(_.GameConfig.STORAGE_KEY,JSON.stringify(e))}loadSavedGameParams(){try{const e=window.famobi.localStorage.getItem(_.GameConfig.STORAGE_KEY),t=JSON.parse(e);t?(this.soundEnabled=t.soundEnabled,this.playerColorMode=t.playerColorMode,this.pvpViewMode=t.pvpViewMode,this.difficulty=t.difficulty,this.highlightMoves=t.highlightMoves,this.boardSkin=t.boardSkin,this.figuresSet=t.figuresSet):this.loadFallbackParams()}catch(e){this.loadFallbackParams()}}loadFallbackParams(){this.gameplayActive=!1,this.gameFinished=!1,this.gameResult=g.GameResult.DRAW,this.difficulty=d.Difficulty.MEDIUM,this.gameMode=o.GameMode.PLAYER_VS_PLAYER,this.playerColorMode=s.PlayerColorMode.WHITE,this.pvpViewMode=r.PVPViewMode.STRAIGHT,this.boardSkin=h.BoardSkin.SKIN_1,this.figuresSet=l.FiguresSkin.SET_1,this.highlightMoves=!0,this.soundEnabled=!0,this._gameTimer=0}update(e){this.gameplayActive&&!this.gameFinished&&(this._gameTimer+=e)}get gameplayActive(){return this._gameplayActive}set gameplayActive(e){this._gameplayActive=e}get difficulty(){return this._difficulty}set difficulty(e){this._difficulty=e,this.saveGameParamsToStorage()}get gameMode(){return this._gameMode}set gameMode(e){this._gameMode=e}get playerColorMode(){return this._playerColorMode}set playerColorMode(e){this._playerColorMode=e,this.saveGameParamsToStorage()}get highlightMoves(){return this._highlightMoves}set highlightMoves(e){this._highlightMoves=e,this.gameplayScene.events.emit(c.EventTypes.HIGHLIGHT_MOVES_TOGGLED,this.highlightMoves),this.saveGameParamsToStorage()}get soundEnabled(){return this._soundEnabled}set soundEnabled(e){this._soundEnabled=e,this.gameplayScene.sound.setMute(!e),this.saveGameParamsToStorage()}get pvpViewMode(){return this._pvpViewMode}set pvpViewMode(e){this._pvpViewMode=e,this.gameplayScene.events.emit(c.EventTypes.PVP_VIEW_MODE_CHANGED,this.pvpViewMode),this.saveGameParamsToStorage()}get boardSkin(){return this._boardSkin}set boardSkin(e){this._boardSkin=n.default.Math.Clamp(e,1,5),this.gameplayScene.events.emit(c.EventTypes.BOARD_SKIN_CHANGED,this.boardSkin),this.saveGameParamsToStorage()}get figuresSet(){return this._figuresSet}set figuresSet(e){this._figuresSet=n.default.Math.Clamp(e,1,5),this.gameplayScene.events.emit(c.EventTypes.FIGURES_SET_CHANGED,this.figuresSet),this.saveGameParamsToStorage()}get gameResult(){return this._gameResult}set gameResult(e){this._gameResult=e}get gameFinished(){return this._gameFinished}set gameFinished(e){this._gameFinished=e}get gameTimer(){return this._gameTimer}get playerColor(){return this._playerColor}set playerColor(e){this._playerColor=e}get currentTurnColor(){return this._currentTurnColor}set currentTurnColor(e){this._currentTurnColor=e}get savedBoardState(){return this._savedBoardState}get flipBoard(){return this.gameMode===o.GameMode.PLAYER_VS_CPU&&this.playerColor===u.FigureColor.BLACK}get score(){return this._score}set score(e){this._score=e,p.FamobiAPI.reportLiveScore(this._score)}}},6602:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverlayScreen=void 0;const s=a(i(2260)),n=i(9898);class o extends s.default.GameObjects.Container{constructor(e){super(e),this.gameplayScene=e,this.buildComponents()}preUpdate(e,t){}resize(e,t,i){this.overlay.setDisplaySize(e/i*1.1,t/i*1.1)}buildComponents(){this.overlay=this.scene.add.image(0,0,"white-square"),this.overlay.setOrigin(.5,.5),this.overlay.setDisplaySize(n.GameConfig._MAX_RENDERER_WIDTH,n.GameConfig._MAX_RENDERER_HEIGHT),this.add(this.overlay),this.overlay.alpha=0,this.overlay.visible=!1}transition(e){const{callback:t,inDuration:i=n.GameConfig.TRANSITION_SCREEN_DURATION.IN,outDuration:a=n.GameConfig.TRANSITION_SCREEN_DURATION.OUT,skipFadeIn:o=!1,color:r=n.GameConfig.TRANSITION_SCREEN_COLORS.DEFAULT}=e;this.overlay.visible=!0,this.overlay.alpha=0,this.overlay.tint=r,o&&(this.overlay.alpha=1),this.scene.tweens.getTweensOf(this.overlay).forEach((e=>this.scene.tweens.remove(e))),this.scene.tweens.add({targets:this.overlay,alpha:1,duration:o?0:i,ease:s.default.Math.Easing.Sine.Out,onComplete:()=>{t&&t(),this.scene.tweens.add({targets:this.overlay,alpha:0,duration:a,ease:s.default.Math.Easing.Sine.In,onComplete:()=>{this.overlay.visible=!1}})}})}}t.OverlayScreen=o},5420:function(e,t,i){var a=this&&this.__rest||function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScreensManager=void 0;const n=s(i(2260)),o=i(1183),r=i(7390);class h extends n.default.GameObjects.Container{constructor(e){super(e),this.gameplayScene=e,this.initScreens()}initScreens(){this.activeScreens=[]}start(){this.changeScreen(o.Screen_MainMenu)}restart(){this.gameplayScene.dataManager.resetGame(),this.transitionTo(o.Screen_MainMenu)}transitionTo(e,t={}){const{callback:i}=t,s=a(t,["callback"]);this.gameplayScene.overlayScreen.transition(Object.assign({callback:()=>{this.changeScreen(e),i&&i()}},s))}getActiveScreen(){return this.activeScreens[this.activeScreens.length-1]}getActiveScreens(){return this.activeScreens}findActiveScreen(e){return this.activeScreens.find((t=>t instanceof e))}getScreenFadeOppositeDirection(e){switch(e){case r.ScreenFadeDirection.UP:return r.ScreenFadeDirection.DOWN;case r.ScreenFadeDirection.DOWN:return r.ScreenFadeDirection.UP;case r.ScreenFadeDirection.LEFT:return r.ScreenFadeDirection.RIGHT;case r.ScreenFadeDirection.RIGHT:return r.ScreenFadeDirection.LEFT;default:return r.ScreenFadeDirection.UP}}showScreen(e,t){const i=new e(this,t);return this.add(i),i.show(),this.activeScreens.push(i),i}addScreen(e,t,i=!0,a=!1,s){t&&i&&this.moveAllOut(t,a);const n=this.showScreen(e,s);t&&n.animateMoveIn(t)}focusExistingScreen(e,t=r.ScreenFadeDirection.UP,i=!0,a=!0){t&&i&&this.getActiveScreens().filter((t=>!(t instanceof e))).forEach((e=>e.animateMoveOut(t,null!=a&&a)));const s=this.getActiveScreens().find((t=>t instanceof e));return s?(s.animateMoveIn(t),!0):(console.warn("Screen not exists: ",e),!1)}moveAllOut(e,t){this.getActiveScreens().forEach((i=>i.animateMoveOut(e,t)))}moveAllIn(e){this.getActiveScreens().forEach((t=>t.animateMoveIn(e)))}changeScreen(e,t){this.hideAll(),this.showScreen(e,t)}hideScreen(...e){e.forEach((e=>{for(let t=this.activeScreens.length-1;t>-1;t--){const i=this.activeScreens[t];i instanceof e&&(this.activeScreens.splice(t,1),i.hide(),i.destroy())}}))}hideScreenInstance(e){for(let t=this.activeScreens.length-1;t>-1;t--){const i=this.activeScreens[t];i===e&&(this.activeScreens.splice(t,1),i.hide(),i.destroy())}}hideAll(){for(let e=this.activeScreens.length-1;e>-1;e--){const t=this.activeScreens[e];this.activeScreens.splice(e,1),t.hide(),t.destroy()}}preUpdate(e,t){this.activeScreens.forEach((i=>i.preUpdate(e,t)))}resize(e,t,i){this.activeScreens.forEach((a=>a.doResize(e,t,i)))}}t.ScreensManager=h},2688:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UIController=void 0;const s=a(i(2260));class n extends s.default.GameObjects.Container{constructor(e){super(e),this.gameplayScene=e,this.buildComponents()}preUpdate(e,t){}buildComponents(){}resize(e,t,i){}}t.UIController=n},4573:function(e,t,i){var a=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))((function(s,n){function o(e){try{h(a.next(e))}catch(e){n(e)}}function r(e){try{h(a.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}h((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Board=void 0;const s=i(1066),n=i(3841),o=i(7686),r=i(8595),h=i(6447),l=i(6099),c=i(272),d=i(9898),g=i(3441),u=i(8353),_=i(5679);class p extends Phaser.GameObjects.Container{constructor(e){super(e.scene),this.drawPossible=!1,this.cpuDrawAskTimeout=0,this.screenGameplay=e,this.gameplayScene=this.screenGameplay.gameplayScene,this.boardBase=this.scene.add.image(0,0,"MainAtlas",`board-${this.gameplayScene.dataManager.boardSkin}`),this.add(this.boardBase),this.gridContainer=this.scene.add.container(1.5,-1.5),this.add(this.gridContainer),this.legalMoveMarksContainer=this.scene.add.container(this.gridContainer.x,this.gridContainer.y),this.add(this.legalMoveMarksContainer),this.buildCells(),this.addEventListeners()}getBoardState(){return this.boardState}isUndoAvailable(){return!!this.boardState&&(this.gameplayScene.dataManager.gameMode===g.GameMode.PLAYER_VS_CPU?this.boardState.moveno>=2&&this.gameplayScene.dataManager.currentTurnColor===this.gameplayScene.dataManager.playerColor:this.boardState.moveno>=1)}getCellAt(e,t){return this.cells[8*e+t]}getCellByIndex(e){return this.cells.find((t=>t.stateIndex===e))}getFigureAt(e,t){var i;return null===(i=this.getCellAt(e,t))||void 0===i?void 0:i.getFigure()}getBoardStateIndex(e,t){return 10*(9-t)+e+1}startNewGame(){this.boardState=o.P4Engine.p4_new_game(),this.postInitializeGame()}loadGame(e){this.boardState=o.P4Engine.p4_fen2state(e.beginning);for(let t=0;t<e.history.length;t++){const i=e.history[t];this.boardState.move(i[0],i[1],i[2])}this.postInitializeGame()}postInitializeGame(){this.gameplayScene.dataManager.flipBoard&&this.flipBoard(),this.updateLegalMovesHighlightAvailability(),this.buildFigures(),this.nextTurn()}flipBoard(){this.angle=180}nextTurn(){this.cancelSelection(),0===this.boardState.to_play?this.gameplayScene.dataManager.currentTurnColor=l.FigureColor.WHITE:this.gameplayScene.dataManager.currentTurnColor=l.FigureColor.BLACK,this.gameplayScene.dataManager.gameMode===g.GameMode.PLAYER_VS_CPU?(this.scene.events.emit(s.EventTypes.UNDO_FEATURE_AVAILABLE,this.gameplayScene.dataManager.currentTurnColor===this.gameplayScene.dataManager.playerColor),this.gameplayScene.dataManager.currentTurnColor===this.gameplayScene.dataManager.playerColor||this.makeCPUMove()):this.scene.events.emit(s.EventTypes.UNDO_FEATURE_AVAILABLE,!0),this.scene.events.emit(s.EventTypes.TURN_CHANGED,this.gameplayScene.dataManager.currentTurnColor)}makeCPUMove(){this.scene.events.emit(s.EventTypes.SHOW_AI_THINKING_ICON),this.scene.time.delayedCall(50,(()=>{const e=(new Date).getTime(),t=this.findCPUMove(),i=(new Date).getTime()-e;c.Utils.wait(Math.max(0,d.GameConfig.MIN_CPU_WAIT_TIME-i)).then((()=>{const e=this.getCellByIndex(t[0]),i=this.getCellByIndex(t[1]),a=null==e?void 0:e.getFigure();a&&i?this.performMove(a,i):(famobi.log("Something went wrong: AI couldn't find a move"),this.nextTurn()),this.scene.events.emit(s.EventTypes.HIDE_AI_THINKING_ICON)}))}))}findCPUMove(){return this.boardState.findmove(this.gameplayScene.dataManager.difficulty)}buildCells(){this.cells=[];for(let e=0;e<8;e++)for(let t=0;t<8;t++){const i=new n.Cell(this,e,t);this.gridContainer.add(i),this.cells.push(i)}}clearFigures(){for(let e=this.figures.length-1;e>-1;e--){this.figures.splice(e,1)[0].destroy()}}buildFigures(){this.figures||(this.figures=[]),this.clearFigures(),this.cells.forEach((e=>{const t=this.boardState.board[e.stateIndex];if(t===h.FigureType.EMPTY||t===h.FigureType.P4_EDGE)return;const i=this.scene.add.existing(new r.ChessFigure(this,t));this.gridContainer.add(i),this.figures.push(i),i.setBoardPosition(e.posX,e.posY)}))}addEventListeners(){this.scene.events.on(s.EventTypes.BOARD_SKIN_CHANGED,this.onBoardSkinChanged,this),this.scene.events.on(s.EventTypes.CELL_SELECTED,this.onCellSelected,this),this.scene.events.on(s.EventTypes.REQUEST_UNDO,this.onUndoRequested,this),this.scene.events.on(s.EventTypes.HIGHLIGHT_MOVES_TOGGLED,this.updateLegalMovesHighlightAvailability,this),this.scene.events.on(s.EventTypes.OFFER_DRAW,this.playerOffersDraw,this),this.scene.events.on(s.EventTypes.DRAW_OFFER_RESULT,this.handleDrawOfferResult,this)}removeEventListeners(){this.scene.events.off(s.EventTypes.BOARD_SKIN_CHANGED,this.onBoardSkinChanged,this),this.scene.events.off(s.EventTypes.CELL_SELECTED,this.onCellSelected,this),this.scene.events.off(s.EventTypes.REQUEST_UNDO,this.onUndoRequested,this),this.scene.events.off(s.EventTypes.HIGHLIGHT_MOVES_TOGGLED,this.updateLegalMovesHighlightAvailability,this),this.scene.events.off(s.EventTypes.OFFER_DRAW,this.playerOffersDraw,this),this.scene.events.off(s.EventTypes.DRAW_OFFER_RESULT,this.handleDrawOfferResult,this)}handleDrawOfferResult(e){e&&this.screenGameplay.finishGameplay(u.GameResult.DRAW)}updateLegalMovesHighlightAvailability(){this.legalMoveMarksContainer.visible=this.gameplayScene.dataManager.highlightMoves}onBoardSkinChanged(e){this.boardBase.setFrame(`board-${e}`)}onUndoRequested(){this.boardState&&(this.isUndoAvailable()?(this.gameplayScene.dataManager.gameMode===g.GameMode.PLAYER_VS_CPU?this.undoMoves(2):this.undoMoves(1),this.scene.events.emit(s.EventTypes.UNDO_FEATURE_AVAILABLE,this.isUndoAvailable())):console.warn("Undo is not available"))}undoMoves(e){e<1||e>this.boardState.moveno||(this.boardState.jump_to_moveno(this.boardState.moveno-e),this.recreateFigures(),this.nextTurn(),this.cancelSelection(),this.highlightLastMove(),this.scene.events.emit(s.EventTypes.UNDO_TO_MOVE_NUMBER,this.boardState.moveno))}onCellSelected(e,t,i){if(this.gameplayScene.dataManager.gameMode===g.GameMode.PLAYER_VS_CPU&&this.gameplayScene.dataManager.currentTurnColor!==this.gameplayScene.dataManager.playerColor)return;const a=this.getCellAt(e,t);if(!a)return;const s=this.getFigureAt(e,t);this.selectedFigure?this.selectedFigure===a.getFigure()?this.cancelSelection():s&&s.figureColor===this.gameplayScene.dataManager.currentTurnColor?this.selectCell(a):this.performMove(this.selectedFigure,a)||this.cancelSelection():s&&s.figureColor===this.gameplayScene.dataManager.currentTurnColor?this.selectCell(a):this.cancelSelection()}selectCell(e){if(!e)return;const t=e.getFigure();t?(this.selectedFigure=t,this.highlightSelectedCell(e),this.highlightLegalMoves(e)):this.cancelSelection()}highlightLegalMoves(e){const t=o.P4Engine.p4_get_legal_moves(this.boardState,e.stateIndex);t.length>0?this.cells.forEach((e=>{t.includes(e.stateIndex)?e.highlightLegalMove():e.resetLegalMoveHighlight()})):this.resetLegalMovesHighlights()}resetLegalMovesHighlights(){for(let e of this.cells)e.resetLegalMoveHighlight()}cancelSelection(){this.selectedFigure=void 0;for(let e of this.cells)e.resetSelection();this.resetLegalMovesHighlights()}resetHighlights(){for(let e of this.cells)e.resetHighlights()}highlightSelectedCell(e){for(let t of this.cells)t===e?t.highlightSelection():t.resetSelection()}highlightLastMove(){if(this.boardState.history.length>0){const e=this.boardState.history[this.boardState.history.length-1],t=this.getCellByIndex(e[0]),i=this.getCellByIndex(e[1]);t&&i&&this.highlightMove(t,i)}else this.resetHighlights()}performMove(e,t){var i,a;const n=null===(i=t.getFigure())||void 0===i?void 0:i.getType(),r=this.boardState.move(null===(a=e.getCell())||void 0===a?void 0:a.stateIndex,t.stateIndex);return!!r.ok&&(this.highlightLastMove(),this.resetLegalMovesHighlights(),this.animateMove(e,t).then((()=>{this.recreateFigures(),this.nextTurn()})).catch((e=>{famobi.log("Figure initial position invalid",e)})),r.flags&o.P4Engine.P4_MOVE_FLAG_DRAW&&this.gameplayScene.dataManager.gameMode===g.GameMode.PLAYER_VS_CPU&&this.gameplayScene.dataManager.currentTurnColor!==this.gameplayScene.dataManager.playerColor?(this.drawPossible=!0,this.cpuDrawAskTimeout<=0&&this.cpuOffersDraw()):this.drawPossible=!1,r.flags&o.P4Engine.P4_MOVE_FLAG_CAPTURE&&n&&this.scene.events.emit(s.EventTypes.FIGURE_CAPTURED,n,this.boardState.moveno),r.flags&o.P4Engine.P4_MOVE_FLAG_CASTLE_KING||(r.flags,o.P4Engine.P4_MOVE_FLAG_CASTLE_QUEEN),r.flags&o.P4Engine.P4_MOVE_FLAG_MATE&&this.scene.time.delayedCall(d.GameConfig.MATE_RESULTS_DELAY,(()=>{this.screenGameplay.finishGameplay(this.gameplayScene.dataManager.currentTurnColor===l.FigureColor.BLACK?u.GameResult.WHINE_WIN:u.GameResult.BLACK_WIN)})),!0)}cpuOffersDraw(){this.cpuDrawAskTimeout=d.GameConfig.CPU_DRAW_PROPOSITION_TIMEOUT,this.screenGameplay.screensManager.addScreen(_.Screen_OfferDraw,void 0,!1,!1)}playerOffersDraw(){this.gameplayScene.dataManager.gameMode===g.GameMode.PLAYER_VS_CPU?this.drawPossible?this.screenGameplay.finishGameplay(u.GameResult.DRAW):this.screenGameplay.screensManager.addScreen(_.Screen_OfferDraw,void 0,!1,!1,{proceedToResult:!0,immediateResult:!1}):this.screenGameplay.screensManager.addScreen(_.Screen_OfferDraw,void 0,!1,!1)}recreateFigures(){this.clearFigures(),this.buildFigures()}animateMove(e,t){return a(this,void 0,void 0,(function*(){const i=yield e.moveToPosition(t.posX,t.posY);return Promise.resolve(i)}))}highlightMove(e,t){this.cancelSelection(),this.resetHighlights(),e.highlightMoveStart(50),t.highlightMoveEnd(50)}printState(){let e=[];for(let t=0;t<12;t++){e[t]=[];for(let i=0;i<10;i++)e[t][i]=this.boardState.board[10*t+i]}console.table(e)}preUpdate(e,t){this.cpuDrawAskTimeout-=t/1e3}destroy(e){this.removeEventListeners(),super.destroy(e)}}t.Board=p},7564:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturedFigurePreview=void 0;const a=i(1066),s=i(9898),n=i(6099);class o extends Phaser.GameObjects.Image{constructor(e,t,i){super(e,0,0,"MainAtlas","set1_1"),this.gameplayScene=e,this.moveNumber=i,this.figureColor=t%2==1?n.FigureColor.BLACK:n.FigureColor.WHITE,this.setOrigin(.5,1),this.figureType=t,this.updateView(),this.addEventListeners()}getFigureType(){return this.figureType}updateView(){this.setFrame("set"+this.gameplayScene.dataManager.figuresSet+"_"+s.GameConfig.CHESS_FRAMES_MAP[this.figureType])}addEventListeners(){this.scene.events.on(a.EventTypes.FIGURES_SET_CHANGED,this.updateView,this)}removeEventListeners(){this.scene.events.off(a.EventTypes.FIGURES_SET_CHANGED,this.updateView,this)}destroy(e){this.removeEventListeners(),super.destroy(e)}}t.CapturedFigurePreview=o},3841:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Cell=void 0;const s=a(i(2260)),n=i(9898),o=i(1066);class r extends s.default.GameObjects.Container{constructor(e,t,i){super(e.gameplayScene),this._pointerDown=!1,this._pointerX=0,this._pointerY=0,this._highlighted=!1,this._highlightedMoveFrom=!1,this._highlightedMoveTo=!1,this._highlightedLegalMove=!1,this.board=e,this.posX=t,this.posY=i,this.stateIndex=this.board.getBoardStateIndex(this.posX,this.posY),this.setPosition((this.posX-3.5)*n.GameConfig.CELL_SIZE,(this.posY-3.5)*n.GameConfig.CELL_SIZE),this.inputCatcher=this.scene.add.image(0,0,"white-square"),this.add(this.inputCatcher),this.inputCatcher.setDisplaySize(~~n.GameConfig.CELL_SIZE,~~n.GameConfig.CELL_SIZE),this.inputCatcher.alpha=1e-4,this.activeFigureHighlighter=this.scene.add.image(0,0,"MainAtlas","cell-highlighter"),this.add(this.activeFigureHighlighter),this.activeFigureHighlighter.alpha=0,this.lastMoveFromIcon=this.scene.add.image(0,0,"MainAtlas","icon-last-move-from"),this.add(this.lastMoveFromIcon),this.lastMoveFromIcon.alpha=0,this.lastMoveToIcon=this.scene.add.image(0,0,"MainAtlas","icon-last-move-to"),this.add(this.lastMoveToIcon),this.lastMoveToIcon.alpha=0,this.legalMoveMark=this.scene.add.image(0,0,"MainAtlas","possible-move-mark"),this.board.legalMoveMarksContainer.add(this.legalMoveMark),this.legalMoveMark.setPosition(this.x,this.y),this.legalMoveMark.alpha=0,n.GameConfig.debug.board&&(this.debugText=this.scene.add.text(.375*-n.GameConfig.CELL_SIZE,.4*-n.GameConfig.CELL_SIZE,""+this.stateIndex,{fontFamily:n.GameConfig.FONTS.MAIN,fontSize:"16px",color:"#0e0e0e",align:"center"}),this.debugText.setOrigin(.5,.5),this.add(this.debugText)),this.addEventListeners()}setFigure(e){this.figure=e}getFigure(){return this.figure}addEventListeners(){this.inputCatcher.setInteractive().on(s.default.Input.Events.POINTER_DOWN,this.handlePointerDown,this).on(s.default.Input.Events.POINTER_UP,this.handlePointerUp,this)}removeEventListeners(){this.inputCatcher.off(s.default.Input.Events.POINTER_DOWN,this.handlePointerDown,this).off(s.default.Input.Events.POINTER_UP,this.handlePointerUp,this)}handlePointerDown(e){this._pointerDown=!0,this._pointerX=e.x,this._pointerY=e.y}handlePointerUp(e){this._pointerDown&&s.default.Math.Distance.Between(this._pointerX,this._pointerY,e.x,e.y)<=10&&this.dispatchCellClick(),this._pointerDown=!1}dispatchCellClick(){this.scene.events.emit(o.EventTypes.CELL_SELECTED,this.posX,this.posY,this)}highlightSelection(){this._highlighted||(this._highlighted=!0,this.scene.tweens.getTweensOf(this.activeFigureHighlighter).forEach((e=>e.destroy())),this.activeFigureHighlighter.scale=.9,this.scene.tweens.add({targets:this.activeFigureHighlighter,alpha:1,scale:1,duration:75,ease:s.default.Math.Easing.Sine.Out}))}resetSelection(){this._highlighted&&(this._highlighted=!1,this.scene.tweens.getTweensOf(this.activeFigureHighlighter).forEach((e=>e.destroy())),this.scene.tweens.add({targets:this.activeFigureHighlighter,alpha:0,scale:0,duration:50,ease:s.default.Math.Easing.Sine.Out}))}highlightLegalMove(){this._highlightedLegalMove||(this._highlightedLegalMove=!0,this.scene.tweens.getTweensOf(this.legalMoveMark).forEach((e=>e.destroy())),this.legalMoveMark.scale=1.333,this.scene.tweens.add({targets:this.legalMoveMark,alpha:1,scale:1,duration:75,ease:s.default.Math.Easing.Sine.Out}))}resetLegalMoveHighlight(){this._highlightedLegalMove&&(this._highlightedLegalMove=!1,this.scene.tweens.getTweensOf(this.legalMoveMark).forEach((e=>e.destroy())),this.scene.tweens.add({targets:this.legalMoveMark,alpha:0,scale:0,duration:10,ease:s.default.Math.Easing.Sine.Out}))}resetHighlights(){this._highlightedMoveFrom&&(this._highlightedMoveFrom=!1,this.scene.tweens.getTweensOf(this.lastMoveFromIcon).forEach((e=>e.destroy())),this.scene.tweens.add({targets:this.lastMoveFromIcon,alpha:0,scale:0,duration:10,ease:s.default.Math.Easing.Sine.Out})),this._highlightedMoveTo&&(this._highlightedMoveTo=!1,this.scene.tweens.getTweensOf(this.lastMoveToIcon).forEach((e=>e.destroy())),this.scene.tweens.add({targets:this.lastMoveToIcon,alpha:0,scale:0,duration:10,ease:s.default.Math.Easing.Sine.Out}))}highlightMoveStart(e){this._highlightedMoveFrom||(this._highlightedMoveFrom=!0,this.scene.tweens.getTweensOf(this.lastMoveFromIcon).forEach((e=>e.destroy())),this.lastMoveFromIcon.scale=1.15,this.scene.tweens.add({targets:this.lastMoveFromIcon,alpha:1,scale:1,duration:150,delay:e,ease:s.default.Math.Easing.Cubic.Out}))}highlightMoveEnd(e){this._highlightedMoveTo||(this._highlightedMoveTo=!0,this.scene.tweens.getTweensOf(this.lastMoveToIcon).forEach((e=>e.destroy())),this.lastMoveToIcon.scale=1.15,this.scene.tweens.add({targets:this.lastMoveToIcon,alpha:1,scale:1,duration:150,delay:e,ease:s.default.Math.Easing.Cubic.Out}))}printPosition(){return`[${this.posX}, ${this.posY}]/${this.stateIndex}`}destroy(e){this.removeEventListeners(),super.destroy(e)}}t.Cell=r},8595:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChessFigure=void 0;const a=i(6447),s=i(1066),n=i(9898),o=i(6099),r=i(7401),h=i(993);class l extends Phaser.GameObjects.Container{constructor(e,t){super(e.gameplayScene),this.board=e,this.gameplayScene=e.gameplayScene,this.figureColor=t%2==1?o.FigureColor.BLACK:o.FigureColor.WHITE,this.owner=this.figureColor===this.gameplayScene.dataManager.playerColor?h.Owner.PLAYER:h.Owner.OPPONENT,this.figureImage=this.scene.add.image(0,0,"MainAtlas","set1_1"),this.figureImage.setOrigin(.5,.5),this.add(this.figureImage),this.setType(t),this.addEventListeners()}setType(e){this.figureType=e,this.updateView()}getType(){return this.figureType}getCell(){return this.cell}setBoardPosition(e,t){this.posX=e,this.posY=t,this.cell=this.board.getCellAt(this.posX,this.posY),this.cell&&this.cell.setFigure(this),this.setPosition((this.posX-3.5)*n.GameConfig.CELL_SIZE,(this.posY-3.5)*n.GameConfig.CELL_SIZE)}moveToPosition(e,t,i=!0){return new Promise(((a,s)=>{var o;this.posX=e,this.posY=t;const r=this.board.getCellAt(this.posX,this.posY);null===(o=this.cell)||void 0===o||o.setFigure(void 0),this.cell=r,this.cell&&this.cell.setFigure(this),this.parentContainer.bringToTop(this),this.scene.sound.play("move");const h=(this.posX-3.5)*n.GameConfig.CELL_SIZE,l=(this.posY-3.5)*n.GameConfig.CELL_SIZE;i?this.scene.tweens.add({targets:this,x:h,y:l,duration:n.GameConfig.FIGURE_MOVEMENT_TWEEN_DURATION,ease:Phaser.Math.Easing.Expo.Out,onComplete:()=>{a(!0)}}):(this.setPosition(h,l),a(!0))}))}updateView(){this.figureImage.setFrame("set"+this.gameplayScene.dataManager.figuresSet+"_"+n.GameConfig.CHESS_FRAMES_MAP[this.figureType]),this.gameplayScene.dataManager.pvpViewMode===r.PVPViewMode.MIRRORED&&this.owner===h.Owner.OPPONENT?this.figureImage.setFlipY(!0):this.figureImage.setFlipY(!1),this.adjustImagePositionAndScale()}adjustImagePositionAndScale(){const e=this.figureType%2==1?this.figureType-1:this.figureType,t=this.gameplayScene.dataManager.figuresSet;this.figureImage.setScale(1,1),this.figureImage.setOrigin(.5,.5),this.figureImage.setPosition(0,0);let i=.95;switch(5===t&&(i=.875),e){case a.FigureType.P4_PAWN:break;case a.FigureType.P4_ROOK:this.figureImage.setScale(i);break;case a.FigureType.P4_KNIGHT:this.figureImage.setScale(i),4===t&&this.figureImage.setScale(.875);break;case a.FigureType.P4_BISHOP:this.figureImage.setScale(i),3===t?this.figureImage.scale*=.95:4===t&&this.figureImage.setScale(1);break;case a.FigureType.P4_QUEEN:this.figureImage.setScale(i),3===t&&(this.figureImage.scale*=.95,this.figureImage.y=-1);break;case a.FigureType.P4_KING:this.figureImage.setScale(i),3===t?(this.figureImage.scale*=.95,this.figureImage.y=-1):4===t&&(this.figureImage.scale*=.9,this.figureImage.y=-1)}3===t&&(this.figureImage.scaleX*=.875),this.gameplayScene.dataManager.flipBoard&&(this.figureImage.setAngle(-180),this.figureImage.y*=-1)}addEventListeners(){this.scene.events.on(s.EventTypes.FIGURES_SET_CHANGED,this.updateView,this),this.scene.events.on(s.EventTypes.PVP_VIEW_MODE_CHANGED,this.updateView,this)}removeEventListeners(){this.scene&&(this.scene.events.off(s.EventTypes.FIGURES_SET_CHANGED,this.updateView,this),this.scene.events.off(s.EventTypes.PVP_VIEW_MODE_CHANGED,this.updateView,this))}destroy(e){this.removeEventListeners(),this.cell&&this.cell.setFigure(void 0),this.cell=void 0,super.destroy(e)}}t.ChessFigure=l},4213:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Clock=void 0;const s=a(i(2260)),n=i(1066);class o extends s.default.GameObjects.Container{constructor(e){super(e),this.background=this.scene.add.image(0,0,"clock-background"),this.add(this.background),this.background.scale=1.5,this.circle=this.scene.add.image(0,0,"MainAtlas","clock-frame"),this.add(this.circle),this.hands=this.scene.add.image(-25,-25,"MainAtlas","clock-hands"),this.add(this.hands),this.visible=!1,this.addEventListeners()}addEventListeners(){this.scene.events.on(n.EventTypes.SHOW_AI_THINKING_ICON,this.show,this),this.scene.events.on(n.EventTypes.HIDE_AI_THINKING_ICON,this.hide,this)}removeEventListeners(){this.scene.events.off(n.EventTypes.SHOW_AI_THINKING_ICON,this.show,this),this.scene.events.off(n.EventTypes.HIDE_AI_THINKING_ICON,this.hide,this)}show(){this.visible=!0,this.alpha=0,this.scale=.9,this.scene.tweens.add({targets:this,alpha:1,scale:1,duration:50,onComplete:()=>{}})}hide(){this.scene.tweens.add({targets:this,alpha:0,scale:.9,duration:50,onComplete:()=>{this.visible=!1}})}destroy(e){this.removeEventListeners(),super.destroy(e)}}t.Clock=o},2899:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DrawOfferPanel=void 0;const a=i(5934),s=i(9898);class n extends Phaser.GameObjects.Container{constructor(e,t){super(e),this.gameplayScene=e,this.callback=t,this.contentContainer=this.scene.add.container(),this.add(this.contentContainer),this.panel=this.scene.add.image(0,0,"MainAtlas","panel-offer-draw"),this.contentContainer.add(this.panel),this.panel.setScale(1,1.075),this.flagIcon=this.scene.add.image(-2,-50,"MainAtlas","icon-flag"),this.flagIcon.setOrigin(1,.5),this.contentContainer.add(this.flagIcon),this.iconContainer=this.scene.add.container(),this.iconContainer.setPosition(2,-50),this.contentContainer.add(this.iconContainer),this.icon=this.scene.add.image(0,0,"MainAtlas","icon-player"),this.icon.setOrigin(0,.5),this.iconContainer.add(this.icon),this.digit=this.scene.add.text(this.icon.displayWidth+3,10,"1",{fontFamily:s.GameConfig.FONTS.MAIN,fontSize:"40px",color:"#472503",align:"center"}),this.digit.setOrigin(0,.5),this.iconContainer.add(this.digit),this.buttonConfirm=this.scene.add.existing(new a.BasicButton({scene:this.scene,x:-88,y:50,texture:"MainAtlas",frame:"button-yes",clickCallback:()=>this.confirmPressed()})),this.contentContainer.add(this.buttonConfirm),this.buttonDeny=this.scene.add.existing(new a.BasicButton({scene:this.scene,x:88,y:50,texture:"MainAtlas",frame:"button-no",clickCallback:()=>this.denyPressed()})),this.contentContainer.add(this.buttonDeny),this.visible=!1}show(e,t="",i=0){this.visible=!0,this.buttonConfirm.setEnabled(!0),this.buttonDeny.setEnabled(!0),this.icon.setFrame(e),t?(this.digit.visible=!0,this.digit.setText(t)):this.digit.visible=!1,this.scene.tweens.getTweensOf(this).forEach((e=>e.destroy())),this.y=-250,this.alpha=0,this.scene.tweens.add({targets:this,y:0,alpha:1,duration:200,delay:i,ease:Phaser.Math.Easing.Sine.Out,onComplete:()=>{}})}hide(){this.scene.tweens.getTweensOf(this).forEach((e=>e.destroy())),this.scene.tweens.add({targets:this,y:250,alpha:0,duration:125,ease:Phaser.Math.Easing.Cubic.Out,onComplete:()=>{this.visible=!1}})}confirmPressed(){this.buttonConfirm.setEnabled(!1),this.buttonDeny.setEnabled(!1),this.callback&&this.callback(!0),this.hide()}denyPressed(){this.buttonConfirm.setEnabled(!1),this.buttonDeny.setEnabled(!1),this.callback&&this.callback(!1),this.hide()}}t.DrawOfferPanel=n},7296:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DrawOfferResultPanel=void 0;const a=i(5934),s=i(9898);class n extends Phaser.GameObjects.Container{constructor(e,t){super(e),this.gameplayScene=e,this.callback=t,this.contentContainer=this.scene.add.container(),this.add(this.contentContainer),this.panel=this.scene.add.image(0,0,"MainAtlas","panel-offer-draw"),this.contentContainer.add(this.panel),this.panel.setScale(1,1.075),this.flagIcon=this.scene.add.image(-2,-50,"MainAtlas","icon-flag"),this.flagIcon.setOrigin(1,.5),this.contentContainer.add(this.flagIcon),this.iconContainer=this.scene.add.container(),this.iconContainer.setPosition(2,-50),this.contentContainer.add(this.iconContainer),this.icon=this.scene.add.image(0,0,"MainAtlas","icon-player"),this.icon.setOrigin(0,.5),this.iconContainer.add(this.icon),this.digit=this.scene.add.text(this.icon.displayWidth+3,10,"1",{fontFamily:s.GameConfig.FONTS.MAIN,fontSize:"40px",color:"#472503",align:"center"}),this.digit.setOrigin(0,.5),this.iconContainer.add(this.digit),this.buttonConfirm=this.scene.add.existing(new a.BasicButton({scene:this.scene,x:0,y:50,texture:"MainAtlas",frame:"button-yes",clickCallback:()=>this.confirmPressed()})),this.contentContainer.add(this.buttonConfirm),this.visible=!1}show(e,t="",i,a=175){this.visible=!0,this.buttonConfirm.setEnabled(!0),this.icon.setFrame(e),t?(this.digit.visible=!0,this.digit.setText(t)):this.digit.visible=!1,this.flagIcon.setFrame(i?"icon-flag":"icon-flag-denied"),this.scene.tweens.getTweensOf(this).forEach((e=>e.destroy())),this.y=-250,this.alpha=0,this.scene.tweens.add({targets:this,y:0,alpha:1,duration:200,delay:a,ease:Phaser.Math.Easing.Sine.Out,onComplete:()=>{}})}hide(){this.scene.tweens.getTweensOf(this).forEach((e=>e.destroy())),this.scene.tweens.add({targets:this,y:250,alpha:0,duration:125,ease:Phaser.Math.Easing.Cubic.Out,onComplete:()=>{this.visible=!1}})}confirmPressed(){this.buttonConfirm.setEnabled(!1),this.callback&&this.callback(!0),this.hide()}}t.DrawOfferResultPanel=n},61:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FiguresPad=void 0;const a=i(6099),s=i(993),n=i(5934),o=i(9060),r=i(3441),h=i(9898),l=i(7401),c=i(1066),d=i(7564),g=i(6447),u=i(7390);class _ extends Phaser.GameObjects.Container{constructor(e,t,i,a){super(e),this.viewMode="landscape",this.gameplayScene=e,this.gameMode=t,this.owner=i,this.ownerColor=a,this.figureScoreValues=new Map,this.figureScoreValues.set(g.FigureType.P4_PAWN,1),this.figureScoreValues.set(g.FigureType.P4_BISHOP,2),this.figureScoreValues.set(g.FigureType.P4_KNIGHT,2),this.figureScoreValues.set(g.FigureType.P4_ROOK,3),this.figureScoreValues.set(g.FigureType.P4_QUEEN,5),this.figureScoreValues.set(g.FigureType.P4_KING,10),this.pad=this.scene.add.image(0,0,"MainAtlas",`${this.owner}-figures-pad`),this.pad.setOrigin(.5,.475),this.add(this.pad),this.iconContainer=this.scene.add.container(),this.add(this.iconContainer),this.icon=this.scene.add.image(0,0,"MainAtlas","icon-player"),this.iconContainer.add(this.icon),t===r.GameMode.PLAYER_VS_PLAYER?(this.icon.x=-10,this.digit=this.scene.add.text(22,10,this.owner===s.Owner.PLAYER?"1":"2",{fontFamily:h.GameConfig.FONTS.MAIN,fontSize:"40px",color:"#472503",align:"center"}),this.digit.setOrigin(.5,.5),this.iconContainer.add(this.digit)):this.icon.setFrame(this.owner===s.Owner.PLAYER?"icon-player":"icon-cpu"),this.figuresContainer=this.scene.add.container(),this.add(this.figuresContainer),this.capturedFigures=[],i===s.Owner.OPPONENT?this.addSettingsButton():i===s.Owner.PLAYER&&this.addUndoButton(),this.updatePVPModeView(),this.addEventListeners()}addEventListeners(){this.scene.events.on(c.EventTypes.UNDO_FEATURE_AVAILABLE,this.onUndoEnabledStatusChanged,this),this.scene.events.on(c.EventTypes.PVP_VIEW_MODE_CHANGED,this.updatePVPModeView,this),this.scene.events.on(c.EventTypes.FIGURE_CAPTURED,this.onFigureCaptured,this),this.scene.events.on(c.EventTypes.UNDO_TO_MOVE_NUMBER,this.undoToMoveNumber,this),this.scene.events.on(c.EventTypes.TURN_CHANGED,this.onTurnChanged,this)}removeEventListeners(){this.scene.events.off(c.EventTypes.UNDO_FEATURE_AVAILABLE,this.onUndoEnabledStatusChanged,this),this.scene.events.off(c.EventTypes.PVP_VIEW_MODE_CHANGED,this.updatePVPModeView,this),this.scene.events.off(c.EventTypes.FIGURE_CAPTURED,this.onFigureCaptured,this),this.scene.events.off(c.EventTypes.UNDO_TO_MOVE_NUMBER,this.undoToMoveNumber,this),this.scene.events.off(c.EventTypes.TURN_CHANGED,this.onTurnChanged,this)}onTurnChanged(e){this.ownerColor===e?this.setPadActive(!0):this.setPadActive(!1)}setPadActive(e){this.pad.setFrame(e?`${s.Owner.PLAYER}-figures-pad`:`${s.Owner.OPPONENT}-figures-pad`)}undoToMoveNumber(e){for(let t=this.capturedFigures.length-1;t>-1;t--){const i=this.capturedFigures[t];i.moveNumber>e&&(this.capturedFigures.splice(t,1),i.destroy())}this.updateScore()}updateScore(){if(this.ownerColor!==this.gameplayScene.dataManager.playerColor){let e=0;this.capturedFigures.forEach((t=>{const i=t.getFigureType()%2==1?t.getFigureType()-1:t.getFigureType(),a=this.figureScoreValues.get(i)||0;e+=a})),this.gameplayScene.dataManager.score=e}}onUndoEnabledStatusChanged(e){this.buttonUndo&&this.buttonUndo.setEnabled(e)}onFigureCaptured(e,t){(e%2==1&&this.ownerColor===a.FigureColor.BLACK||e%2==0&&this.ownerColor===a.FigureColor.WHITE)&&this.addCapturedFigure(e,t)}addCapturedFigure(e,t){const i=this.scene.add.existing(new d.CapturedFigurePreview(this.gameplayScene,e,t));this.figuresContainer.add(i),this.capturedFigures.push(i),this.alignFigures(),this.updateScore()}alignFigures(){"portrait"===this.viewMode?this.alignCapturedFiguresPortrait():this.alignCapturedFiguresLandscape()}alignCapturedFiguresPortrait(){this.capturedFigures.forEach(((e,t)=>{const i=t%h.GameConfig.PLAYER_PAD_MAX_FIGURES_IN_A_ROW*h.GameConfig.PLAYER_PAD_CAPTURED_FIGURE_LAYOUT_PORTRAIT.GAP_X,a=(Math.floor(t/h.GameConfig.PLAYER_PAD_MAX_FIGURES_IN_A_ROW)-.5)*h.GameConfig.PLAYER_PAD_CAPTURED_FIGURE_LAYOUT_PORTRAIT.GAP_Y+35*h.GameConfig.PLAYER_PAD_CAPTURED_FIGURE_SCALE;e.setPosition(i,a),e.setScale(h.GameConfig.PLAYER_PAD_CAPTURED_FIGURE_SCALE)}))}alignCapturedFiguresLandscape(){this.capturedFigures.forEach(((e,t)=>{const i=(t%2-.5)*h.GameConfig.PLAYER_PAD_CAPTURED_FIGURE_LAYOUT_LANDSCAPE.GAP_X,a=Math.floor(t/2)*h.GameConfig.PLAYER_PAD_CAPTURED_FIGURE_LAYOUT_LANDSCAPE.GAP_Y+30*h.GameConfig.PLAYER_PAD_CAPTURED_FIGURE_SCALE;e.setPosition(i,a),e.setScale(h.GameConfig.PLAYER_PAD_CAPTURED_FIGURE_SCALE)}))}resizePortrait(e,t,i){this.viewMode="portrait",this.pad.angle=0,this.iconContainer.setPosition(-220,-2),this.figuresContainer.setPosition(-150,0),this.buttonSettings&&this.buttonSettings.setPosition(220,0),this.buttonUndo&&this.buttonUndo.setPosition(220,0),this.updatePVPModeView(),this.alignCapturedFiguresPortrait()}resizeLandscape(e,t,i){this.viewMode="landscape",this.pad.angle=90,this.iconContainer.setPosition(-3,-220),this.figuresContainer.setPosition(-7,-150),this.buttonSettings&&this.buttonSettings.setPosition(0,220),this.buttonUndo&&this.buttonUndo.setPosition(0,220),this.updatePVPModeView(),this.alignCapturedFiguresLandscape()}updatePVPModeView(){this.gameplayScene.dataManager.pvpViewMode===l.PVPViewMode.MIRRORED&&this.gameMode===r.GameMode.PLAYER_VS_PLAYER&&this.owner===s.Owner.OPPONENT?this.angle=180:this.angle=0}addSettingsButton(){this.buttonSettings=this.scene.add.existing(new n.BasicButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-settings-ingame",clickCallback:()=>this.onSettingsClicked()})),this.add(this.buttonSettings)}addUndoButton(){this.buttonUndo=this.scene.add.existing(new n.BasicButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-undo",clickCallback:()=>this.onUndoClicked()})),this.add(this.buttonUndo)}onUndoClicked(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:Gameplay:UndoMove"}),this.gameplayScene.events.emit(c.EventTypes.REQUEST_UNDO)}onSettingsClicked(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:Gameplay:Pause"}),window.famobi_analytics.trackEvent("EVENT_PAUSE").then((()=>{this.gameplayScene.screensManager.addScreen(o.Screen_Settings,u.ScreenFadeDirection.UP,!0)}))}destroy(e){this.removeEventListeners(),super.destroy(e)}}t.FiguresPad=_},6864:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SaveSlot=void 0;const s=a(i(2260)),n=i(9898),o=i(5934),r=i(272),h=i(3431);class l extends s.default.GameObjects.Container{constructor(e,t,i){super(e),this.gameplayScene=e,this.slotIndex=t,this.onSlotSelectedCallback=i,this.pad=this.scene.add.existing(new o.BasicButton({scene:this.gameplayScene,x:0,y:0,texture:"MainAtlas",frame:"savegame-selector",clickCallback:()=>this.onSlotSelected()})),this.pad.alpha=1e-4,this.add(this.pad),this.icon=this.scene.add.image(-205,0,"MainAtlas",Math.random()>.5?"icon-savegame-pvp":"icon-savegame-cpu"),this.add(this.icon),this.nameText=this.scene.add.text(65,0,"-no data-",{fontFamily:n.GameConfig.FONTS.MAIN,fontSize:"30px",color:"#472503",align:"center"}),this.nameText.setOrigin(.5,.5),this.add(this.nameText),this.loadDataFromStorage()}onSlotSelected(){this.onSlotSelectedCallback&&this.onSlotSelectedCallback(this.slotIndex)}hasSaveData(){return!!this.saveData}getSaveData(){return this.saveData}saveCurrentGame(e){const t=new h.SaveSlotData;t.timestamp=(new Date).getTime(),t.gameMode=this.gameplayScene.dataManager.gameMode,t.playerColor=this.gameplayScene.dataManager.playerColor,t.playerColorMode=this.gameplayScene.dataManager.playerColorMode,t.duration=this.gameplayScene.dataManager.gameTimer,t.difficulty=this.gameplayScene.dataManager.difficulty,t.highlightMoves=this.gameplayScene.dataManager.highlightMoves,t.enableSound=this.gameplayScene.dataManager.soundEnabled,t.pvpViewMode=this.gameplayScene.dataManager.pvpViewMode,t.boardSkin=this.gameplayScene.dataManager.boardSkin,t.figuresSet=this.gameplayScene.dataManager.figuresSet,t.score=this.gameplayScene.dataManager.score,t.beginning=e.beginning,t.history=e.history.slice(),t.moveno=e.moveno,this.saveData=t,window.famobi.localStorage.setItem(n.GameConfig.SAVESLOT_NAME+this.slotIndex,JSON.stringify(this.saveData)),this.updateView()}loadDataFromStorage(){const e=window.famobi.localStorage.getItem(n.GameConfig.SAVESLOT_NAME+this.slotIndex);try{const t=JSON.parse(e);this.saveData=t}catch(e){this.saveData=void 0}finally{this.updateView()}}updateView(){this.saveData?(this.nameText.setText(r.Utils.formatDate(this.saveData.timestamp)),this.icon.setFrame("icon-savegame-"+this.saveData.gameMode),this.setContentVisible(!0)):this.setContentVisible(!1)}setContentVisible(e){this.icon.alpha=e?1:0,this.nameText.alpha=e?1:0}destroy(e){super.destroy(e)}}t.SaveSlot=l},5724:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsPanel=void 0;const a=i(5934),s=i(7401),n=i(3441);class o extends Phaser.GameObjects.Container{constructor(e){super(e),this.gameplayScene=e,this.twoPlayersViewModeContainer=this.scene.add.container(),this.add(this.twoPlayersViewModeContainer),this.buttonModeMirrored=this.scene.add.existing(new a.BasicButton({scene:this.scene,x:-47,y:0,texture:"MainAtlas",frame:"two-players-mode-view-mirrored",clickCallback:()=>this.setTwoPlayersMode(s.PVPViewMode.MIRRORED)})),this.twoPlayersViewModeContainer.add(this.buttonModeMirrored),this.buttonModeStraight=this.scene.add.existing(new a.BasicButton({scene:this.scene,x:47,y:0,texture:"MainAtlas",frame:"two-players-mode-view-straight",clickCallback:()=>this.setTwoPlayersMode(s.PVPViewMode.STRAIGHT)})),this.twoPlayersViewModeContainer.add(this.buttonModeStraight),this.updateTwoPlayersView(),this.viewsContainer=this.scene.add.container(),this.add(this.viewsContainer),this.viewsContainer.setPosition(0,0),this.boardSkinContainer=this.scene.add.container(),this.viewsContainer.add(this.boardSkinContainer),this.boardIcon=this.scene.add.image(0,0,"MainAtlas","board-skin-preview-"+this.gameplayScene.dataManager.boardSkin),this.boardSkinContainer.add(this.boardIcon),this.arrowBoardSkinLeft=this.scene.add.existing(new a.BasicButton({scene:this.scene,x:-135,y:0,texture:"MainAtlas",frame:"arrow-left",clickCallback:()=>this.switchToPrevBoard()})),this.boardSkinContainer.add(this.arrowBoardSkinLeft),this.arrowBoardSkinRight=this.scene.add.existing(new a.BasicButton({scene:this.scene,x:135,y:0,texture:"MainAtlas",frame:"arrow-right",clickCallback:()=>this.switchToNextBoard()})),this.boardSkinContainer.add(this.arrowBoardSkinRight),this.updateBoardSkinView(),this.figuresSetContainer=this.scene.add.container(),this.viewsContainer.add(this.figuresSetContainer),this.figuresSetIcon=this.scene.add.image(0,0,"MainAtlas","icons-set-preview-"+this.gameplayScene.dataManager.figuresSet),this.figuresSetContainer.add(this.figuresSetIcon),this.arrowFiguresSetLeft=this.scene.add.existing(new a.BasicButton({scene:this.scene,x:-135,y:0,texture:"MainAtlas",frame:"arrow-left",clickCallback:()=>this.switchToPrevFiguresSet()})),this.figuresSetContainer.add(this.arrowFiguresSetLeft),this.arrowFiguresSetRight=this.scene.add.existing(new a.BasicButton({scene:this.scene,x:135,y:0,texture:"MainAtlas",frame:"arrow-right",clickCallback:()=>this.switchToNextFiguresSet()})),this.figuresSetContainer.add(this.arrowFiguresSetRight),this.updateFiguresSetView()}setTwoPlayersMode(e){this.gameplayScene.dataManager.pvpViewMode=e,this.updateTwoPlayersView()}updateTwoPlayersView(){this.gameplayScene.dataManager.pvpViewMode===s.PVPViewMode.MIRRORED?(this.buttonModeMirrored.setTransparent(!1),this.buttonModeStraight.setTransparent(!0)):(this.buttonModeMirrored.setTransparent(!0),this.buttonModeStraight.setTransparent(!1))}switchToPrevBoard(){this.gameplayScene.dataManager.boardSkin-=1,this.updateBoardSkinView()}switchToNextBoard(){this.gameplayScene.dataManager.boardSkin+=1,this.updateBoardSkinView()}updateBoardSkinView(){this.boardIcon.setFrame(`board-skin-preview-${this.gameplayScene.dataManager.boardSkin}`),this.arrowBoardSkinLeft.setEnabled(this.gameplayScene.dataManager.boardSkin>1),this.arrowBoardSkinRight.setEnabled(this.gameplayScene.dataManager.boardSkin<5)}switchToPrevFiguresSet(){this.gameplayScene.dataManager.figuresSet-=1,this.updateFiguresSetView()}switchToNextFiguresSet(){this.gameplayScene.dataManager.figuresSet+=1,this.updateFiguresSetView()}updateFiguresSetView(){this.figuresSetIcon.setFrame("icons-set-preview-"+this.gameplayScene.dataManager.figuresSet),this.arrowFiguresSetLeft.setEnabled(this.gameplayScene.dataManager.figuresSet>1),this.arrowFiguresSetRight.setEnabled(this.gameplayScene.dataManager.figuresSet<5)}resizePortrait(e,t,i){this.boardSkinContainer.setPosition(0,-75),this.figuresSetContainer.setPosition(0,75),this.gameplayScene.dataManager.gameMode===n.GameMode.PLAYER_VS_CPU?(this.twoPlayersViewModeContainer.visible=!1,this.viewsContainer.setPosition(0,45)):(this.twoPlayersViewModeContainer.visible=!0,this.twoPlayersViewModeContainer.setPosition(0,-110),this.viewsContainer.setPosition(0,110))}resizeLandscape(e,t,i){e/i<980?this.resizePortrait(e,t,i):(this.boardSkinContainer.setPosition(-190,0),this.figuresSetContainer.setPosition(190,0),this.gameplayScene.dataManager.gameMode===n.GameMode.PLAYER_VS_CPU?(this.twoPlayersViewModeContainer.visible=!1,this.viewsContainer.setPosition(0,0)):(this.twoPlayersViewModeContainer.visible=!0,this.twoPlayersViewModeContainer.setPosition(0,-75),this.viewsContainer.setPosition(0,75)))}}t.SettingsPanel=o},6593:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractGameScreen=void 0;const s=a(i(2260)),n=i(9898),o=i(7390);class r extends s.default.GameObjects.Container{constructor(e,t){super(e.gameplayScene),this.screensManager=e,this.gameplayScene=e.gameplayScene,this.config=t,this.build(),this.hide()}show(){this.setVisible(!0),this.doResize(this.scene.cameras.main.width,this.scene.cameras.main.height,this.scene.cameras.main.zoom),this.showComponents()}hide(){this.setVisible(!1),this.hideComponents()}animateMoveIn(e,t){switch(this.setVisible(!0),e){case o.ScreenFadeDirection.UP:this.x=0,this.y=this.scene.cameras.main.height/this.scene.cameras.main.zoom;break;case o.ScreenFadeDirection.DOWN:this.x=0,this.y=-this.scene.cameras.main.height/this.scene.cameras.main.zoom;break;case o.ScreenFadeDirection.LEFT:this.x=this.scene.cameras.main.width/this.scene.cameras.main.zoom,this.y=0;break;case o.ScreenFadeDirection.RIGHT:this.x=-this.scene.cameras.main.width/this.scene.cameras.main.zoom,this.y=0}this.scene.tweens.add({targets:this,x:0,y:0,duration:n.GameConfig.SCREEN_FADE_MOVEMENT_DURATION,ease:s.default.Math.Easing.Sine.Out,onComplete:()=>{t&&t()}})}animateMoveOut(e,t,i){let a={};switch(e){case o.ScreenFadeDirection.UP:a.y=-this.scene.cameras.main.height/this.scene.cameras.main.zoom;break;case o.ScreenFadeDirection.DOWN:a.y=this.scene.cameras.main.height/this.scene.cameras.main.zoom;break;case o.ScreenFadeDirection.LEFT:a.x=-this.scene.cameras.main.width/this.scene.cameras.main.zoom;break;case o.ScreenFadeDirection.RIGHT:a.x=this.scene.cameras.main.width/this.scene.cameras.main.zoom}this.scene.tweens.add(Object.assign(Object.assign({targets:this},a),{duration:n.GameConfig.SCREEN_FADE_MOVEMENT_DURATION,ease:s.default.Math.Easing.Sine.Out,onComplete:()=>{i&&i(),t?this.screensManager.hideScreenInstance(this):this.setVisible(!1)}}))}showComponents(){}hideComponents(){}doResize(e,t,i){e/t<=n.GameConfig.MAX_PORTRAIT_SCREEN_RATIO?this.resizePortrait(e,t,i):this.resizeLandscape(e,t,i)}resizeLandscape(e,t,i){this.resizePortrait(e,t,i)}makeResponsive(e,t){this.gameplayScene.makeResponsive(e,t)}destroy(e){super.destroy(e)}}t.AbstractGameScreen=r},59:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Screen_Gameplay=void 0;const a=i(6593),s=i(4573),n=i(9898),o=i(61),r=i(993),h=i(6099),l=i(8353),c=i(2589),d=i(4213),g=i(2728),u=i(3441);class _ extends a.AbstractGameScreen{constructor(e,t){super(e,Object.assign({screenName:"Gameplay"},t))}build(){this.boardContainer=this.scene.add.container(),this.add(this.boardContainer),this.makeResponsive(this.boardContainer,{x:0,y:0,landscape:{x:0,y:0}}),this.board=this.scene.add.existing(new s.Board(this)),this.boardContainer.add(this.board),this.thinkingClock=this.scene.add.existing(new d.Clock(this.gameplayScene)),this.boardContainer.add(this.thinkingClock),this.playerPad=this.scene.add.existing(new o.FiguresPad(this.gameplayScene,this.gameplayScene.dataManager.gameMode,r.Owner.PLAYER,h.FigureColor.WHITE)),this.boardContainer.add(this.playerPad),this.opponentsPad=this.scene.add.existing(new o.FiguresPad(this.gameplayScene,this.gameplayScene.dataManager.gameMode,r.Owner.OPPONENT,h.FigureColor.BLACK)),this.boardContainer.add(this.opponentsPad)}showComponents(){this.gameplayScene.dataManager.startGameplay(),this.startGame()}startGame(){this.gameplayScene.dataManager.savedBoardState?(this.board.loadGame(this.gameplayScene.dataManager.savedBoardState),this.gameplayScene.dataManager.clearSavedBoardState()):this.board.startNewGame(),window.famobi_analytics.trackEvent("EVENT_LEVELSTART",{levelName:this.gameplayScene.dataManager.gameMode===u.GameMode.PLAYER_VS_CPU?"PLAYER_VS_CPU":"PLAYER_VS_PLAYER"})}finishGameplay(e){const t=e===l.GameResult.DRAW?"draw":e===l.GameResult.WHINE_WIN?this.gameplayScene.dataManager.playerColor===h.FigureColor.WHITE?"success":"fail":this.gameplayScene.dataManager.playerColor===h.FigureColor.BLACK?"success":"fail";g.FamobiAPI.handleLevelEndEvent(t,100,(()=>{this.gameplayScene.dataManager.finishGameplay(e),this.screensManager.transitionTo(c.Screen_Results)}))}getBoard(){return this.board}resizePortrait(e,t,i){const a=t/i;this.boardContainer.setScale(1);const s=Phaser.Math.Clamp((a-n.GameConfig.BOARD_HEIGHT*this.boardContainer.scale)/4,n.GameConfig.PLAYER_PAD_MIN_GAP,n.GameConfig.PLAYER_PAD_MAX_GAP_PORTRAIT);this.playerPad.setPosition(0,n.GameConfig.BOARD_HEIGHT/2+s),this.playerPad.resizePortrait(e,t,i),this.opponentsPad.setPosition(0,-n.GameConfig.BOARD_HEIGHT/2-s),this.opponentsPad.resizePortrait(e,t,i)}resizeLandscape(e,t,i){const a=e/i,s=t/i,o=n.GameConfig.BOARD_HEIGHT+10,r=n.GameConfig.BOARD_WIDTH+2*n.GameConfig.PLAYER_PAD_WIDTH+40;this.boardContainer.setScale(Math.min(Math.max(1,s/o),a/r));const h=Phaser.Math.Clamp((a-n.GameConfig.BOARD_WIDTH*this.boardContainer.scale)/4,n.GameConfig.PLAYER_PAD_MIN_GAP,n.GameConfig.PLAYER_PAD_MAX_GAP_LANDSCAPE)/this.boardContainer.scale;this.playerPad.setPosition(-n.GameConfig.BOARD_WIDTH/2-h,0),this.playerPad.resizeLandscape(e,t,i),this.opponentsPad.setPosition(n.GameConfig.BOARD_WIDTH/2+h,0),this.opponentsPad.resizeLandscape(e,t,i)}preUpdate(e,t){}destroy(e){super.destroy(e)}}t.Screen_Gameplay=_},2704:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Screen_LevelConfig=void 0;const a=i(6593),s=i(5934),n=i(9273),o=i(1183),r=i(3441),h=i(59),l=i(7390);class c extends a.AbstractGameScreen{constructor(e,t){super(e,Object.assign({screenName:"LevelConfig"},t))}build(){this.centerContainer=this.scene.add.container(),this.add(this.centerContainer),this.makeResponsive(this.centerContainer,{x:0,y:-.05,scale:1.25,landscape:{x:0,y:-.05,scale:1.25}}),this.difficultyContainer=this.scene.add.container(),this.centerContainer.add(this.difficultyContainer),this.difficultyContainer.setPosition(0,-160),this.brainIcon=this.scene.add.image(0,0,"difficulty","brain_"+this.gameplayScene.dataManager.difficulty),this.difficultyContainer.add(this.brainIcon),this.brainIcon.setScale(.5),this.arrowLeft=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:-135,y:0,texture:"MainAtlas",frame:"arrow-left",clickCallback:()=>this.decreaseDifficulty()})),this.difficultyContainer.add(this.arrowLeft),this.arrowRight=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:135,y:0,texture:"MainAtlas",frame:"arrow-right",clickCallback:()=>this.increaseDifficulty()})),this.difficultyContainer.add(this.arrowRight),this.colorContainer=this.scene.add.container(),this.centerContainer.add(this.colorContainer),this.colorContainer.setPosition(0,0),this.spacerA=this.scene.add.image(0,-65,"MainAtlas","separatorH"),this.colorContainer.add(this.spacerA),this.buttonRandomColor=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:-95,y:0,texture:"MainAtlas",frame:"button-color-mode-"+n.PlayerColorMode.RANDOM,clickCallback:()=>this.selectColor(n.PlayerColorMode.RANDOM)})),this.colorContainer.add(this.buttonRandomColor),this.buttonWhiteColor=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-color-mode-"+n.PlayerColorMode.WHITE,clickCallback:()=>this.selectColor(n.PlayerColorMode.WHITE)})),this.colorContainer.add(this.buttonWhiteColor),this.buttonBlackColor=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:95,y:0,texture:"MainAtlas",frame:"button-color-mode-"+n.PlayerColorMode.BLACK,clickCallback:()=>this.selectColor(n.PlayerColorMode.BLACK)})),this.colorContainer.add(this.buttonBlackColor),this.spacerB=this.scene.add.image(0,65,"MainAtlas","separatorH"),this.colorContainer.add(this.spacerB),this.highlightMovesContainer=this.scene.add.container(),this.centerContainer.add(this.highlightMovesContainer),this.highlightMovesContainer.setPosition(0,130),this.buttonHighlightMoves=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:-80,y:0,texture:"MainAtlas",frame:"button-highlight-moves",clickCallback:()=>this.setHighlightMoves(!0)})),this.highlightMovesContainer.add(this.buttonHighlightMoves),this.buttonHideMoves=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:80,y:0,texture:"MainAtlas",frame:"button-hide-moves",clickCallback:()=>this.setHighlightMoves(!1)})),this.highlightMovesContainer.add(this.buttonHideMoves),this.bottomContainer=this.scene.add.container(),this.add(this.bottomContainer),this.makeResponsive(this.bottomContainer,{x:0,y:.25,dy:0,scale:1.25,landscape:{x:0,y:.35,dy:0,scale:1.25}}),this.buttonBack=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:-90,y:0,texture:"MainAtlas",frame:"button-back",clickCallback:()=>this.backPressed()})),this.bottomContainer.add(this.buttonBack),this.buttonNext=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:90,y:0,texture:"MainAtlas",frame:"button-play",clickCallback:()=>this.nextPressed()})),this.bottomContainer.add(this.buttonNext)}showComponents(){this.updateDifficultyView(),this.updateColorSelectorView(),this.updateHighlightMovesView()}decreaseDifficulty(){this.gameplayScene.dataManager.difficulty-=1,this.updateDifficultyView()}increaseDifficulty(){this.gameplayScene.dataManager.difficulty+=1,this.updateDifficultyView()}updateDifficultyView(){this.gameplayScene.dataManager.gameMode===r.GameMode.PLAYER_VS_CPU?(this.brainIcon.setFrame(`brain_${this.gameplayScene.dataManager.difficulty}`),this.arrowLeft.setEnabled(this.gameplayScene.dataManager.difficulty>1),this.arrowRight.setEnabled(this.gameplayScene.dataManager.difficulty<6)):(this.brainIcon.setAlpha(.5),this.arrowLeft.setEnabled(!1),this.arrowRight.setEnabled(!1))}selectColor(e){this.gameplayScene.dataManager.playerColorMode=e,this.updateColorSelectorView()}updateColorSelectorView(){if(this.gameplayScene.dataManager.gameMode===r.GameMode.PLAYER_VS_CPU)switch(this.gameplayScene.dataManager.playerColorMode){case n.PlayerColorMode.RANDOM:this.buttonRandomColor.setTransparent(!1),this.buttonWhiteColor.setTransparent(!0),this.buttonBlackColor.setTransparent(!0);break;case n.PlayerColorMode.WHITE:this.buttonRandomColor.setTransparent(!0),this.buttonWhiteColor.setTransparent(!1),this.buttonBlackColor.setTransparent(!0);break;case n.PlayerColorMode.BLACK:this.buttonRandomColor.setTransparent(!0),this.buttonWhiteColor.setTransparent(!0),this.buttonBlackColor.setTransparent(!1)}else this.spacerA.setAlpha(.5),this.buttonRandomColor.setEnabled(!1),this.buttonWhiteColor.setEnabled(!1),this.buttonBlackColor.setEnabled(!1),this.spacerB.setAlpha(.5)}setHighlightMoves(e){this.gameplayScene.dataManager.highlightMoves=e,this.updateHighlightMovesView()}updateHighlightMovesView(){this.buttonHighlightMoves.setTransparent(!this.gameplayScene.dataManager.highlightMoves),this.buttonHideMoves.setTransparent(this.gameplayScene.dataManager.highlightMoves)}backPressed(){this.gameplayScene.screensManager.addScreen(o.Screen_MainMenu,l.ScreenFadeDirection.DOWN,!0,!0)}nextPressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:LevelSelect:Play"}),window.famobi.showInterstitialAd({eventId:"Button:LevelSelect:Play",callback:()=>{this.screensManager.transitionTo(h.Screen_Gameplay)}})}resizePortrait(e,t,i){}preUpdate(e,t){}}t.Screen_LevelConfig=c},1183:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Screen_MainMenu=void 0;const a=i(6593),s=i(5934),n=i(3441),o=i(2704),r=i(9060),h=i(3422),l=i(7390);class c extends a.AbstractGameScreen{constructor(e,t){super(e,Object.assign({screenName:"MainMenu"},t))}build(){this.logo=this.scene.add.image(0,0,"MainAtlas","logo"),this.add(this.logo),this.makeResponsive(this.logo,{y:-.25,scale:1.25,landscape:{y:-.25,scale:1.25}}),this.buttonsContainer=this.scene.add.container(),this.add(this.buttonsContainer),this.makeResponsive(this.buttonsContainer,{x:0,y:.05,scale:1,landscape:{x:0,y:.1,scale:1.25}}),this.buttonSinglePlayer=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:0,y:-108,texture:"MainAtlas",frame:"button-1-player",clickCallback:()=>this.onSinglePlayerPressed()})),this.buttonsContainer.add(this.buttonSinglePlayer),this.buttonTwoPlayers=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-2-players",clickCallback:()=>this.onTwoPlayersPressed()})),this.buttonsContainer.add(this.buttonTwoPlayers),this.buttonLoad=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:-90,y:108,texture:"MainAtlas",frame:"button-load",clickCallback:()=>this.onLoadPressed()})),this.buttonsContainer.add(this.buttonLoad),this.buttonSettings=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:90,y:108,texture:"MainAtlas",frame:"button-settings",clickCallback:()=>this.onSettingsPressed()})),this.buttonsContainer.add(this.buttonSettings)}onSinglePlayerPressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:MainMenu:PlayVsComputer"}),this.gameplayScene.dataManager.gameMode=n.GameMode.PLAYER_VS_CPU,this.gameplayScene.screensManager.addScreen(o.Screen_LevelConfig,l.ScreenFadeDirection.UP,!0,!0)}onTwoPlayersPressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:MainMenu:PlayVsPlayer"}),this.gameplayScene.dataManager.gameMode=n.GameMode.PLAYER_VS_PLAYER,this.gameplayScene.screensManager.addScreen(o.Screen_LevelConfig,l.ScreenFadeDirection.UP,!0,!0)}onLoadPressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:MainMenu:SaveLoad"}),this.gameplayScene.screensManager.addScreen(h.Screen_SaveLoad,l.ScreenFadeDirection.RIGHT)}onSettingsPressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:MainMenu:Settings"}),this.gameplayScene.screensManager.addScreen(r.Screen_Settings,l.ScreenFadeDirection.LEFT)}resizePortrait(e,t,i){}preUpdate(e,t){}}t.Screen_MainMenu=c},5679:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Screen_OfferDraw=void 0;const a=i(6593),s=i(2899),n=i(3441),o=i(7296),r=i(1066);class h extends a.AbstractGameScreen{constructor(e,t){var i,a;super(e,Object.assign({screenName:"MenuSettings"},t)),this.drawAccepted=!1,this.proceedToResult=!1,this.immediateResult=!1,t&&(this.proceedToResult=null!==(i=t.proceedToResult)&&void 0!==i&&i,this.immediateResult=null!==(a=t.immediateResult)&&void 0!==a&&a)}build(){this.overlay=this.scene.add.image(0,0,"white-square"),this.overlay.tint=0,this.overlay.alpha=.5,this.add(this.overlay),this.overlay.setInteractive(),this.centerContainer=this.scene.add.container(),this.add(this.centerContainer),this.makeResponsive(this.centerContainer,{x:0,y:0,dy:0,scale:1,landscape:{x:0,y:0,dy:0,scale:1.25}}),this.drawOfferPanel=this.scene.add.existing(new s.DrawOfferPanel(this.gameplayScene,(e=>{this.handlePlayerAnswer(e)}))),this.centerContainer.add(this.drawOfferPanel),this.drawOfferResult=this.scene.add.existing(new o.DrawOfferResultPanel(this.gameplayScene,(()=>{this.closeWindow()}))),this.centerContainer.add(this.drawOfferResult)}showComponents(){if(this.scene.tweens.add({targets:this.overlay,alpha:.6,duration:200}),this.proceedToResult)this.handlePlayerAnswer(this.immediateResult);else if(this.gameplayScene.dataManager.gameMode===n.GameMode.PLAYER_VS_CPU){const e=this.gameplayScene.dataManager.currentTurnColor===this.gameplayScene.dataManager.playerColor?"icon-player":"icon-cpu";this.drawOfferPanel.show(e)}else{const e=this.gameplayScene.dataManager.currentTurnColor===this.gameplayScene.dataManager.playerColor?"1":"2";this.drawOfferPanel.show("icon-player",e)}}handlePlayerAnswer(e){if(window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:Draw:"+(e?"Accept":"Decline")}),this.drawAccepted=e,this.gameplayScene.dataManager.gameMode===n.GameMode.PLAYER_VS_CPU){const t=this.gameplayScene.dataManager.currentTurnColor===this.gameplayScene.dataManager.playerColor?"icon-player":"icon-cpu";this.drawOfferResult.show(t,"",e)}else{const t=this.gameplayScene.dataManager.currentTurnColor===this.gameplayScene.dataManager.playerColor?"2":"1";this.drawOfferResult.show("icon-player",t,e)}}closeWindow(){this.scene.tweens.add({targets:this.overlay,alpha:0,duration:125,onComplete:()=>{this.scene.events.emit(r.EventTypes.DRAW_OFFER_RESULT,this.drawAccepted),this.screensManager.hideScreenInstance(this)}})}resizePortrait(e,t,i){this.overlay.setDisplaySize(e/i*4,t/i*4)}preUpdate(e,t){}}t.Screen_OfferDraw=h},2589:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Screen_Results=void 0;const s=i(6593),n=i(5934),o=i(1183),r=a(i(2260)),h=i(9898),l=i(8353),c=i(272),d=i(3441),g=i(6099);class u extends s.AbstractGameScreen{constructor(e,t){super(e,Object.assign({screenName:"ResultsScreen"},t)),this.victory=!1}build(){let e,t;switch(this.centerContainer=this.scene.add.container(),this.add(this.centerContainer),this.makeResponsive(this.centerContainer,{x:0,y:-.05,dy:25,scale:1.25,landscape:{x:0,y:-.05,dy:25,scale:1.25}}),this.podium=this.scene.add.image(0,-50,"MainAtlas","results-podium"),this.centerContainer.add(this.podium),this.gameplayScene.dataManager.gameResult){case l.GameResult.WHINE_WIN:this.gameplayScene.dataManager.playerColor===g.FigureColor.WHITE&&(this.victory=!0),e={x:45,y:-130},t={x:-54,y:-94};break;case l.GameResult.BLACK_WIN:this.gameplayScene.dataManager.playerColor===g.FigureColor.BLACK&&(this.victory=!0),e={x:-54,y:-94},t={x:45,y:-130};break;case l.GameResult.DRAW:e={x:10,y:-130},t={x:80,y:-130}}this.whiteKing=this.scene.add.image(e.x,e.y,"MainAtlas",`set${this.gameplayScene.dataManager.figuresSet}_9`),this.centerContainer.add(this.whiteKing),this.blackKing=this.scene.add.image(t.x,t.y,"MainAtlas",`set${this.gameplayScene.dataManager.figuresSet}_10`),this.centerContainer.add(this.blackKing),this.clockIcon=this.scene.add.image(0,60,"MainAtlas","icon-results-clock"),this.centerContainer.add(this.clockIcon),this.matchDurationText=this.scene.add.text(0,120,c.Utils.humanizeTime(this.gameplayScene.dataManager.gameTimer),{fontFamily:h.GameConfig.FONTS.CALIBRI_GDI,fontSize:"50px",color:"#d2bb87",align:"center"}),this.matchDurationText.setOrigin(.5,.5),this.centerContainer.add(this.matchDurationText),this.bottomContainer=this.scene.add.container(),this.add(this.bottomContainer),this.makeResponsive(this.bottomContainer,{x:0,y:.4,dy:0,scale:1.25,landscape:{x:0,y:.4,dy:0,scale:1.25}}),this.buttonHome=this.scene.add.existing(new n.BasicButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-home",clickCallback:()=>this.homePressed()})),this.bottomContainer.add(this.buttonHome),this.buttonHome.visible=!1}showComponents(){setTimeout((()=>{let e=[];e=this.victory?[window.famobi_analytics.trackEvent("EVENT_LEVELSUCCESS",{levelName:this.gameplayScene.dataManager.gameMode===d.GameMode.PLAYER_VS_CPU?"PLAYER_VS_CPU":"PLAYER_VS_PLAYER"}),window.famobi_analytics.trackEvent("EVENT_LEVELSCORE",{levelName:this.gameplayScene.dataManager.gameMode===d.GameMode.PLAYER_VS_CPU?"PLAYER_VS_CPU":"PLAYER_VS_PLAYER",levelScore:this.gameplayScene.dataManager.score})]:[window.famobi_analytics.trackEvent("EVENT_LEVELFAIL",{levelName:this.gameplayScene.dataManager.gameMode===d.GameMode.PLAYER_VS_CPU?"PLAYER_VS_CPU":"PLAYER_VS_PLAYER",reason:"dead"}),window.famobi_analytics.trackEvent("EVENT_LEVELSCORE",{levelName:this.gameplayScene.dataManager.gameMode===d.GameMode.PLAYER_VS_CPU?"PLAYER_VS_CPU":"PLAYER_VS_PLAYER",levelScore:this.gameplayScene.dataManager.score})],Promise.all([...e]).then((()=>this.showButtons(400)),(()=>this.showButtons(400)))}),450)}showButtons(e){this.scene&&this.scene.time.delayedCall(e,(()=>{this.buttonHome.visible=!0,this.buttonHome.alpha=0,this.buttonHome.y=40,this.scene.tweens.add({targets:this.buttonHome,y:"-=40",alpha:1,duration:300,ease:r.default.Math.Easing.Sine.Out})}))}homePressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:Results:Quit"}),window.famobi.showInterstitialAd({eventId:"Button:Results:Quit",callback:()=>{this.screensManager.transitionTo(o.Screen_MainMenu)}})}resizePortrait(e,t,i){}resizeLandscape(e,t,i){}preUpdate(e,t){}}t.Screen_Results=u},3422:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Screen_SaveLoad=void 0;const a=i(6593),s=i(5934),n=i(1183),o=i(59),r=i(6864),h=i(9898),l=i(7390),c=i(9060);class d extends a.AbstractGameScreen{constructor(e,t){super(e,Object.assign({screenName:"SaveLoadScreen"},t)),this.selectedSlotIndex=-1}build(){this.contentContainer=this.scene.add.container(),this.add(this.contentContainer),this.makeResponsive(this.contentContainer,{x:0,y:0}),this.panel=this.scene.add.image(0,0,"MainAtlas","savegame-panel"),this.contentContainer.add(this.panel),this.slotsContainer=this.scene.add.container(),this.contentContainer.add(this.slotsContainer),this.slotsContainer.setPosition(0,-234),this.activeSlotHighlighter=this.scene.add.image(-3,0,"MainAtlas","savegame-selector"),this.slotsContainer.add(this.activeSlotHighlighter),this.activeSlotHighlighter.alpha=0,this.slots=[];for(let e=0;e<h.GameConfig.TOTAL_SAVESLOTS;e++){const t=this.scene.add.existing(new r.SaveSlot(this.gameplayScene,e,(e=>{this.highlightSlot(e)})));this.slotsContainer.add(t),this.slots.push(t),t.setPosition(0,e*h.GameConfig.SAVESLOT_PANEL_HEIGHT)}this.buttonsContainer=this.scene.add.container(),this.contentContainer.add(this.buttonsContainer),this.buttonsContainer.setPosition(0,215),this.buttonSave=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:-172,y:0,texture:"MainAtlas",frame:"button-save",clickCallback:()=>this.savePressed()})),this.buttonsContainer.add(this.buttonSave),this.buttonLoad=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-load",clickCallback:()=>this.loadPressed()})),this.buttonsContainer.add(this.buttonLoad),this.buttonBack=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:172,y:0,texture:"MainAtlas",frame:"button-back",clickCallback:()=>this.backPressed()})),this.buttonsContainer.add(this.buttonBack)}showComponents(){this.buttonLoad.setEnabled(!1),this.gameplayScene.dataManager.gameplayActive?this.buttonSave.setEnabled(!0):this.buttonSave.setEnabled(!1)}highlightSlot(e){var t;this.slots[e]?(this.selectedSlotIndex=e,this.updateActiveSlotHighlighter(),this.buttonLoad.setEnabled(!!(null===(t=this.getCurrentSlot())||void 0===t?void 0:t.hasSaveData()))):this.selectedSlotIndex=-1}updateActiveSlotHighlighter(){this.selectedSlotIndex>=0?(this.activeSlotHighlighter.alpha=1,this.activeSlotHighlighter.y=this.selectedSlotIndex*h.GameConfig.SAVESLOT_PANEL_HEIGHT):this.activeSlotHighlighter.alpha=0}getCurrentSlot(){return this.slots[this.selectedSlotIndex]}savePressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:LoadSave:SaveGame"});const e=this.getCurrentSlot();if(!e)return famobi.log("no slot selected!");const t=this.gameplayScene.screensManager.findActiveScreen(o.Screen_Gameplay);t?(e.saveCurrentGame(t.getBoard().getBoardState()),this.highlightSlot(this.selectedSlotIndex)):console.log("no active game")}loadPressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:LoadSave:LoadGame"});const e=this.getCurrentSlot();if(!(null==e?void 0:e.hasSaveData()))return;const t=null==e?void 0:e.getSaveData();t&&(this.gameplayScene.dataManager.useSaveSlotForNextLoad(t),this.screensManager.transitionTo(o.Screen_Gameplay))}backPressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:LoadSave:Back"}),this.gameplayScene.dataManager.gameplayActive?this.screensManager.focusExistingScreen(c.Screen_Settings,l.ScreenFadeDirection.RIGHT)||this.screensManager.addScreen(c.Screen_Settings,l.ScreenFadeDirection.RIGHT,!0,!0):this.screensManager.focusExistingScreen(n.Screen_MainMenu,l.ScreenFadeDirection.LEFT)||this.screensManager.addScreen(n.Screen_MainMenu,l.ScreenFadeDirection.LEFT,!0,!0)}resizePortrait(e,t,i){this.contentContainer.setScale(Math.min(e/i/640,t/i/750))}resizeLandscape(e,t,i){this.contentContainer.setScale(Math.min(e/i/640,t/i/750))}preUpdate(e,t){}}t.Screen_SaveLoad=d},9060:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Screen_Settings=void 0;const a=i(6593),s=i(5934),n=i(1183),o=i(8727),r=i(5724),h=i(3422),l=i(7390),c=i(59),d=i(1066),g=i(3441);class u extends a.AbstractGameScreen{constructor(e,t){super(e,Object.assign({screenName:"MenuSettings"},t))}build(){this.banner=this.scene.add.image(0,0,"famobi-banner"),this.add(this.banner),this.makeResponsive(this.banner,{x:0,y:-.475,dy:80,scale:.5,landscape:{x:0,y:-.475,dy:65,scale:.5}}),this.banner.setInteractive().on(Phaser.Input.Events.POINTER_DOWN,(()=>{window.famobi.openBrandingLink()})),this.topContainer=this.scene.add.container(),this.add(this.topContainer),this.makeResponsive(this.topContainer,{x:0,y:-.275,dy:75,scale:1.25,landscape:{x:0,y:-.3,dy:75,scale:1.25}}),this.buttonSurrender=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-surrender",clickCallback:()=>this.onSurrenderPressed()})),this.topContainer.add(this.buttonSurrender),this.makeResponsive(this.buttonSurrender,{dx:-160,dy:0,landscape:{dx:-160,dy:0}}),this.buttonSound=this.scene.add.existing(new o.ToggleButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-sound-on",frameOff:"button-sound-off",toggleState:this.gameplayScene.dataManager.soundEnabled,clickCallback:()=>this.handleSoundStateChanged(this.buttonSound.getToggleState())})),this.topContainer.add(this.buttonSound),this.makeResponsive(this.buttonSound,{dx:0,dy:0,landscape:{dx:0,dy:0}}),window.famobi.hasFeature("external_mute")&&(this.buttonSound.visible=!1),this.buttonSave=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:0,y:90,texture:"MainAtlas",frame:"button-load",clickCallback:()=>this.onSavePressed()})),this.topContainer.add(this.buttonSave),this.makeResponsive(this.buttonSave,{dx:160,dy:0,landscape:{dx:160,dy:0}}),this.centerContainer=this.scene.add.container(),this.add(this.centerContainer),this.makeResponsive(this.centerContainer,{x:0,y:-.05,dy:120,scale:1,landscape:{x:0,y:-.15,dy:160,scale:1.25}}),this.settingsPanel=this.scene.add.existing(new r.SettingsPanel(this.gameplayScene)),this.centerContainer.add(this.settingsPanel),this.bottomContainer=this.scene.add.container(),this.add(this.bottomContainer),this.makeResponsive(this.bottomContainer,{x:0,y:.4,dy:0,scale:1.25,landscape:{x:0,y:.4,dy:0,scale:1.25}}),this.buttonBack=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-back",clickCallback:()=>this.backPressed()})),this.bottomContainer.add(this.buttonBack),this.buttonHome=this.scene.add.existing(new s.BasicButton({scene:this.scene,x:0,y:0,texture:"MainAtlas",frame:"button-home",clickCallback:()=>this.homePressed()})),this.bottomContainer.add(this.buttonHome),this.updateComponentsVisibility()}showComponents(){}handleSoundStateChanged(e){this.gameplayScene.dataManager.soundEnabled=e}onSurrenderPressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:Pause:OfferDraw"}),this.gameplayScene.screensManager.focusExistingScreen(c.Screen_Gameplay,l.ScreenFadeDirection.UP,!0,!0),this.scene.events.emit(d.EventTypes.OFFER_DRAW)}onSavePressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:Pause:SaveGame"}),this.gameplayScene.screensManager.addScreen(h.Screen_SaveLoad,l.ScreenFadeDirection.LEFT,!0)}backPressed(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:Pause:Back"}),window.famobi_analytics.trackEvent("EVENT_RESUME").then((()=>{this.gameplayScene.dataManager.gameplayActive?this.screensManager.focusExistingScreen(c.Screen_Gameplay,l.ScreenFadeDirection.DOWN)||this.screensManager.addScreen(c.Screen_Gameplay,l.ScreenFadeDirection.DOWN,!0,!0):this.screensManager.focusExistingScreen(n.Screen_MainMenu,l.ScreenFadeDirection.RIGHT)||this.screensManager.addScreen(n.Screen_MainMenu,l.ScreenFadeDirection.RIGHT,!0,!0)}))}homePressed(){window.famobi_analytics.trackEvent("EVENT_LEVELFAIL",{levelName:this.gameplayScene.dataManager.gameMode===g.GameMode.PLAYER_VS_CPU?"PLAYER_VS_CPU":"PLAYER_VS_PLAYER",reason:"dead"}).then((()=>{window.famobi_analytics.trackEvent("EVENT_CUSTOM",{eventName:"GA:Design",eventId:"Button:Pause:Quit"}),window.famobi.showInterstitialAd({eventId:"Button:Pause:Quit",callback:()=>{this.gameplayScene.dataManager.exitGameplay(),this.screensManager.transitionTo(n.Screen_MainMenu)}})}))}resizePortrait(e,t,i){this.updateComponentsVisibility(),this.settingsPanel.resizePortrait(e,t,i),this.gameplayScene.dataManager.gameplayActive||(this.centerContainer.y-=75)}resizeLandscape(e,t,i){this.updateComponentsVisibility(),this.settingsPanel.resizeLandscape(e,t,i)}updateComponentsVisibility(){this.gameplayScene.dataManager.gameplayActive?(this.buttonHome.visible=!0,this.buttonBack.setPosition(-160,0),this.buttonHome.setPosition(160,0),this.buttonSurrender.visible=!0,this.buttonSave.visible=!0):(this.buttonSurrender.visible=!1,this.buttonSave.visible=!1,this.buttonHome.visible=!1,this.buttonBack.setPosition(0,0))}preUpdate(e,t){}}t.Screen_Settings=u},8891:function(e,t,i){var a=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))((function(s,n){function o(e){try{h(a.next(e))}catch(e){n(e)}}function r(e){try{h(a.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}h((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LocalizationManager=void 0;const s=i(9898);class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}constructor(){this.activeLocale="en-US"}loadLocalizationFile(e){return a(this,void 0,void 0,(function*(){console.log("loading localizations...");const t=yield fetch(e).then((e=>e.json()));this.init(t)}))}setLocale(e){this.activeLocale=this.findAvailableLocale(e),this.activeTranslationData=this.translations.get(this.activeLocale)}getText(e){return s.GameConfig.ENABLE_LOCALIZATION?this.activeTranslationData?this.activeTranslationData[e]?this.activeTranslationData[e]:(console.warn('LocalizationManager.getText: no translation for key "'+e+'"'),"---"+e):(console.warn("LocalizationManager.getText: localization data not loaded yet"),e):(console.error("Set GameConfig.ENABLE_LOCALIZATION to true before using localized texts!"),e)}getLocalesData(){return Array.from(this.translations.entries())}getActiveLocale(){return this.activeLocale}init(e){this.translations=new Map;for(let t in e)this.translations.set(t,e[t]),famobi.log("loaded localization for "+t);const t=this.getClientLanguage();famobi.log("Browser language: "+t),this.setLocale(t)}findAvailableLocale(e){if(this.translations.has(e))return e;const t=this.getLang(e);return this._findFallbackLocale(e,t)}getLang(e){const t=e.indexOf("-");return-1!==t?e.substring(0,t):e}_findFallbackLocale(e,t){let i=n.DEFAULT_LOCALE_FALLBACKS[e];if(i&&this.translations[i])return i;if(i=n.DEFAULT_LOCALE_FALLBACKS[t],i&&this.translations[i])return i;for(let e of this.translations){const i=e[0];if(t===this.getLang(i))return i}return n.DEFAULT_LOCALE}getClientLanguage(){return navigator.language||"en-US"}}n.DEFAULT_LOCALE="en-US",n.DEFAULT_LOCALE_FALLBACKS={en:"en-US",es:"en-ES",zh:"zh-CN","zh-HK":"zh-TW","zh-TW":"zh-HK","zh-MO":"zh-HK",fr:"fr-FR",de:"de-DE",it:"it-IT",ru:"ru-RU",ja:"ja-JP"},t.LocalizationManager=n},8537:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(i(2260)),n=a(i(6756)),o=a(i(1475)),r=a(i(2906)),h=i(9898),l=i(8314),c=i(578),d=i(8891),g=i(8240),u=i(2728);const _=()=>{(0,g.initFamobiMockObject)(),u.FamobiAPI.addFamobiHandlers();const e={type:s.default.AUTO,transparent:!0,parent:"game-container",title:"Chess Classic ©Famobi 2023",banner:!1,version:!1,fullscreenTarget:"game-container",scale:{mode:s.default.Scale.ScaleModes.NONE},scene:[o.default,r.default],input:{activePointers:1}},t=[];if(h.GameConfig.ENABLE_LOCALIZATION){const e=d.LocalizationManager.getInstance().loadLocalizationFile("assets/localization/localization.json");t.push(e)}const i=l.FontsLoader.loadFonts(...Object.values(h.GameConfig.FONTS));t.push(i),Promise.all(t).then((()=>{window.game=new n.default(e)})),c.ResizeController.getInstance().init()};"undefined"!=typeof famobi?_():window.addEventListener("load",(()=>{_()}))},8314:function(e,t,i){var a=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))((function(s,n){function o(e){try{h(a.next(e))}catch(e){n(e)}}function r(e){try{h(a.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}h((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FontsLoader=void 0;const n=s(i(5933));t.FontsLoader=class{static loadFonts(...e){return a(this,void 0,void 0,(function*(){if(!e||0===e.length)return Promise.resolve("No fonts");n.default.load({custom:{families:e},active:()=>Promise.resolve("Loaded"),inactive:()=>Promise.resolve("Inactive")})}))}}},578:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ResizeController=void 0;const s=i(9898),n=a(i(6756));class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}constructor(){}init(){window.addEventListener("resize",(()=>this.doResize())),setTimeout((()=>this.doResize()),100)}doResize(){var e;(null===(e=n.default.instance)||void 0===e?void 0:e.currentScene)&&(this._resizeCanvas(),setTimeout((()=>this._resizeCanvas()),250),(navigator.userAgent.includes("iPad")||navigator.userAgent.includes("iPhone"))&&setTimeout((()=>this._resizeCanvas()),500))}_resizeCanvas(){var e,t,i;const a=null===(e=n.default.instance)||void 0===e?void 0:e.scale.canvas,o=famobi.getOffsets(),r=window.innerWidth-o.left-o.right,h=window.innerHeight-o.top-o.bottom,l=Math.min(window.devicePixelRatio||1,3);let c=Math.floor(r*l),d=Math.floor(h*l);if(Math.max(c,d)>s.GameConfig._MAX_RENDERER_WIDTH){const e=s.GameConfig._MAX_RENDERER_WIDTH/Math.max(c,d);c=Math.floor(e*c),d=Math.floor(e*d)}null===(i=null===(t=n.default.instance)||void 0===t?void 0:t.currentScene)||void 0===i||i.scale.resize(c,d),a.style.left=o.left+"px",a.style.right=o.right+"px",a.style.top=o.top+"px",a.style.bottom=o.bottom+"px",a.style.width=r+"px",a.style.height=h+"px"}forceResize(){this.doResize()}}t.ResizeController=o},2301:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(i(2260)),n=i(9898),o=a(i(6756)),r=i(2149);class h extends s.default.Scene{constructor(e){super(e),this.autoResizeableElements=[],window.scene=o.default.instance.currentScene=this}preload(){this.scale.on("resize",this.onResize,this),this.events.on("postupdate",this.postUpdate,this),this.events.on("shutdown",this.onShutdown,this)}update(e,t){super.update(e,t)}doResize(e,t){var i;if(this.cameras&&this.cameras.main){this.resizeCamera(e,t);const a=this.cameras.main.zoom;null===(i=this.autoResizeableElements)||void 0===i||i.forEach((i=>{i&&i.__responsivePositionData&&this._resizeElement(i,e,t,a)})),this.handleResize(e,t,a)}}onResize(e){this.doResize(e.width,e.height)}resizeCamera(e,t){this.cameras.resize(e,t),this.cameras.main.setZoom(Math.min(e/n.GameConfig.getWidth(),t/n.GameConfig.getHeight()))}_resizeElement(e,t,i,a){const s=this.isLandscape()&&e.__responsivePositionData.landscape||e.__responsivePositionData,n=s.x||0,o=s.y||0,r=s.dx||0,h=s.dy||0;e.setPosition(n*t/a+r,o*i/a+h),void 0!==s.scale&&e.setScale(s.scale)}postUpdate(e,t){}isPortrait(){return this.cameras.main.width/this.cameras.main.height<=n.GameConfig.MAX_PORTRAIT_SCREEN_RATIO}isLandscape(){return!this.isPortrait()}makeResponsive(e,t,i=!0){e instanceof Array||(e=[e]),e.forEach((e=>{var a;e.__responsivePositionData=t?r.ResponsivePositionData.clone(t):new r.ResponsivePositionData,null===(a=this.autoResizeableElements)||void 0===a||a.push(e),i&&this._resizeElement(e,this.cameras.main.width,this.cameras.main.height,this.cameras.main.zoom)}))}onShutdown(){delete this.autoResizeableElements,this.scale.off("resize",this.onResize,this),this.events.off("postupdate",this.postUpdate,this),this.events.off("destroy",this.onShutdown,this)}}t.default=h},2906:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(3825),n=i(2688),o=i(6602),r=a(i(2301)),h=i(6512),l=i(5420),c=i(3408),d=i(578),g=i(4191);class u extends r.default{constructor(){super(s.Scenes.GAMEPLAY),this.dataManager=new c.GameDataManager(this)}create(){this.addEventListeners(),this.createElements(),d.ResizeController.getInstance().forceResize(),this.overlayScreen.transition({callback:()=>{this.dataManager.loadSavedGameParams(),this.dataManager.resetGame(),this.screensManager.start()},skipFadeIn:!0})}update(e,t){this.dataManager.update(t/1e3)}handleResize(e,t,i){this.backgroundController.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.screensManager.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.uiController.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.foregroundController.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.overlayScreen.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.backgroundController.resize(e,t,i),this.screensManager.resize(e,t,i),this.uiController.resize(e,t,i),this.foregroundController.resize(e,t,i),this.overlayScreen.resize(e,t,i)}getActiveScreen(){return this.screensManager.getActiveScreen()}getActiveScreens(){return this.screensManager.getActiveScreens()}addEventListeners(){}createElements(){this.backgroundController=new h.BackgroundController(this),this.backgroundController.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.add.existing(this.backgroundController),this.screensManager=new l.ScreensManager(this),this.screensManager.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.add.existing(this.screensManager),this.uiController=new n.UIController(this),this.uiController.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.add.existing(this.uiController),this.foregroundController=new g.ForegroundController(this),this.foregroundController.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.add.existing(this.foregroundController),this.overlayScreen=new o.OverlayScreen(this),this.overlayScreen.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.add.existing(this.overlayScreen)}}t.default=u},1475:function(e,t,i){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(i(2260)),n=i(3825),o=a(i(2301)),r=i(272);class h extends o.default{constructor(){super(n.Scenes.PRELOAD)}handleResize(e,t){}preload(){super.preload(),this.load.json("config","assets/config.json")}create(){this.load.image("white-square","assets/img/white-square.png"),this.load.image("background","assets/img/background.jpg"),this.load.image("clock-background","assets/img/clock-background.png"),this.load.image("famobi-logo","assets/img/famobi-logo.png"),this.load.image("famobi-banner",window.famobi.getBrandingButtonImage()),this.load.multiatlas("particles","assets/img/particles.json","assets/img"),this.load.multiatlas("assets","assets/img/assets.json","assets/img"),this.load.atlasXML("MainAtlas","assets/img/MainAtlas.png","assets/img/MainAtlas.xml"),this.load.atlasXML("difficulty","assets/img/difficulty.png","assets/img/difficulty.xml"),this.load.audio("click","assets/audio/click.mp3"),this.load.audio("move","assets/audio/move.mp3"),this.load.on(s.default.Loader.Events.COMPLETE,(()=>{r.Utils.setLoadingSpinnerVisible(!1),this.scene.start(n.Scenes.GAMEPLAY),document.body.style.background="black",window.famobi.gameReady()})),this.load.on(s.default.Loader.Events.PROGRESS,(e=>{window.famobi.setPreloadProgress(Math.floor(100*e)),r.Utils.setLoadingSpinnerProgress(e)})),this.load.start()}}t.default=h},5934:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BasicButtonConfig=t.BasicButton=void 0;class i extends Phaser.GameObjects.Container{constructor(e){var t,a;super(e.scene,e.x||0,e.y||0),this.enabled=!0,this.transparent=!1,this.isPointerDown=!1,this.isPointerOver=!1,this._baseScale=new Phaser.Math.Vector2(1,1),this.scene.add.existing(this),this.useScaleTween=null===(t=e.applyScaleTween)||void 0===t||t,this.useTintTween=null!==(a=e.applyTintTween)&&void 0!==a&&a,this._hoverScale=e.hoverScale||i.HOVER_SCALE,this._downScale=e.downScale||i.DOWN_SCALE,this.hoverSFXKey=e.hoverSFX,this.clickSFXKey=e.clickSFX||"click",e.scale&&this.setScale(e.scale),this.buttonBase=new Phaser.GameObjects.Image(e.scene,0,0,e.texture,e.frame),this.buttonBase.setOrigin(.5,.5),this.add(this.buttonBase),this.buttonBase.setInteractive({useHandCursor:!0}).on("pointerover",(e=>{this.scene&&this.scene.game.device.os.desktop&&(this.isPointerOver||(this.isPointerOver=!0,this.hoverSFXKey&&this.scene.sound.play(this.hoverSFXKey)),this.enterButtonHoverState())})).on("pointerout",(e=>{this.isPointerOver=!1,this.enterButtonDefaultState()})).on("pointerdown",(t=>{this.enterButtonActiveState(),this.isPointerDown=!0,this.downX=t.x,this.downY=t.y,e.downCallback&&e.downCallback()})).on("pointerup",(t=>{this.enabled&&(this.enterButtonHoverState(),this.isPointerDown&&(this.clickSFXKey&&this.scene.sound.play(this.clickSFXKey),this.handleClick(),e.clickCallback&&e.clickCallback(),e.upCallback&&e.upCallback()),this.isPointerDown=!1)}))}handleClick(){}setScale(e,t){const i=super.setScale(e,t);return this._baseScale.set(this.scaleX,this.scaleY),i}setEnabled(e){this.enabled=e,this.updateOpacity()}setTransparent(e){this.transparent=e,this.updateOpacity()}updateOpacity(){this.buttonBase.alpha=this.enabled?this.transparent?i.TRANSPARENT_ALPHA:1:i.DISABLED_ALPHA}isEnabled(){return this.enabled}setFrame(e){this.buttonBase.setFrame(e)}preUpdate(e,t){}enterButtonHoverState(){this.enabled&&(this.useTintTween&&(this.buttonBase.tint=13421772),this.useScaleTween&&this._tweenScale(this._hoverScale))}enterButtonDefaultState(){this.enabled&&(this.useTintTween&&(this.buttonBase.tint=16777215),this.useScaleTween&&this._tweenScale(1))}enterButtonActiveState(){this.enabled&&(this.useTintTween&&(this.buttonBase.tint=14540253),this.useScaleTween&&this._tweenScale(this._downScale))}_tweenScale(e){this.scaleTween&&this.scene.tweens.remove(this.scaleTween),this.scaleTween=this.scene.tweens.add({targets:this,scaleX:this._baseScale.x*e,scaleY:this._baseScale.y*e,duration:50})}}i.HOVER_SCALE=1.0125,i.DOWN_SCALE=.975,i.DISABLED_ALPHA=.5,i.TRANSPARENT_ALPHA=.5,t.BasicButton=i;t.BasicButtonConfig=class{constructor(){this.x=0,this.y=0}}},8727:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToggleButtonConfig=t.ToggleButton=void 0;const a=i(5934);class s extends a.BasicButton{constructor(e){var t,i,a,s;super(e),this.toggleState=!0,this.frameOn=null!==(t=e.frame)&&void 0!==t?t:"",this.frameOff=null!==(a=null!==(i=e.frameOff)&&void 0!==i?i:e.frame)&&void 0!==a?a:"",this.toggleState=null===(s=e.toggleState)||void 0===s||s,this.setToggleState(this.toggleState)}setToggleState(e){this.toggleState=e,this.updateView()}getToggleState(){return this.toggleState}handleClick(){this.toggleState=!this.toggleState,this.updateView()}updateView(){this.buttonBase.setFrame(this.toggleState?this.frameOn:this.frameOff)}}t.ToggleButton=s;class n extends a.BasicButtonConfig{}t.ToggleButtonConfig=n},272:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;const a=i(9898);t.Utils=class{static setLoadingSpinnerVisible(e){document.querySelector("#preloader").style.display=e?"block":"none"}static setLoadingSpinnerProgress(e){a.GameConfig.SHOW_LOADING_PROGRESS&&e>0&&(document.querySelector("#loading-text").textContent=Math.floor(100*e)+"%")}static postMessage(e){window.parent.postMessage(e,"*")}static formatDate(e){return new Date(e).toLocaleTimeString([],{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}static humanizeTime(e){let t=e,i=Math.floor(t/3600);t%=3600;let a=Math.floor(t/60);return t%=60,(i<10?"0":"")+i+":"+(a<10?"0":"")+a+":"+(t<10?"0":"")+Math.floor(t)}static wait(e){return new Promise(((t,i)=>{setTimeout((()=>t()),e)}))}}}},i={};function a(e){var s=i[e];if(void 0!==s)return s.exports;var n=i[e]={exports:{}};return t[e].call(n.exports,n,n.exports,a),n.exports}a.m=t,e=[],a.O=(t,i,s,n)=>{if(!i){var o=1/0;for(c=0;c<e.length;c++){for(var[i,s,n]=e[c],r=!0,h=0;h<i.length;h++)(!1&n||o>=n)&&Object.keys(a.O).every((e=>a.O[e](i[h])))?i.splice(h--,1):(r=!1,n<o&&(o=n));if(r){e.splice(c--,1);var l=s();void 0!==l&&(t=l)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[i,s,n]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};a.O.j=t=>0===e[t];var t=(t,i)=>{var s,n,[o,r,h]=i,l=0;if(o.some((t=>0!==e[t]))){for(s in r)a.o(r,s)&&(a.m[s]=r[s]);if(h)var c=h(a)}for(t&&t(i);l<o.length;l++)n=o[l],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},i=self.webpackChunkhtml5_minigame=self.webpackChunkhtml5_minigame||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var s=a.O(void 0,[216],(()=>a(8537)));s=a.O(s)})();