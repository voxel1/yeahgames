window.__require=function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return r(t[a][1][e]||e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<o.length;a++)r(o[a]);return r}({AudioCustom:[function(e,t,n){"use strict";cc._RF.push(t,"710adinKahGH6EAz4DATjwG","AudioCustom");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var r=cc._decorator.ccclass,i=function(){function e(){this._sound=null,this._onLoadSuccess=null,this._duration=0,this._id=-1,this._isFirstTimeCallPlay=!0}return e.prototype.preload=function(e,t){var n=this;Howl.autoSuspend=!1,this._onLoadSuccess=t,this._sound=new Howl({src:[e],format:["mp3"],html5:!0,preload:!1,loop:!1,onload:function(){n._duration=n._sound.duration(),n.seek(n._duration-1),n._id=n._sound.play(),n._onLoadSuccess&&n._onLoadSuccess(),cc.log("load music successfully")}}),this._sound.load(),this.mute(!0)},e.prototype.play=function(){this._sound.playing()||this._sound.play(this._id),this._isFirstTimeCallPlay&&(this.mute(!1),this._isFirstTimeCallPlay=!1)},e.prototype.resume=function(){this._sound.playing()||this._sound.play(this._id)},e.prototype.playOnce=function(){var e=this;this._sound.once("load",function(){e._sound.play()})},e.prototype.fade=function(e,t){t<=.05?this.stop():this.playing()||this._sound.play(this._id)},e.prototype.stop=function(){this._sound.stop()},e.prototype.pause=function(){this._sound.pause()},e.prototype.seek=function(e){this._sound.seek(e)},e.prototype.playing=function(){return this._sound.playing()},e.prototype.rate=function(e){e=Math.min(4,Math.max(.5,e)),this._sound.rate(e)},e.prototype.getRate=function(){return this._sound.rate()},e.prototype.duration=function(){return this._duration},e.prototype.mute=function(e){this._sound.mute(e)},o([r],e)}();n.default=i,cc._RF.pop()},{}],AudioManager:[function(e,t,n){"use strict";cc._RF.push(t,"52597rbU5dEFqjTOBQG5xzw","AudioManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./MusicPlayer"),l=e("./Controller/MainController"),u=e("./GameManager"),p=cc._decorator,h=p.ccclass,d=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dieSound=null,t.botDieSound=null,t.blankSound=null,t.buttonSound=null,t.replayButonSound=null,t.resultSound=null,t.completeSound=null,t.completeCrownSound=null,t.seSource=null,t.playerAudio=null,t.speed=1,t.status=!1,t.pauseWhenRequestDone=!1,t.isFading=!1,t.fadeCallback=null,t}var n;return r(t,e),n=t,t.prototype.onLoad=function(){n.Instance=this,this.playBlank()},t.prototype.init=function(){var e=this;this.setEnable(l.default.Instance.audioEnableChangable.isAudioEnabled()),u.GameLog.log("[AudioManager] Initialized with audio enabled: "+l.default.Instance.audioEnableChangable.isAudioEnabled()),l.default.Instance.audioEnableChangable.onAudioEnabledChange(function(t){e.setEnable(t),u.GameLog.log("[AudioManager] Audio enabled changed to: "+t)})},t.prototype.loadFromUrl=function(e,t){return void 0===t&&(t=!1),a(this,void 0,Promise,function(){var n;return s(this,function(o){switch(o.label){case 0:return u.GameLog.log("[AudioManager] Loading audio from url: "+e+", loop: "+t),null!=this.playerAudio&&this.playerAudio.stop(),(n=new c.MusicPlayerOptions).src=e,n.loop=t,this.playerAudio=new c.MusicPlayer(n),[4,this.playerAudio.load()];case 1:return o.sent(),[2]}})})},t.prototype.reload=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.playerAudio.load()];case 1:return e.sent(),[2]}})})},t.prototype.setEnable=function(e){this.status=e;var t=!e;u.GameLog.log("[AudioManager] Setting audio enable: "+e+", isMute: "+t),this.playerAudio&&this.playerAudio.mute(t),this.seSource&&(this.seSource.mute=t)},t.prototype.getPlayerAudio=function(){return this.playerAudio},t.prototype.play=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return u.GameLog.log("[AudioManager] Playing audio"),this.isRequestPlaying=!0,this.pauseWhenRequestDone=!1,[4,this.playerAudio.play()];case 1:return e.sent(),this.playerAudio.mute(!this.status),this.isRequestPlaying=!1,this.setFadeIn(),this.pauseWhenRequestDone&&this.pause(),[2]}})})},t.prototype.pause=function(){u.GameLog.log("[AudioManager] Pausing audio"),this.stopFadeIn(),this.isRequestPlaying?this.pauseWhenRequestDone=!0:this.playerAudio.pause()},t.prototype.stop=function(){u.GameLog.log("[AudioManager] Stopping audio"),this.stopFadeIn(),null!=this.playerAudio&&this.playerAudio.stop()},t.prototype.seek=function(e){u.GameLog.log("[AudioManager] Seeking to time: "+e),this.stopFadeIn(),this.playerAudio.setCurrentTime(e)},t.prototype.getCurrentTime=function(){return this.playerAudio.getCurrentTime()},t.prototype.setSpeedMusic=function(e){u.GameLog.log("[AudioManager] Setting music speed to: "+e),this.speed=e,this.playerAudio.setSpeedMusic(e)},t.prototype.getSpeedMusic=function(){return this.playerAudio.getSpeedMusic()},t.prototype.resume=function(){this.playerAudio.resume()},t.prototype.playing=function(){return this.playerAudio.isPlaying()},t.prototype.duration=function(){return this.playerAudio.getDuration()},t.prototype.volume=function(e){e>1?e=1:e<0&&(e=0),u.GameLog.log("[AudioManager] Setting volume to: "+e),null!=this.playerAudio&&(this.playerAudio.setVolumeMusic(e),this.playerAudio.mute(!this.status))},t.prototype.seVolume=function(e){e>1?e=1:e<0&&(e=0),u.GameLog.log("[AudioManager] Setting SE volume to: "+e),null!=this.seSource&&(this.seSource.volume=e)},t.prototype.restart=function(){this.playerAudio.restart()},t.prototype.playDie=function(){this.seSource.clip=this.dieSound,this.seSource.play()},t.prototype.playBotDie=function(){this.seSource.clip=this.botDieSound,this.seSource.play()},t.prototype.playButton=function(){this.seSource.clip=this.buttonSound,this.seSource.play()},t.prototype.playReplayButton=function(){this.seSource.clip=this.replayButonSound,this.seSource.play()},t.prototype.playResult=function(){this.seSource.clip=this.resultSound,this.seSource.play()},t.prototype.playWin=function(){this.seSource.clip=this.completeSound,this.seSource.play()},t.prototype.playWinCrown=function(){this.seSource.clip=this.completeCrownSound,this.seSource.play()},t.prototype.playBlank=function(){this.seSource.clip=this.blankSound,this.seSource.play()},t.prototype.setFadeIn=function(){var e=this;u.GameLog.log("[AudioManager] Starting fade in effect"),this.stopFadeIn();var t=0;this.volume(0),this.isFading=!0,this.fadeCallback=function(){e.isFading&&(t+=.02,e.volume(t),t>=1&&(e.stopFadeIn(),u.GameLog.log("[AudioManager] Fade in completed")))},this.schedule(this.fadeCallback,0)},t.prototype.stopFadeIn=function(){this.isFading&&(this.isFading=!1,this.fadeCallback&&(this.unschedule(this.fadeCallback),this.fadeCallback=null),u.GameLog.log("[AudioManager] Fade in stopped"))},t.Instance=null,i([d({type:cc.AudioClip})],t.prototype,"dieSound",void 0),i([d({type:cc.AudioClip})],t.prototype,"botDieSound",void 0),i([d({type:cc.AudioClip})],t.prototype,"blankSound",void 0),i([d({type:cc.AudioClip})],t.prototype,"buttonSound",void 0),i([d({type:cc.AudioClip})],t.prototype,"replayButonSound",void 0),i([d({type:cc.AudioClip})],t.prototype,"resultSound",void 0),i([d({type:cc.AudioClip})],t.prototype,"completeSound",void 0),i([d({type:cc.AudioClip})],t.prototype,"completeCrownSound",void 0),i([d(cc.AudioSource)],t.prototype,"seSource",void 0),n=i([h],t)}(cc.Component);n.default=f,cc._RF.pop()},{"./Controller/MainController":"MainController","./GameManager":"GameManager","./MusicPlayer":"MusicPlayer"}],AvatarItem:[function(e,t,n){"use strict";cc._RF.push(t,"b0427UMmHxCb77py6BdEtNT","AvatarItem");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../AudioManager"),l=e("../ConfigManager"),u=e("../Controller/MainController"),p=e("../GameEvent"),h=e("../ResourcesManager"),d=cc._decorator,f=d.ccclass,g=d.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.avatarSprite=null,t.frameSprite=null,t.checkNode=null,t.button=null,t.loadingNode=null,t.loadSession=0,t.loadingCount=0,t.config=null,t.onProfileAvatarChanged=function(){return t.refreshCheck()},t.onClickButton=function(){c.default.Instance.playButton(),cc.view.emit(p.GameEvent.EVENT_CHANGE_PROFILE_AVATAR_REQUEST,new p.ChangeProfileAvatarRequestEvent(t.config.avatarId))},t}return r(t,e),t.prototype.onLoad=function(){this.button.node.on("click",this.onClickButton,this)},t.prototype.onEnable=function(){cc.view.on(p.GameEvent.EVENT_PROFILE_AVATAR_CHANGED,this.onProfileAvatarChanged,this)},t.prototype.onDisable=function(){this.loadSession++,cc.view.off(p.GameEvent.EVENT_PROFILE_AVATAR_CHANGED,this.onProfileAvatarChanged,this)},t.prototype.init=function(e){var t=this;this.config=l.default.Instance.getAvatarConfig(e),this.loadSession++;var n=this.loadSession;this.showLoading(),Promise.all([this.loadSprite(e,this.avatarSprite,h.default.Instance.loadAvatar,h.default.Instance.defaultAvatar,n),this.loadSprite(u.default.Instance.userDataService.getCurrentFrameId(),this.frameSprite,h.default.Instance.loadFrame,h.default.Instance.defaultFrame,n)]).then(function(){t.hideLoading()}),this.refreshCheck()},t.prototype.refreshCheck=function(){this.checkNode.active=this.config.avatarId===u.default.Instance.userDataService.getCurrentAvatarId()},t.prototype.loadSprite=function(e,t,n,o,r){return a(this,void 0,Promise,function(){var i;return s(this,function(a){switch(a.label){case 0:return null==e||""==e?(t.node.active=!1,[2]):(t.node.active=!0,t.spriteFrame=o,[4,n.call(h.default.Instance,e)]);case 1:return i=a.sent(),r!==this.loadSession?[2]:(i&&(t.spriteFrame=i),[2])}})})},t.prototype.showLoading=function(){this.loadingCount++,this.loadingNode.active=!0},t.prototype.hideLoading=function(){this.loadingCount--,this.loadingNode.active=this.loadingCount>0},i([g(cc.Sprite)],t.prototype,"avatarSprite",void 0),i([g(cc.Sprite)],t.prototype,"frameSprite",void 0),i([g(cc.Node)],t.prototype,"checkNode",void 0),i([g(cc.Button)],t.prototype,"button",void 0),i([g(cc.Node)],t.prototype,"loadingNode",void 0),i([f],t)}(cc.Component);n.default=y,cc._RF.pop()},{"../AudioManager":"AudioManager","../ConfigManager":"ConfigManager","../Controller/MainController":"MainController","../GameEvent":"GameEvent","../ResourcesManager":"ResourcesManager"}],AvatarTab:[function(e,t,n){"use strict";cc._RF.push(t,"360bbh5HyJFGohEyOPTP5sL","AvatarTab");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ConfigManager"),s=e("../GameManager"),c=e("./AvatarItem"),l=cc._decorator,u=l.ccclass,p=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layout=null,t.containerWidget=null,t.avatarItemPrefab=null,t.container=null,t.avatarItems=[],t.avatarItemPool=new cc.NodePool,t}return r(t,e),t.prototype.onEnable=function(){this.initItemSize(),this.refresh(),cc.view.on(s.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChaged,this)},t.prototype.onDisable=function(){cc.view.off(s.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChaged,this)},t.prototype.refresh=function(){var e=this;this.avatarItems.forEach(function(t){e.avatarItemPool.put(t.node)}),this.avatarItems=[],a.default.Instance.getAvatarIds().forEach(function(t){var n;(n=e.avatarItemPool.size()>0?e.avatarItemPool.get():cc.instantiate(e.avatarItemPrefab)).setContentSize(e.itemSize),e.container.addChild(n);var o=n.getComponent(c.default);o.init(t),e.avatarItems.push(o)}),this.layout.updateLayout()},t.prototype.initItemSize=function(){this.containerWidget.updateAlignment();var e=(this.layout.node.width-this.layout.paddingLeft-this.layout.paddingRight-3*this.layout.spacingX)/4-10;this.itemSize=new cc.Size(e,e)},t.prototype.onCanvasSizeChaged=function(){this.initItemSize(),this.refresh()},i([p(cc.Layout)],t.prototype,"layout",void 0),i([p(cc.Widget)],t.prototype,"containerWidget",void 0),i([p(cc.Prefab)],t.prototype,"avatarItemPrefab",void 0),i([p(cc.Node)],t.prototype,"container",void 0),i([u],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../ConfigManager":"ConfigManager","../GameManager":"GameManager","./AvatarItem":"AvatarItem"}],BackgroundController:[function(e,t,n){"use strict";cc._RF.push(t,"9e003cKKRhGNKiY9mBD1ywa","BackgroundController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../GameManager"),s=e("./GameplayController"),c=cc._decorator,l=c.ccclass,u=(c.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){cc.view.on(a.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChaged.bind(this)),cc.view.on(s.default.EVENT_CAMERA_ORTHO_CHANGED,this.onCameraOrthoChanged.bind(this))},t.prototype.onDestroy=function(){cc.view.off(a.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChaged.bind(this)),cc.view.off(s.default.EVENT_CAMERA_ORTHO_CHANGED,this.onCameraOrthoChanged.bind(this))},t.prototype.onCanvasSizeChaged=function(){this.updateSize()},t.prototype.onCameraOrthoChanged=function(){this.updateSize()},t.prototype.updateSize=function(){var e=s.default.Instance.camera.orthoSize,t=a.default.Instance.fullCanvasSize;if(null!=t&&0!=t.width&&0!=t.height){var n=2*e,o=n*(t.width/t.height);this.node.setContentSize(o,n)}else a.GameLog.log("Canvas size is invalid. Exiting updateSize.")},i([l],t)}(cc.Component));n.default=u,cc._RF.pop()},{"../GameManager":"GameManager","./GameplayController":"GameplayController"}],BaseSceneController:[function(e,t,n){"use strict";cc._RF.push(t,"96a1efNwf5BjpCr/0358R0z","BaseSceneController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),i([s],t)}(cc.Component));n.default=c,cc._RF.pop()},{}],BoolClass:[function(e,t,n){"use strict";cc._RF.push(t,"b5ee2UTpCJK+5AH1bVMH+yQ","BoolClass"),Object.defineProperty(n,"__esModule",{value:!0}),n.BoolClass=void 0;n.BoolClass=function(e){this.value=e},cc._RF.pop()},{}],CameraController:[function(e,t,n){"use strict";cc._RF.push(t,"5f4fbjxh3BCwayPM9ivhM+h","CameraController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../GameManager"),s=cc._decorator,c=s.ccclass,l=s.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.playZone=null,t}return r(t,e),t.prototype.start=function(){this.updateSize(),cc.view.on(a.default.EVENT_CANVAS_SIZE_CHANGED,this.updateSize,this)},t.prototype.onDestroy=function(){cc.view.off(a.default.EVENT_CANVAS_SIZE_CHANGED,this.updateSize,this)},t.prototype.updateSize=function(){var e=cc.view.getCanvasSize(),t=cc.size(e.width/cc.view.getScaleX(),e.height/cc.view.getScaleY());this.node.setContentSize(t)},i([l(cc.Node)],t.prototype,"playZone",void 0),i([c],t)}(cc.Component);n.default=u,cc._RF.pop()},{"../GameManager":"GameManager"}],ConfigManager:[function(e,t,n){"use strict";cc._RF.push(t,"ef26fdgvvlPRpkYuVvJa2Cr","ConfigManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./Components/EnhancedLoading"),l=e("./Data/GameConfig"),u=e("./Utils/GameUtils"),p=cc._decorator,h=p.ccclass,d=(p.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mapAvatarConfig=new Map,t.mapFrameConfig=new Map,t.mapLevelConfig=new Map,t}var n;return r(t,e),n=t,t.prototype.getLoadingComponentList=function(){var e=this;return[{resultRequire:[],resultList:[c.LoadingResultType.AVATAR_CONFIG],executeFunction:function(){return e.initAvatarConfig()}},{resultRequire:[],resultList:[c.LoadingResultType.FRAME_CONFIG],executeFunction:function(){return e.initFrameConfig()}},{resultRequire:[],resultList:[c.LoadingResultType.LEVEL_CONFIG],executeFunction:function(){return e.initLevelConfig()}}]},t.prototype.getAvatarIds=function(){return Array.from(this.mapAvatarConfig.keys())},t.prototype.getFrameIds=function(){return Array.from(this.mapFrameConfig.keys())},t.prototype.getAvatarConfig=function(e){return this.mapAvatarConfig.get(e)||null},t.prototype.getFrameConfig=function(e){return this.mapFrameConfig.get(e)||null},t.prototype.getLevelConfig=function(e){return this.mapLevelConfig.get(e)||null},t.prototype.getAvatarConfigs=function(){return this.mapAvatarConfig},t.prototype.getFrameConfigs=function(){return this.mapFrameConfig},t.prototype.getLevelConfigs=function(){return this.mapLevelConfig},t.prototype.initAvatarConfig=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,u.default.loadTextDataFromURL("game-resources/avatars/config.json")];case 1:return e=t.sent(),this.importConfig(e,this.mapAvatarConfig,l.AvatarConfig),[2]}})})},t.prototype.initFrameConfig=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return[4,u.default.loadTextDataFromURL("game-resources/frames/config.json")];case 1:return e=n.sent(),(t=new l.FrameConfig).frameId="",t.url="",t.levelUnlock=0,t.songChallengUnlock=-1,this.mapFrameConfig.set("",t),this.importConfig(e,this.mapFrameConfig,l.FrameConfig),[2]}})})},t.prototype.initLevelConfig=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,u.default.loadTextDataFromURL("game-resources/levels/config.json")];case 1:return e=t.sent(),this.importConfig(e,this.mapLevelConfig,l.LevelConfig),[2]}})})},t.prototype.importConfig=function(e,t,n){JSON.parse(e).forEach(function(e){var o=new n;Object.assign(o,e),t.set(e[Object.keys(e)[0]],o)})},t.Instance=new n,i([h],t)}(cc.Component));n.default=d,cc._RF.pop()},{"./Components/EnhancedLoading":"EnhancedLoading","./Data/GameConfig":"GameConfig","./Utils/GameUtils":"GameUtils"}],Convert:[function(e,t,n){"use strict";cc._RF.push(t,"da309iI4AdNQKRm2Qj+W1nv","Convert"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.convertNodePositionByNode=function(e,t){return cc.v3(e.convertToNodeSpaceAR(t.convertToWorldSpaceAR(e.position)))},e.moveN1toN2=function(e,t){return e.parent.convertToNodeSpaceAR(t.parent.convertToWorldSpaceAR(t.position))},e.convertNodeSpaceAR=function(e,t){return e.parent.convertToNodeSpaceAR(t.parent.convertToNodeSpaceAR(t.position))},e}();n.default=o,cc._RF.pop()},{}],CosmeticController:[function(e,t,n){"use strict";cc._RF.push(t,"3616eFGyrBKu6JPhMg3VjT4","CosmeticController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Components/ThemeItem"),s=e("../ThemeManager"),c=e("./GameplayController"),l=cc._decorator,u=l.ccclass,p=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.themeItemPrefab=null,t.themeItemContainer=null,t.scrollViewWidget=null,t.scrollViewNode=null,t.isInit=!1,t.items=[],t}var n;return r(t,e),n=t,t.prototype.onLoad=function(){n.Instance=this,this.hiddenBottom=-this.scrollViewWidget.node.height,this.scrollViewWidget.isAbsoluteBottom=!0,this.scrollViewWidget.bottom=this.hiddenBottom,this.scrollViewWidget.updateAlignment()},t.prototype.setup=function(){var e=this;this.scrollViewWidget.node.active=!0,this.scrollViewNode.active=!c.default.Instance.request.isTutorial,cc.Tween.stopAllByTarget(this.scrollViewWidget),cc.tween(this.scrollViewWidget).to(.5,{bottom:0},{easing:"sineInOut"}).delay(.3).call(function(){e.scrollViewWidget.updateAlignment()}).start(),this.isInit||(this.init(),this.isInit=!0);var t=s.default.Instance.currentThemeData();this.items.forEach(function(e){return e.refresh(t)})},t.prototype.onStartGame=function(){var e=this;cc.Tween.stopAllByTarget(this.scrollViewWidget),cc.tween(this.scrollViewWidget).to(.5,{bottom:this.hiddenBottom},{easing:"sineInOut"}).call(function(){e.scrollViewWidget.updateAlignment()}).start()},t.prototype.init=function(){var e=this,t=s.default.Instance.allThemeId();this.themeItemContainer.removeAllChildren(),t.forEach(function(t){var n=cc.instantiate(e.themeItemPrefab),o=n.getComponent(a.default);o.init(t),e.themeItemContainer.addChild(n),e.items.push(o)})},i([p(cc.Prefab)],t.prototype,"themeItemPrefab",void 0),i([p(cc.Node)],t.prototype,"themeItemContainer",void 0),i([p(cc.Widget)],t.prototype,"scrollViewWidget",void 0),i([p(cc.Node)],t.prototype,"scrollViewNode",void 0),n=i([u],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../Components/ThemeItem":"ThemeItem","../ThemeManager":"ThemeManager","./GameplayController":"GameplayController"}],Countdown:[function(e,t,n){"use strict";cc._RF.push(t,"33eb9PYilZPZ4T+NWuiyx7t","Countdown");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.progressBar=null,t.duration=5,t.callback=[],t}return r(t,e),t.prototype.onEnable=function(){var e=this;this.progressBar.progress=1,cc.tween(this.progressBar).to(this.duration,{progress:0}).call(function(){cc.Component.EventHandler.emitEvents(e.callback)}).start()},t.prototype.stopCountdown=function(){cc.Tween.stopAllByTarget(this.progressBar)},t.prototype.resumeCountdown=function(){var e=this;this.progressBar.progress=1,cc.tween(this.progressBar).to(this.duration,{progress:0}).call(function(){cc.Component.EventHandler.emitEvents(e.callback)}).start()},i([c(cc.ProgressBar)],t.prototype,"progressBar",void 0),i([c],t.prototype,"duration",void 0),i([c([cc.Component.EventHandler])],t.prototype,"callback",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],Counter:[function(e,t,n){"use strict";cc._RF.push(t,"64e7ciVqXtKYoOVI24dA1s6","Counter");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var r=cc._decorator.ccclass,i=function(){function e(){}var t;return t=e,e.updateScore=function(e,n){t.score+=e,t.updateType(n,e),null!==t.triggerUpdateScore&&t.triggerUpdateScore(),t.doAnimScore&&t.doAnimScore()},e.updateHeart=function(e){t.numTilesCanMiss=e,null!==t.triggerUpdateHeart&&t.triggerUpdateHeart()},e.updateType=function(e,n){switch(e){case"perfect":t.perfect++;break;case"great":t.great++;break;case"cool":t.cool++;break;case"bonus":t.bonus+=n}},e.updateProgress=function(e){t.progress=e},e.setup=function(){t.score=0,t.perfect=0,t.great=0,t.cool=0,t.tile_hit=0,t.perfectStreak=0,t.totalNote=0,t.totalNoteRemove=0,t.CurrentStar=0,t.reviveTimes=0,t.numTilesCanMiss=0,t.bonus=0,t.progress=0},e.score=0,e.perfect=0,e.great=0,e.cool=0,e.bonus=0,e.tile_hit=0,e.perfectStreak=0,e.totalNote=0,e.totalNoteRemove=0,e.CurrentStar=0,e.OnTileHit=null,e.reviveTimes=0,e.triggerUpdateScore=null,e.doAnimScore=null,e.numTilesCanMiss=0,e.triggerUpdateHeart=null,e.progress=0,t=o([r],e)}();n.default=i,cc._RF.pop()},{}],DeadZone:[function(e,t,n){"use strict";cc._RF.push(t,"b94eb681rFAWb10doteyhte","DeadZone");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Defines"),s=e("../Controller/GameplayController"),c=cc._decorator,l=c.ccclass,u=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameplayCamera=null,t.tileWrong=null,t.syncTest=null,t.gpcNode=null,t.tileFalse=[],t.gpc=null,t.speed=0,t}return r(t,e),t.prototype.onLoad=function(){cc.view.on(s.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit.bind(this)),cc.view.on(s.default.EVENT_GAMEPLAY_RESUME_RESULT,this.onGameplayResumeResult.bind(this))},t.prototype.onDestroy=function(){cc.view.off(s.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit.bind(this)),cc.view.off(s.default.EVENT_GAMEPLAY_RESUME_RESULT,this.onGameplayResumeResult.bind(this))},t.prototype.onGameplayInit=function(){this.tileWrong.active=!1},t.prototype.onGameplayResumeResult=function(){this.tileWrong.active=!1},t.prototype._onTouchStart=function(e){if(null!=this.gpc&&!this.gpc.isHit&&this.gpc.gameStatus!==a.GameStatus.DIED){this.syncTest.y=e.y,this.gpcNode.y=e.y;var t=this.gpc.getTileByPositionY(e.y);if(null!=t){var n=Math.floor(e.x/this.gpc.tileSize.width);this.tileWrong.setPosition(this.gpc.startPosition.x+n*this.gpc.tileSize.width,t.node.y),this.tileWrong.setContentSize(t.noteSize),this.tileWrong.active=!0,cc.tween(this.tileWrong).to(.5,{opacity:128},{easing:"smooth"}).start(),this.gpc.isMissTile(t,!0)}}},t.prototype._onTouchFalseLong=function(e,t){if(null!=this.gpc&&this.gpc.gameStatus!==a.GameStatus.DIED&&(this.syncTest.y=e.y,this.gpcNode.y=e.y,null!=t)){var n=this.tileFalse[t.laneIndex];n.setPosition(t.node.x,t.node.y),n.setContentSize(cc.size(t.noteSize.width,9999)),n.active=!0,cc.tween(n).to(.3,{opacity:80},{easing:"smooth"}).to(.7,{opacity:0}).start()}},t.prototype.update=function(e){this.node.angle+=this.speed*e},i([u(cc.Node)],t.prototype,"gameplayCamera",void 0),i([u(cc.Node)],t.prototype,"tileWrong",void 0),i([u(cc.Node)],t.prototype,"syncTest",void 0),i([u(cc.Node)],t.prototype,"gpcNode",void 0),i([u(cc.Node)],t.prototype,"tileFalse",void 0),i([l],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../Controller/GameplayController":"GameplayController","../Defines":"Defines"}],DefaultAudioEnabledChange:[function(e,t,n){"use strict";cc._RF.push(t,"2ff38sWvWJHmI8Tiw/8r5fQ","DefaultAudioEnabledChange"),Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultAudioEnabledChange=void 0;var o=e("../Controller/MainController"),r=function(){function e(){o.default.Instance.audioEnableChangable=this}return e.prototype.onAudioEnabledChange=function(){},e.prototype.isAudioEnabled=function(){return!0},e}();n.DefaultAudioEnabledChange=r,cc._RF.pop()},{"../Controller/MainController":"MainController"}],DefaultDataStoragable:[function(e,t,n){"use strict";cc._RF.push(t,"d7225PBLeNNm4Kg8GvkeQde","DefaultDataStoragable"),Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultDataStoragable=void 0;var o=e("../Controller/MainController"),r=e("../GameManager"),i=function(){function e(){o.default.Instance.dataStoragable=this,this.isLocalStorageAvailable="undefined"!=typeof localStorage&&null!==localStorage}return e.prototype.loadData=function(){var e=this;return new Promise(function(t,n){if(e.isLocalStorageAvailable)try{t(localStorage.getItem("gameData")||null)}catch(o){n("Error loading data from localStorage: "+o.message)}else n(new Error("localStorage is not available"))})},e.prototype.saveData=function(e){var t=this;return new Promise(function(n,o){if(t.isLocalStorageAvailable)try{localStorage.setItem("gameData",e),r.GameLog.log("Data saved"),n()}catch(i){o("Error saving data to localStorage: "+i.message)}else o(new Error("localStorage is not available"))})},e}();n.DefaultDataStoragable=i,cc._RF.pop()},{"../Controller/MainController":"MainController","../GameManager":"GameManager"}],DefaultFirstFrameReady:[function(e,t,n){"use strict";cc._RF.push(t,"bb233Jq/AZClLqt1RwA99Jv","DefaultFirstFrameReady"),Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultFirstFrameReady=void 0;var o=function(){function e(){}return e.prototype.firstFrameReady=function(){},e}();n.DefaultFirstFrameReady=o,cc._RF.pop()},{}],DefaultGameReady:[function(e,t,n){"use strict";cc._RF.push(t,"55b04biub1Jb7LybygOvbQi","DefaultGameReady"),Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultGameReady=void 0;var o=e("../Controller/MainController"),r=function(){function e(){o.default.Instance.gameReady=this}return e.prototype.gameReady=function(){},e}();n.DefaultGameReady=r,cc._RF.pop()},{"../Controller/MainController":"MainController"}],DefaultHighScoreSender:[function(e,t,n){"use strict";cc._RF.push(t,"01bc0E0iC9P2p8RW8HeWLmL","DefaultHighScoreSender"),Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultHighScoreSender=void 0;var o=e("../Controller/MainController"),r=function(){function e(){o.default.Instance.highScoreSender=this}return e.prototype.sendScore=function(){return new Promise(function(e){return e()})},e}();n.DefaultHighScoreSender=r,cc._RF.pop()},{"../Controller/MainController":"MainController"}],DefaultPauseAndResume:[function(e,t,n){"use strict";cc._RF.push(t,"626b5XR9YhP84n9bqWlq+U8","DefaultPauseAndResume"),Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultPauseAndResume=void 0;var o=e("../Controller/MainController"),r=function(){function e(){var e=this;o.default.Instance.pauseAndResumeable=this,document.addEventListener("visibilitychange",function(){document.hidden?e.pauseFuction&&e.pauseFuction():e.resumeFuction&&e.resumeFuction()}),window.addEventListener("beforeunload",function(){e.pauseFuction&&e.pauseFuction()})}return e.prototype.onPause=function(e){this.pauseFuction=e},e.prototype.onResume=function(e){this.resumeFuction=e},e}();n.DefaultPauseAndResume=r,cc._RF.pop()},{"../Controller/MainController":"MainController"}],Defines:[function(e,t,n){"use strict";cc._RF.push(t,"fde708v4ZZEEJAknmR52+DH","Defines"),Object.defineProperty(n,"__esModule",{value:!0}),n.Audio=n.progressBar=n.TileDefines=n.SlideTileDefines=n.TileType=n.MultiPlayerState=n.GameStatus=n.GameMode=n.NoteLineInt=void 0,function(e){e[e.BPM=72]="BPM",e[e.PEAK=73]="PEAK",e[e.VOCALS=74]="VOCALS",e[e.MELODY=75]="MELODY",e[e.DRUMS=76]="DRUMS"}(n.NoteLineInt||(n.NoteLineInt={})),function(e){e[e.SINGLE=0]="SINGLE",e[e.MULTIPLAYER=2]="MULTIPLAYER"}(n.GameMode||(n.GameMode={})),function(e){e[e.ONLOAD=0]="ONLOAD",e[e.LOADED=1]="LOADED",e[e.PRELOAD_AUDIO=2]="PRELOAD_AUDIO",e[e.PLAYING=3]="PLAYING",e[e.MOVING_SYNC_LINE=4]="MOVING_SYNC_LINE",e[e.WAIT_TO_RESUME=5]="WAIT_TO_RESUME",e[e.WAIT_TO_REVIVE=6]="WAIT_TO_REVIVE",e[e.PAUSED=7]="PAUSED",e[e.PAUSED_BY_BROWSER=8]="PAUSED_BY_BROWSER",e[e.DIED=9]="DIED",e[e.WIN=10]="WIN",e[e.WAIT_TO_END=11]="WAIT_TO_END",e[e.WAIT_NEXT_LOOP=12]="WAIT_NEXT_LOOP"}(n.GameStatus||(n.GameStatus={})),function(e){e[e.NONE=0]="NONE",e[e.INIT=1]="INIT",e[e.READY=2]="READY",e[e.STARTGAME=3]="STARTGAME",e[e.DEAD=4]="DEAD",e[e.UPDATE_SCORE=5]="UPDATE_SCORE",e[e.UPDATE_HEART=6]="UPDATE_HEART",e[e.DISCONNECT=7]="DISCONNECT",e[e.FINISH=8]="FINISH"}(n.MultiPlayerState||(n.MultiPlayerState={})),function(e){e[e.SHORT=1]="SHORT",e[e.LONG=2]="LONG"}(n.TileType||(n.TileType={})),function(e){e[e.HOLD_SIZE_ADDITION=200]="HOLD_SIZE_ADDITION",e[e.scaleDownDuration=.3]="scaleDownDuration",e[e.scaleDownVal=0]="scaleDownVal",e[e.scaleUpDuration=.3]="scaleUpDuration",e[e.scaleUpVal=3]="scaleUpVal",e[e.scaleAuraTweenTag=999]="scaleAuraTweenTag"}(n.SlideTileDefines||(n.SlideTileDefines={})),function(e){e[e.touchID=-1]="touchID",e[e.opacity=50]="opacity"}(n.TileDefines||(n.TileDefines={})),function(e){e[e.alignUI=100]="alignUI"}(n.progressBar||(n.progressBar={})),function(e){e[e.DIE=1]="DIE",e[e.BOTDIE=1]="BOTDIE",e[e.BLANK=1]="BLANK",e[e.BUTTON=1]="BUTTON",e[e.RESULT=1]="RESULT",e[e.COMPLETE=1]="COMPLETE",e[e.COMPLETE_CROWN=1]="COMPLETE_CROWN",e[e.REPLAY_BUTTON=1]="REPLAY_BUTTON"}(n.Audio||(n.Audio={})),cc._RF.pop()},{}],DeviceSetting:[function(e,t,n){"use strict";cc._RF.push(t,"35c54QVi/pI+b2MRmvK8IJI","DeviceSetting");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isIPhoneX=!1,t.isIPad=!1,t.isIPhone2X=!1,t.isXperia1=!1,t.isIPad2=!1,t.width=0,t.height=0,t}return r(t,e),t.prototype.onLoad=function(){this.initialize()},t.prototype.initialize=function(){this.updateDesignResolutionSize()},t.prototype.isWideScreen=function(){if(this.isIPhoneX)return!0;var e=cc.view.getFrameSize(),t=cc.view.getDesignResolutionSize(),n=t.height/t.width,o=e.height/e.width;return!(1125/2436>o)&&n<o},t.prototype.updateDesignResolutionSize=function(){var e=cc.view.getFrameSize(),t=cc.view.getDesignResolutionSize(),n=t.width,o=t.height;this.width=n,this.height=o,n/o>e.width/e.height?(this.height=o=this.width*e.height/e.width,this.isIPhoneX=!0):(Math.abs(n/o-e.width/e.height)>cc.macro.FLT_EPSILON&&(this.isIPad=!0),this.height=o=this.height*e.width/e.height)},i([s],t)}(cc.Component));n.default=c,cc._RF.pop()},{}],EffectController:[function(e,t,n){"use strict";cc._RF.push(t,"36621nJsvhHHI8VGgVxFxH5","EffectController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../Components/ParticleControl"),s=e("../../Utils/KeyedDictionary"),c=e("../../Components/FireflyEffect"),l=cc._decorator,u=l.ccclass,p=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.perfect=null,t.great=null,t.cool=null,t.xCombo=null,t.unbelievable=null,t.fireflyEffect=null,t.effectDict=new s.KeyedDictionary,t.xComboTween=null,t}return r(t,e),t.prototype.onLoad=function(){this.effectDict.add("perfect",this.perfect),this.effectDict.add("great",this.great),this.effectDict.add("cool",this.cool),this.perfect.play(),this.cool.play(),this.great.play()},t.prototype.doActive=function(){this.node.opacity=255},t.prototype.doDeactive=function(){this.node.opacity=0},t.prototype.showUnbelievable=function(){this.unbelievable.node.active=!0,this.unbelievable.node.opacity=255,this.unbelievable.node.scale=2;var e=cc.tween;e(this.unbelievable.node).delay(3).parallel(e().to(1.2,{scale:5}),e().to(1.2,{opacity:0})).start()},t.prototype.showFirefly=function(){},t.prototype.resetEffect=function(){var e=this.effectDict.keys();for(var t in e){var n=this.effectDict.item(e[t]);n.stop(),n.node.opacity=0}this.xCombo.node.opacity=0},t.prototype.showEffect=function(e,t){var n=this.effectDict.item(e);n&&(this.resetEffect(),n.node.opacity=255,n.play(),0==e.localeCompare("perfect")?(this.xCombo.string="x"+t,this.xCombo.node.opacity=255,this.xCombo.node.setScale(0),null!=this.xComboTween&&this.xComboTween.stop(),this.xComboTween=cc.tween(this.xCombo.node).to(.2,{scale:1},{easing:"sineOut"}).delay(.5).to(.3,{opacity:0}).start()):this.xCombo.node.opacity=0)},t.prototype.hideUIForQuickPlay=function(){this.xCombo.node.active=!1},t.prototype.instantiatePerfect=function(){for(var e=0;e<100;e++){var t=cc.instantiate(this.perfect.node).getComponent(a.default);this.node.addChild(t.node),t.play()}},t.prototype.setScaleParticles=function(e){this.perfect.setScale(e),this.great.setScale(e),this.cool.setScale(e)},i([p(a.default)],t.prototype,"perfect",void 0),i([p(a.default)],t.prototype,"great",void 0),i([p(a.default)],t.prototype,"cool",void 0),i([p(cc.Label)],t.prototype,"xCombo",void 0),i([p(cc.Sprite)],t.prototype,"unbelievable",void 0),i([p(c.default)],t.prototype,"fireflyEffect",void 0),i([u],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../../Components/FireflyEffect":"FireflyEffect","../../Components/ParticleControl":"ParticleControl","../../Utils/KeyedDictionary":"KeyedDictionary"}],EnhancedLoading:[function(e,t,n){"use strict";cc._RF.push(t,"ceb5e1ky9VL4r4QhSdcPW/K","EnhancedLoading");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EnhancedLoading=n.LoadingResultType=void 0;var i=e("../Utils/GameUtils");(function(e){e.GAME_SETTING="GAME_SETTING",e.LOCAL_DATA="LOCAL_DATA",e.CLIENT="CLIENT",e.SESSION="SESSION",e.AVATAR_CONFIG="AVATAR_CONFIG",e.FRAME_CONFIG="FRAME_CONFIG",e.LEVEL_CONFIG="LEVEL_CONFIG",e.YOUTUBE_INIT="YOUTUBE_INIT",e.SONG_LIST_CONFIG="SONG_LIST_CONFIG"})(n.LoadingResultType||(n.LoadingResultType={}));var a=function(){function e(){var e=this;this.providerList=[],this.loadingQueue=[],this.completedResults=new Set,this.loadingComponents=0,this.canStartLoading=function(t){return t.resultRequire.every(function(t){return e.completedResults.has(t)})},this.loadComponent=function(t){return o(e,void 0,Promise,function(){var e=this;return r(this,function(n){switch(n.label){case 0:return this.loadingComponents++,[4,t.executeFunction()];case 1:return n.sent(),this.loadingComponents--,t.resultList.forEach(function(t){e.completedResults.add(t)}),this.processQueue(),[2]}})})}}return e.prototype.addProvider=function(e){this.providerList.push(e)},e.prototype.beginLoad=function(){return o(this,void 0,Promise,function(){var e,t,n,o,a=this;return r(this,function(r){switch(r.label){case 0:for(this.loadingQueue=[],this.completedResults.clear(),e=0,t=this.providerList;e<t.length;e++)n=t[e],(o=this.loadingQueue).push.apply(o,n.getLoadingComponentList());return this.processQueue(),[4,i.default.waitWhile(function(){return a.loadingComponents>0})];case 1:return r.sent(),[2]}})})},e.prototype.processQueue=function(){return o(this,void 0,Promise,function(){var e=this;return r(this,function(){return this.loadingQueue.length>0&&this.loadingQueue.filter(this.canStartLoading).forEach(function(t){e.loadingQueue.splice(e.loadingQueue.indexOf(t),1),e.loadComponent(t)}),[2]})})},e}();n.EnhancedLoading=a,cc._RF.pop()},{"../Utils/GameUtils":"GameUtils"}],FireflyEffect:[function(e,t,n){"use strict";cc._RF.push(t,"76176NB8u9IMonNrtlfReRE","FireflyEffect");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),e("../Utils/GameUtils");var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fireFlyPrefab=null,t.holder=null,t.pools=new cc.NodePool("firefly"),t.halfScreenSize=null,t.delayTimeSpawn=0,t.maxScale=.5,t}return r(t,e),t.prototype.onLoad=function(){if(this.halfScreenSize=cc.size(cc.Canvas.instance.node.width/2,cc.Canvas.instance.node.height/2),!(this.pools.size()>0))for(var e=0;e<5;e++){var t=cc.instantiate(this.fireFlyPrefab);this.pools.put(t)}},t.prototype.spawnFireFly=function(){},t.prototype.update=function(e){this.delayTimeSpawn-=e,this.delayTimeSpawn<0&&(this.spawnFireFly(),this.delayTimeSpawn=2*Math.random()+.2)},t.prototype.return=function(e){this.pools.put(e)},i([c(cc.Prefab)],t.prototype,"fireFlyPrefab",void 0),i([c(cc.Node)],t.prototype,"holder",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{"../Utils/GameUtils":"GameUtils"}],FirestoreManager:[function(e,t,n){"use strict";cc._RF.push(t,"dc962cpEx1PeZgylLA7agAH","FirestoreManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r(t,e),n=t,t.prototype.onLoad=function(){n.Instance=this},n=i([s],t)}(cc.Component));n.default=c,cc._RF.pop()},{}],FollowNode:[function(e,t,n){"use strict";cc._RF.push(t,"0d6ebea+udJlbdj7gmpoYIp","FollowNode");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.target=null,t.canvas=null,t.parent=null,t}return r(t,e),t.prototype.start=function(){var e=this.target.parent.convertToWorldSpaceAR(this.target.position);this.node.setPosition(this.parent.convertToNodeSpaceAR(e))},t.prototype.update=function(){var e=this.target.parent.convertToWorldSpaceAR(this.target.position);this.node.setPosition(this.parent.convertToNodeSpaceAR(e))},i([c(cc.Node)],t.prototype,"target",void 0),i([c(cc.Node)],t.prototype,"canvas",void 0),i([c(cc.Node)],t.prototype,"parent",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],FrameItem:[function(e,t,n){"use strict";cc._RF.push(t,"406d6mujrxGQp1DbKHWS2h3","FrameItem");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../AudioManager"),l=e("../ConfigManager"),u=e("../Controller/MainController"),p=e("../GameEvent"),h=e("../GameManager"),d=e("../ResourcesManager"),f=cc._decorator,g=f.ccclass,y=f.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.avatarSprite=null,t.frameSprite=null,t.checkNode=null,t.button=null,t.loadingNode=null,t.lockNode=null,t.loadSession=0,t.loadingCount=0,t.config=null,t.onClickButton=function(){if(u.default.Instance.isFrameLocked(t.config.frameId))c.default.Instance.playButton(),cc.view.emit(p.GameEvent.EVENT_CHANGE_PROFILE_FRAME_REQUEST,new p.ChangeProfileFrameRequestEvent(t.config.frameId));else{var e=t.button.node.convertToWorldSpaceAR(cc.v2(0,0)),n=h.default.Instance.uiZone.convertToNodeSpaceAR(e),o=u.default.Instance.getFrameUnlockText(t.config.frameId),r=new p.ShowTooltipRequestEvent(o,n);cc.view.emit(p.GameEvent.EVENT_SHOW_TOOLTIP_REQUEST,r)}},t.refreshCheck=function(){t.checkNode.active=t.config.frameId===u.default.Instance.userDataService.getCurrentFrameId()},t}return r(t,e),t.prototype.onLoad=function(){this.button.node.on("click",this.onClickButton,this)},t.prototype.onEnable=function(){cc.view.on(p.GameEvent.EVENT_PROFILE_FRAME_CHANGED,this.refreshCheck,this)},t.prototype.onDisable=function(){this.loadSession++,cc.view.off(p.GameEvent.EVENT_PROFILE_FRAME_CHANGED,this.refreshCheck,this)},t.prototype.init=function(e){var t=this;this.config=l.default.Instance.getFrameConfig(e),this.loadSession++;var n=this.loadSession;this.showLoading(),Promise.all([this.loadSprite(this.config.frameId,this.frameSprite,d.default.Instance.loadFrame,d.default.Instance.defaultFrame,n),this.loadSprite(u.default.Instance.userDataService.getCurrentAvatarId(),this.avatarSprite,d.default.Instance.loadAvatar,d.default.Instance.defaultAvatar,n)]).then(function(){t.hideLoading()}),this.refreshUI()},t.prototype.refreshUI=function(){this.refreshCheck(),this.refreshLock()},t.prototype.refreshLock=function(){this.lockNode.active=!u.default.Instance.isFrameLocked(this.config.frameId)},t.prototype.loadSprite=function(e,t,n,o,r){return a(this,void 0,Promise,function(){var i;return s(this,function(a){switch(a.label){case 0:return null==e||""==e?(t.node.active=!1,[2]):(t.node.active=!0,t.spriteFrame=o,[4,n.call(d.default.Instance,e)]);case 1:return i=a.sent(),r!==this.loadSession?[2]:(i&&(t.spriteFrame=i),[2])}})})},t.prototype.showLoading=function(){this.loadingCount++,this.loadingNode.active=!0},t.prototype.hideLoading=function(){this.loadingCount--,this.loadingNode.active=this.loadingCount>0},i([y(cc.Sprite)],t.prototype,"avatarSprite",void 0),i([y(cc.Sprite)],t.prototype,"frameSprite",void 0),i([y(cc.Node)],t.prototype,"checkNode",void 0),i([y(cc.Button)],t.prototype,"button",void 0),i([y(cc.Node)],t.prototype,"loadingNode",void 0),i([y(cc.Node)],t.prototype,"lockNode",void 0),i([g],t)}(cc.Component);n.default=v,cc._RF.pop()},{"../AudioManager":"AudioManager","../ConfigManager":"ConfigManager","../Controller/MainController":"MainController","../GameEvent":"GameEvent","../GameManager":"GameManager","../ResourcesManager":"ResourcesManager"}],FrameTab:[function(e,t,n){"use strict";cc._RF.push(t,"0cbecXC5k9Az5oEygRzhoxG","FrameTab");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../ConfigManager"),s=e("../GameManager"),c=e("./FrameItem"),l=cc._decorator,u=l.ccclass,p=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layout=null,t.containerWidget=null,t.frameItemPrefab=null,t.container=null,t.frameItems=[],t.frameItemPool=new cc.NodePool,t}return r(t,e),t.prototype.onEnable=function(){this.initItemSize(),this.refresh(),cc.view.on(s.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChaged,this)},t.prototype.onDisable=function(){cc.view.off(s.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChaged,this)},t.prototype.refresh=function(){var e=this;this.frameItems.forEach(function(t){e.frameItemPool.put(t.node)}),this.frameItems=[],a.default.Instance.getFrameIds().forEach(function(t){var n;(n=e.frameItemPool.size()>0?e.frameItemPool.get():cc.instantiate(e.frameItemPrefab)).setContentSize(e.itemSize),e.container.addChild(n);var o=n.getComponent(c.default);o.init(t),e.frameItems.push(o)})},t.prototype.initItemSize=function(){this.containerWidget.updateAlignment();var e=(this.layout.node.width-this.layout.paddingLeft-this.layout.paddingRight-3*this.layout.spacingX)/4-10;this.itemSize=new cc.Size(e,e)},t.prototype.onCanvasSizeChaged=function(){this.initItemSize(),this.refresh()},i([p(cc.Layout)],t.prototype,"layout",void 0),i([p(cc.Widget)],t.prototype,"containerWidget",void 0),i([p(cc.Prefab)],t.prototype,"frameItemPrefab",void 0),i([p(cc.Node)],t.prototype,"container",void 0),i([u],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../ConfigManager":"ConfigManager","../GameManager":"GameManager","./FrameItem":"FrameItem"}],FromJsonToSongConfig:[function(e,t,n){"use strict";cc._RF.push(t,"37ff2Suu39K7ribcC9h/WQs","FromJsonToSongConfig"),Object.defineProperty(n,"__esModule",{value:!0}),n.FromJsonToSongConfig=void 0;var o=e("../SongListManager"),r=e("../Data/GameConfig"),i=function(){function e(){}return e.prototype.parse=function(e){return new Promise(function(t){t(JSON.parse(e).map(function(e){var t=new r.SongConfig;return t.songId=e.ID,t.songName=e.Name,t.artistName=e.Author,t.midiLink=e.MidiFile,t.mp3FileLink=e.Mp3File,t.mp3ReviewLink=e.PreviewMp3File,t.songTrackClip=o.default.Instance.splitStringToNumberArray(e.SongTrackClip),t.songTrackSpeed=o.default.Instance.splitStringToNumberArray(e.SongTrackSpeed),t.coverImageLink=e.CoverFile,t.noteTimeUnit=e.NoteTimeUnit,t.difficulty=e.Difficulty,t.tag=e.Tag,t.midiVersion=e.MidiVersion,t}))})},e}();n.FromJsonToSongConfig=i,cc._RF.pop()},{"../Data/GameConfig":"GameConfig","../SongListManager":"SongListManager"}],FromTsvToSongConfig:[function(e,t,n){"use strict";cc._RF.push(t,"e4cefRD09hNt6RfYtROpCH7","FromTsvToSongConfig"),Object.defineProperty(n,"__esModule",{value:!0}),n.FromTsvToSongConfig=void 0;var o=e("../SongListManager"),r=e("../Data/GameConfig"),i=function(){function e(){}return e.prototype.parse=function(e){return new Promise(function(t){for(var n=e.split("\n"),i=n[0].split("\t"),a=[],s=1;s<n.length;s++){var c=n[s].trim();if(c){for(var l=c.split("\t"),u={},p=0;p<i.length;p++)u[i[p]]=l[p];var h=new r.SongConfig;h.songId=u.ID,h.songName=u.Name,h.artistName=u.Author,h.midiLink=u.MidiFile,h.mp3FileLink=u.Mp3File,h.mp3ReviewLink=u.PreviewMp3File,h.songTrackClip=o.default.Instance.splitStringToNumberArray(u.SongTrackClip),h.songTrackSpeed=o.default.Instance.splitStringToNumberArray(u.SongTrackSpeed),h.coverImageLink=u.CoverFile,h.noteTimeUnit=u.NoteTimeUnit,h.difficulty=u.Difficulty,h.tag=u.Tag,h.midiVersion=u.MidiVersion,a.push(h)}}t(a)})},e}();n.FromTsvToSongConfig=i,cc._RF.pop()},{"../Data/GameConfig":"GameConfig","../SongListManager":"SongListManager"}],GM:[function(e,t,n){"use strict";cc._RF.push(t,"196bcWq2ldBsqqn25P56jaY","GM");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Graphics/DeviceSetting"),s=e("./GlobalDefines"),c=e("./TileManager"),l=e("./Controller/GameplayController"),u=e("./GameManager"),p=cc._decorator,h=p.ccclass,d=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gpc=null,t.gm=null,t}var n;return r(t,e),n=t,t.Instance=function(){if(!n.instance){var e=new cc.Node("GM");cc.director.getScene().addChild(e),n.instance=e.addComponent(n)}return n.instance},t.prototype.onLoad=function(){n.instance=this,n.devices(),n.tileMgr=this.node.getComponent(c.default),n.gmeMgr=this.gm},t.devices=function(){return n.dsScript||(n.dsScript=n.Instance().addComponent(a.default)),n.dsScript},t.defines=function(){return n.definesScript},t.tileManager=function(){return n.tileMgr},t.gameManager=function(){return n.gmeMgr},t.tileMgr=null,t.gmeMgr=null,t.instance=null,t.dsScript=null,t.definesScript=new s.default,i([d(l.default)],t.prototype,"gpc",void 0),i([d(u.default)],t.prototype,"gm",void 0),n=i([h],t)}(cc.Component);n.default=f,cc._RF.pop()},{"./Controller/GameplayController":"GameplayController","./GameManager":"GameManager","./GlobalDefines":"GlobalDefines","./Graphics/DeviceSetting":"DeviceSetting","./TileManager":"TileManager"}],GameConfig:[function(e,t,n){"use strict";cc._RF.push(t,"b532dC/6FJGwIl2DfetAdVu","GameConfig"),Object.defineProperty(n,"__esModule",{value:!0}),n.LevelConfig=n.FrameConfig=n.AvatarConfig=n.ThemeConfig=n.SongConfig=n.SongListConfig=n.NoteData=n.NoteDataType=void 0;var o,r=e("../Handlers/FromJsonToSongConfig");(function(e){e[e.Single=0]="Single",e[e.Multi=1]="Multi",e[e.Slash=2]="Slash",e[e.Shake=3]="Shake",e[e.Dual_Single=4]="Dual_Single",e[e.Dual_Multi=5]="Dual_Multi",e[e.Hold=6]="Hold",e[e.Slide=7]="Slide",e[e.Dual_Slide=8]="Dual_Slide",e[e.Multi_Sfx=9]="Multi_Sfx",e[e.Dual_Multi_Sfx=10]="Dual_Multi_Sfx",e[e.Companion_Tile=11]="Companion_Tile",e[e.Big_Tile=12]="Big_Tile",e[e.Red_Tile_Single=13]="Red_Tile_Single",e[e.Red_Tile_Multi=14]="Red_Tile_Multi",e[e.Red_Tile_Dual_Single=15]="Red_Tile_Dual_Single",e[e.Red_Tile_Dual_Multi=16]="Red_Tile_Dual_Multi"})(o=n.NoteDataType||(n.NoteDataType={}));var i=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.index=0,this.tickStart=0,this.tickEnd=0,this.totalTicks=0,this.isDual=!1,this.laneIndex=0,this.time=0,this.tick=0,this.tickDuration=0,this.durationTicks=0,this.nodeID=0,this.velocity=0,this.inCompanionPhase=!1,this.forceLanePos=!1,this.type=o.Single,this.segmentLane=[],this.segmentMidi=[],this.numberOfTap=0,this.laneSlider=0,8===e.length&&(this.index=e[0],this.tickStart=e[1],this.tickEnd=e[2],this.totalTicks=e[3],this.isDual=e[4],this.laneIndex=e[5],this.time=e[6],this.durationTicks=e[7])}return e.prototype.setData=function(e,t,n,o,r,i,a,s){this.index=e,this.tickStart=t,this.tickEnd=n,this.totalTicks=o,this.isDual=r,this.laneIndex=i,this.time=a,this.durationTicks=s},e.prototype.clone=function(e){this.index=e.index,this.tickStart=e.tickStart,this.tickEnd=e.tickEnd,this.totalTicks=e.totalTicks,this.isDual=e.isDual,this.laneIndex=e.laneIndex,this.time=e.time,this.durationTicks=e.durationTicks,this.nodeID=e.nodeID,this.velocity=e.velocity,this.inCompanionPhase=e.inCompanionPhase,this.forceLanePos=e.forceLanePos,this.type=e.type,this.segmentLane=e.segmentLane,this.segmentMidi=e.segmentMidi,this.laneSlider=e.laneSlider},e}();n.NoteData=i;var a=function(){function e(){}return e.prototype.getJsonParser=function(){return new r.FromJsonToSongConfig},e}();n.SongListConfig=a;var s=function(){function e(){this.songId="undefided",this.songName="undefided",this.artistName="undefined",this.mp3FileLink="undefined",this.mp3ReviewLink="undefined",this.coverImageLink="undefined",this.midiLink="undefined",this.midiVersion=null,this.isNew=!1,this.isHot=!1,this.songTrackClip=[],this.songTrackSpeed=[],this.noteTimeUnit=200,this.difficulty="",this.tag="",this.levelData=null}return e.prototype.getMp3ReviewLink=function(){return this.dataAvailable(this.mp3ReviewLink)?this.mp3ReviewLink:this.getMp3Link()},e.prototype.getCoverImageLink=function(){return this.coverImageLink},e.prototype.getMp3Link=function(){return this.mp3FileLink},e.prototype.getMidiLink=function(){return this.midiLink},e.prototype.dataAvailable=function(e){return null!=e&&null!=e&&""!=e},e.prototype.isAutoContent=function(){return"auto"==this.midiVersion},e}();n.SongConfig=s;n.ThemeConfig=function(){this.icon=null,this.backgrounds=null};n.AvatarConfig=function(){};n.FrameConfig=function(){};n.LevelConfig=function(){},cc._RF.pop()},{"../Handlers/FromJsonToSongConfig":"FromJsonToSongConfig"}],GameData:[function(e,t,n){"use strict";var o;cc._RF.push(t,"afe25sP8Z9CTJ1R3EzujP4X","GameData"),Object.defineProperty(n,"__esModule",{value:!0}),n.NoteData=n.NoteDataType=void 0,function(e){e[e.Single=0]="Single",e[e.Multi=1]="Multi",e[e.Slash=2]="Slash",e[e.Shake=3]="Shake",e[e.Dual_Single=4]="Dual_Single",e[e.Dual_Multi=5]="Dual_Multi",e[e.Hold=6]="Hold",e[e.Slide=7]="Slide",e[e.Dual_Slide=8]="Dual_Slide",e[e.Multi_Sfx=9]="Multi_Sfx",e[e.Dual_Multi_Sfx=10]="Dual_Multi_Sfx",e[e.Companion_Tile=11]="Companion_Tile",e[e.Big_Tile=12]="Big_Tile",e[e.Red_Tile_Single=13]="Red_Tile_Single",e[e.Red_Tile_Multi=14]="Red_Tile_Multi",e[e.Red_Tile_Dual_Single=15]="Red_Tile_Dual_Single",e[e.Red_Tile_Dual_Multi=16]="Red_Tile_Dual_Multi"}(o=n.NoteDataType||(n.NoteDataType={}));var r=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.index=0,this.tickStart=0,this.tickEnd=0,this.totalTicks=0,this.isDual=!1,this.laneIndex=0,this.time=0,this.tick=0,this.tickDuration=0,this.durationTicks=0,this.nodeID=0,this.velocity=0,this.inCompanionPhase=!1,this.forceLanePos=!1,this.type=o.Single,this.segmentLane=[],this.segmentMidi=[],this.numberOfTap=0,this.laneSlider=0,8===e.length&&(this.index=e[0],this.tickStart=e[1],this.tickEnd=e[2],this.totalTicks=e[3],this.isDual=e[4],this.laneIndex=e[5],this.time=e[6],this.durationTicks=e[7])}return e.prototype.setData=function(e,t,n,o,r,i,a,s){this.index=e,this.tickStart=t,this.tickEnd=n,this.totalTicks=o,this.isDual=r,this.laneIndex=i,this.time=a,this.durationTicks=s},e.prototype.clone=function(e){this.index=e.index,this.tickStart=e.tickStart,this.tickEnd=e.tickEnd,this.totalTicks=e.totalTicks,this.isDual=e.isDual,this.laneIndex=e.laneIndex,this.time=e.time,this.durationTicks=e.durationTicks,this.nodeID=e.nodeID,this.velocity=e.velocity,this.inCompanionPhase=e.inCompanionPhase,this.forceLanePos=e.forceLanePos,this.type=e.type,this.segmentLane=e.segmentLane,this.segmentMidi=e.segmentMidi,this.laneSlider=e.laneSlider},e}();n.NoteData=r,cc._RF.pop()},{}],GameEvent:[function(e,t,n){"use strict";cc._RF.push(t,"d91b3XggJBDTrbyMWjiLU0G","GameEvent"),Object.defineProperty(n,"__esModule",{value:!0}),n.ShowTooltipRequestEvent=n.ProfileFrameChangedEvent=n.ProfileNicknameChangedEvent=n.ProfileAvatarChangedEvent=n.ChangeProfileFrameRequestEvent=n.ChangeProfileNicknameRequestEvent=n.ChangeProfileAvatarRequestEvent=n.OpenProfileSceneRequestEvent=n.BackgroundEndLoadEvent=n.BackgroundStartLoadEvent=n.UserChangeThemeEvent=n.UserRequestThemeEvent=n.StartGameRequestEvent=n.ReviewStartSongEvent=n.StopReviewSongRequestEvent=n.StartReviewSongRequestEvent=n.GameEvent=void 0;var o=function(){function e(){}return e.EVENT_INIT_MAIN_HANDLER="EVENT_INIT_MAIN_HANDLER",e.EVENT_START_REVIEW_SONG_REQUEST="EVENT_START_REVIEW_SONG_REQUEST",e.EVENT_STOP_REVIEW_SONG_REQUEST="EVENT_STOP_REVIEW_SONG_REQUEST",e.EVENT_REVIEW_SONG_STARTED="EVENT_REVIEW_SONG_STARTED",e.EVENT_START_GAME_REQUEST="EVENT_START_GAME_REQUEST",e.EVENT_USER_CHANGE_THEME="EVENT_USER_CHANGE_THEME",e.EVENT_USER_REQUEST_THEME="EVENT_USER_REQUEST_THEME",e.EVENT_BACKGROUND_START_LOAD="EVENT_BACKGROUND_START_LOAD",e.EVENT_BACKGROUND_END_LOAD="EVENT_BACKGROUND_END_LOAD",e.EVENT_OPEN_PROFILE_SCENE_REQUEST="EVENT_OPEN_PROFILE_SCENE_REQUEST",e.EVENT_CHANGE_PROFILE_AVATAR_REQUEST="EVENT_CHANGE_PROFILE_AVATAR_REQUEST",e.EVENT_CHANGE_PROFILE_FRAME_REQUEST="EVENT_CHANGE_PROFILE_FRAME_REQUEST",e.EVENT_CHANGE_PROFILE_NICKNAME_REQUEST="EVENT_CHANGE_NICKNAME_REQUEST",e.EVENT_PROFILE_AVATAR_CHANGED="EVENT_PROFILE_AVATAR_CHANGED",e.EVENT_PROFILE_FRAME_CHANGED="EVENT_PROFILE_FRAME_CHANGED",e.EVENT_PROFILE_NICKNAME_CHANGED="EVENT_PROFILE_NICKNAME_CHANGED",e.EVENT_SHOW_TOOLTIP_REQUEST="EVENT_SHOW_TOOLTIP_REQUEST",e}();n.GameEvent=o;n.StartReviewSongRequestEvent=function(){};n.StopReviewSongRequestEvent=function(){};n.ReviewStartSongEvent=function(){};n.StartGameRequestEvent=function(){};n.UserRequestThemeEvent=function(){};n.UserChangeThemeEvent=function(){};n.BackgroundStartLoadEvent=function(){};n.BackgroundEndLoadEvent=function(){};n.OpenProfileSceneRequestEvent=function(){};n.ChangeProfileAvatarRequestEvent=function(e){this.avatarId=e};n.ChangeProfileNicknameRequestEvent=function(){};n.ChangeProfileFrameRequestEvent=function(e){this.frameId=e};n.ProfileAvatarChangedEvent=function(){};n.ProfileNicknameChangedEvent=function(){};n.ProfileFrameChangedEvent=function(){};n.ShowTooltipRequestEvent=function(e,t){this.text=e,this.position=t},cc._RF.pop()},{}],GameManager:[function(e,t,n){"use strict";cc._RF.push(t,"74231x2q8lCAJblnBwNdTN+","GameManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.GameLog=void 0;var c=e("./Gameplay/ProgressBar/Counter"),l=e("./Controller/GameplayController"),u=e("./Controller/MainController"),p=e("./SongListManager"),h=e("./SceneManager"),d=e("./LeaderBoardManager"),f=e("./ThemeManager"),g=e("./PreviewSongManager"),y=e("./ResourcesManager"),v=e("./GameEvent"),m=e("./ProfileManager"),S=e("./YoutubeManager"),_=e("./ConfigManager"),b=e("./NakamaManager"),T=e("./SongChallengeManager"),C=e("./Components/EnhancedLoading"),E=e("./AudioManager"),w=function(){function e(){}return e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.logStartInit=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.logInitSuccess=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.logInitError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.remind=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e}();n.GameLog=w;var L=cc._decorator,R=L.ccclass,P=L.property,I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loading=null,t.uiZone=null,t.gameCanvas=null,t.tool=null,t.setting=null,t.statusLabel=null,t.songListManager=null,t.leaderBoardManager=null,t.themeManager=null,t.previewSongManager=null,t.resourcesManager=null,t.profileManager=null,t.youtubeManager=null,t.configManager=null,t.nakamaManager=null,t.songChallengeManager=null,t.isSetup=!1,t.hasResume=!1,t.countLoop=0,t.timer=0,t.isAutoContent=!1,t.bgChangeData=null,t.startTime=-1,t.endTime=-1,t.device=["iPhone13,3","iPhone13,4","iPhone14,2","iPhone14,3","iPhone15,2","iPhone15,3"],t.indexLoadNoteFalse=0,t.userPlayScale=1,t._isMobile=null,t}var n;return r(t,e),n=t,t.prototype.onLoad=function(){return a(this,void 0,void 0,function(){return s(this,function(){return this.setting.active=!1,n.Instance=this,u.default.Instance=new u.default,u.default.Instance.init(),p.default.Instance=this.songListManager,d.default.Instance=this.leaderBoardManager,f.default.Instance=this.themeManager,g.default.Instance=this.previewSongManager,y.default.Instance=this.resourcesManager,m.default.Instance=this.profileManager,S.YoutubeManager.Instance=this.youtubeManager,_.default.Instance=this.configManager,b.default.Instance=this.nakamaManager,T.default.Instance=this.songChallengeManager,this.updateCanvasSize(),cc.view.setResizeCallback(this.onResize.bind(this)),[2]})})},t.prototype.start=function(){this.firstLoad()},t.prototype.firstLoad=function(){return a(this,void 0,void 0,function(){var e,t,n,o=this;return s(this,function(r){switch(r.label){case 0:return cc.director.getScheduler().setTimeScale(1),(e=new C.EnhancedLoading).addProvider(u.default.Instance),e.addProvider(b.default.Instance),e.addProvider(p.default.Instance),e.addProvider(f.default.Instance),e.addProvider(_.default.Instance),e.addProvider(d.default.Instance),e.addProvider(T.default.Instance),e.addProvider(m.default.Instance),e.addProvider(S.YoutubeManager.Instance),[4,e.beginLoad()];case 1:return r.sent(),E.default.Instance.init(),u.default.Instance.pauseAndResumeable.onPause(function(){w.log("[GameManager] Pause"),o.pause()}),u.default.Instance.pauseAndResumeable.onResume(function(){w.log("[GameManager] Resume"),o.resume()}),u.default.Instance.gameReady.gameReady(),[4,u.default.Instance.userDataService.saveData()];case 2:return r.sent(),t=u.default.Instance.userDataService.getData(),n=!t.tutorialPlayed,[4,p.default.Instance.loadSongList(n)];case 3:return r.sent(),n?(w.log("[Main]: Begin load scene Tutorial"),[4,h.default.Instance.showTutorialScene()]):[3,5];case 4:return r.sent(),[3,7];case 5:return w.log("[Main]: Begin load scene Home"),[4,h.default.Instance.showHome()];case 6:r.sent(),r.label=7;case 7:return[2]}})})},t.prototype.loadGamePlay=function(e,t){return void 0===t&&(t=!1),a(this,void 0,void 0,function(){var n,o,r;return s(this,function(i){switch(i.label){case 0:(n=new l.GameplayRequest).isTutorial=t,n.isSongChallenge=u.default.Instance.userDataService.getData().challengeData.challengeSongId===e,i.label=1;case 1:return i.trys.push([1,5,,6]),cc.view.emit(v.GameEvent.EVENT_STOP_REVIEW_SONG_REQUEST,new v.StopReviewSongRequestEvent),h.default.Instance.showLoading(),w.log("[Main]: Get Song Config = "+e),[4,p.default.Instance.getSongConfig(e,t)];case 2:return o=i.sent(),w.log("[Main]: DownLoad Level = "+e),[4,p.default.Instance.loadLevelWithSongId(e,t)];case 3:return i.sent(),n.songConfig=o,[4,f.default.Instance.loadCurrentBackgrounds()];case 4:return i.sent(),w.log("[Main]: Preapre Data for Gameplay",o),[3,6];case 5:return r=i.sent(),console.error("Error load gameplay",r),r instanceof Error&&console.error("Stack trace:",r.stack),h.default.Instance.hideLoading(),[2];case 6:return l.default.Instance.request=n,w.log("[Main]: Begin load scene gameplay as Tutorial = "+t),[4,h.default.Instance.showGamePlay()];case 7:return i.sent(),[2]}})})},t.prototype.onResize=function(){this.updateCanvasSize()},t.prototype.onDestroy=function(){cc.view.setResizeCallback(null)},t.prototype.updateCanvasSize=function(){var e=cc.view.getCanvasSize();if(w.log("canvas size scaled = "+e),0!=e.width&&0!=e.height){var t=cc.size(cc.view.getScaleX(),cc.view.getScaleY());if(w.log("view scaled: "+t),0!=t.width&&0!=t.height){var o=cc.size(e.width/cc.view.getScaleX(),e.height/cc.view.getScaleY());if(w.log("canvas size"+o),0!=o.width&&0!=o.height){var r=o.width/o.height,i=this.gameCanvas.designResolution,a=i.width/i.height;if(w.log("ratio = "+r),r<a)this.canvasSize=o,this.userPlayScale=1;else{var s=cc.size(o.height*a,o.height);this.canvasSize=i,this.userPlayScale=s.width/i.width}this.fullCanvasSize=o,this.node.scale=this.userPlayScale,this.uiZone.setContentSize(this.canvasSize),w.log("canvas scale = "+this.node.scale),w.log("gameplay scale = "+l.default.Instance.node.scale),cc.view.emit(n.EVENT_CANVAS_SIZE_CHANGED)}else w.error("canvas size invalid: "+e)}else w.error("view scaled invalid: "+e)}else w.error("canvas size scaled invalid: "+e)},t.prototype.btnTool=function(){this.tool.active=!this.tool.active},t.prototype.pause=function(){w.log("[Main] Pause"),l.default.Instance.pauseByBrower(),g.default.Instance.pauseCurrentSong()},t.prototype.resume=function(){return a(this,void 0,void 0,function(){return s(this,function(){return w.log("[Main] Resume"),l.default.Instance.resumeBrower(),g.default.Instance.resumeCurrentSong(),[2]})})},t.prototype.endGame=function(e){return a(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return t=l.default.Instance.request,e.isHighScore=u.default.Instance.userDataService.isHigherScore(t.songConfig.songId,e.score),e.isTutorial=t.isTutorial,e.songId=t.songConfig.songId,t.isTutorial?(u.default.Instance.userDataService.saveTutorialPlayed(),[3,3]):[3,1];case 1:return u.default.Instance.userDataService.endSong(t.songConfig.songId,c.default.score,e.stars,e.crowns),[4,d.default.Instance.updateLeaderboard(t.songConfig.songId,e.stars,e.crowns,e.score)];case 2:n.sent(),n.label=3;case 3:return[4,this.updateHighScore()];case 4:return n.sent(),[4,h.default.Instance.showResult()];case 5:return n.sent(),[2]}})})},t.prototype.updateHighScore=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return e=u.default.Instance.userDataService.getData(),t=e.songDatas.reduce(function(e,t){return e+t.star+t.crown},0),[4,u.default.Instance.userDataService.updateHighscore(t)];case 1:return n.sent(),[2]}})})},t.prototype.resultToHome=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return h.default.Instance.showLoading(),[4,p.default.Instance.loadSongList()];case 1:return e.sent(),[4,h.default.Instance.showHome()];case 2:return e.sent(),[2]}})})},t.prototype.playNextSong=function(){return a(this,void 0,void 0,function(){var e,t,n,o,r;return s(this,function(i){switch(i.label){case 0:return h.default.Instance.showLoading(),e=l.default.Instance.request,[4,p.default.Instance.loadSongList(!1)];case 1:return t=i.sent(),n=e.isTutorial?-1:t.findIndex(function(t){return t.songId===e.songConfig.songId}),e.isTutorial?[4,p.default.Instance.loadSongList(!0)]:[3,3];case 2:o=i.sent(),t=t.filter(function(e){return!o.some(function(t){return t.songName===e.songName})}),i.label=3;case 3:return[4,this.findNextSongToPlay(t,n)];case 4:return r=i.sent(),w.log("[Main] Load Gameplay"),[4,this.loadGamePlay(r.songId,!1)];case 5:return i.sent(),[2]}})})},t.prototype.findNextSongToPlay=function(e,t){return a(this,void 0,Promise,function(){var n,o,r,i;return s(this,function(a){switch(a.label){case 0:n=0,o=[function(e){return 0===e.star},function(e){return e.star<3},function(e){return e.crown<3},function(){return!0}],a.label=1;case 1:return n<o.length?(r=o[n],[4,this.findSongMatchingCondition(e,t,r)]):[3,4];case 2:if(i=a.sent())return[2,i];a.label=3;case 3:return n++,[3,1];case 4:return[2,e[(t+1)%e.length]]}})})},t.prototype.findSongMatchingCondition=function(e,t,n){return a(this,void 0,Promise,function(){var o,r,i=this;return s(this,function(c){switch(c.label){case 0:return[4,(o=function(t,o){return a(i,void 0,void 0,function(){var r,i,a;return s(this,function(){for(r=t;r!==o;r=(r+1)%e.length)if(i=e[r],a=u.default.Instance.userDataService.getSongData(i.songId),n(a))return[2,i];return[2,null]})})})((t+1)%e.length,t)];case 1:return(r=c.sent())?[2,r]:[4,o(0,t)];case 2:return[2,r=c.sent()]}})})},t.prototype.replaySong=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return e=l.default.Instance.request,w.log("[Main] Replay Song"),h.default.Instance.showLoading(),w.log("[Main] Load Gameplay"),[4,this.loadGamePlay(e.songConfig.songId,e.isTutorial)];case 1:return t.sent(),[2]}})})},t.prototype.isMobile=function(){if(null!==this._isMobile)return this._isMobile;if(cc.sys)this._isMobile=cc.sys.isMobile;else{var e=navigator.userAgent||navigator.vendor||window.opera;this._isMobile=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e.toLowerCase())}return this._isMobile},t.prototype.isPC=function(){return!this.isMobile()},t.EVENT_CANVAS_SIZE_CHANGED="canvas-size-changed",i([P(cc.Node)],t.prototype,"loading",void 0),i([P(cc.Node)],t.prototype,"uiZone",void 0),i([P(cc.Canvas)],t.prototype,"gameCanvas",void 0),i([P(cc.Node)],t.prototype,"tool",void 0),i([P(cc.Node)],t.prototype,"setting",void 0),i([P(cc.Label)],t.prototype,"statusLabel",void 0),i([P(p.default)],t.prototype,"songListManager",void 0),i([P(d.default)],t.prototype,"leaderBoardManager",void 0),i([P(f.default)],t.prototype,"themeManager",void 0),i([P(g.default)],t.prototype,"previewSongManager",void 0),i([P(y.default)],t.prototype,"resourcesManager",void 0),i([P(m.default)],t.prototype,"profileManager",void 0),i([P(S.YoutubeManager)],t.prototype,"youtubeManager",void 0),i([P(_.default)],t.prototype,"configManager",void 0),i([P(b.default)],t.prototype,"nakamaManager",void 0),i([P(T.default)],t.prototype,"songChallengeManager",void 0),n=i([R],t)}(cc.Component);n.default=I,cc._RF.pop()},{"./AudioManager":"AudioManager","./Components/EnhancedLoading":"EnhancedLoading","./ConfigManager":"ConfigManager","./Controller/GameplayController":"GameplayController","./Controller/MainController":"MainController","./GameEvent":"GameEvent","./Gameplay/ProgressBar/Counter":"Counter","./LeaderBoardManager":"LeaderBoardManager","./NakamaManager":"NakamaManager","./PreviewSongManager":"PreviewSongManager","./ProfileManager":"ProfileManager","./ResourcesManager":"ResourcesManager","./SceneManager":"SceneManager","./SongChallengeManager":"SongChallengeManager","./SongListManager":"SongListManager","./ThemeManager":"ThemeManager","./YoutubeManager":"YoutubeManager"}],GamePlaySceneController:[function(e,t,n){"use strict";cc._RF.push(t,"d70a6xRh2JAU6BMaVCbHhDR","GamePlaySceneController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../AudioManager"),l=e("../GameManager"),u=e("../Utils/GameUtils"),p=e("./BaseSceneController"),h=e("./CosmeticController"),d=e("./GameplayController"),f=e("./InfoController"),g=e("./StartController"),y=cc._decorator,v=y.ccclass,m=y.property,S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameplayControllerNode=null,t.gameplayCamera2DRoot=null,t.startController=null,t.infoController=null,t.cosmeticController=null,t.gameplayController=null,t.loadingCounter=0,t}var n;return r(t,e),n=t,t.prototype.onLoad=function(){n.Instance=this,this.gameplayController=this.gameplayControllerNode.getComponent(d.default),this.gameplayController.node.active=!1,this.gameplayCamera2DRoot.active=!1,this.node.active=!1},t.prototype.showScene=function(){return a(this,void 0,void 0,function(){var e,t,n=this;return s(this,function(o){switch(o.label){case 0:return this.gameplayController.node.active=!0,this.node.active=!0,this.gameplayCamera2DRoot.active=!0,e=d.default.Instance.request,t=e.songConfig,[4,c.default.Instance.loadFromUrl(t.getMp3Link())];case 1:return o.sent(),l.GameLog.log("[Main] Setup Gameplay"),[4,this.gameplayController.setup()];case 2:return o.sent(),l.GameLog.log("[Main] Setup Start Controller"),this.startController.setup(),l.GameLog.log("[Main] Setup Info"),this.infoController.setup(),this.cosmeticController.setup(),[4,u.default.waitUtil(function(){return n.loadingCounter<=0})];case 3:return o.sent(),[2]}})})},t.prototype.hideScene=function(){return a(this,void 0,void 0,function(){return s(this,function(){return this.gameplayController.node.active=!1,this.node.active=!1,this.gameplayCamera2DRoot.active=!1,[2]})})},t.prototype.onClickTileStart=function(){return a(this,void 0,void 0,function(){return s(this,function(){return l.GameLog.log("[Main] StartGame"),d.default.Instance.startGame(),l.GameLog.log("[Main] OnStartGame StartController"),this.startController.onStartGame(),l.GameLog.log("[Main] OnStartGame Cosmetic"),this.cosmeticController.onStartGame(),[2]})})},t.prototype.getCanvasSize=function(){return cc.size(this.node.width,this.node.height)},t.Instance=null,i([m(cc.Node)],t.prototype,"gameplayControllerNode",void 0),i([m(cc.Node)],t.prototype,"gameplayCamera2DRoot",void 0),i([m(g.default)],t.prototype,"startController",void 0),i([m(f.default)],t.prototype,"infoController",void 0),i([m(h.default)],t.prototype,"cosmeticController",void 0),n=i([v],t)}(p.default);n.default=S,cc._RF.pop()},{"../AudioManager":"AudioManager","../GameManager":"GameManager","../Utils/GameUtils":"GameUtils","./BaseSceneController":"BaseSceneController","./CosmeticController":"CosmeticController","./GameplayController":"GameplayController","./InfoController":"InfoController","./StartController":"StartController"}],GameUtils:[function(e,t,n){"use strict";cc._RF.push(t,"f8f1aewBzlJnInk5YPhBWQQ","GameUtils");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../GM"),s=cc._decorator.ccclass,c=function(){function e(){}var t;return t=e,e.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.random=function(e,t){return Math.random()*(t-e)+e},e.calcTimeFromTileToSyncline=function(e,t,n,o,r){var i=e.convertToWorldSpaceAR(n.position),s=t.convertToWorldSpaceAR(o.position);return(i.y-s.y+.5*a.default.defines().SHORT_TILE_HEIGHT)/r},e.doActionSimulationGame=function(e,t){cc.tween(e).delay(t).call(function(){}).start()},e.createEmptyNode=function(e){var t=new cc.Node("nodeTemp");return e.addChild(t),t},e.getTileXByLane=function(e){var n=t.originTileWidth*a.default.defines().MAX_LANE/2;return(e+.5)*t.originTileWidth-n},e.getLeftConnerTileXByLane=function(e){return t.getTileXByLane(e)+t.originTileWidth/2},e.csvJSON=function(e){for(var t=e.split("\n"),n=[],o=t[0].trim().split(","),r=1;r<t.length;r++){for(var i={},a=t[r].split(","),s=0;s<o.length;s++)i[o[s]]=a[s].trim();n.push(i)}return n},e.LookAt=function(e,t){var n=t.sub(e),o=n.normalize(),r=Math.atan2(o.y,o.x);return{direction:n,directionNormalized:o,radianAngle:r,angle:cc.misc.radiansToDegrees(r)}},e.delay=function(e){return r(this,void 0,Promise,function(){return i(this,function(){return[2,new Promise(function(t){return setTimeout(t,e)})]})})},e.waitUtil=function(e){return r(this,void 0,Promise,function(){return i(this,function(){return[2,new Promise(function(t){var n=function(){e()?t():requestAnimationFrame(n)};n()})]})})},e.waitWhile=function(e){return r(this,void 0,Promise,function(){return i(this,function(){return[2,new Promise(function(t){var n=function(){e()?requestAnimationFrame(n):t()};n()})]})})},e.getRandomInt=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},e.loadTextDataFromURL=function(e){return r(this,void 0,Promise,function(){return i(this,function(){return[2,new Promise(function(t,n){var o=new XMLHttpRequest;o.open("GET",e,!0),o.onload=function(){o.status>=200&&o.status<300?t(o.responseText):n(new Error("Failed to fetch TSV data: "+o.statusText))},o.onerror=function(){n(new Error("Network error occurred while fetching TSV data"))},o.send()})]})})},e.tileSize=cc.size(0,0),e.originTileWidth=0,e.vlineWidth=0,t=o([s],e)}();n.default=c,cc._RF.pop()},{"../GM":"GM"}],GameplayController:[function(e,t,n){"use strict";cc._RF.push(t,"a9bdb4CkHZKQ4aNhTTRX5h/","GameplayController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,r++)o[r]=i[a];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.BooleanRequest=n.GameplayHeartChangedEvent=n.GameplayRequest=void 0;var l=e("./ProgressBarControllers"),u=e("../Gameplay/ProgressBar/Counter"),p=e("../Gameplay/DeadZone"),h=e("../Defines"),d=e("./StartController"),f=e("../Utils/GameUtils"),g=e("../AudioManager"),y=e("../GM"),v=e("../Data/GameConfig"),m=e("./HapticController"),S=e("../GameManager"),_=e("../Gameplay/GameplayResult"),b=e("../SongListManager"),T=e("../GenObs");n.GameplayRequest=function(){};var C=function(e){this.heart=e};n.GameplayHeartChangedEvent=C;var E=cc._decorator,w=E.ccclass,L=E.property,R=function(){function e(){this.waiting=!0,this.result=!1}return e.prototype.setResult=function(e){this.waiting=!1,this.result=e},e.prototype.waitForResult=function(){return a(this,void 0,Promise,function(){var e=this;return s(this,function(t){switch(t.label){case 0:return[4,f.default.waitUtil(function(){return 0==e.waiting})];case 1:return t.sent(),[2,this.result]}})})},e}();n.BooleanRequest=R;var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mainCamera=null,t.canvas=null,t.camera=null,t.syncLine=null,t.syncLineRenderer=null,t.progress=null,t.ui=null,t.vLines=[],t.deadZone=null,t.gameMode=h.GameMode.SINGLE,t.startController=null,t.debugUI=null,t.gameManager=null,t.nodeHighScore=null,t.nodeResume=null,t.noteData=[],t.lastNoteData=new v.NoteData,t.activeTiles=[],t.tileSize=cc.Size.ZERO,t.isHit=!1,t.cameraZ=0,t.smoothDeltaTime=0,t.shouldAddNew=0,t.waitNextLoopTime=0,t.currentLoop=1,t.levelSpeed=0,t.prevNoteIndex=0,t.currentModifySpeedBySongConfig=1,t.startPosition=cc.Vec2.ZERO,t.lastNoteIndex=0,t.currentLaneIndex=0,t.tickDuration=0,t.heart=0,t.ppq=0,t.bpm=0,t.currentLevelTime=0,t.arrTimeChangleColor=[],t.arrManualTimeChangleBg=[],t.arrManualChangeBgId=[],t.bgChangeCount=0,t.prevCompLaneSupport=0,t.prevCompLaneMain=0,t.previousLanes=0,t.pulseTempo=[],t.speedTempo=[],t.posDataTile=[],t.signalChangeBg=["C0","C#0","D0","D#0","E0","F0"],t.gameStatus=-1,t.result=null,t.resumeRequest=null,t.request=null,t.keyDownMap={},t.currentScale=1,t}var n;return r(t,e),n=t,t.prototype.onLoad=function(){n.Instance=this,this.gameStatus=h.GameStatus.ONLOAD,this.startController.node.active=!1,this.nodeResume.active=!1,this.deadZone.gpc=this,this.activeTiles=[],this.canvas.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.canvas.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.canvas.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.nodeResume.on("click",this.onClickResume.bind(this))},t.prototype.start=function(){this.onCanvasSizeChanged(),cc.view.on(S.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged,this)},t.prototype.onDestroy=function(){cc.view.off(S.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged,this),this.canvas.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.canvas.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.canvas.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.nodeResume.off("click",this.onClickResume.bind(this))},t.prototype.setup=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(o){switch(o.label){case 0:return[4,this.loadLevelData(this.request.songConfig)];case 1:return(e=o.sent())?(this.initializeProperties(e),u.default.setup(),0===(t=this.generateMidiData(e)).notes.length?[2]:(this.noteData=t.notes,u.default.totalNote=this.noteData.length,this.calculateTimingParameters(),this.resetCamera(),this.calcStartPosition(3),this.request.songConfig.isAutoContent()||T.manualInitTileLanes(this),this.resetActiveTiles(),this.shouldAddNew=0,this.gameStatus=h.GameStatus.LOADED,this.preloadNotes(),this.updateHapticAndAudio(),this.heart=this.request.isTutorial||S.default.Instance.isMobile()?1:3,S.GameLog.log("this.heart",this.heart),cc.view.emit(n.EVENT_GAMEPLAY_INIT),[2])):[2]}})})},t.prototype.loadLevelData=function(e){return a(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,b.default.Instance.loadAndCloneLevel(e)];case 1:return[2,t.sent()]}})})},t.prototype.initializeProperties=function(e){this.prevNoteIndex=-1,this.bpm=e.bpm,this.ppq=e.ppq,this.currentLoop=0,this.waitNextLoopTime=0,this.lastNoteIndex=0,this.currentModifySpeedBySongConfig=1,this.currentScale=1,this.currentLevelTime=0,this.keyDownMap={}},t.prototype.generateMidiData=function(e){var t;if(this.request.songConfig.isAutoContent())t=T.legatoAutoMidi(this,e),this.initSpeedForAutoContent();else{this.initPlusTempos(e);var n=T.legatoMidi(this,e),o=0;n.forEach(function(e){o+=e.durationTicks}),t={notes:n,shortestTicks:0,ticks:o}}return t},t.prototype.calculateTimingParameters=function(){var e=this.ppq*(this.bpm/60);this.tickDuration=1/e;var t=1*y.default.defines().speedByDistance/y.default.defines().oldReferenceSpeed;this.levelSpeed=4*y.default.defines().SHORT_TILE_HEIGHT*t,S.GameLog.log(" this.startCameraSpeed ",this.levelSpeed,y.default.defines().oldReferenceSpeed),this.speedTempo.length>0&&(this.levelSpeed=this.speedTempo[0].speed,S.GameLog.log("force this.startCameraSpeed ",this.levelSpeed))},t.prototype.resetCamera=function(){this.mainCamera.x=0,this.mainCamera.y=0,this.mainCamera.z=this.cameraZ},t.prototype.resetActiveTiles=function(){for(var e=0;e<this.activeTiles.length;e++)y.default.tileManager().returnPool(this.activeTiles[e]);this.activeTiles.splice(0,this.activeTiles.length)},t.prototype.preloadNotes=function(){for(var e=0;e<30;e++)this.addNewNote()},t.prototype.updateHapticAndAudio=function(){m.default.currentMusicSpeed=this.currentScale,g.default.Instance.setSpeedMusic(this.currentScale)},t.prototype.onCanvasSizeChanged=function(){this.loadVlines(),this.alignWithScreen();var e=S.default.Instance.fullCanvasSize.width/y.default.defines().MAX_LANE,t=y.default.defines().SHORT_TILE_HEIGHT;this.tileSize=new cc.Size(e,t),f.default.tileSize=this.tileSize.clone(),f.default.originTileWidth=e},t.prototype.loadVlines=function(){for(var e=S.default.Instance.canvasSize.width/y.default.defines().MAX_LANE,t=0;t<this.vLines.length;t++){var n=this.vLines[t];n.x=e*(t-2);var o=2==t?4:2;n.setContentSize(o,4e3)}},t.prototype.alignWithScreen=function(){var e=S.default.Instance.canvasSize.height;this.camera.alignWithScreen=!1,this.camera.orthoSize=e/2;var t=this.camera.fov*cc.macro.RAD;this.cameraZ=e/(2*Math.tan(t/2)),this.camera.node.z=this.cameraZ,S.GameLog.log("set new camera orthoSize = "+this.camera.orthoSize),S.GameLog.log("set new camera z = "+this.camera.node.z),cc.view.emit(n.EVENT_CAMERA_ORTHO_CHANGED)},t.prototype.getRandomDiffLane=function(e){switch(e){case 0:case 2:e=this.getRandomLane(1,3);break;case 1:case 3:e=this.getRandomLane(0,2);break;default:e=f.default.randomInt(0,3)}return e},t.prototype.getRandomLane=function(e,t){return 0===f.default.randomInt(0,1)?e:t},t.prototype.getDualTileLane=function(e){return e<2?e+2:e-2},t.prototype.checkChangeManualBg=function(e){return this.signalChangeBg.indexOf(e.name)>-1},t.prototype.getBackgroundId=function(e){switch(e){case"C0":case"F0":return 0;case"C#0":case"E0":return 1;case"D0":return 2;case"D#0":return 3;default:return-1}},t.prototype.combineTracks=function(e){var t=c(e[0]);return e[1].forEach(function(e){t.push(e)}),t=t.sort(function(e,t){return e.ticks-t.ticks})},t.prototype.onLatency=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.gameStatus=h.GameStatus.PRELOAD_AUDIO,[4,g.default.Instance.reload()];case 1:return e.sent(),this.gameStatus=h.GameStatus.PLAYING,this.currentLevelTime=this.currentScale*this.getLevelTimeFromRealTime(-3),this.currentModifySpeedBySongConfig=1,this.updateCameraPosition(),[4,this.waitCameraTransition()];case 2:return e.sent(),this.gameStatus!=h.GameStatus.PLAYING?[2]:(g.default.Instance.setSpeedMusic(n.Instance.currentScale),g.default.Instance.seek(this.getRealTimeFromLevelTime(this.currentLevelTime)),[4,g.default.Instance.play()]);case 3:return e.sent(),cc.view.emit(n.EVENT_GAMEPLAY_START_LOOP),[2]}})})},t.prototype.waitCameraTransition=function(){return a(this,void 0,void 0,function(){var e=this;return s(this,function(){return[2,new Promise(function(t){var n=function(){e.currentLevelTime>0&&(cc.director.getScheduler().unschedule(n,e),t())};cc.director.getScheduler().schedule(n,e,0,cc.macro.REPEAT_FOREVER,0,!1)})]})})},t.prototype.startGame=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.gameStatus===h.GameStatus.PLAYING?[2]:(cc.view.emit(n.EVENT_GAMEPLAY_START),[4,this.onLatency()]);case 1:return e.sent(),[2]}})})},t.prototype.onTileTouchStart=function(e,t){if(void 0===t&&(t=!1),this.gameStatus===h.GameStatus.PLAYING){var n=this.getNextTile();this.isValidTile(e,n)&&(e.isTouch=!0,this.handleLongTile(e),this.handleSlideTile(e),e.hit(),this.isHit=!0)}},t.prototype.isValidTile=function(e,t){return null===t||(e.isDual?t.noteIndex+1>=e.noteIndex:t.noteIndex===e.noteIndex)},t.prototype.handleLongTile=function(e){"long"===e.type&&null!=e&&(e.preventPlayingEffect=!1)},t.prototype.handleSlideTile=function(e){e.noteData.type!==v.NoteDataType.Slide&&e.noteData.type!==v.NoteDataType.Dual_Slide||null!=e&&(e.preventPlayingEffect=!1)},t.prototype.onTouchStart=function(e){if(this.gameStatus===h.GameStatus.PLAYING){var t=this.screenToGamePlaySpace(e.getLocation());this.onTouchStartWithLocalPos(e.getID(),t)}},t.prototype.onTouchStartWithLocalPos=function(e,t){for(var n=0,o=0;o<this.activeTiles.length;o++){var r=this.activeTiles[o];if(this.isElementTouchable(r)){var i=r.contains(t);if(null!=i&&r._onTouchStart(e,i.localPosition)&&++n>=2)return}}0===n&&(S.GameLog.log("touch failed, go to deadzone"),this.deadZone._onTouchStart(t))},t.prototype.isElementTouchable=function(e){return e&&!e.isInPool&&!e.isHit},t.prototype.onTouchEnd=function(e){this.onTouchEndWithTouchId(e.getID())},t.prototype.onTouchEndWithTouchId=function(e){var t=this;this.activeTiles.forEach(function(n){t.isElementEligibleForTouchEnd(n,e)&&n._onTouchEnd(e)}),this.isHit=!1},t.prototype.isElementEligibleForTouchEnd=function(e,t){return!e.isInPool&&e.isTouch&&e.touchId===t},t.prototype.onTouchCancel=function(e){var t=this;this.activeTiles.forEach(function(n){t.isElementEligibleForTouchCancel(n,e)&&n._onTouchCancel(e)})},t.prototype.isElementEligibleForTouchCancel=function(e,t){return!e.isInPool&&e.isTouch&&e.touchId===t.getID()},t.prototype.checkActiveTiles=function(){for(var e=0,t=0;t<this.activeTiles.length&&t<2;t++){var n=this.activeTiles[t];if(this.isMissTile(n,!1))return;this.isTileOutOfBottomScreen(n)&&(this.removeTile(n),e++)}e>0&&this.activeTiles.splice(0,e),this.shouldAddNew+=e},t.prototype.isTileOutOfBottomScreen=function(e){return e.isOutOfBottomScreen(this.mainCamera.y)},t.prototype.removeTile=function(e){e.stopScaleUpAnimation(),y.default.tileManager().returnPool(e)},t.prototype.updateModifyCameraSpeedBySongConfig=function(){var e=this.request.songConfig;if(this.isSongConfigValid(e)){var t=this.currentModifySpeedBySongConfig;this.currentModifySpeedBySongConfig=this.calculateCurrentModifySpeed(e,this.currentLevelTime),this.currentModifySpeedBySongConfig!==t&&(S.GameLog.log("[Gameplay] currentModifySpeedBySongConfig changed from "+t+" to "+this.currentModifySpeedBySongConfig),S.GameLog.log("[Gameplay] this.gameTimeCount = "+this.currentLevelTime))}},t.prototype.isSongConfigValid=function(e){return e.songTrackClip.length===e.songTrackSpeed.length},t.prototype.calculateCurrentModifySpeed=function(e,t){if(t<0)return 1;if(0===e.songTrackClip.length)return 1;for(var n=e.songTrackSpeed[0],o=e.songTrackClip.length-1;o>=0;o--)if(e.songTrackClip[o]<t)return e.songTrackSpeed[o];return n},t.prototype.addNoteManual=function(e,t,n,o,r,i){e.type!==v.NoteDataType.Slide&&e.type!==v.NoteDataType.Dual_Slide||(t="slider");var a=y.default.tileManager().getOrCreate(t,this.node);a&&(a.noteIndex=n,a.laneIndex=i,a.gpc=this,a.isDual=e.isDual,a.noteData.clone(e),a.isHit=!1,a.OnTouchStart=this.onTileTouchStart.bind(this),a.sizeTemp=o,a.posTemp=r,this.preprocessTileFromNoteData(a))},t.prototype.isMissTile=function(e,t){return e.isTouchableOutOfBottomScreen(this.mainCamera.y)&&!e.isHit||t?(this.onDead(e),!0):!!t&&(this.onDead(e),!0)},t.prototype.pauseByBrower=function(){return a(this,void 0,void 0,function(){return s(this,function(){return this.gameStatus===h.GameStatus.PLAYING&&this.currentLevelTime>=0&&(g.default.Instance.pause(),this.gameStatus=h.GameStatus.PAUSED_BY_BROWSER),[2]})})},t.prototype.resumeBrower=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.gameStatus!==h.GameStatus.PAUSED_BY_BROWSER?[3,2]:null==(e=this.getNextTile())?(this.gameStatus=h.GameStatus.PLAYING,[2]):(S.GameLog.log("[Main] Move to Sync Line Higher"),[4,this.moveToLevelTime(e.noteData.time+-1)]);case 1:t.sent(),this.waitToResume(),t.label=2;case 2:return[2]}})})},t.prototype.onDead=function(e){return a(this,void 0,void 0,function(){var t;return s(this,function(o){switch(o.label){case 0:return this.heart--,cc.view.emit(n.EVENT_GAMEPLAY_HEART_CHANGED,new C(this.heart)),t=n.Instance.request,S.GameLog.log("[Main] Handle On Dead"),g.default.Instance.playDie(),g.default.Instance.pause(),S.GameLog.log("[Main] Move to Sync Line"),this.gameStatus=h.GameStatus.MOVING_SYNC_LINE,cc.view.emit(n.EVENT_GAMEPLAY_DEAD),[4,this.moveToLevelTime(e.noteData.time)];case 1:return o.sent(),t.isTutorial||this.heart>0?(e.playScaleUpAnimation(),S.GameLog.log("[Main] Move to Sync Line Higher"),[4,this.moveToLevelTime(e.noteData.time+-1)]):[3,4];case 2:return o.sent(),[4,this.waitToResume()];case 3:return o.sent(),[3,5];case 4:S.GameLog.log("[Main] End Game"),this.gameStatus=h.GameStatus.DIED,this.endGame(),o.label=5;case 5:return[2]}})})},t.prototype.continueAfterDead=function(e){return a(this,void 0,void 0,function(){return s(this,function(){return e.isHit=!0,[2]})})},t.prototype.waitToResume=function(){return a(this,void 0,void 0,function(){var e,t,o;return s(this,function(r){switch(r.label){case 0:return this.gameStatus=h.GameStatus.WAIT_TO_RESUME,this.activeResumeScreen(),S.GameLog.log("[Main] Requesting to Resume"),e=new R,this.resumeRequest=e,t=this.getRealTimeFromLevelTime(this.currentLevelTime),cc.view.emit(n.EVENT_GAMEPLAY_RESUME_REQUEST),[4,this.resumeRequest.waitForResult()];case 1:return o=r.sent(),S.GameLog.log("[Main] Request Resume Has Result = "+o),this.hideResumeScreen(),cc.view.emit(n.EVENT_GAMEPLAY_RESUME_RESULT),o?(S.GameLog.log("[Main] Resume Gameplay"),[4,this.seekAndPlayAudio(t)]):[3,3];case 2:return r.sent(),this.gameStatus=h.GameStatus.PLAYING,[3,4];case 3:S.GameLog.error("[Main] TODO: Handler Resume Failed"),r.label=4;case 4:return[2]}})})},t.prototype.getRealTimeFromLevelTime=function(e){var t=this.request.songConfig;if(t.songTrackClip.length!==t.songTrackSpeed.length||0===t.songTrackClip.length)return S.GameLog.log("Mismatch in lengths or empty array:",t.songTrackClip.length,t.songTrackSpeed.length),e*this.ratioWebDelay();for(var n=t.songTrackClip,o=t.songTrackSpeed,r=0,i=0;i<n.length;i++){var a=(i+1<n.length?n[i+1]:1/0)-n[i],s=a/o[i];if(e<=s)return(r+=e/o[i])*this.ratioWebDelay();e-=a,r+=s}return r*this.ratioWebDelay()},t.prototype.seekAndPlayAudio=function(e){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return g.default.Instance.seek(e),[4,g.default.Instance.play()];case 1:return t.sent(),[2]}})})},t.prototype.activeResumeScreen=function(){this.nodeResume.active=!0,this.nodeResume.getComponent(cc.Button).interactable=!0,this.nodeResume.children[1].active=!0},t.prototype.hideResumeScreen=function(){this.nodeResume.active=!1},t.prototype.responseResume=function(e){null!=this.resumeRequest&&(this.resumeRequest.setResult(e),this.resumeRequest=null)},t.prototype.onClickResume=function(){this.gameStatus==h.GameStatus.WAIT_TO_RESUME&&this.responseResume(!0)},t.prototype.onKeyDown=function(e){if(!this.keyDownMap[e.keyCode]){switch(this.keyDownMap[e.keyCode]=!0,this.gameStatus){case h.GameStatus.PLAYING:this.handleKeyDownWhenPlaying(e);break;case h.GameStatus.WAIT_TO_RESUME:this.handleKeyDownWhenWaitToResume(e)}this.gameStatus,h.GameStatus.PLAYING}},t.prototype.onKeyUp=function(e){if(delete this.keyDownMap[e.keyCode],this.gameStatus==h.GameStatus.PLAYING){var t=this.getIndexFromKeyCode(e.keyCode);-1!=t&&this.onTouchEndWithTouchId(t)}},t.prototype.handleKeyDownWhenPlaying=function(e){var t=this.getIndexFromKeyCode(e.keyCode);if(-1!=t){var n=this.getNextTile();if(null!=n){var o=n.node.y+.05*this.tileSize.height;if(!(o>this.getSyncLinePosition().y+.8*S.default.Instance.canvasSize.height)){var r=this.startPosition.x+this.tileSize.width*(t-2),i=new cc.Vec3(r,o);this.onTouchStartWithLocalPos(t,i)}}}},t.prototype.handleKeyDownWhenWaitToResume=function(){this.responseResume(!0)},t.prototype.getIndexFromKeyCode=function(e){switch(e){case cc.macro.KEY.f:return 0;case cc.macro.KEY.g:return 1;case cc.macro.KEY.h:return 2;case cc.macro.KEY.j:return 3;default:return-1}},t.prototype.getNextTile=function(){for(var e=0;e<this.activeTiles.length;e++){var t=this.activeTiles[e];if(!t.isHit)return t}return null},t.prototype.getTileByPositionY=function(e){for(var t=0;t<this.activeTiles.length;t++){var n=this.activeTiles[t];if(!n.isHit&&n.node.y<=e&&e<=n.getTopY())return n}return null},t.prototype.getSyncLinePosition=function(){var e=this.mainCamera.convertToWorldSpaceAR(this.syncLine.position);return this.node.convertToNodeSpaceAR(e)},t.prototype.moveToLevelTime=function(e){return a(this,void 0,void 0,function(){var t,n,o,r=this;return s(this,function(i){switch(i.label){case 0:return t=this.currentLevelTime,n=e,o=performance.now(),[4,new Promise(function(e){var i=function(a){var s,c=a-o,l=Math.min(c/1e3,1),u=(s=l,-(Math.cos(Math.PI*s)-1)/2);r.currentLevelTime=t+(n-t)*u,r.updateCameraPosition(),l<1?requestAnimationFrame(i):e()};requestAnimationFrame(i)})];case 1:return i.sent(),[2]}})})},t.prototype.update=function(e){var t=this;if(this.smoothDeltaTime=e,this.gameStatus==h.GameStatus.WAIT_NEXT_LOOP)return this.waitNextLoopTime-=e,0===y.default.defines().maxLoop&&(y.default.defines().maxLoop=-1),void(this.waitNextLoopTime<=0&&(this.waitNextLoopTime=0,this.nextLoop()));this.gameStatus===h.GameStatus.PLAYING&&(this.gameManager.isMultiTrack&&this.bgChangeCount<this.gameManager.bgChangeData.notes.length&&g.default.Instance.getCurrentTime().then(function(e){e>=t.gameManager.bgChangeData.notes[t.bgChangeCount].time&&(t.progress.showEffectByStarActive(t.bgChangeCount),t.bgChangeCount++)}).catch(function(e){S.GameLog.error(e)}),this.shouldAddNew>0&&(this.addNewNote(),this.shouldAddNew--),this.checkActiveTiles(),0===this.activeTiles.length&&(this.waitNextLoopTime=y.default.defines().WAIT_TIME_EACH_LOOP,this.gameStatus=h.GameStatus.WAIT_NEXT_LOOP),this.updateCurrentLevelTime(e),this.updateModifyCameraSpeedBySongConfig(),this.updateCameraPosition(),cc.view.emit(n.EVENT_GAMEPLAY_UPDATED))},t.prototype.updateCurrentLevelTime=function(e){this.currentLevelTime+=e*this.getAllModifySpeed()},t.prototype.updateCameraPosition=function(){return this.mainCamera.y=this.getCameraPosition(this.currentLevelTime)},t.prototype.getTrackSpeedAtTime=function(e){return this.speedTempo.length<=0?this.levelSpeed:this.speedTempo.reduce(function(t,n){return n.time<=e&&n.time>t.time?n:t},{speed:0,time:-1/0}).speed},t.prototype.getLevelTimeFromRealTime=function(e){var t=this.request.songConfig;if(e<0)return e;if(0===t.songTrackClip.length||0===t.songTrackSpeed.length||t.songTrackClip.length!=t.songTrackSpeed.length)return e;for(var n=this.request.songConfig.songTrackClip,o=this.request.songConfig.songTrackSpeed,r=0,i=0;i<n.length;i++){var a=(i+1<n.length?n[i+1]:1/0)-n[i];if(e<=a)return r+e*o[i];e-=a,r+=a*o[i]}return r},t.prototype.getLevelTimeFromCameraTime=function(e){if(this.speedTempo.length<=0||!this.levelSpeed||0===this.levelSpeed)return e;for(var t=0,n=0,o=0;o<this.speedTempo.length&&t<e;o++){var r=o+1<this.speedTempo.length?this.speedTempo[o+1].time:e,i=this.speedTempo[o].speed,a=r-this.speedTempo[o].time,s=this.levelSpeed/i,c=Math.min(a*s,e-t);if(n+=c,(t+=c/s)>=e)break}return n},t.prototype.getCameraTimeFromLevelTime=function(e){if(this.speedTempo.length<=0||!this.levelSpeed||0===this.levelSpeed||e<=0)return e;for(var t=0,n=0,o=0;o<this.speedTempo.length&&n<e;o++){var r=o+1<this.speedTempo.length?this.speedTempo[o+1].time:e,i=Math.min(r-this.speedTempo[o].time,e-n);if(t+=i*(this.speedTempo[o].speed/this.levelSpeed),(n+=i)>=e)break}return t},t.prototype.getCameraSpeedAtLevelTime=function(e){if(0===this.speedTempo.length||e<0)return this.levelSpeed;for(var t=0;t<this.speedTempo.length;t++){var n=this.speedTempo[t];if(t===this.speedTempo.length-1||this.speedTempo[t+1].time>e)return n.speed}return this.speedTempo[this.speedTempo.length-1].speed},t.prototype.getAllModifySpeed=function(){return this.currentScale*this.currentModifySpeedBySongConfig},t.prototype.getCameraPosition=function(e){return this.startPosition.y+this.levelSpeed*this.getCameraTimeFromLevelTime(e)-this.syncLine.position.y+this.tileSize.height/2},t.prototype.getCurrentCameraSpeed=function(){return this.getCameraSpeedAtLevelTime(this.currentLevelTime)*this.currentScale*this.currentModifySpeedBySongConfig},t.prototype.nextLoop=function(){if(this.request.isTutorial||this.currentLoop+1>=y.default.defines().maxLoop)return this.gameStatus=h.GameStatus.WIN,void this.endGame();this.currentLoop+=1,this.addSpeed(y.default.defines().SPEED_ADD_PERCENT),this.mainCamera.y=0,this.calcStartPosition(3),this.prevNoteIndex=-1;for(var e=0;e<30;e++)this.addNewNote();this.onLatency()},t.prototype.endGame=function(){return a(this,void 0,void 0,function(){var e,t,o;return s(this,function(r){switch(r.label){case 0:return cc.view.emit(n.EVENT_GAMEPLAY_END),e=new _.GameplayResult,t=u.default.CurrentStar<=3?u.default.CurrentStar:3,o=(o=u.default.CurrentStar<=3?0:u.default.CurrentStar-3)>3?3:o,u.default.totalNoteRemove,u.default.totalNote,e.stars=t,e.crowns=o,e.score=u.default.score,e.percent=u.default.totalNoteRemove/u.default.totalNote,this.result=e,[4,f.default.delay(1e3)];case 1:return r.sent(),S.default.Instance.endGame(e),[2]}})})},t.prototype.calcStartPosition=function(e){var t=.5*this.tileSize.width,n=e*this.levelSpeed;this.startPosition=new cc.Vec2(t,n)},t.prototype.addNewNote=function(){var e=this.prevNoteIndex+1,t=e;if(!(t>=this.noteData.length)){var n=this.noteData[t];this.prevNoteIndex=e,this.lastNoteData.clone(n);var o=this.startPosition.y+n.tickStart*this.tickDuration*this.levelSpeed,r=f.default.getTileXByLane(n.laneIndex),i=new cc.Vec2(r,o),a=n.durationTicks*this.tickDuration,s=this.levelSpeed*a,c="long";s<=1.25*y.default.defines().SHORT_TILE_HEIGHT&&(c="short"),s<y.default.defines().SHORT_TILE_HEIGHT&&(s=Math.max(s,y.default.defines().SHORT_TILE_HEIGHT));var l=cc.size(this.tileSize.width,s);this.currentLaneIndex=n.laneIndex,this.addNoteManual(n,c,this.lastNoteIndex,l,i,this.currentLaneIndex),this.lastNoteIndex++}},t.prototype.addSpeed=function(e){this.currentScale+=e},t.prototype.getDualLane=function(e){var t=0;switch(e){case 0:t=2;break;case 1:t=3;break;case 2:t=0;break;case 3:t=1}return t},t.prototype.randomLane=function(e,t){return 0===f.default.randomInt(0,2)?e:t},t.prototype.getNoteTimeByDelta=function(e,t){for(var n=0,o=e,r=0,i=!0,a=t.length-1;a>=0;a--)if(e>=t[a].ticks){var s=this.pulseTempo[a];i&&(r=s,i=!1),n+=(o-t[a].ticks)*s,o=t[a].ticks}return{t:n,timeplus:r}},t.prototype.initPlusTempos=function(e){var t=e.tempos;this.pulseTempo=[];for(var n=0;n<t.length;n++){var o=6e7/t[n].bpm/1e6/e.ppq;this.pulseTempo.push(o)}for(var r=this.request.songConfig.noteTimeUnit/1e3,i=t[0].ticks,a=1,s=!0,c=t.length-1;c>=0;c--)if(i>=t[c].ticks){var l=this.pulseTempo[c];s&&(a=l,s=!1)}var u=Math.ceil(r/a);for(y.default.defines().fixedTickPerTile=0===u?y.default.defines().fixedTickPerTile:u,y.default.defines().fixedTickPerTile75percent=.75*y.default.defines().fixedTickPerTile,S.GameLog.log("xxx tick per tile: ",u,"timepluse",a),this.speedTempo=[],n=0;n<t.length;n++){var p=this.getNoteTimeByDelta(t[n].ticks,t),h=y.default.defines().SHORT_TILE_HEIGHT/(u*p.timeplus);this.speedTempo.length>0&&Math.abs(this.speedTempo[this.speedTempo.length-1].speed-h)<=1e-4||(this.speedTempo.push({time:p.t,speed:h}),S.GameLog.log("xxx midiOn: "+p.t+", pulse: "+a+", speed: "+h))}S.GameLog.log("this.speedTempo",this.speedTempo)},t.prototype.initSpeedForAutoContent=function(){this.speedTempo=[],this.speedTempo.push({time:0,speed:y.default.defines().SHORT_TILE_HEIGHT/.2})},t.prototype.preprocessTileFromNoteData=function(e){var t=this.posDataTile[e.laneIndex];if(e.posTemp.x=f.default.getTileXByLane(e.laneIndex),e.setup(e.sizeTemp,e.posTemp,this.syncLine,this.mainCamera),e.noteData.type===v.NoteDataType.Slide||e.noteData.type===v.NoteDataType.Dual_Slide){var n=e;n.intSegLane=t.intSegLane,n.endSliderLane=t.endSliderLane}this.activeTiles.push(e)},t.prototype.screenToGamePlaySpace=function(e){var t=S.default.Instance.canvasSize,n=S.default.Instance.userPlayScale,o=t.height*n,r=960-o/2,i=960+o/2;e.y=(e.y-r)/(i-r)*1920;var a=this.camera.getScreenToWorldPoint(e),s=this.node.convertToNodeSpaceAR(a);return s.x=s.x/n,s},t.prototype.ratioWebDelay=function(){return.9975},t.Instance=null,t.EVENT_GAMEPLAY_INIT="gameplay-init",t.EVENT_GAMEPLAY_START="gameplay-start",t.EVENT_GAMEPLAY_START_LOOP="gameplay-start-loop",t.EVENT_GAMEPLAY_UPDATED="gameplay-updated",t.EVENT_CAMERA_ORTHO_CHANGED="camera-ortho-changed",t.EVENT_GAMEPLAY_RESUME_REQUEST="gameplay-resume-request",t.EVENT_GAMEPLAY_RESUME_RESULT="gameplay-resume-result",t.EVENT_GAMEPLAY_DEAD="gameplay-dead",t.EVENT_GAMEPLAY_END="gameplay-end",t.EVENT_GAMEPLAY_HEART_CHANGED="gameplay-heart-changed",i([L(cc.Node)],t.prototype,"mainCamera",void 0),i([L(cc.Node)],t.prototype,"canvas",void 0),i([L(cc.Camera)],t.prototype,"camera",void 0),i([L(cc.Node)],t.prototype,"syncLine",void 0),i([L(cc.Node)],t.prototype,"syncLineRenderer",void 0),i([L(l.default)],t.prototype,"progress",void 0),i([L(cc.Node)],t.prototype,"ui",void 0),i([L([cc.Node])],t.prototype,"vLines",void 0),i([L(p.default)],t.prototype,"deadZone",void 0),i([L({type:cc.Enum(h.GameMode)})],t.prototype,"gameMode",void 0),i([L(d.default)],t.prototype,"startController",void 0),i([L(cc.Label)],t.prototype,"debugUI",void 0),i([L(S.default)],t.prototype,"gameManager",void 0),i([L(cc.Node)],t.prototype,"nodeHighScore",void 0),i([L(cc.Node)],t.prototype,"nodeResume",void 0),n=i([w],t)}(cc.Component);n.default=P,cc._RF.pop()},{"../AudioManager":"AudioManager","../Data/GameConfig":"GameConfig","../Defines":"Defines","../GM":"GM","../GameManager":"GameManager","../Gameplay/DeadZone":"DeadZone","../Gameplay/GameplayResult":"GameplayResult","../Gameplay/ProgressBar/Counter":"Counter","../GenObs":"GenObs","../SongListManager":"SongListManager","../Utils/GameUtils":"GameUtils","./HapticController":"HapticController","./ProgressBarControllers":"ProgressBarControllers","./StartController":"StartController"}],GameplayResult:[function(e,t,n){"use strict";cc._RF.push(t,"c9766IhjLZC1IvWqpSN4P8Z","GameplayResult");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),n.GameplayResult=void 0;var r=cc._decorator,i=r.ccclass,a=(r.property,function(){function e(){this.songId="",this.score=0,this.stars=0,this.crowns=0,this.percent=0,this.isTutorial=!1,this.isHighScore=!1}return o([i],e)}());n.GameplayResult=a,cc._RF.pop()},{}],GenObs:[function(e,t,n){"use strict";cc._RF.push(t,"d90acWAS+9G2Lovnd4a+0xn","GenObs");var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,r++)o[r]=i[a];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.legatoAutoMidi=n.manualInitTileLanes=n.legatoMidi=void 0;var r=e("./Data/GameConfig"),i=e("./GM"),a=function(e){for(var t,n=i.default.defines().fixedTickPerTile,o=e,a=.8*n,s=!1,c=!1,l=[],u=[],p=[],h=[],d=function(e){var i=o[e];if(p.find(function(e){return e===i})||h.find(function(e){return e===i}))return t=e,"continue";if(i.durationTicks<=a&&e+1<o.length){var d=o[e+1];s=d.nodeID===i.nodeID&&Math.abs(d.tickStart-(i.tickStart+i.durationTicks))<5,s=!1}if(s)if(s=!1,i.velocity>=100&&i.velocity<127||127===i.velocity){for(l=[],++e;e<o.length&&!(o[e].nodeID!==i.nodeID||o[e].durationTicks>a);e++)l.push(o[e]);if(--e,l.length>0){l.forEach(function(e){p.push(e)});var f=l[l.length-1];i.durationTicks=f.tickStart+f.tickDuration-i.tickStart}else i.type=r.NoteDataType.Multi}else p.push(i);else{var g=i.tickStart+i.durationTicks;if(i.type===r.NoteDataType.Multi){u=[];for(var y=e+1;y<o.length;y++){var v=o[y];if(Math.abs(v.nodeID-i.nodeID)<4){if(!(g-v.tickStart>5))break;g=v.tickStart+v.durationTicks,u.push(v),c=v.time>i.time}}if(u.length>0){var m=i.tickStart;if(!c){var S=[],_=i;for(y=0;y<u.length-1;y++)(P=(R=u[y]).tickStart-m)<a?p.push(R):(_.durationTicks=P,_.durationTicks>n?(_.type=r.NoteDataType.Multi,_.durationTicks=R.tickStart-m):(_.type=r.NoteDataType.Single,_.durationTicks=0),S.push(_),m=R.tickStart,_=R);var b=(I=u[u.length-1]).tickStart-_.tickStart;b>=n&&I.durationTicks>=n?(_.durationTicks=b,_.durationTicks>n?(_.type=r.NoteDataType.Multi,_.time=I.time-_.time):_.type=r.NoteDataType.Single,S.push(_),S.push(I)):(_.durationTicks=I.tickStart+I.durationTicks-_.tickStart,_.durationTicks>n?_.type=r.NoteDataType.Multi:_.type=r.NoteDataType.Single,S.push(_),p.push(I));var T=[];for(y=0;y<u.length;y++)T.push(u[y].laneIndex);if(S.length>2){S[S.length-1].laneIndex=T[T.length-1];var C=S[0].laneIndex,E=S[S.length-1].laneIndex,w=0;for(y=1;y<S.length-1;y++,w++){var L=T[w];if(L===C||L===E)if(L<C)do{L=(L-1)%4}while(L===C||L===E);else do{L=(L+1)%4}while(L===C||L===E);S[y].laneIndex=L,C=L}}else 2===S.length&&(S[S.length-1].laneIndex=T[T.length-1],(C=S[0].laneIndex)===(E=S[S.length-1].laneIndex)&&(S[0].type=r.NoteDataType.Multi,S[0].tickDuration=S[1].tick+S[1].tickDuration-S[0].tickStart,p.push(S[1]),S.splice(1,1)));for(w=0;w<S.length;w++)h.push(S[w]);return S[S.length-1],t=e,"continue"}for(y=0;y<u.length-1;y++){var R=u[y+1];i.segmentLane.push(u[y].laneIndex);var P=R.tickStart-m;i.segmentMidi.push(P),m=R.tickStart,p.push(u[y])}var I=u[u.length-1];u[u.length-2],p.push(I),i.segmentLane.push(I.laneIndex);var O=I.tickStart+I.durationTicks-m;i.segmentMidi.push(O),i.durationTicks=I.tickStart+I.durationTicks-i.tickStart,i.type=r.NoteDataType.Slide,i.laneSlider=I.laneIndex}}if(i.nodeID>=84&&i.nodeID<88){var M=o.filter(function(e){return e.nodeID>=96&&e.tickStart>=i.tickStart&&e.tickStart<i.tickStart+i.durationTicks});M=[],o.forEach(function(e){e.nodeID>=96&&e.tickStart>=i.tickStart&&e.tickStart<i.tickStart+i.durationTicks&&M.push(e)}),M.length>0&&(i.inCompanionPhase=!0,i.velocity=i.velocity>99?99:i.velocity,M.forEach(function(e){e.forceLanePos=!0,e.inCompanionPhase=!0,e.velocity=e.velocity>99?99:e.velocity}),i.forceLanePos=M[0].forceLanePos)}if(i.velocity>=100&&i.velocity<=126){var D;if((D=Object.assign({},i)).segmentLane=[],D.segmentMidi=[],i.type===r.NoteDataType.Slide){for(i.type=D.type=r.NoteDataType.Dual_Slide,y=0;y<i.segmentLane.length;y++)D.segmentLane[y]=(i.segmentLane[y]+2)%4;for(y=0;y<i.segmentMidi.length;y++){var A=i.segmentMidi[y];D.segmentMidi.push(A)}D.laneSlider=D.segmentLane[D.segmentLane.length-1]}else i.type===r.NoteDataType.Single?i.type=D.type=r.NoteDataType.Dual_Single:i.type===r.NoteDataType.Multi&&(i.type=D.type=r.NoteDataType.Dual_Multi);i.isDual=D.isDual=!0;var N=(i.laneIndex+2)%4;D.laneIndex=N,D.nodeID=96+N,o.splice(e++,0,D)}}t=e},f=0;f<o.length;f++)d(f),f=t;for(var g=0;g<p.length;g++){var y=p[g],v=o.indexOf(y);v>=0&&o.splice(v,1)}return o};n.legatoMidi=function(e,t){var n=t.tracks.main,o=t.tracks.relation;if(n){for(var i=[],s=0;s<n.length;s++){var c,l,u=n[s],p=u.midi,h=r.NoteDataType.Single,d=127*u.velocity;l=p>=96?p-96:p-84,u.durationTicks>0&&(h=r.NoteDataType.Multi),c={index:s,tickStart:u.ticks,isDual:!1,laneIndex:l,time:u.time,durationTicks:u.durationTicks,nodeID:p,velocity:d,type:h,segmentLane:[],segmentMidi:[],numberOfTap:0,laneSlider:-1},i.push(c)}if(i=a(i),e.arrManualTimeChangleBg=[],e.arrManualChangeBgId=[],null!=o)for(var f=0;f<o.length;f++)if(p=o[f],e.checkChangeManualBg(p)){var g=e.getBackgroundId(p.name);if(g>-1){var y=p.time;y>=0&&(e.arrManualTimeChangleBg.push(y),e.arrManualChangeBgId.push(g))}}return 0==e.arrManualChangeBgId.length&&(e.arrManualTimeChangleBg.push(0),e.arrManualChangeBgId.push(0)),i}},n.manualInitTileLanes=function(e){for(var t=e.posDataTile,n=0,a=null,s=function(n){for(var o=n,a=t.length-1,s=a<20?a:a-20,c=a;c>=0&&c>=s;c--){var l=t[c],u=l.noteData.tickStart+l.noteData.durationTicks;if(o.noteData.tickStart-u>i.default.defines().fixedTickPerTile75percent)break;if(l.noteData.forceLanePos)break;if(!(o.noteData.inCompanionPhase&&o.noteData.nodeID<96&&l.noteData.inCompanionPhase))if(l.noteData.isDual){if(l.noteData.type===r.NoteDataType.Dual_Slide){if(l.endSliderLane%2!=o.laneIndex%2)break;l.laneIndex=l.noteData.laneIndex,l.endSliderLane=l.noteData.laneSlider,l.intSegLane=l.noteData.segmentLane}else{if(l.laneIndex%2!=o.laneIndex%2)break;l.laneIndex=l.noteData.laneIndex,l.endSliderLane=l.noteData.laneSlider}c>0&&(t[--c].laneIndex=e.getDualLane(l.laneIndex)),o=l}else{if(o.noteData.isDual)if(l.noteData.type===r.NoteDataType.Slide){if(l.endSliderLane%2!=o.laneIndex%2)break;l.laneIndex=l.noteData.laneIndex,l.endSliderLane=l.noteData.laneSlider,l.intSegLane=l.noteData.segmentLane}else{if(l.laneIndex%2!=o.laneIndex%2)break;l.laneIndex=l.noteData.laneIndex,l.endSliderLane=l.noteData.laneSlider}else if(l.noteData.type===r.NoteDataType.Slide){if(l.endSliderLane!==o.laneIndex)break;l.laneIndex=l.noteData.laneIndex,l.endSliderLane=l.noteData.laneSlider,l.intSegLane=l.noteData.segmentLane}else{if(l.laneIndex!==o.laneIndex)break;l.laneIndex=l.noteData.laneIndex,l.endSliderLane=l.noteData.laneSlider}o=l}}},c=function(e,t){for(var n=e.noteData,r=o(n.segmentLane),i=t-e.noteData.laneIndex,a=0;a<r.length;a++){var s=r[a]-n.laneIndex;(r[a]+i>3||r[a]+i<0)&&(s=-s),r[a]=t+s}e.laneIndex=t,e.noteData.segmentLane=r,e.endSliderLane=r[r.length-1]},l=function(o){var i=o.length,l=(t.length>0&&t[t.length-1],e.noteData);if(1===i&&!1===o[0].noteData.isDual){var u=o[0].noteData.laneIndex;o[0].endSliderLane=o[0].noteData.laneSlider,o[0].noteData.forceLanePos?o[0].noteData.inCompanionPhase&&o[0].noteData.nodeID:(n+1<l.length&&l[n+1],u>3?(u-=4,o[0].laneIndex=u,s(o[0])):o[0].noteData.type===r.NoteDataType.Slide&&c(o[0],u)),o[0].laneIndex=u,t.push(o[0]),n++}else if(2===i){var p=o[0].noteData.laneIndex;o[0].endSliderLane=o[0].noteData.laneSlider;var h=o[1].noteData.laneIndex;o[1].endSliderLane=o[1].noteData.laneSlider,o[0].noteData.forceLanePos||(n+1<l.length&&l[n+1],p>3&&(p-=4,o[0].laneIndex=p,t.splice(t.length-1,1),s(o[0]),t.push(o[0])),h=e.getDualLane(p),o[0].noteData.type===r.NoteDataType.Dual_Slide&&(o[0].noteData.laneSlider>o[0].noteData.laneIndex?1===p||3===p?(o[0].endSliderLane=p-1,o[1].endSliderLane=h-1):(o[0].endSliderLane=p+1,o[1].endSliderLane=h+1):0===p||2===p?(o[0].endSliderLane=p+1,o[1].endSliderLane=h+1):(o[0].endSliderLane=p-1,o[1].endSliderLane=h-1))),o[0].laneIndex=p,o[0].noteData.type===r.NoteDataType.Dual_Slide&&(o[0].laneIndex=o[0].noteData.laneIndex),o[1].laneIndex=h,o[1].noteData.type===r.NoteDataType.Dual_Slide&&(o[1].laneIndex=o[1].noteData.laneIndex),t.push(o[1]),n++,a=null}else t.push(o[0]),a=o[0],n++},u=0;u<e.noteData.length;u++){var p=e.noteData[u],h={laneIndex:p.laneIndex,landSilder:p.laneSlider,endSliderLane:p.laneSlider,type:p.type,noteIndex:p.index,inCompanionPhase:p.inCompanionPhase,intSegLane:p.segmentLane,noteData:p};l(a?[a,h]:[h])}},n.legatoAutoMidi=function(e,t){for(var n=[],o=t.notes,r=0,i=-1,a=-1,s=1e9,c=0;c<o.length;c++){for(var l=o[c],u=c+1<o.length?o[c+1]:null,p=null==u?l.durationTicks:u.ticks-l.ticks,h=l.ticks+l.durationTicks,d=c,f=i;f==i||f==a;)f=e.getRandomDiffLane(f);var g={index:d,tickStart:l.ticks,tickEnd:h,totalTicks:l.durationTicks,isDual:!1,laneIndex:f,time:l.time,durationTicks:l.durationTicks};if(s=Math.min(p,s),r+=p,n.push(g),l.forceDual){var y=e.getDualLane(f),v={index:d,tickStart:l.ticks,tickEnd:h,totalTicks:l.durationTicks,isDual:!0,laneIndex:y,time:l.time,durationTicks:l.durationTicks};n.push(v),a=y}else a=-1;i=f}e.arrManualTimeChangleBg=[],e.arrManualChangeBgId=[];var m=-1;for(c=0;c<t.timeChangeColor.length;c++)++m>=5&&(m=0),e.arrManualTimeChangleBg.push(t.timeChangeColor[c]),e.arrManualChangeBgId.push(m);return 0==e.arrManualChangeBgId.length&&(e.arrManualTimeChangleBg.push(0),e.arrManualChangeBgId.push(0)),{notes:n,shortestTicks:s,ticks:r}},cc._RF.pop()},{"./Data/GameConfig":"GameConfig","./GM":"GM"}],GlobalDefines:[function(e,t,n){"use strict";cc._RF.push(t,"6feafSs9p5KeJgR6N3kMuEw","GlobalDefines"),Object.defineProperty(n,"__esModule",{value:!0}),n.HapticMode=void 0;n.default=function(){this.maxLoop=3,this.NABLE_MOVE_SYNC_LINE=!1,this.NABLE_UPDATE_SYNC_LINE_UI=!0,this.MAX_LANE=4,this.SHORT_TILE_HEIGHT=480,this.SCORE_PERFECT=3,this.SCORE_GREAT=2,this.SCORE_COOL=1,this.SPEED_ADD_PERCENT=.2,this.SPEED_ADD_SMALL_PERCENT=0,this.SPEED_ADD_PERCENT_AUTOCONTENT=.1,this.TIME_ADD_SPEED_AUTOCONTENT=90,this.WAIT_TIME_EACH_LOOP=2,this.MAX_STARS=3,this.MAX_CROWN=3,this.TARGET_FRAMERATE=60,this.LOADING_TIMEOUT=30,this.MAX_RATE=2,this.MAX_SPEED=2,this.TIME_FINISH_ANIM_BG=1.377972,this.ON_READY_REQUEST="onReadyRequest",this.ON_DEATH_REQUEST="onDeadRequest",this.ON_HIT_TILE_REQUEST="onHitTileRequest",this.ON_HIT_TILE_RESPONSE="onHitTileResponse",this.ON_GUY_DEATH_RESPONSE="onGuyDeathResponse",this.ON_RESULT_RESPONSE="onResultResponse",this.ON_START_GAME_RESPONSE="onStartGameResponse",this.ON_ROOM_STATUS_CHANGED="onRoomStatusChanged",this.ON_SCORE_EFFECT="onScoreEffect",this.INDEX_TO_RANKING_TEXT=["1st","2nd","3rd","4th"],this.ENABLE_HAPTIC=!0,this.isAutoPlay=!1,this.IS_DEBUG_MODE=!1,this.speedByDistance=2500,this.fixedTickPerTile=86,this.fixedTickPerTile75percent=0,this.oldReferenceSpeed=1900,this.isMultiMissEnable=!1,this.numMissAccept=0,this.startTickFistNote=0,this.latencyBluetooth=0,this.delayRevive=.5,this.ENABLE_SLIDER_TILE="auto",this.SHOW_FTUE=!1,this.ENDLESS_MODE="auto",this.SHOW_ADS_BANNER=!1},function(e){e[e.lightImpact=0]="lightImpact",e[e.mediumImpact=1]="mediumImpact",e[e.heavyImpact=2]="heavyImpact",e[e.successNotification=3]="successNotification",e[e.warningNotification=4]="warningNotification",e[e.errorNotification=5]="errorNotification",e[e.selection=6]="selection"}(n.HapticMode||(n.HapticMode={})),cc._RF.pop()},{}],Global:[function(e,t,n){"use strict";cc._RF.push(t,"5b4b8i8nbJFYaJ92W3nF1w0","Global"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.tileMissed=null,e.LineX=[],e}();n.default=o,cc._RF.pop()},{}],GraphicsShowMesh:[function(e,t,n){"use strict";cc._RF.push(t,"509905KIDNEKbpLpCwNjrGF","GraphicsShowMesh");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator.ccclass,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){this.InjectAssembler()},t.prototype.start=function(){},t.prototype.InjectAssembler=function(){var e=this._assembler,t=(e._vset,cc.gfx),n=new t.VertexFormat([{name:t.ATTR_POSITION,type:t.ATTR_TYPE_FLOAT32,num:2},{name:"a_index",type:t.ATTR_TYPE_FLOAT32,num:1},{name:"a_dist",type:t.ATTR_TYPE_FLOAT32,num:1}]);n.name="vfmtPosIndexSdf",e.getVfmt=function(){return n},e._vset=function(t,n,o){void 0===o&&(o=0);var r=e._buffer,i=r.meshbuffer,a=r.vertexStart*e.getVfmtFloatCount(),s=i._vData;i._uintVData,s[a]=t,s[a+1]=n,s[a+2]=Math.floor(r.vertexStart),s[a+3]=o,r.vertexStart++,i._dirty=!0}},i([a],t)}(cc.Graphics);n.default=s,cc._RF.pop()},{}],HapticController:[function(e,t,n){"use strict";cc._RF.push(t,"f3d99RNE0NLnbHF/H/QFSzf","HapticController"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.SetDurationForHapticPattern=function(t){var n=e.pattern1.Pattern[0].Event.EventDuration,o=t-n-e.pattern1.Pattern[2].Event.EventDuration-.1;e.pattern1.Pattern[1].Event.EventDuration=o/e.currentMusicSpeed,e.pattern1.Pattern[2].Event.Time=(n+o)/e.currentMusicSpeed},e.GetStringForHapticPattern=function(){return JSON.stringify(e.pattern1)},e.currentMusicSpeed=1,e.pattern1={Version:1,Metadata:{Project:"Magic Tiles 3",Created:"16 Mar 2021",Description:"A pattern for long note in magic tiles 3 game on MEP platform","Author:":"hieu.nguyen@amanotes.com"},Pattern:[{Event:{Time:0,EventType:"HapticTransient",EventDuration:.08,EventParameters:[{ParameterID:"HapticIntensity",ParameterValue:.8},{ParameterID:"HapticSharpness",ParameterValue:.3}]}},{Event:{Time:.08,EventType:"HapticContinuous",EventDuration:3,EventParameters:[{ParameterID:"HapticIntensity",ParameterValue:.2},{ParameterID:"HapticSharpness",ParameterValue:.1}]}},{Event:{Time:.09,EventType:"HapticTransient",EventDuration:.03,EventParameters:[{ParameterID:"HapticIntensity",ParameterValue:.7},{ParameterID:"HapticSharpness",ParameterValue:1}]}}]},e}();n.default=o,cc._RF.pop()},{}],HeartController:[function(e,t,n){"use strict";cc._RF.push(t,"2a537KMKXBFxocrnc/q58Cd","HeartController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a,s=e("../GameManager"),c=e("./GameplayController"),l=cc._decorator,u=l.ccclass,p=l.property;(function(e){e[e.SHOWED=0]="SHOWED",e[e.SHOWING=1]="SHOWING",e[e.HIDED=2]="HIDED",e[e.HIDDING=3]="HIDDING"})(a||(a={}));var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container=null,t.nodeHearts=[],t.heartStates=[],t}return r(t,e),t.prototype.onLoad=function(){var e=this;this.nodeHearts.forEach(function(t,n){t.active=!1,t.opacity=0,t.scale=0,e.heartStates[n]=a.HIDED}),cc.view.on(c.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit,this),cc.view.on(c.default.EVENT_GAMEPLAY_START,this.onGameplayStart,this),cc.view.on(c.default.EVENT_GAMEPLAY_HEART_CHANGED,this.onGameplayHeartChanged,this)},t.prototype.onDestroy=function(){cc.view.off(c.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit,this),cc.view.off(c.default.EVENT_GAMEPLAY_START,this.onGameplayStart,this),cc.view.off(c.default.EVENT_GAMEPLAY_HEART_CHANGED,this.onGameplayHeartChanged,this)},t.prototype.onGameplayHeartChanged=function(e){var t=this;s.default.Instance.isMobile()||this.nodeHearts.forEach(function(n,o){o<e.heart?t.heartStates[o]!==a.SHOWING&&t.heartStates[o]!==a.SHOWED&&t.animateNodeIn(n,o):t.heartStates[o]!==a.HIDDING&&t.heartStates[o]!==a.HIDED&&t.animateNodeOut(n,o)})},t.prototype.onGameplayInit=function(){var e=this,t=c.default.Instance.request;this.container.active=!s.default.Instance.isMobile()&&!t.isTutorial,this.container.active&&this.nodeHearts.forEach(function(t,n){t.active=!1,t.opacity=0,t.scale=0,e.heartStates[n]=a.HIDED})},t.prototype.onGameplayStart=function(){var e=this;this.container.active&&this.nodeHearts.forEach(function(t,n){e.animateNodeIn(t,n)})},t.prototype.animateNodeIn=function(e,t){var n=this;e.active=!0,cc.Tween.stopAllByTarget(e),this.heartStates[t]=a.SHOWING,cc.tween(e).to(.5,{opacity:255,scale:1,angle:360},{easing:"backOut"}).call(function(){n.heartStates[t]=a.SHOWED}).start()},t.prototype.animateNodeOut=function(e,t){var n=this;cc.Tween.stopAllByTarget(e),this.heartStates[t]=a.HIDDING,cc.tween(e).sequence(cc.tween().by(.1,{angle:15}).by(.1,{angle:-30}).by(.1,{angle:15}),cc.tween().to(.5,{opacity:0,scale:0,angle:-360},{easing:"backIn"})).call(function(){e.active=!1,n.heartStates[t]=a.HIDED}).start()},i([p([cc.Node])],t.prototype,"container",void 0),i([p([cc.Node])],t.prototype,"nodeHearts",void 0),i([u],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../GameManager":"GameManager","./GameplayController":"GameplayController"}],HighlightNoteEffect:[function(e,t,n){"use strict";cc._RF.push(t,"54fe0Fo7lJLupX6ozHuM8lG","HighlightNoteEffect");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.animSprite=null,t.render=null,t.isInUse=!1,t}return r(t,e),t.prototype.doAnim=function(e){this.animSprite.node.stopAllActions(),this.animSprite.node.setContentSize(e),this.render.node.setContentSize(e.width-20,e.height-20),cc.tween(this.animSprite.node).repeatForever(cc.tween(this.animSprite.node).to(.3,{scaleX:1.05,scaleY:1.05},{easing:"smooth"}).to(.15,{scale:1},{easing:"smooth"})).start()},i([c(cc.Sprite)],t.prototype,"animSprite",void 0),i([c(cc.Sprite)],t.prototype,"render",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],HoldTileEffect:[function(e,t,n){"use strict";cc._RF.push(t,"fe01eqPmBRCa4f4wh7jgwFe","HoldTileEffect");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.holdEffect=null,t.holdSprite=null,t._maxSize=0,t._targetHoldEffectScale=2.2,t}return r(t,e),t.prototype.start=function(){},t.prototype.processEndTouch=function(e){this.holdEffect.scale=Math.max(0,this.holdEffect.scale-e)},t.prototype.setVisibleHoldSprite=function(e){this.holdSprite.active=e},t.prototype.setHoldSpriteSize=function(e){this.holdSprite.setContentSize(e)},i([c(cc.Node)],t.prototype,"holdEffect",void 0),i([c(cc.Node)],t.prototype,"holdSprite",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],HomeSceneController:[function(e,t,n){"use strict";cc._RF.push(t,"bccbcpMz21PQ430m1mvmj6R","HomeSceneController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../GameEvent"),l=e("../GameManager"),u=e("../SceneManager"),p=e("./BaseSceneController"),h=e("./MainController"),d=e("../SongListManager"),f=cc._decorator,g=f.ccclass,y=f.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.topNode=null,t.midNode=null,t.botNode=null,t}return r(t,e),t.prototype.showScene=function(){this.node.active=!0,this.topNode.active=!0,this.midNode.active=!0,this.botNode.active=!0,this.playPreviewSong(),cc.view.on(c.GameEvent.EVENT_START_GAME_REQUEST,this.onStartGameRequest,this),cc.view.on(c.GameEvent.EVENT_OPEN_PROFILE_SCENE_REQUEST,this.onOpenProfileSceneRequest,this)},t.prototype.hideScene=function(){this.node.active=!1,this.topNode.active=!1,this.midNode.active=!1,this.botNode.active=!1,cc.view.off(c.GameEvent.EVENT_START_GAME_REQUEST,this.onStartGameRequest,this),cc.view.off(c.GameEvent.EVENT_OPEN_PROFILE_SCENE_REQUEST,this.onOpenProfileSceneRequest,this)},t.prototype.playPreviewSong=function(){return a(this,void 0,void 0,function(){var e,t,n;return s(this,function(o){switch(o.label){case 0:return null!==h.default.Instance.runtimeData.currentSongUrl?[2]:[4,d.default.Instance.getSongList(!1)];case 1:return null!=(e=o.sent())&&e.length>0&&(t=this.selectSong(e),(n=new c.StartReviewSongRequestEvent).url=t.getMp3ReviewLink(),cc.view.emit(c.GameEvent.EVENT_START_REVIEW_SONG_REQUEST,n)),[2]}})})},t.prototype.onStartGameRequest=function(e){l.default.Instance.loadGamePlay(e.songId)},t.prototype.onOpenProfileSceneRequest=function(){u.default.Instance.showProfile()},t.prototype.selectSong=function(e){var t=1e6,n=null;return e.forEach(function(e){var o=h.default.Instance.userDataService.getSongData(e.songId),r=o.star+o.crown;r<t&&(t=r,n=e)}),null==n&&e.length>0&&(n=e[0]),n},i([y(cc.Node)],t.prototype,"topNode",void 0),i([y(cc.Node)],t.prototype,"midNode",void 0),i([y(cc.Node)],t.prototype,"botNode",void 0),i([g],t)}(p.default);n.default=v,cc._RF.pop()},{"../GameEvent":"GameEvent","../GameManager":"GameManager","../SceneManager":"SceneManager","../SongListManager":"SongListManager","./BaseSceneController":"BaseSceneController","./MainController":"MainController"}],IAudioEnabledChangable:[function(e,t,n){"use strict";cc._RF.push(t,"f80bexE/gpG1J/AlewcamKe","IAudioEnabledChangable"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],IDataStoragable:[function(e,t,n){"use strict";cc._RF.push(t,"8115fe0RZhKhZ/pbc9l1KtP","IDataStoragable"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],IFirstFrameReady:[function(e,t,n){"use strict";cc._RF.push(t,"fc47bYagWdCULpUXM36ph4r","IFirstFrameReady"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],IGameReady:[function(e,t,n){"use strict";cc._RF.push(t,"28df2+DQLdFzrEfES3OUsw+","IGameReady"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],IHighScoreSender:[function(e,t,n){"use strict";cc._RF.push(t,"4740b5KTRBKpatjWPp3iIfu","IHighScoreSender"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],IParseSongListConfig:[function(e,t,n){"use strict";cc._RF.push(t,"224d33NNU1GOLSXP1ptRT3C","IParseSongListConfig"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],IPauseAndResumeable:[function(e,t,n){"use strict";cc._RF.push(t,"eea3bEQwn9I4bH7YdBZ2PdQ","IPauseAndResumeable"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],IUnlockFrameChecker:[function(e,t,n){"use strict";cc._RF.push(t,"88dafx1imhJUYoDLFNw0tXc","IUnlockFrameChecker"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],InOutParticleSysytem:[function(e,t,n){"use strict";cc._RF.push(t,"cfc33u2W7lNnYXSPUKUhIei","InOutParticleSysytem");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=e("./particle-simulator");cc.ParticleSystem.prototype.initProperties=function(){this._previewTimer=null,this._focused=!1,this._aspectRatio=1,this._simulator=new l.default(this),this._startColor=cc.color(255,255,255,255),this._startColorVar=cc.color(0,0,0,0),this._endColor=cc.color(255,255,255,0),this._endColorVar=cc.color(0,0,0,0),this._renderSpriteFrame=null};var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.zoomInOutSpeed=3,t.zoomInOutIntensity=6,t.opacityInOutSpeed=0,t.opacityInOutDuration=2,t}return r(t,e),i([c],t.prototype,"zoomInOutSpeed",void 0),i([c],t.prototype,"zoomInOutIntensity",void 0),i([c],t.prototype,"opacityInOutSpeed",void 0),i([c],t.prototype,"opacityInOutDuration",void 0),i([s],t)}(cc.ParticleSystem);n.default=u,cc._RF.pop()},{"./particle-simulator":"particle-simulator"}],InfoController:[function(e,t,n){"use strict";cc._RF.push(t,"47067gRC5xPxbzpilE1odev","InfoController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Components/MarqueeLayout"),s=e("../GameManager"),c=e("../Gameplay/ProgressBar/NoteProgress"),l=e("./GameplayController"),u=e("./MainController"),p=cc._decorator,h=p.ccclass,d=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.marqueeLayout=null,t.stars=[],t.starActiveFrame=null,t.starDeactiveFrame=null,t.crownActiveFrame=null,t.crownDeactiveFrame=null,t.listNoteProgress=[],t}return r(t,e),t.prototype.onLoad=function(){var e=s.default.Instance.canvasSize,t=new cc.Size(e.width/cc.view.getScaleX(),e.height/cc.view.getScaleY());this.node.setContentSize(t),cc.view.on(l.default.EVENT_GAMEPLAY_START,this.onGameplayStart.bind(this))},t.prototype.onDestroy=function(){cc.view.on(l.default.EVENT_GAMEPLAY_START,this.onGameplayStart.bind(this))},t.prototype.setup=function(){this.node.active=!0,this.node.opacity=255;for(var e=l.default.Instance.request.songConfig,t=u.default.Instance.userDataService.getSongData(e.songId),n=0;n<3;++n)t.crown>0?(this.stars[n].node.angle=0,this.stars[n].node.setContentSize(69,55)):(this.stars[n].node.angle=-20,this.stars[n].node.setContentSize(73,74));this.marqueeLayout.node.active=!0,this.marqueeLayout.updateInfo(e.songName,e.artistName,t.highScore),t.crown>0?this.setActiveByStar(t.crown,this.crownActiveFrame,this.crownDeactiveFrame):this.setActiveByStar(t.star,this.starActiveFrame,this.starDeactiveFrame),3===t.star?this.listNoteProgress[0].getComponent(c.default).onFlag():this.listNoteProgress[0].getComponent(c.default).onStone(),2===t.crown?this.listNoteProgress[1].getComponent(c.default).onFlag():this.listNoteProgress[1].getComponent(c.default).onStone(),3===t.crown?(this.listNoteProgress[1].getComponent(c.default).onFlag(),this.listNoteProgress[2].getComponent(c.default).onFlag()):this.listNoteProgress[2].getComponent(c.default).onStone()},t.prototype.onGameplayStart=function(){this.hide()},t.prototype.setActiveByStar=function(e,t,n){for(var o=0;o<3;++o)this.stars[o].spriteFrame=e>0?t:n,e--},t.prototype.hide=function(){this.node.active=!1,this.marqueeLayout.node.active=!1},i([d(a.default)],t.prototype,"marqueeLayout",void 0),i([d([cc.Sprite])],t.prototype,"stars",void 0),i([d(cc.SpriteFrame)],t.prototype,"starActiveFrame",void 0),i([d(cc.SpriteFrame)],t.prototype,"starDeactiveFrame",void 0),i([d(cc.SpriteFrame)],t.prototype,"crownActiveFrame",void 0),i([d(cc.SpriteFrame)],t.prototype,"crownDeactiveFrame",void 0),i([d(c.default)],t.prototype,"listNoteProgress",void 0),i([h],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Components/MarqueeLayout":"MarqueeLayout","../GameManager":"GameManager","../Gameplay/ProgressBar/NoteProgress":"NoteProgress","./GameplayController":"GameplayController","./MainController":"MainController"}],KeyedDictionary:[function(e,t,n){"use strict";cc._RF.push(t,"a9358ri/NJBH6zXbExW5BqJ","KeyedDictionary"),Object.defineProperty(n,"__esModule",{value:!0}),n.KeyedDictionary=void 0;var o=function(){function e(){this._items={},this._count=0}return e.prototype.containKey=function(e){return Object.prototype.hasOwnProperty.call(this.items,e)},e.prototype.count=function(){return this._count},e.prototype.add=function(e,t){Object.prototype.hasOwnProperty.call(this.items,e)||this._count++,this._items[e]=t},e.prototype.remove=function(e){var t=this._items[e];return t&&(delete this._items[e],this._count--),t},e.prototype.removeAlls=function(){this._items={}},e.prototype.item=function(e){return this._items[e]||null},e.prototype.keys=function(){var e=[];for(var t in this._items)Object.prototype.hasOwnProperty.call(this._items,t)&&e.push(t);return e},e.prototype.values=function(){for(var e=[],t=this.keys(),n=0;n<t.length;n++)e.push(this.item(t[n]));return e},e.prototype.items=function(){return this._items},e}();n.KeyedDictionary=o,cc._RF.pop()},{}],LabelController:[function(e,t,n){"use strict";cc._RF.push(t,"de3fdBDBkxLv4VperoPJrrA","LabelController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.labels=[],t.init=!1,t}return r(t,e),t.prototype.showLabel=function(e){this.tryInitLabels(),this.labels.forEach(function(t){t.active=e&&t.name.toLowerCase()===e.toLowerCase()})},t.prototype.tryInitLabels=function(){var e=this;this.init||(this.init=!0,this.labels=[],this.node.children.forEach(function(t){e.labels.push(t),t.active=!1}))},i([c([cc.Node])],t.prototype,"labels",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],LeaderBoardItemView:[function(e,t,n){"use strict";cc._RF.push(t,"81d5dY9Wk9LUJZlIrFIUgMm","LeaderBoardItemView");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../GameManager"),l=e("../ResourcesManager"),u=e("../Controller/MainController"),p=cc._decorator,h=p.ccclass,d=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nameLabel=null,t.avatarSprite=null,t.frameSprite=null,t.levelLabel=null,t.starsLabel=null,t.crownLabel=null,t.scoreLabel=null,t.indexTopNode=[],t.indexLabel=null,t.backgroundSprite=null,t.backgroundTopSpriteFrame=[],t.defaultBackgroundSpriteFrame=null,t.defaultSelfBackgroundSpriteFrame=null,t.rootAnimationWidget=null,t.avatarLoadSession=0,t.frameLoadSession=0,t}return r(t,e),t.prototype.updateItem=function(e){this.updateLabels(e),this.updateBackground(e.index,e.userId),this.updateIndexNode(e.index)},t.prototype.start=function(){this.updateSize(),cc.view.on(c.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged,this)},t.prototype.onDestroy=function(){cc.view.off(c.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged,this)},t.prototype.onEnable=function(){this.startAnimation()},t.prototype.onDisable=function(){this.resetAnimation()},t.prototype.setActive=function(e){this.node.active=e},t.prototype.updateLabels=function(e){this.updateLabelText(this.nameLabel,e.userName),this.updateLabelText(this.starsLabel,e.stars.toString()),this.updateLabelText(this.crownLabel,e.crowns.toString()),this.updateLabelText(this.scoreLabel,e.scores.toString()),this.updateLabelText(this.levelLabel,e.level.toString()),this.updateLabelText(this.indexLabel,(e.index+1).toString()),this.loadAvatar(e.avatarId),this.loadFrame(e.frameId)},t.prototype.updateLabelText=function(e,t){e&&e.isValid&&(e.string=t)},t.prototype.updateBackground=function(e,t){e<this.backgroundTopSpriteFrame.length?this.backgroundSprite.spriteFrame=this.backgroundTopSpriteFrame[e]:t===u.default.Instance.userDataService.getData().server.nakamaId&&this.defaultSelfBackgroundSpriteFrame?this.backgroundSprite.spriteFrame=this.defaultSelfBackgroundSpriteFrame:this.backgroundSprite.spriteFrame=this.defaultBackgroundSpriteFrame},t.prototype.updateIndexNode=function(e){this.indexTopNode.forEach(function(t,n){t.active=n===e}),e<this.indexTopNode.length?this.indexLabel.node.active=!1:this.indexLabel.node.active=!0},t.prototype.onCanvasSizeChanged=function(){this.updateSize()},t.prototype.updateSize=function(){var e=c.default.Instance.canvasSize;this.node.setContentSize(e.width,this.node.height)},t.prototype.startAnimation=function(){this.rootAnimationWidget&&(this.resetWidgetPosition(),this.animateOpacityAndPosition())},t.prototype.resetWidgetPosition=function(){this.rootAnimationWidget.right=-300,this.rootAnimationWidget.left=300,this.rootAnimationWidget.updateAlignment(),this.rootAnimationWidget.node.opacity=0},t.prototype.animateOpacityAndPosition=function(){var e=this;cc.tween(this.rootAnimationWidget.node).to(.3,{opacity:255}).start(),cc.tween(this.rootAnimationWidget).to(.3,{right:0,left:0}).call(function(){return e.rootAnimationWidget.updateAlignment()}).start()},t.prototype.resetAnimation=function(){this.rootAnimationWidget&&cc.Tween.stopAllByTarget(this.rootAnimationWidget)},t.prototype.loadAvatar=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return this.avatarSprite.spriteFrame=l.default.Instance.getDefaultAvatar(),this.avatarLoadSession++,t=this.avatarLoadSession,[4,l.default.Instance.loadAvatar(e)];case 1:return n=o.sent(),t!=this.avatarLoadSession?[2]:(null!=n&&(this.avatarSprite.spriteFrame=n),[2])}})})},t.prototype.loadFrame=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return null==e||""==e?(this.frameSprite.node.active=!1,[2]):(this.frameSprite.node.active=!0,this.frameSprite.spriteFrame=l.default.Instance.getDefaultFrame(),this.frameLoadSession++,t=this.frameLoadSession,[4,l.default.Instance.loadFrame(e)]);case 1:return n=o.sent(),t!=this.frameLoadSession?[2]:(null!=n&&(this.frameSprite.spriteFrame=n),[2])}})})},i([d(cc.Label)],t.prototype,"nameLabel",void 0),i([d(cc.Sprite)],t.prototype,"avatarSprite",void 0),i([d(cc.Sprite)],t.prototype,"frameSprite",void 0),i([d(cc.Label)],t.prototype,"levelLabel",void 0),i([d(cc.Label)],t.prototype,"starsLabel",void 0),i([d(cc.Label)],t.prototype,"crownLabel",void 0),i([d(cc.Label)],t.prototype,"scoreLabel",void 0),i([d([cc.Node])],t.prototype,"indexTopNode",void 0),i([d(cc.Label)],t.prototype,"indexLabel",void 0),i([d(cc.Sprite)],t.prototype,"backgroundSprite",void 0),i([d([cc.SpriteFrame])],t.prototype,"backgroundTopSpriteFrame",void 0),i([d(cc.SpriteFrame)],t.prototype,"defaultBackgroundSpriteFrame",void 0),i([d(cc.SpriteFrame)],t.prototype,"defaultSelfBackgroundSpriteFrame",void 0),i([d(cc.Widget)],t.prototype,"rootAnimationWidget",void 0),i([h],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Controller/MainController":"MainController","../GameManager":"GameManager","../ResourcesManager":"ResourcesManager"}],LeaderBoardManager:[function(e,t,n){"use strict";cc._RF.push(t,"5dfa6hckoJI9LHkOhQ0i9W1","LeaderBoardManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.LeaderBoardModel=n.LeaderBoardData=n.LeaderBoardRecordData=void 0;var c=e("./Data/UserData"),l=e("./NakamaManager"),u=e("./Utils/GameUtils"),p=e("./Controller/MainController"),h=e("./GameManager"),d=e("./Time"),f=e("./SongChallengeManager"),g=e("./BoolClass"),y=e("./Components/EnhancedLoading"),v=cc._decorator,m=v.ccclass,S=(v.property,function(){function e(){this.userId="",this.userName="",this.index=0,this.stars=0,this.crowns=0,this.avatarId="",this.frameId="",this.level=1,this.scores=0,this.lastUpdate=0,this.scoreCalculated=0}return e.prototype.setData=function(e,t,n){var o;this.userId=e.owner_id||"",this.userName=t.userName||"",this.stars=n.stars||0,this.crowns=n.crowns||0,this.avatarId=t.avatarId||"",this.frameId=t.frameId||"",this.level=t.level||1,this.scores=n.scores||0,this.lastUpdate=n.lastUpdate||0,this.scoreCalculated=n.scoreCalculated||0,this.index=null!==(o=e.rank-1)&&void 0!==o?o:0},e.prototype.self=function(e){var t=p.default.Instance.userDataService.getData();this.userId=t.server.nakamaId,this.userName=t.profile.userName,this.avatarId=t.profile.avatarId,this.frameId=t.profile.frameId,this.level=t.profile.level,this.stars=e.stars,this.crowns=e.crowns,this.scores=e.scores,this.lastUpdate=e.lastUpdate,this.scoreCalculated=e.scoreCalculated},e}());n.LeaderBoardRecordData=S;n.LeaderBoardData=function(){this.units=[],this.units=[]};var _,b,T=function(){this.leaderBoardId="",this.lastResetTime=0,this.rankInLastSession=0,this.songs=[]};n.LeaderBoardModel=T,function(e){e.NO="no",e.DAILY="daily",e.WEEKLY="weekly"}(_||(_={})),function(e){e.START_AND_CROWN="start_and_crown",e.SCORE="score"}(b||(b={}));var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mapLeaderBoardModelConfig=new Map,t.mapLeaderBoardCached=new Map,t}var n;return r(t,e),n=t,t.prototype.getLoadingComponentList=function(){var e=this;return[{resultRequire:[],resultList:[],executeFunction:function(){return e.init()}},{resultRequire:[y.LoadingResultType.LOCAL_DATA,y.LoadingResultType.GAME_SETTING,y.LoadingResultType.SESSION,y.LoadingResultType.SONG_LIST_CONFIG],resultList:[],executeFunction:function(){return e.refreshAndResendWhenInit()}}]},t.prototype.init=function(){return a(this,void 0,Promise,function(){return s(this,function(){return h.GameLog.logStartInit("[LeaderBoardManager] Starting leaderboard initialization"),this.initializeModelConfigs(),h.GameLog.logInitSuccess("[LeaderBoardManager] Initialized"),[2]})})},t.prototype.refreshAndResendWhenInit=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return h.GameLog.logStartInit("[LeaderBoardManager] Refreshing and resending when init"),[4,this.checkRefreshAndSendToLeaderBoards()];case 1:return e.sent(),h.GameLog.logInitSuccess("[LeaderBoardManager] Refreshed and resended"),[2]}})})},t.prototype.initializeModelConfigs=function(){var e=this;[{id:n.LEADERBOARD_IDS.ALL,pointType:b.START_AND_CROWN,resetType:_.NO},{id:n.LEADERBOARD_IDS.DAILY,pointType:b.START_AND_CROWN,resetType:_.DAILY},{id:n.LEADERBOARD_IDS.WEEKLY,pointType:b.START_AND_CROWN,resetType:_.WEEKLY},{id:n.LEADERBOARD_IDS.CHALLENGE,pointType:b.SCORE,resetType:_.DAILY,isSongChallenge:!0}].forEach(function(t){e.mapLeaderBoardModelConfig.set(t.id,{leaderBoardId:t.id,pointType:t.pointType,resetType:t.resetType,isSongChallenge:t.isSongChallenge})})},t.prototype.getModelConfig=function(e){return this.mapLeaderBoardModelConfig.get(e)},t.prototype.getTimeSession=function(e){switch(this.getModelConfig(e).resetType){case _.DAILY:return d.Time.ONE_DAY;case _.WEEKLY:return d.Time.ONE_WEEK;case _.NO:return 0;default:return d.Time.ONE_DAY}},t.prototype.getNextTimeReset=function(e){return this.getModelData(e).lastResetTime+this.getTimeSession(e)},t.prototype.getModelData=function(e){var t=p.default.Instance.userDataService.getData(),n=t.leaderBoardData.units.find(function(t){return t.leaderBoardId===e});return n||((n=new T).leaderBoardId=e,n.lastResetTime=0,n.songs=[],t.leaderBoardData.units.push(n),h.GameLog.log("[LeaderBoardManager] New model created for leaderboard: "+e)),n},t.prototype.getLeaderBoardCacheData=function(e){return this.mapLeaderBoardCached.has(e)||(this.mapLeaderBoardCached.set(e,{leaderBoardId:e,listLeaderBoard:null,selfLeaderBoard:null,lastUpdateTime:null,lastSelfUpdateTime:null,loadingSelfLeaderBoard:!1,loadingLeaderBoard:!1}),h.GameLog.log("[LeaderBoardManager] New cache data created for leaderboard: "+e)),this.mapLeaderBoardCached.get(e)},t.prototype.checkRefreshAndSendToLeaderBoards=function(){return a(this,void 0,Promise,function(){var e,t,o=this;return s(this,function(r){switch(r.label){case 0:return e=Object.values(n.LEADERBOARD_IDS),h.GameLog.log("[LeaderBoardManager] Resending all leaderboards"),t=new g.BoolClass(!1),[4,Promise.all(e.map(function(e){return a(o,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,this.checkResetPeriod(e,t)];case 1:return n.sent(),[4,this.sendLeaderBoardById(e)];case 2:return n.sent(),[2]}})})}))];case 1:return r.sent(),t.value?[4,p.default.Instance.userDataService.saveDataLocalAndServer()]:[3,3];case 2:r.sent(),h.GameLog.log("[LeaderBoardManager] User data saved after resending leaderboards"),r.label=3;case 3:return[2]}})})},t.prototype.exportLeaderBoardUserData=function(){var e=this,t={leaderBoardMetaData:[]};return p.default.Instance.userDataService.getData().leaderBoardData.units.forEach(function(n){var o=e.createLeaderBoardUserMetadataForLeaderboard(n.leaderBoardId);t.leaderBoardMetaData.push(o)}),t},t.prototype.sendLeaderBoardById=function(e){return a(this,void 0,Promise,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return t=this.createLeaderBoardUserMetadataForLeaderboard(e),n=this.getLeaderBoardCacheData(e),t.scoreCalculated<=0?(h.GameLog.log("[LeaderBoardManager] No points to send to leaderboard "+e),[2]):(h.GameLog.log("[LeaderBoardManager] Sending score "+t.scoreCalculated+" to leaderboard "+e),[4,l.default.Instance.sendToLeaderBoard(e,t.scoreCalculated,t)]);case 1:return o.sent(),n.lastUpdateTime=0,h.GameLog.log("[LeaderBoardManager] Score sent successfully to leaderboard "+e),[2]}})})},t.prototype.calculateScoreFromMetaData=function(e,t){switch(e){case b.START_AND_CROWN:return this.calculateScoreFromStarAndCrown(t.stars,t.crowns);case b.SCORE:return this.calculateScoreFromScore(t.scores);default:return h.GameLog.error("[LeaderBoardManager] Invalid point type: "+e),0}},t.prototype.calculateScoreFromLeaderBoardRecord=function(e,t){switch(e){case b.START_AND_CROWN:return this.calculateScoreFromStarAndCrown(t.stars,t.crowns);case b.SCORE:return this.calculateScoreFromScore(t.scores);default:return h.GameLog.error("[LeaderBoardManager] Invalid point type: "+e),0}},t.prototype.calculateScoreFromStarAndCrown=function(e,t){var n=Math.floor(1e3*e+1*t);return h.GameLog.log("[LeaderBoardManager] Calculated score from stars and crowns: "+n),n},t.prototype.calculateScoreFromScore=function(e){return e},t.prototype.createLeaderBoardUserMetadataForLeaderboard=function(e){var t=this.getModelData(e),n=this.getModelConfig(e),o=t.songs.reduce(function(e,t){return e+t.star},0),r=t.songs.reduce(function(e,t){return e+t.crown},0),i=t.songs.reduce(function(e,t){return Math.max(e,t.highScore)},0),a={leaderBoardId:e,lastUpdate:t.lastResetTime,stars:o,crowns:r,scores:i,scoreCalculated:0};return a.scoreCalculated=this.calculateScoreFromMetaData(n.pointType,a),h.GameLog.log("[LeaderBoardManager] Created metadata for leaderboard "+e+":",a),a},t.prototype.getLeaderBoard=function(e){return a(this,void 0,Promise,function(){var t;return s(this,function(n){switch(n.label){case 0:return(t=this.getLeaderBoardCacheData(e)).loadingLeaderBoard?(h.GameLog.log("[LeaderBoardManager] Waiting for leaderboard "+e+" to finish loading"),[4,u.default.waitWhile(function(){return t.loadingLeaderBoard})]):[3,2];case 1:n.sent(),n.label=2;case 2:return this.shouldUpdateLeaderBoard(t)?(h.GameLog.log("[LeaderBoardManager] Updating leaderboard cache for "+e),[4,this.updateLeaderBoardCache(e,t)]):[3,4];case 3:n.sent(),n.label=4;case 4:return h.GameLog.log("[LeaderBoardManager] Returning leaderboard data for "+e),[2,{list:t.listLeaderBoard,self:t.selfLeaderBoard}]}})})},t.prototype.shouldUpdateLeaderBoard=function(){return!0},t.prototype.updateLeaderBoardCache=function(e,t){return a(this,void 0,Promise,function(){var n,o,r,i,a;return s(this,function(s){switch(s.label){case 0:t.loadingLeaderBoard=!0,h.GameLog.log("[LeaderBoardManager] Updating leaderboard cache for "+e),s.label=1;case 1:return s.trys.push([1,4,,5]),t.listLeaderBoard=[],t.selfLeaderBoard=null,n=p.default.Instance.userDataService.getData().server.nakamaId,[4,l.default.Instance.getLeaderBoardList(e,[n],100)];case 2:return o=s.sent(),r=this.getAllUserIdsInRecordList(o),[4,l.default.Instance.getUserMetaData(r)];case 3:return i=s.sent(),t.listLeaderBoard=this.exportListLeaderBoardData(o.records,i),t.selfLeaderBoard=o.owner_records.length>0?this.exportLeaderBoardData(o.owner_records[0],i.users.find(function(e){return e.id===n})):null,this.fixRankInLeaderBoard(e),h.GameLog.log("[LeaderBoardManager] Leaderboard "+e+" cache updated successfully"),[3,5];case 4:return a=s.sent(),h.GameLog.error("[LeaderBoardManager] Error updating leaderboard "+e+" cache:",a),t.listLeaderBoard=[],t.selfLeaderBoard=null,[3,5];case 5:return t.loadingLeaderBoard=!1,[2]}})})},t.prototype.getAllUserIdsInRecordList=function(e){var t=new Set;return e.records.forEach(function(e){t.add(e.owner_id)}),e.owner_records.forEach(function(e){t.add(e.owner_id)}),Array.from(t)},t.prototype.fixRankInLeaderBoard=function(e){var t=this.getLeaderBoardCacheData(e),n=p.default.Instance.userDataService.getData().server.nakamaId;if(null==t.selfLeaderBoard){var o=this.createLeaderBoardUserMetadataForLeaderboard(e);o.scoreCalculated>0&&(t.selfLeaderBoard=this.exportSelfLeaderBoardData(o))}var r=t.selfLeaderBoard;null!=r&&null==t.listLeaderBoard.find(function(e){return e.userId==n})&&t.listLeaderBoard.push(r),t.listLeaderBoard.sort(function(e,t){return t.scoreCalculated-e.scoreCalculated});for(var i=0;i<t.listLeaderBoard.length;i++)t.listLeaderBoard[i].index=i,t.listLeaderBoard[i].userId==n&&null!=r&&(r.index=i)},t.prototype.isOutdated=function(e){var t=d.Time.getCurrentOffsetTime()-e>300;return h.GameLog.log("[LeaderBoardManager] Is leaderboard outdated: "+t),t},t.prototype.exportListLeaderBoardData=function(e,t){var n=this,o=new Map;t.users.forEach(function(e){o.set(e.id,e)});var r=e.map(function(e){var t=o.get(e.owner_id);return n.exportLeaderBoardData(e,t)}).filter(function(e){return null!==e});return h.GameLog.log("[LeaderBoardManager] Exported "+r.length+" leaderboard records"),r},t.prototype.exportSelfLeaderBoardData=function(e){var t=new S;return t.index=-1,t.self(e),t},t.prototype.exportLeaderBoardData=function(e,t){var n=new S,o=t?t.metadata:null,r={userName:o&&o.userName?o.userName:"Amonymouse",avatarId:o&&o.avatarId?o.avatarId:"",frameId:o&&o.frameId?o.frameId:"",level:o&&o.level?o.level:0,leaderBoardData:o&&o.leaderBoardData?o.leaderBoardData:{leaderBoardMetaData:[]}},i=r.leaderBoardData.leaderBoardMetaData.find(function(t){return t.leaderBoardId===e.leaderboard_id})||{leaderBoardId:e.leaderboard_id,scoreCalculated:0,scores:0,stars:0,crowns:0,lastUpdate:0},a={leaderBoardId:i.leaderBoardId||e.leaderboard_id,scoreCalculated:i.scoreCalculated||0,scores:i.scores||0,stars:i.stars||0,crowns:i.crowns||0,lastUpdate:i.lastUpdate||0};return n.setData(e,r,a),h.GameLog.log("[LeaderBoardManager] Exported leaderboard data for user "+n.userName),n},t.prototype.updateLeaderboard=function(e,t,o,r){return a(this,void 0,Promise,function(){var i,a;return s(this,function(s){switch(s.label){case 0:return h.GameLog.log("[LeaderBoardManager] Updating leaderboards for song "+e+" with star: "+t+", crown: "+o+", score: "+r),i=new g.BoolClass(!1),(a=[]).push(this.updateLeaderBoard(n.LEADERBOARD_IDS.ALL,e,t,o,r,i)),a.push(this.updateLeaderBoard(n.LEADERBOARD_IDS.DAILY,e,t,o,r,i)),a.push(this.updateLeaderBoard(n.LEADERBOARD_IDS.WEEKLY,e,t,o,r,i)),a.push(this.updateLeaderBoard(n.LEADERBOARD_IDS.CHALLENGE,e,t,o,r,i)),[4,Promise.all(a)];case 1:return s.sent(),i.value?[4,p.default.Instance.userDataService.saveDataLocalAndServer()]:[3,3];case 2:s.sent(),h.GameLog.log("[LeaderBoardManager] User data saved after leaderboard update"),s.label=3;case 3:return[2]}})})},t.prototype.updateLeaderBoard=function(e,t,n,o,r,i){return a(this,void 0,Promise,function(){var a;return s(this,function(s){switch(s.label){case 0:return[4,this.checkResetPeriod(e,i)];case 1:return s.sent(),a=new g.BoolClass(!0),[4,this.checkTargetSong(e,t,i,a)];case 2:return s.sent(),a.value?this.updateModelScore(e,t,n,o,r,i)?(h.GameLog.log("[LeaderBoardManager] New high score for "+e+", sending to leaderboard"),[4,this.sendLeaderBoardById(e)]):[3,4]:[2];case 3:s.sent(),s.label=4;case 4:return[2]}})})},t.prototype.checkResetPeriod=function(e,t){return a(this,void 0,Promise,function(){var n,o,r;return s(this,function(i){switch(i.label){case 0:if(n=this.getModelConfig(e),o=this.getModelData(e),!n||!o)return h.GameLog.error("[LeaderBoardManager] Invalid config or model for leaderboard "+e),[2,!1];switch(r=!1,n.resetType){case _.DAILY:o.lastResetTime+d.Time.ONE_DAY<=d.Time.getTimeBeginToDay()&&(o.lastResetTime=d.Time.getTimeBeginToDay(),r=!0,t.value=!0);break;case _.WEEKLY:o.lastResetTime+d.Time.ONE_WEEK<=d.Time.getTimeBeginThisWeek()&&(o.lastResetTime=d.Time.getTimeBeginThisWeek(),r=!0,t.value=!0);break;default:return[2,!1]}return r?(h.GameLog.log("[LeaderBoardManager] Resetting leaderboard "+e),o.songs=[],[4,this.updateRankInLastSession(e,t)]):[3,4];case 1:return i.sent(),[4,this.resetLeaderBoard(e,t)];case 2:return i.sent(),[4,this.earnRewardLastRank(e,t)];case 3:i.sent(),i.label=4;case 4:return[2,r]}})})},t.prototype.earnRewardLastRank=function(e,t){return a(this,void 0,Promise,function(){var n,o;return s(this,function(r){switch(r.label){case 0:return n=this.getModelConfig(e),o=this.getModelData(e),n&&o?o.rankInLastSession<=0?[2]:n.isSongChallenge?[4,f.default.Instance.giveReward(o.rankInLastSession,t)]:[3,2]:(h.GameLog.error("[LeaderBoardManager] Invalid config or model for leaderboard "+e),[2]);case 1:r.sent(),o.rankInLastSession=-1,r.label=2;case 2:return[2]}})})},t.prototype.checkTargetSong=function(e,t,n,o){return a(this,void 0,Promise,function(){var n,r;return s(this,function(){return n=this.getModelConfig(e),r=p.default.Instance.userDataService.getData().challengeData,n.isSongChallenge?(o.value=r.challengeSongId==t,[2]):(o.value=!0,[2])})})},t.prototype.updateRankInLastSession=function(e,t){return a(this,void 0,Promise,function(){var n,o,r,i;return s(this,function(a){switch(a.label){case 0:return h.GameLog.log("[LeaderBoardManager] Updating rank for leaderboard: "+e),(n=this.getModelData(e)).rankInLastSession=-1,o=p.default.Instance.userDataService.getData().server.nakamaId,[4,l.default.Instance.getLeaderBoardList(e,[o],null,null,n.lastResetTime.toString())];case 1:return null!=(r=a.sent())&&r.owner_records.length>0?(i=r.owner_records.find(function(e){return e.owner_id===o}),n.rankInLastSession=i.rank+1,h.GameLog.log("[LeaderBoardManager] New rank: "+n.rankInLastSession)):h.GameLog.log("[LeaderBoardManager] No record found for current user"),t.value=!0,[2]}})})},t.prototype.resetLeaderBoard=function(e,t){return a(this,void 0,Promise,function(){var n,o,r,i;return s(this,function(a){switch(a.label){case 0:return n=this.getModelData(e),o=this.getModelConfig(e),r=p.default.Instance.userDataService.getData().challengeData,n.songs=[],o.isSongChallenge?(i=r,[4,f.default.Instance.getCurrentSongToday()]):[3,2];case 1:i.challengeSongId=a.sent(),a.label=2;case 2:return t.value=!0,[2]}})})},t.prototype.updateModelScore=function(e,t,n,o,r,i){var a=this.getModelData(e),s=a.songs.find(function(e){return e.songId===t});s||(s=new c.SongData(t),a.songs.push(s));var l=n>s.star||o>s.crown||r>s.highScore;return s.star=Math.max(s.star,n),s.crown=Math.max(s.crown,o),s.highScore=Math.max(s.highScore,r),l&&(i.value=!0),l},t.LEADERBOARD_IDS={ALL:"leaderboard",DAILY:"daily_leaderboard",WEEKLY:"weekly_leaderboard",CHALLENGE:"daily_challenge_leaderboard"},n=i([m],t)}(cc.Component);n.default=C,cc._RF.pop()},{"./BoolClass":"BoolClass","./Components/EnhancedLoading":"EnhancedLoading","./Controller/MainController":"MainController","./Data/UserData":"UserData","./GameManager":"GameManager","./NakamaManager":"NakamaManager","./SongChallengeManager":"SongChallengeManager","./Time":"Time","./Utils/GameUtils":"GameUtils"}],LeaderBoardTab:[function(e,t,n){"use strict";cc._RF.push(t,"693a0ShmE1FLY0YTUB11NZx","LeaderBoardTab");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../LeaderBoardManager"),l=e("./LeaderBoardItemView"),u=e("./VirtualScrollView"),p=cc._decorator,h=p.ccclass,d=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="",t.selfLeaderBoardView=null,t.virtualScrollView=null,t.scrollViewWidget=null,t.viewWidget=null,t.loading=null,t.leaderBoard=[],t.selfLeaderBoard=null,t.sessionLoad=0,t}return r(t,e),t.prototype.onLoad=function(){this.virtualScrollView.setUpdateItemCallback(this.updateLeaderBoardItemView.bind(this)),this.virtualScrollView.initialize()},t.prototype.onEnable=function(){this.refresh()},t.prototype.onDisable=function(){this.sessionLoad++},t.prototype.refresh=function(){return a(this,void 0,void 0,function(){var e,t,n,o;return s(this,function(r){switch(r.label){case 0:return this.startLoading(),this.clearViews(),e=++this.sessionLoad,[4,c.default.Instance.getLeaderBoard(this.key)];case 1:return t=r.sent(),n=t.list,o=t.self,this.isSessionValid(e)?(this.leaderBoard=n,this.selfLeaderBoard=o,this.populateSelfLeaderBoard(),this.updateSizeViewLeaderBoard(),this.populateLeaderBoard(),this.stopLoading(),[2]):[2]}})})},t.prototype.updateSizeViewLeaderBoard=function(){var e=null==this.selfLeaderBoardView||0==this.selfLeaderBoardView.node.active?0:this.selfLeaderBoardView.node.height;this.virtualScrollView.setWidgetScrollviewBottomAlign(e)},t.prototype.updateLeaderBoardItemView=function(e,t){if(this.isValidIndex(t)){var n=this.leaderBoard[t];e.getComponent(l.default).updateItem(n)}},t.prototype.isValidIndex=function(e){return e>=0&&e<this.leaderBoard.length},t.prototype.isSessionValid=function(e){return this.sessionLoad===e},t.prototype.startLoading=function(){this.loading.active=!0},t.prototype.stopLoading=function(){this.loading.active=!1},t.prototype.clearViews=function(){var e;null===(e=this.selfLeaderBoardView)||void 0===e||e.setActive(!1),this.virtualScrollView.clear()},t.prototype.populateLeaderBoard=function(){this.virtualScrollView.setup(this.leaderBoard.length)},t.prototype.populateSelfLeaderBoard=function(){if(null!=this.selfLeaderBoardView){var e=null!=this.selfLeaderBoard&&this.selfLeaderBoard.index>=10;this.selfLeaderBoardView.setActive(e),e&&this.selfLeaderBoardView.updateItem(this.selfLeaderBoard)}},i([d],t.prototype,"key",void 0),i([d(l.default)],t.prototype,"selfLeaderBoardView",void 0),i([d(u.default)],t.prototype,"virtualScrollView",void 0),i([d(cc.Widget)],t.prototype,"scrollViewWidget",void 0),i([d(cc.Widget)],t.prototype,"viewWidget",void 0),i([d(cc.Node)],t.prototype,"loading",void 0),i([h],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../LeaderBoardManager":"LeaderBoardManager","./LeaderBoardItemView":"LeaderBoardItemView","./VirtualScrollView":"VirtualScrollView"}],LoadingController:[function(e,t,n){"use strict";cc._RF.push(t,"4f84eD9BlJMRpygjE0HIaHu","LoadingController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),i([s],t)}(cc.Component));n.default=c,cc._RF.pop()},{}],LongTile:[function(e,t,n){"use strict";cc._RF.push(t,"13480TebORLS5CPMDjiSWiy","LongTile");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Defines"),s=e("./Tile"),c=e("../Gameplay/ProgressBar/Counter"),l=e("../GM"),u=cc._decorator,p=u.ccclass,h=u.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.holdSprite=null,t.line=null,t.circle=null,t.auraSprite=null,t.scoreBonusLabel=null,t.blinkingCircle=null,t.noteFalse=null,t.shouldUpdateEffect=!1,t.endTouch=!1,t.score=0,t.maxScoreBonus=0,t.scaleDownDuration=.3,t.scaleDownVal=0,t.scaleUpDuration=.3,t.scaleUpVal=3,t.scaleAuraTweenTag=999,t.preventPlayingEffect=!0,t.isAuraScalePlaying=!1,t.auraScaleTween=null,t}return r(t,e),t.prototype.setup=function(t,n,o,r){if(e.prototype.setup.call(this,t,n,o,r),this.shouldUpdateEffect=!1,this.endTouch=!1,this.holdSprite.active=!1,this.holdSprite.setContentSize(cc.size(t.width,550)),this.sprite.node.opacity=255,this.noteFalse.active=!1,this.noteFalse.setContentSize(t),null!=this.line&&(this.line.node.setContentSize(cc.size(5,this.noteSize.height-370)),this.line.node.setPosition(0,220)),null!=this.circle&&this.circle.node.setPosition(0,180),null!=this.scoreBonusLabel){this.scoreBonusLabel.node.setPosition(32,this.noteSize.height),this.scoreBonusLabel.node.active=!1;var i=Math.floor(this.noteSize.height/l.default.defines().SHORT_TILE_HEIGHT);i=i>10?10:i,this.score=i>=1?i:0,this.scoreBonusLabel.string="+ "+i.toString(),this.maxScoreBonus=this.score}this.auraScaleTween=cc.tween(this.auraSprite).tag(this.scaleAuraTweenTag),this.auraSprite.active=!1,this.preventPlayingEffect=!0,this.isAuraScalePlaying=!1,this.blinkingCircle.active=!1},t.prototype.hit=function(){e.prototype.hit.call(this)},t.prototype.checkReachSyncLine=function(){return e.prototype.checkReachSyncLine.call(this)},t.prototype.doHitEffect=function(){this.endTouch||(this.holdSprite.active=!0,this.shouldUpdateEffect=!0)},t.prototype.endHitEffect=function(){this.isHit&&this.shouldUpdateEffect&&(this.shouldUpdateEffect=!1,this.holdSprite.active=!1,this.endTouch=!0,this.blinkingCircle.active=!1,this.auraScaleTween.removeSelf(),this.auraScaleTween=cc.tween(this.auraSprite).tag(this.scaleAuraTweenTag),this.playScaleAuraSprite(this.scaleDownDuration,this.scaleDownVal,!0),this.isAuraScalePlaying=!0,this.sprite.node.opacity=50)},t.prototype.update=function(e){if(this.gpc&&this.gpc.gameStatus===a.GameStatus.PLAYING){if(l.default.defines().isAutoPlay&&!this.isHit&&this.checkReachSyncLine()&&!this.shouldUpdateEffect&&(this.endTouch=!1,this.holdSprite.active=!0,this.shouldUpdateEffect=!0),this.endTouch)return;if(!this.isHit)return;this.updateHoldSprite(e)}},t.prototype.updateHoldSprite=function(){if(this.shouldUpdateEffect){var e=this.holdSprite.height,t=this.gpc.getCurrentCameraSpeed()*this.gpc.smoothDeltaTime,n=this.auraSprite.position;if(n.y+=t,this.auraSprite.position=n,e+=t,n.y=this.holdSprite.y+e,this.blinkingCircle.position=n,e>=this.noteSize.height)return this.holdSprite.height=e,this.endHitEffect(),void this.bonusScore();this.holdSprite.height=e}},t.prototype.playScaleAuraSprite=function(e,t,n){var o=this;void 0===n&&(n=!1),null!=this.auraScaleTween&&(this.auraScaleTween.stop(),this.auraScaleTween.to(e,{scale:t}).call(function(){!0===n&&(o.isAuraScalePlaying=!1,o.auraSprite.active=!1)}).start())},t.prototype.getTouchProgress=function(){var e=this.holdSprite.height;return e>=this.noteSize.height?1:e/this.noteSize.height},t.prototype._onTouchStart=function(t,n){if(this.endTouch)return!1;if(!e.prototype._onTouchStart.call(this,t,n))return!1;var o=this.touchStartPosition.y+200,r=cc.size(this.noteSize.width,o);return this.holdSprite.setContentSize(r),!1===this.preventPlayingEffect&&(this.blinkingCircle.active=!0,this.auraSprite.active=!0,this.auraSprite.setPosition(this.auraSprite.getPosition().x,n.y),this.playScaleAuraSprite(this.scaleUpDuration,this.scaleUpVal)),!0},t.prototype._onTouchEnd=function(t){this.holdSprite.height<.7*this.noteSize.height?(c.default.perfectStreak=0,this.noteFalse.active=!0,this.gpc.deadZone._onTouchFalseLong(t,this.node._components[0])):this.addScore(),e.prototype._onTouchEnd.call(this,t),this.cancelAllEffects()},t.prototype._onTouchCancel=function(t){e.prototype._onTouchCancel.call(this,t),this.cancelAllEffects()},t.prototype.bonusScore=function(){this.score<=0||null==this.scoreBonusLabel||(this.scoreBonusLabel.node.active=!0,c.default.updateScore(this.score,"bonus"),this.score=0)},t.prototype.cancelAllEffects=function(){this.shouldUpdateEffect=!1,this.isHit&&(this.endTouch=!0),this.blinkingCircle.active=!1,this.isAuraScalePlaying||(this.auraScaleTween.removeSelf(),this.auraScaleTween=cc.tween(this.auraSprite).tag(this.scaleAuraTweenTag),this.playScaleAuraSprite(this.scaleDownDuration,this.scaleDownVal,!0),this.isAuraScalePlaying=!0),this.getTouchProgress()<1||this.endHitEffect()},t.prototype.onResume=function(){e.prototype.onResume.call(this),this.cancelAllEffects()},i([h(cc.Node)],t.prototype,"holdSprite",void 0),i([h(cc.Sprite)],t.prototype,"line",void 0),i([h(cc.Sprite)],t.prototype,"circle",void 0),i([h(cc.Node)],t.prototype,"auraSprite",void 0),i([h(cc.Label)],t.prototype,"scoreBonusLabel",void 0),i([h(cc.Node)],t.prototype,"blinkingCircle",void 0),i([h(cc.Node)],t.prototype,"noteFalse",void 0),i([p],t)}(s.default);n.default=d,cc._RF.pop()},{"../Defines":"Defines","../GM":"GM","../Gameplay/ProgressBar/Counter":"Counter","./Tile":"Tile"}],MainController:[function(e,t,n){"use strict";cc._RF.push(t,"47ca4B0cCBNN5uUHNWYiPsi","MainController");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../GameEvent"),s=e("../Handlers/DefaultAudioEnabledChange"),c=e("../Handlers/DefaultDataStoragable"),l=e("../Handlers/DefaultFirstFrameReady"),u=e("../Handlers/DefaultGameReady"),p=e("../Handlers/DefaultHighScoreSender"),h=e("../Handlers/DefaultPauseAndResume"),d=e("../Handlers/RuntimeData"),f=e("../Handlers/UserDataService"),g=e("../Utils/GameUtils"),y=e("../Components/EnhancedLoading"),v=e("../GameManager"),m=cc._decorator,S=m.ccclass,_=(m.property,function(){function e(){this.frameUnlockCheckers=[]}return e.prototype.getLoadingComponentList=function(){var e=this;return[{resultRequire:[],resultList:[y.LoadingResultType.GAME_SETTING],executeFunction:function(){return e.initConfig()}},{resultRequire:[y.LoadingResultType.YOUTUBE_INIT],resultList:[y.LoadingResultType.LOCAL_DATA],executeFunction:function(){return e.loadLocalData()}},{resultRequire:[y.LoadingResultType.SESSION,y.LoadingResultType.LOCAL_DATA],resultList:[],executeFunction:function(){return e.saveLocalDataToServerData()}}]},e.prototype.init=function(){return r(this,void 0,void 0,function(){return i(this,function(){return v.GameLog.logStartInit("[MainController] Starting main controller initialization"),this.createDefaultHandlers(),this.createHandlers(),this.userDataService=new f.UserDataService,this.runtimeData=new d.RuntimeData,v.GameLog.logStartInit("[MainController] Main controller initialization complete"),[2]})})},e.prototype.initConfig=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return v.GameLog.logStartInit("[MainController] Starting config initialization"),[4,g.default.loadTextDataFromURL("game-resources/game_settings.json")];case 1:return e=t.sent(),this.applyConfig(e),v.GameLog.logInitSuccess("[MainController] Config initialization complete"),[2]}})})},e.prototype.loadLocalData=function(){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return v.GameLog.logStartInit("[MainController] Starting local data initialization"),[4,this.userDataService.loadData()];case 1:return e.sent(),v.GameLog.logInitSuccess("[MainController] Local data initialization complete"),[2]}})})},e.prototype.saveLocalDataToServerData=function(){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return v.GameLog.logStartInit("[MainController] Starting local data saving"),[4,this.userDataService.updateUserMetaDataToServer()];case 1:return e.sent(),v.GameLog.logInitSuccess("[MainController] Local data saving complete"),[2]}})})},e.prototype.applyConfig=function(e){return r(this,void 0,void 0,function(){return i(this,function(){return this.settings=JSON.parse(e),[2]})})},e.prototype.createDefaultHandlers=function(){new h.DefaultPauseAndResume,new s.DefaultAudioEnabledChange,new c.DefaultDataStoragable,new l.DefaultFirstFrameReady,new u.DefaultGameReady,new p.DefaultHighScoreSender},e.prototype.createHandlers=function(){cc.view.emit(a.GameEvent.EVENT_INIT_MAIN_HANDLER)},e.prototype.isFrameLocked=function(e){for(var t=this.frameUnlockCheckers,n=0;n<t.length;n++)if(t[n].isFrameLocked(e))return!0;return!1},e.prototype.getFrameUnlockText=function(e){for(var t=this.frameUnlockCheckers,n=0;n<t.length;n++){var o=t[n].getUnlockText(e);if(null!=o)return o}return"Something went wrong"},o([S],e)}());n.default=_,cc._RF.pop()},{"../Components/EnhancedLoading":"EnhancedLoading","../GameEvent":"GameEvent","../GameManager":"GameManager","../Handlers/DefaultAudioEnabledChange":"DefaultAudioEnabledChange","../Handlers/DefaultDataStoragable":"DefaultDataStoragable","../Handlers/DefaultFirstFrameReady":"DefaultFirstFrameReady","../Handlers/DefaultGameReady":"DefaultGameReady","../Handlers/DefaultHighScoreSender":"DefaultHighScoreSender","../Handlers/DefaultPauseAndResume":"DefaultPauseAndResume","../Handlers/RuntimeData":"RuntimeData","../Handlers/UserDataService":"UserDataService","../Utils/GameUtils":"GameUtils"}],MainSongTab:[function(e,t,n){"use strict";cc._RF.push(t,"4ceb0Cg7QtBxaVX2G7o5rAZ","MainSongTab");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./VirtualScrollView"),l=e("./SongItemView"),u=e("../SongChallengeManager"),p=e("../Controller/MainController"),h=e("../SongListManager"),d=e("../Time"),f=cc._decorator,g=f.ccclass,y=f.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.virtualScrollView=null,t.loadingNode=null,t.songList=[],t.allCreatedItems=[],t.session=0,t}return r(t,e),t.prototype.onLoad=function(){this.initializeVirtualScrollView()},t.prototype.onEnable=function(){this.refresh()},t.prototype.onDisable=function(){this.session++},t.prototype.update=function(){this.checkForChallengeReset()},t.prototype.initializeVirtualScrollView=function(){this.virtualScrollView.setCreateItemCallBack(this.createItemView.bind(this)),this.virtualScrollView.setUpdateItemCallback(this.updateSongItemView.bind(this)),this.virtualScrollView.setGetPrefabIndexCallback(this.getPrefabIndex.bind(this)),this.virtualScrollView.initialize()},t.prototype.refresh=function(){return a(this,void 0,Promise,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.showLoading(!0),this.clearScrollView(),e=++this.session,[4,this.updateSongList()];case 1:return t.sent(),this.isSessionValid(e)&&(this.showLoading(!1),this.updateScrollView()),[2]}})})},t.prototype.updateSongList=function(){return a(this,void 0,Promise,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,u.default.Instance.checkResetChallenge()];case 1:return t.sent(),e=this,[4,h.default.Instance.getSongList()];case 2:return e.songList=t.sent(),this.updateSongOfTheDay(),[2]}})})},t.prototype.updateSongOfTheDay=function(){var e=p.default.Instance.userDataService.getData().challengeData.challengeSongId,t=this.songList.findIndex(function(t){return t.songId===e});if(-1!==t&&2!==t){var n=this.songList.splice(t,1)[0];this.songList.splice(2,0,n)}else-1===t&&console.warn("Song of the day not found in the list.")},t.prototype.updateSongItemView=function(e,t){if(this.isValidIndex(t)){var n=this.songList[t];e.getComponent(l.default).updateView(n)}},t.prototype.getPrefabIndex=function(e){return this.songList[e].songId===p.default.Instance.userDataService.getData().challengeData.challengeSongId?1:0},t.prototype.createItemView=function(e){var t=e.getComponent(l.default);this.allCreatedItems.push(t)},t.prototype.clearScrollView=function(){this.virtualScrollView.clear()},t.prototype.updateScrollView=function(){this.virtualScrollView.setup(this.songList.length),this.virtualScrollView.refresh()},t.prototype.showLoading=function(e){this.loadingNode.active=e},t.prototype.isValidIndex=function(e){return e>=0&&e<this.songList.length},t.prototype.isSessionValid=function(e){return this.session===e},t.prototype.checkForChallengeReset=function(){if(!this.loadingNode.active){var e=u.default.Instance.getNextResetTime();e>0&&d.Time.getCurrentOffsetTime()>=e&&this.refresh()}},i([y(c.default)],t.prototype,"virtualScrollView",void 0),i([y(cc.Node)],t.prototype,"loadingNode",void 0),i([g],t)}(cc.Component);n.default=v,cc._RF.pop()},{"../Controller/MainController":"MainController","../SongChallengeManager":"SongChallengeManager","../SongListManager":"SongListManager","../Time":"Time","./SongItemView":"SongItemView","./VirtualScrollView":"VirtualScrollView"}],MarqueeLayout:[function(e,t,n){"use strict";cc._RF.push(t,"25f22G4G8BIcqOJGtz9pEWo","MarqueeLayout");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.songTitleLabel=null,t.songArtistLabel=null,t.songHighScoreLabel=null,t.songNameMask=null,t.subSongName=null,t.sizeLayout=0,t._fadeSongName=!1,t}return r(t,e),t.prototype.start=function(){this.sizeLayout=this.node.width},t.prototype.updateInfo=function(e,t,n){this._fadeSongName=!1,this.songTitleLabel.string=""+e,this.subSongName.string=""+e,this.songTitleLabel.string.length>20?(this._fadeSongName=!0,this.subSongName.node.x=this.songTitleLabel.node.x+35*this.songTitleLabel.string.length,this.subSongName.node.active=!0):(this._fadeSongName=!1,this.songTitleLabel.node.x=0,this.subSongName.node.active=!1),this.songArtistLabel.string=t,this.songHighScoreLabel.string=n.toString()},t.prototype.update=function(e){this._fadeSongName&&(this.songTitleLabel.node.x-=50*e,this.subSongName.node.x-=50*e,this.songTitleLabel.node.x<=-this.songTitleLabel.node.width&&(this.songTitleLabel.node.x=this.subSongName.node.x+35*this.songTitleLabel.string.length),this.subSongName.node.x<=-this.subSongName.node.width&&(this.subSongName.node.x=this.songTitleLabel.node.x+35*this.songTitleLabel.string.length))},i([c(cc.Label)],t.prototype,"songTitleLabel",void 0),i([c(cc.Label)],t.prototype,"songArtistLabel",void 0),i([c(cc.Label)],t.prototype,"songHighScoreLabel",void 0),i([c(cc.Node)],t.prototype,"songNameMask",void 0),i([c(cc.Label)],t.prototype,"subSongName",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],MenuToggleItem:[function(e,t,n){"use strict";cc._RF.push(t,"fb037RjLP9OqKdMMOC1Yy3I","MenuToggleItem");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),n.MenuItem=void 0;var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.button=null,t.activeNode=null,t.mainNode=null,t}return r(t,e),i([c(cc.Node)],t.prototype,"button",void 0),i([c(cc.Node)],t.prototype,"activeNode",void 0),i([c(cc.Node)],t.prototype,"mainNode",void 0),i([s],t)}(cc.Component);n.MenuItem=l,cc._RF.pop()},{}],MenuToggle:[function(e,t,n){"use strict";cc._RF.push(t,"c3538BWqLBPUJKkZPZ+9V9j","MenuToggle");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../AudioManager"),l=e("./MenuToggleItem"),u=cc._decorator,p=u.ccclass,h=u.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.menuItems=[],t.defaultIndex=-1,t.currentIndex=-1,t}return r(t,e),t.prototype.onLoad=function(){for(var e=this,t=function(t){var o=n.menuItems[t],r=t;o.button.on("click",function(){return e.onClickFooter(r)})},n=this,o=0;o<this.menuItems.length;o++)t(o)},t.prototype.start=function(){-1!==this.defaultIndex&&this.defaultIndex<this.menuItems.length&&this.changeMenu(this.defaultIndex)},t.prototype.onClickFooter=function(e){c.default.Instance.playButton(),this.changeMenu(e)},t.prototype.changeMenu=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(){if(this.currentIndex==e)return[2];for(this.currentIndex=e,t=0;t<this.menuItems.length;t++)(n=this.menuItems[t]).activeNode.active=e==t,n.mainNode.active=e==t;return[2]})})},i([h([l.MenuItem])],t.prototype,"menuItems",void 0),i([h],t.prototype,"defaultIndex",void 0),i([p],t)}(cc.Component);n.default=d,cc._RF.pop()},{"../AudioManager":"AudioManager","./MenuToggleItem":"MenuToggleItem"}],MusicPlayer:[function(e,t,n){"use strict";cc._RF.push(t,"51b8b+22ipD1og0uVi3kjTf","MusicPlayer");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.MusicPlayer=n.MusicPlayerOptions=void 0;n.MusicPlayerOptions=function(){};var i=function(){function e(e){this.isMuted=!1,this.volume=1,this.options=e,this.audio=new Audio(e.src),this.audio.preload="auto",this.audio.loop=e.loop||!1,this.playingState=!1,this.speedMusic=e.rate||1,this.isMuted=!1,this.volume=1}return e.prototype.load=function(){return o(this,void 0,Promise,function(){var e=this;return r(this,function(){return[2,new Promise(function(t){e.audio.onloadeddata=function(){t()},e.audio.load()})]})})},e.prototype.play=function(){return o(this,void 0,Promise,function(){return r(this,function(e){switch(e.label){case 0:return this.playingState=!0,[4,this.audio.play()];case 1:return e.sent(),this.applyVolumeAndMute(),[2]}})})},e.prototype.pause=function(){this.audio.pause(),this.playingState=!1},e.prototype.resume=function(){this.play()},e.prototype.stop=function(){this.audio.pause(),this.audio.currentTime=0,this.playingState=!1},e.prototype.restart=function(){this.stop(),this.play()},e.prototype.mute=function(e){this.isMuted=e,this.applyVolumeAndMute()},e.prototype.setSpeedMusic=function(e){this.audio.playbackRate=e,this.speedMusic=e},e.prototype.getSpeedMusic=function(){return this.speedMusic},e.prototype.getDuration=function(){return this.audio.duration},e.prototype.setCurrentTime=function(e){this.audio.currentTime=e},e.prototype.getCurrentTime=function(){return this.audio.currentTime},e.prototype.setVolumeMusic=function(e){this.volume=Math.max(0,Math.min(1,e)),this.applyVolumeAndMute()},e.prototype.getVolumeMusic=function(){return this.volume},e.prototype.isPlaying=function(){return this.playingState},e.prototype.reset=function(){this.audio.currentTime=0},e.prototype.applyVolumeAndMute=function(){this.audio.volume=this.isMuted?0:this.volume,this.audio.muted=this.isMuted},e}();n.MusicPlayer=i,cc._RF.pop()},{}],MutilResolutionAdapter:[function(e,t,n){"use strict";cc._RF.push(t,"50154hCybNF7r/1EmPJ1Icn","MutilResolutionAdapter");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){var e=Math.min(cc.view.getCanvasSize().width/this.node.width,cc.view.getCanvasSize().height/this.node.height),t=this.node.width*e,n=this.node.height*e;this.node.width=this.node.width*(cc.view.getCanvasSize().width/t),this.node.height=this.node.height*(cc.view.getCanvasSize().height/n)},i([s],t)}(cc.Component));n.default=c,cc._RF.pop()},{}],NakamaManager:[function(e,t,n){"use strict";cc._RF.push(t,"f638fzrnkJHG762a6OgHdSf","NakamaManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./Components/EnhancedLoading"),l=e("./Controller/MainController"),u=e("./GameManager"),p=e("./Time"),h=e("./Utils/GameUtils"),d=cc._decorator,f=d.ccclass,g=(d.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getLoadingComponentList=function(){var e=this;return[{resultRequire:[],resultList:[c.LoadingResultType.CLIENT],executeFunction:function(){return e.createClient()}},{resultRequire:[c.LoadingResultType.CLIENT,c.LoadingResultType.LOCAL_DATA],resultList:[c.LoadingResultType.SESSION],executeFunction:function(){return e.createSession()}}]},t.prototype.createClient=function(){return a(this,void 0,void 0,function(){var e,t,n;return s(this,function(o){switch(o.label){case 0:u.GameLog.logStartInit("[NakamaManager] Starting Nakama initialization"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,h.default.loadTextDataFromURL("game-resources/server_settings.json")];case 2:return e=o.sent(),t=JSON.parse(e),this.client=new nakamajs.Client(t.key,t.url,t.port,t.ssl),u.GameLog.log("Nakama client initialized successfully"),[3,4];case 3:return n=o.sent(),u.GameLog.error("Failed to initialize Nakama client",n),[3,4];case 4:return u.GameLog.logInitSuccess("[NakamaManager] Nakama initialization complete"),[2]}})})},t.prototype.createSession=function(){return a(this,void 0,void 0,function(){var e,t,n,o,r,i;return s(this,function(a){switch(a.label){case 0:if(u.GameLog.logStartInit("[NakamaManager] Creating session"),null==this.client)return u.GameLog.log("Nakama client is null, cannot create session"),[2];e=l.default.Instance.userDataService.getData(),t=e.profile,n=t.userId,this.session=null,a.label=1;case 1:return a.trys.push([1,4,,5]),o=t.userName,[4,this.client.authenticateCustom(n,!0,o)];case 2:return r=a.sent(),this.session=r,e.refreshToken=r.refresh_token,e.token=r.token,e.server.nakamaId=this.session.user_id,u.GameLog.log("Current time: "+p.Time.getCurrentUTCTime()),u.GameLog.log("Session expire time: "+this.session.expires_at),u.GameLog.log("Session refresh expire time: "+this.session.refresh_expires_at),u.GameLog.log("Session expire remaining: "+(this.session.expires_at-p.Time.getCurrentUTCTime())),u.GameLog.log("Session refresh expire remaining: "+(this.session.refresh_expires_at-p.Time.getCurrentUTCTime())),[4,l.default.Instance.userDataService.saveData()];case 3:return a.sent(),u.GameLog.logInitSuccess("[NakamaManager] Session created successfully"),[3,5];case 4:return i=a.sent(),u.GameLog.logInitError("[NakamaManager] Session creation failed",i),[3,5];case 5:return[2]}})})},t.prototype.getStorageObject=function(e,t){return a(this,void 0,Promise,function(){var n;return s(this,function(o){switch(o.label){case 0:return null==this.client?(u.GameLog.error("Nakama client not initialized"),[2,null]):null==this.session||this.session.isexpired(p.Time.getCurrentUTCTime())||this.session.isrefreshexpired(p.Time.getCurrentUTCTime())?(u.GameLog.log("Session expired or null, creating new session"),[4,this.createSession()]):[3,2];case 1:o.sent(),o.label=2;case 2:if(null==this.session)return u.GameLog.log("Failed to create session, cannot send to leaderboard"),[2,null];o.label=3;case 3:return o.trys.push([3,5,,6]),[4,this.client.readStorageObjects(this.session,{object_ids:[{collection:e,key:t}]})];case 4:return[2,o.sent().objects[0].value];case 5:return n=o.sent(),u.GameLog.error("Failed to get storage object",n),[2,null];case 6:return[2]}})})},t.prototype.sendToLeaderBoard=function(e,t,n){return a(this,void 0,Promise,function(){var o,r,i;return s(this,function(a){switch(a.label){case 0:return null==this.client?(u.GameLog.error("Nakama client not initialized"),[2,null]):null==this.session||this.session.isexpired(p.Time.getCurrentUTCTime())||this.session.isrefreshexpired(p.Time.getCurrentUTCTime())?(u.GameLog.log("Session expired or null, creating new session"),[4,this.createSession()]):[3,2];case 1:a.sent(),a.label=2;case 2:if(null==this.session)return u.GameLog.log("Failed to create session, cannot send to leaderboard"),[2,null];a.label=3;case 3:return a.trys.push([3,5,,6]),o={score:t.toString(),metadata:n},[4,this.client.writeLeaderboardRecord(this.session,e,o)];case 4:return r=a.sent(),u.GameLog.log("Successfully sent score to leaderboard"),[2,r];case 5:return i=a.sent(),u.GameLog.error("Failed to write leaderboard record",i),[2,null];case 6:return[2]}})})},t.prototype.getLeaderBoardList=function(e,t,n,o,r){return a(this,void 0,Promise,function(){var i,a;return s(this,function(s){switch(s.label){case 0:return null==this.client?(u.GameLog.error("Nakama client not initialized"),[2,null]):null==this.session||this.session.isexpired(p.Time.getCurrentUTCTime())||this.session.isrefreshexpired(p.Time.getCurrentUTCTime())?(u.GameLog.log("Session expired or null, creating new session"),[4,this.createSession()]):[3,2];case 1:s.sent(),s.label=2;case 2:if(null==this.session)return u.GameLog.log("Failed to create session, cannot get leaderboard list"),[2,null];s.label=3;case 3:return s.trys.push([3,5,,6]),u.GameLog.log("Getting leaderboard list with request: leaderBoardId: "+e+", ownerIds: "+t+", limit: "+n+", cursor: "+o+", expiry: "+r),[4,this.client.listLeaderboardRecords(this.session,e,t,n,o,r)];case 4:return i=s.sent(),u.GameLog.log("Successfully retrieved leaderboard list",i),[2,i];case 5:return a=s.sent(),u.GameLog.error("Failed to get leaderboard list",a),[2,null];case 6:return[2]}})})},t.prototype.updateUserMetaData=function(e,t){return a(this,void 0,void 0,function(){var n,o,r;return s(this,function(i){switch(i.label){case 0:return null==this.client?(u.GameLog.error("Nakama client not initialized"),[2,null]):null==this.session||this.session.isexpired(p.Time.getCurrentUTCTime())||this.session.isrefreshexpired(p.Time.getCurrentUTCTime())?(u.GameLog.log("Session expired or null, creating new session"),[4,this.createSession()]):[3,2];case 1:i.sent(),i.label=2;case 2:if(null==this.session)return u.GameLog.log("Failed to create session, cannot update user metadata"),[2,null];i.label=3;case 3:return i.trys.push([3,5,,6]),n=t,u.GameLog.log("Updating metadata for user "+e,t),[4,this.client.rpc(this.session,"update_user_metadata",n)];case 4:return o=i.sent(),u.GameLog.log("User metadata updated successfully",o),[2,o];case 5:return r=i.sent(),u.GameLog.error("Failed to update user metadata",r),[2,null];case 6:return[2]}})})},t.prototype.getUserMetaData=function(e){return a(this,void 0,Promise,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return null==this.client?(u.GameLog.error("Nakama client not initialized"),[2,null]):null==this.session||this.session.isexpired(p.Time.getCurrentUTCTime())||this.session.isrefreshexpired(p.Time.getCurrentUTCTime())?(u.GameLog.log("Session expired or null, creating new session"),[4,this.createSession()]):[3,2];case 1:o.sent(),o.label=2;case 2:if(null==this.session)return u.GameLog.log("Failed to create session, cannot get user metadata"),[2,null];o.label=3;case 3:return o.trys.push([3,5,,6]),u.GameLog.log("Getting user metadata with request: userIds: "+e),[4,this.client.getUsers(this.session,e)];case 4:return t=o.sent(),u.GameLog.log("Successfully retrieved user metadata",t),[2,t];case 5:return n=o.sent(),u.GameLog.error("Failed to get user metadata",n),[2,null];case 6:return[2]}})})},i([f],t)}(cc.Component));n.default=g,cc._RF.pop()},{"./Components/EnhancedLoading":"EnhancedLoading","./Controller/MainController":"MainController","./GameManager":"GameManager","./Time":"Time","./Utils/GameUtils":"GameUtils"}],NoteProgressController:[function(e,t,n){"use strict";cc._RF.push(t,"3f1b7//x2NIf4rIdftzPuwh","NoteProgressController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Gameplay/ProgressBar/NoteProgress"),s=cc._decorator,c=s.ccclass,l=s.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.notes=[],t}return r(t,e),t.prototype.onLoad=function(){},i([l([a.default])],t.prototype,"notes",void 0),i([c],t)}(cc.Component);n.default=u,cc._RF.pop()},{"../Gameplay/ProgressBar/NoteProgress":"NoteProgress"}],NoteProgress:[function(e,t,n){"use strict";cc._RF.push(t,"0ac4bU3j65NyYJzUJmdFOWM","NoteProgress");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a,s=cc._decorator,c=s.ccclass,l=s.property;(function(e){e[e.STAR=0]="STAR",e[e.CROWN=1]="CROWN"})(a||(a={}));var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t.spriteScale=null,t.star0=null,t.star1=null,t.crown0=null,t.crown1=null,t.milesStone=null,t.flag=null,t.type=a.STAR,t.activeColor=255,t.deactiveColor=0,t.actionDead=null,t}var n;return r(t,e),n=t,t.prototype.start=function(){this.activeColor=255,this.deactiveColor=0,this.resetNote()},t.prototype.active=function(){this.type===a.STAR?(this.spriteScale.spriteFrame=this.star1,this.sprite.spriteFrame=this.star1,this.spriteScale.node.setContentSize(n.STAR_SIZE),this.sprite.node.setContentSize(n.STAR_SIZE)):(this.spriteScale.spriteFrame=this.crown1,this.sprite.spriteFrame=this.crown1,this.sprite.sizeMode=cc.Sprite.SizeMode.RAW,this.spriteScale.sizeMode=cc.Sprite.SizeMode.RAW),this.milesStone&&(cc.tween(this.milesStone.node).to(.25,{opacity:0}).start(),cc.tween(this.flag.node).to(.25,{opacity:255}).start(),this.spriteScale.node.opacity=this.activeColor,cc.tween(this.spriteScale.node).to(.25,{scale:1.25}).to(.25,{scale:1}).start())},t.prototype.onFlag=function(){this.milesStone.node.opacity=this.deactiveColor,this.flag.node.opacity=this.activeColor},t.prototype.onStone=function(){this.milesStone.node.opacity=this.activeColor,this.flag.node.opacity=this.deactiveColor},t.prototype.resetNote=function(){this.type===a.STAR?(this.sprite.spriteFrame=this.star0,this.spriteScale.spriteFrame=this.star0,this.spriteScale.node.setContentSize(n.STAR_SIZE),this.sprite.node.setContentSize(n.STAR_SIZE),this.spriteScale.node.setAnchorPoint(n.STAR_ANCHOR_POINT),this.sprite.node.setAnchorPoint(n.STAR_ANCHOR_POINT)):(this.sprite.spriteFrame=this.crown0,this.spriteScale.spriteFrame=this.crown0,this.sprite.sizeMode=cc.Sprite.SizeMode.RAW,this.spriteScale.sizeMode=cc.Sprite.SizeMode.RAW,this.spriteScale.node.setAnchorPoint(n.CROWN_ANCHOR_POINT),this.sprite.node.setAnchorPoint(n.CROWN_ANCHOR_POINT)),this.sprite.node.opacity=this.activeColor,this.spriteScale.node.opacity=this.deactiveColor,null!=this.actionDead&&this.actionDead.stop()},t.prototype.effectDead=function(){var e=this;e.spriteScale.node.opacity=e.activeColor,e.actionDead=cc.tween(e.spriteScale.node).repeat(10,cc.tween().to(.25,{scale:1.25,opacity:0}).to(.5,{scale:1.75,opacity:255})).call(function(){e.spriteScale.node.opacity=0}).start()},t.prototype.continue=function(){null!=this.actionDead&&this.actionDead.stop(),this.spriteScale.node.setScale(1,1),this.spriteScale.node.opacity=this.activeColor},t.prototype.isStar=function(){return this.type===a.STAR},t.STAR_SIZE=cc.size(85,85),t.STAR_ANCHOR_POINT=cc.v2(.65,.55),t.CROWN_ANCHOR_POINT=cc.v2(.6,.35),i([l(cc.Sprite)],t.prototype,"sprite",void 0),i([l(cc.Sprite)],t.prototype,"spriteScale",void 0),i([l(cc.SpriteFrame)],t.prototype,"star0",void 0),i([l(cc.SpriteFrame)],t.prototype,"star1",void 0),i([l(cc.SpriteFrame)],t.prototype,"crown0",void 0),i([l(cc.SpriteFrame)],t.prototype,"crown1",void 0),i([l(cc.Sprite)],t.prototype,"milesStone",void 0),i([l(cc.Sprite)],t.prototype,"flag",void 0),i([l({type:cc.Enum(a)})],t.prototype,"type",void 0),n=i([c],t)}(cc.Component);n.default=u,cc._RF.pop()},{}],PCGameplayKeyboard:[function(e,t,n){"use strict";cc._RF.push(t,"89b51faVd1Mq6IxWAxRbKHy","PCGameplayKeyboard");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.animation=null,t}return r(t,e),t.prototype.playAnimation=function(){this.animation.enabled=!0,this.animation.play()},t.prototype.stopAnimation=function(){this.animation.enabled=!1,this.animation.node.scale=1},i([c(cc.Animation)],t.prototype,"animation",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],PCGameplayTutorialController:[function(e,t,n){"use strict";cc._RF.push(t,"7f4d2mLt81Lrrf9tzrZ9jxe","PCGameplayTutorialController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../Components/PCGameplayKeyboard"),l=e("../GameManager"),u=e("../Utils/GameUtils"),p=e("./GameplayController"),h=cc._decorator,d=h.ccclass,f=h.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mainNode=null,t.keyboard=[],t}return r(t,e),t.prototype.onLoad=function(){this.mainNode.active=!1,cc.view.on(p.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit,this),cc.view.on(p.default.EVENT_GAMEPLAY_START,this.onGameplayStart,this),cc.view.on(p.default.EVENT_GAMEPLAY_RESUME_RESULT,this.onGameplayResumeResult,this),cc.view.on(p.default.EVENT_GAMEPLAY_DEAD,this.onGameplayDead,this),cc.view.on(l.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged,this)},t.prototype.onDestroy=function(){cc.view.off(p.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit,this),cc.view.off(p.default.EVENT_GAMEPLAY_START,this.onGameplayStart,this),cc.view.off(p.default.EVENT_GAMEPLAY_RESUME_RESULT,this.onGameplayResumeResult,this),cc.view.off(p.default.EVENT_GAMEPLAY_DEAD,this.onGameplayDead,this),cc.view.off(l.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged,this)},t.prototype.onGameplayInit=function(){l.default.Instance.isPC()&&(this.mainNode.active=!0,this.keyboard.forEach(function(e){return e.playAnimation()}),p.default.Instance.request.isTutorial?this.setPositionIsBot():this.setPositionIsCenterWithOffset(),this.mainNode.active=!0)},t.prototype.onGameplayStart=function(){l.default.Instance.isPC()&&(p.default.Instance.request.isTutorial?this.moveToBot():this.mainNode.active=!1)},t.prototype.onGameplayDead=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return l.default.Instance.isPC()?p.default.Instance.request.isTutorial?[4,u.default.delay(1e3)]:[3,2]:[2];case 1:e.sent(),this.moveToPerfectLine(),e.label=2;case 2:return[2]}})})},t.prototype.onCanvasSizeChanged=function(){this.updateKeyBoardPosition()},t.prototype.onGameplayResumeResult=function(){l.default.Instance.isPC()&&p.default.Instance.request.isTutorial&&this.moveToBot()},t.prototype.setPositionIsCenterWithOffset=function(){this.mainNode.y=-40},t.prototype.updateKeyBoardPosition=function(){var e=l.default.Instance.canvasSize.width,t=.375*-e,n=.25*e;this.keyboard.forEach(function(e,o){e.node.setPosition(new cc.Vec3(t+o*n,0,0))})},t.prototype.moveToPerfectLine=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return e=p.default.Instance.syncLine.position.y,cc.tween(this.mainNode).to(.5,{y:e}).start(),[4,u.default.delay(500)];case 1:return t.sent(),this.keyboard.forEach(function(e){return e.playAnimation()}),[2]}})})},t.prototype.moveToBot=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(){return e=l.default.Instance.canvasSize,this.keyboard.forEach(function(e){return e.stopAnimation()}),t=-e.height/2+this.mainNode.height/2,cc.tween(this.mainNode).to(.5,{y:t}).start(),[2]})})},t.prototype.setPositionIsBot=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(){return e=l.default.Instance.canvasSize,t=-e.height/2+this.mainNode.height/2,this.mainNode.y=t,[2]})})},i([f(cc.Node)],t.prototype,"mainNode",void 0),i([f([c.default])],t.prototype,"keyboard",void 0),i([d],t)}(cc.Component);n.default=g,cc._RF.pop()},{"../Components/PCGameplayKeyboard":"PCGameplayKeyboard","../GameManager":"GameManager","../Utils/GameUtils":"GameUtils","./GameplayController":"GameplayController"}],Particle2DControl:[function(e,t,n){"use strict";cc._RF.push(t,"6ac6daQFmtC+6XttAylII1C","Particle2DControl");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.particles=[],t}return r(t,e),t.prototype.onLoad=function(){for(var e=this.particles.length-1;e>=0;--e);},t.prototype.play=function(){for(var e=this.particles.length-1;e>=0;--e)this.particles[e].resetSystem()},t.prototype.stop=function(){for(var e=this.particles.length-1;e>=0;--e)this.particles[e].resetSystem(),this.particles[e].stopSystem()},i([c([cc.ParticleSystem])],t.prototype,"particles",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],ParticleControl:[function(e,t,n){"use strict";cc._RF.push(t,"a9758tt9JxB9rTmknOHPY0k","ParticleControl");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.particles=[],t}return r(t,e),t.prototype.onLoad=function(){for(var e=this.particles.length-1;e>=0;--e){var t=this.particles[e].startSize.constant;this.particles[e].startSize.constant=2*t}},t.prototype.modifyCapacity=function(e,t){this.particles.length<e||(this.particles[e].capacity=t)},t.prototype.restart=function(){for(var e=this.particles.length-1;e>=0;--e)this.particles[e].stop(),this.particles[e].play()},t.prototype.play=function(){for(var e=this.particles.length-1;e>=0;--e)this.particles[e].play()},t.prototype.stop=function(){for(var e=this.particles.length-1;e>=0;--e)this.particles[e].stop()},t.prototype.pause=function(){for(var e=this.particles.length-1;e>=0;--e)this.particles[e].pause()},t.prototype.setScale=function(e){this.particles.forEach(function(t){t.node.setScale(e)})},i([c([cc.ParticleSystem3D])],t.prototype,"particles",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],PointGroup:[function(e,t,n){"use strict";cc._RF.push(t,"1e1fcrCGYFDP6L2bohNm7jQ","PointGroup");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=cc._decorator,l=c.ccclass,u=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stars=[],t}return r(t,e),t.prototype.show=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(){for(this.node.active=!0,t=this.stars.length,n=0;n<t;n++)this.stars[n].active=n<e;return[2]})})},t.prototype.hide=function(){return a(this,void 0,void 0,function(){return s(this,function(){return this.node.active=!1,[2]})})},i([u([cc.Node])],t.prototype,"stars",void 0),i([l],t)}(cc.Component);n.default=p,cc._RF.pop()},{}],PreviewSongManager:[function(e,t,n){"use strict";cc._RF.push(t,"f733bYCY5BClb+h4xduPwPW","PreviewSongManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./AudioManager"),s=e("./Controller/MainController"),c=e("./GameEvent"),l=cc._decorator,u=l.ccclass,p=(l.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isPlaying=!1,t.loadSession=0,t}var n;return r(t,e),n=t,t.prototype.onLoad=function(){n.Instance=this,this.addEventListeners()},t.prototype.onDestroy=function(){this.removeEventListeners()},t.prototype.addEventListeners=function(){cc.view.on(c.GameEvent.EVENT_START_REVIEW_SONG_REQUEST,this.onStartReviewSongRequest,this),cc.view.on(c.GameEvent.EVENT_STOP_REVIEW_SONG_REQUEST,this.onStopReviewSongRequest,this)},t.prototype.removeEventListeners=function(){cc.view.off(c.GameEvent.EVENT_START_REVIEW_SONG_REQUEST,this.onStartReviewSongRequest,this),cc.view.off(c.GameEvent.EVENT_STOP_REVIEW_SONG_REQUEST,this.onStopReviewSongRequest,this)},t.prototype.onStartReviewSongRequest=function(e){var t=s.default.Instance.runtimeData.currentSongUrl;this.isPlaying&&t===e.url||(this.stopCurrentSong(),this.playSong(e.url))},t.prototype.onStopReviewSongRequest=function(){this.stopCurrentSong()},t.prototype.playSong=function(e){var t=this;this.loadSession++;var n=this.loadSession;s.default.Instance.runtimeData.currentSongUrl=e,a.default.Instance.loadFromUrl(e,!0).then(function(){n===t.loadSession&&(a.default.Instance.play(),t.isPlaying=!0,t.notifyReviewSongStarted(e))})},t.prototype.stopCurrentSong=function(){this.loadSession++,s.default.Instance.runtimeData.currentSongUrl=null,a.default.Instance.stop(),this.isPlaying=!1},t.prototype.pauseCurrentSong=function(){this.isPlaying&&a.default.Instance.pause()},t.prototype.resumeCurrentSong=function(){this.isPlaying&&s.default.Instance.runtimeData.currentSongUrl&&a.default.Instance.resume()},t.prototype.notifyReviewSongStarted=function(e){var t=new c.ReviewStartSongEvent;t.url=e,cc.view.emit(c.GameEvent.EVENT_REVIEW_SONG_STARTED,t)},n=i([u],t)}(cc.Component));n.default=p,cc._RF.pop()},{"./AudioManager":"AudioManager","./Controller/MainController":"MainController","./GameEvent":"GameEvent"}],ProfileManager:[function(e,t,n){"use strict";cc._RF.push(t,"fa6cfLdpxRMjrkbREgPsdHI","ProfileManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./Components/EnhancedLoading"),l=e("./ConfigManager"),u=e("./Controller/MainController"),p=e("./GameEvent"),h=e("./GameManager"),d=e("./Handlers/UnlockFrameByLevelChecker"),f=cc._decorator,g=f.ccclass,y=(f.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getLoadingComponentList=function(){var e=this;return[{resultRequire:[c.LoadingResultType.LOCAL_DATA,c.LoadingResultType.AVATAR_CONFIG],resultList:[],executeFunction:function(){return e.progressData()}}]},t.prototype.onLoad=function(){cc.view.on(p.GameEvent.EVENT_CHANGE_PROFILE_AVATAR_REQUEST,this.onChangeProfileAvatarRequest,this),cc.view.on(p.GameEvent.EVENT_CHANGE_PROFILE_NICKNAME_REQUEST,this.onChangeProfileNicknameRequest,this),cc.view.on(p.GameEvent.EVENT_CHANGE_PROFILE_FRAME_REQUEST,this.onChangeProfileFrameRequest,this),this.initMainHandler()},t.prototype.onDestroy=function(){cc.view.off(p.GameEvent.EVENT_CHANGE_PROFILE_AVATAR_REQUEST,this.onChangeProfileAvatarRequest,this),cc.view.off(p.GameEvent.EVENT_CHANGE_PROFILE_NICKNAME_REQUEST,this.onChangeProfileNicknameRequest,this),cc.view.off(p.GameEvent.EVENT_CHANGE_PROFILE_FRAME_REQUEST,this.onChangeProfileFrameRequest,this)},t.prototype.progressData=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(){return e=u.default.Instance.userDataService.getData(),(t=l.default.Instance.getAvatarIds()).length>0&&(t.includes(e.profile.avatarId)||(e.profile.avatarId=t[0],h.GameLog.log("[ProfileManager] avatarId "+e.profile.avatarId+" not found, set to "+e.profile.avatarId))),[2]})})},t.prototype.onChangeProfileAvatarRequest=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return(t=e.avatarId)?[4,u.default.Instance.userDataService.updateAvatar(t)]:[3,2];case 1:o.sent(),(n=new p.ProfileAvatarChangedEvent).avatarId=t,cc.view.emit(p.GameEvent.EVENT_PROFILE_AVATAR_CHANGED,n),o.label=2;case 2:return[2]}})})},t.prototype.onChangeProfileNicknameRequest=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return(t=e.nickname)&&t.length>0&&t.length<=16?[4,u.default.Instance.userDataService.updateName(t)]:[3,2];case 1:o.sent(),(n=new p.ProfileNicknameChangedEvent).nickname=t,cc.view.emit(p.GameEvent.EVENT_PROFILE_NICKNAME_CHANGED,n),o.label=2;case 2:return[2]}})})},t.prototype.onChangeProfileFrameRequest=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return((t=e.frameId)||""===t)&&u.default.Instance.isFrameLocked(t)?[4,u.default.Instance.userDataService.updateFrame(t)]:[3,2];case 1:o.sent(),(n=new p.ProfileFrameChangedEvent).frameId=t,cc.view.emit(p.GameEvent.EVENT_PROFILE_FRAME_CHANGED,n),o.label=2;case 2:return[2]}})})},t.prototype.initMainHandler=function(){u.default.Instance.frameUnlockCheckers.push(new d.UnlockFrameByLevelChecker)},i([g],t)}(cc.Component));n.default=y,cc._RF.pop()},{"./Components/EnhancedLoading":"EnhancedLoading","./ConfigManager":"ConfigManager","./Controller/MainController":"MainController","./GameEvent":"GameEvent","./GameManager":"GameManager","./Handlers/UnlockFrameByLevelChecker":"UnlockFrameByLevelChecker"}],ProfileNameTab:[function(e,t,n){"use strict";cc._RF.push(t,"fc904Rik91BUbDl/L3q3iZR","ProfileNameTab");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../Controller/MainController"),l=e("../GameEvent"),u=e("../GameManager"),p=e("../ResourcesManager"),h=cc._decorator,d=h.ccclass,f=h.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.userLevelLabel=null,t.avatarSprite=null,t.frameSprite=null,t.userNameEditBox=null,t.avatarLoadSession=0,t.frameLoadSession=0,t}return r(t,e),t.prototype.onLoad=function(){this.userNameEditBox.node.on("editing-did-ended",this.onEndEditUserName,this)},t.prototype.showScene=function(){this.node.active=!0},t.prototype.hideScene=function(){this.node.active=!1},t.prototype.onSaveUserName=function(){var e=this.userNameEditBox.string;e.length>0?c.default.Instance.userDataService.getData().profile.userName=e:u.GameLog.error("User name cannot be empty!")},t.prototype.onEnable=function(){this.refresh(),this.userNameEditBox.node.on("editing-did-ended",this.onEndEditUserName,this),cc.view.on(l.GameEvent.EVENT_PROFILE_NICKNAME_CHANGED,this.onProfileNicknameChanged,this)},t.prototype.onDisable=function(){this.avatarLoadSession++,this.frameLoadSession++,this.userNameEditBox.node.off("editing-did-ended",this.onEndEditUserName,this),cc.view.off(l.GameEvent.EVENT_PROFILE_NICKNAME_CHANGED,this.onProfileNicknameChanged,this)},t.prototype.refresh=function(){this.updateUserInfo()},t.prototype.onProfileNicknameChanged=function(e){this.updateUserName(e.nickname)},t.prototype.updateUserInfo=function(){var e=c.default.Instance.userDataService.getData().profile;this.updateUserLevel(e.level),this.updateUserName(e.userName),this.loadAvatar(e.avatarId),this.loadFrame(e.frameId)},t.prototype.updateUserName=function(e){this.userNameEditBox.string=e},t.prototype.updateUserLevel=function(e){this.userLevelLabel.string=e.toString()},t.prototype.loadAvatar=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return this.avatarSprite.spriteFrame=p.default.Instance.getDefaultAvatar(),this.avatarLoadSession++,t=this.avatarLoadSession,[4,p.default.Instance.loadAvatar(e)];case 1:return n=o.sent(),t!=this.avatarLoadSession?[2]:(null!=n&&(this.avatarSprite.spriteFrame=n),[2])}})})},t.prototype.loadFrame=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return null==e||""==e?(this.frameSprite.node.active=!1,[2]):(this.frameSprite.node.active=!0,this.frameSprite.spriteFrame=p.default.Instance.getDefaultFrame(),this.frameLoadSession++,t=this.frameLoadSession,[4,p.default.Instance.loadFrame(e)]);case 1:return n=o.sent(),t!=this.frameLoadSession?[2]:(null!=n&&(this.frameSprite.spriteFrame=n),[2])}})})},t.prototype.onEndEditUserName=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(){return e=this.userNameEditBox.string,(t=new l.ChangeProfileNicknameRequestEvent).nickname=e,cc.view.emit(l.GameEvent.EVENT_CHANGE_PROFILE_NICKNAME_REQUEST,t),[2]})})},i([f(cc.Label)],t.prototype,"userLevelLabel",void 0),i([f(cc.Sprite)],t.prototype,"avatarSprite",void 0),i([f(cc.Sprite)],t.prototype,"frameSprite",void 0),i([f(cc.EditBox)],t.prototype,"userNameEditBox",void 0),i([d],t)}(cc.Component);n.default=g,cc._RF.pop()},{"../Controller/MainController":"MainController","../GameEvent":"GameEvent","../GameManager":"GameManager","../ResourcesManager":"ResourcesManager"}],ProfileSceneController:[function(e,t,n){"use strict";cc._RF.push(t,"225b9kWpOxOxqBYgZNKJ6Q3","ProfileSceneController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../AudioManager"),s=e("../SceneManager"),c=e("./BaseSceneController"),l=cc._decorator,u=l.ccclass,p=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.headerNode=null,t.midNode=null,t.closeButton=null,t}return r(t,e),t.prototype.onLoad=function(){this.closeButton.node.on("click",this.onClickClose,this)},t.prototype.showScene=function(){this.node.active=!0,this.headerNode.active=!0,this.midNode.active=!0},t.prototype.hideScene=function(){this.node.active=!1},t.prototype.onClickClose=function(){a.default.Instance.playButton(),s.default.Instance.showHome()},i([p(cc.Node)],t.prototype,"headerNode",void 0),i([p(cc.Node)],t.prototype,"midNode",void 0),i([p(cc.Button)],t.prototype,"closeButton",void 0),i([u],t)}(c.default);n.default=h,cc._RF.pop()},{"../AudioManager":"AudioManager","../SceneManager":"SceneManager","./BaseSceneController":"BaseSceneController"}],ProgressBarControllers:[function(e,t,n){"use strict";cc._RF.push(t,"25aae6IgVlKvY7ySdmKVsH3","ProgressBarControllers");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Gameplay/ProgressBar/Counter"),s=e("../Gameplay/ProgressBar/NoteProgress"),c=e("../Gameplay/ProgressBar/EffectController"),l=e("../GM"),u=e("./StarController"),p=e("../GameManager"),h=e("./GameplayController"),d=e("../AudioManager"),f=cc._decorator,g=f.ccclass,y=f.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.listNoteToNextStar=[],t.currentProgress=null,t.listNoteProgress=[],t.effectController=null,t.starController=null,t.starLayout=null,t.scoreLable=null,t.reviveLable=null,t.light=null,t.status=[],t.starSprite=null,t.crownSprite=null,t.statusNode=null,t.wedgetNeedDissable=[],t.gamemanager=null,t.leftNode=null,t.rightNode=null,t._starPoss={1:[0],2:[-60,60],3:[-103,0,103]},t.targetMove=cc.Vec2.ZERO,t.lightPos=cc.Vec2.ZERO,t.percent=0,t.isScaleForMultiplayer=!1,t}var n;return r(t,e),n=t,t.prototype.onLoad=function(){n.Instance=this,a.default.OnTileHit=this.onTileHit.bind(this),a.default.doAnimScore=this.doAnimScoreLabel.bind(this),cc.view.on(h.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit.bind(this)),cc.view.on(h.default.EVENT_GAMEPLAY_START,this.onGameplayStart.bind(this)),cc.view.on(h.default.EVENT_GAMEPLAY_RESUME_REQUEST,this.onGameplayResumeRequest.bind(this)),cc.view.on(h.default.EVENT_GAMEPLAY_RESUME_RESULT,this.onGameplayResumeResult.bind(this))},t.prototype.onDestroy=function(){cc.view.off(h.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit.bind(this)),cc.view.off(h.default.EVENT_GAMEPLAY_START,this.onGameplayStart.bind(this)),cc.view.off(h.default.EVENT_GAMEPLAY_RESUME_REQUEST,this.onGameplayResumeRequest.bind(this)),cc.view.off(h.default.EVENT_GAMEPLAY_RESUME_RESULT,this.onGameplayResumeResult.bind(this))},t.prototype.enableCrownForEndlessMode=function(e){Math.min(l.default.defines().maxLoop,l.default.defines().MAX_CROWN);for(var t=3;t<this.listNoteProgress.length;t++)this.listNoteProgress[t].node.active=e;this.starLayout.updateLayout()},t.prototype.setSizeProgress=function(){p.default.Instance.fullCanvasSize,this.targetMove=cc.Vec2.ZERO,this.targetMove.y=-p.default.Instance.fullCanvasSize.height/5,this.lightPos=cc.Vec2.ZERO,this.starLayout.updateLayout()},t.prototype.progressChange=function(){var e=h.default.Instance.request,t=a.default.CurrentStar,n=3+(e.isTutorial?0:3);t>=n?this.percent=1:this.percent+=1/n/(this.listNoteToNextStar[t+1]-this.listNoteToNextStar[t]);var o=this.rightNode.x-this.leftNode.x,r=this.percent*o;this.currentProgress.node.width=r,a.default.updateProgress((r/this.node.width).toFixed(2)),this.lightPos.x=r,this.light.setPosition(this.lightPos.x,this.lightPos.y),a.default.totalNoteRemove>=this.listNoteToNextStar[a.default.CurrentStar+1]&&(a.default.CurrentStar++,this.starController.play3dStarAnim(a.default.CurrentStar-1,this.setUpStarEffect.bind(this)),this.gamemanager.isMultiTrack||this.showEffectByStarActive(a.default.CurrentStar),3==a.default.CurrentStar&&d.default.Instance.playWin(),a.default.CurrentStar>3&&d.default.Instance.playWinCrown())},t.prototype.setUpStarEffect=function(){this.listNoteProgress[a.default.CurrentStar-1].active(),this.starController.setInactive()},t.prototype.showEffectByStarActive=function(){},t.prototype.statusStar=function(e){if(0!=this.statusNode.active){this.statusNode.opacity=255;var t=e>3?this.crownSprite:this.starSprite;e>this.status.length&&(e-=this.status.length);for(var n=e,o=0;o<this.status.length&&(this.status[o].node.x=this._starPoss[e][o],this.status[o].node.opacity=255,this.status[o].spriteFrame=t,cc.tween(this.status[o].node).delay(.1+.1*o).to(.2,{scale:1.5},{easing:"quartOut"}).delay(2+.1*o).to(.1,{scale:0}).to(.1,{opacity:0}).start(),0!=--n);o++);}},t.prototype.setUpProgress=function(){var e=.3*a.default.totalNote,t=.6*a.default.totalNote,n=a.default.totalNote,o=a.default.totalNote+a.default.totalNote/2,r=2*a.default.totalNote,i=3*a.default.totalNote;this.listNoteToNextStar=[0,e,t,n,o,r,i],this.percent=0,this.progressChange(),this.scoreLable.string="0",this.scoreLable.node.opacity=0,this.effectController.resetEffect(),this.effectController.doActive();for(var s=0;s<this.listNoteProgress.length;s++)this.listNoteProgress[s].resetNote();for(s=0;s<this.listNoteProgress.length;s++)this.listNoteProgress[s].enabled=!1;this.wedgetNeedDissable[1].node.y=0},t.prototype.onTileHit=function(e,t){var n=0;switch(e){case"perfect":n=l.default.defines().SCORE_PERFECT,a.default.perfectStreak++;break;case"great":n=l.default.defines().SCORE_GREAT,a.default.perfectStreak=0;break;case"cool":n=l.default.defines().SCORE_COOL,a.default.perfectStreak=0}"short"===t&&a.default.updateScore(n,e),a.default.totalNoteRemove++,this.progressChange(),this.effectController.showEffect(e,a.default.perfectStreak)},t.prototype.doAnimScoreLabel=function(){cc.director.getActionManager().removeActionByTag(9,this.scoreLable.node),this.scoreLable.node.scale=1,this.scoreLable.string=a.default.score.toString();var e=cc.tween(this.scoreLable.node);e.to(.1,{scale:1.1}).to(.1,{scale:1}).start(),e.tag(9)},t.prototype.goScreen=function(){cc.tween(this.wedgetNeedDissable[1].node).to(.5,{position:cc.v3(this.targetMove.x,this.targetMove.y,this.wedgetNeedDissable[1].node.z)}).start();var e=6-a.default.reviveTimes==1?" TIME LEFT":" TIMES LEFT";this.reviveLable.string=6-a.default.reviveTimes+e,this.scoreLable.node.opacity=0,this.reviveLable.node.opacity=255,a.default.perfectStreak=0,this.effectController.doDeactive();for(var t=0;t<this.listNoteProgress.length;t++)this.listNoteProgress[t].effectDead()},t.prototype.goBack=function(){cc.tween(this.wedgetNeedDissable[1].node).to(.5,{position:cc.v3(0,0,this.wedgetNeedDissable[1].node.z)}).start(),this.scoreLable.node.opacity=255,this.reviveLable.node.opacity=0,this.effectController.doActive();for(var e=0;e<this.listNoteProgress.length;e++)this.listNoteProgress[e].continue()},t.prototype.onTouchSpamParticle=function(){this.effectController.instantiatePerfect()},t.prototype.onHide=function(){this.node.active=!1},t.prototype.onShow=function(){this.node.active||(this.node.active=!0)},t.prototype.onGameplayInit=function(){this.starController.setInactive(),this.scoreLable.node.opacity=0,this.reviveLable.node.opacity=0,this.setSizeProgress(),this.effectController.doActive(),this.enableCrownForEndlessMode(!h.default.Instance.request.isTutorial),this.setUpProgress()},t.prototype.onGameplayStart=function(){this.scoreLable.node.opacity=256},t.prototype.onGameplayResumeRequest=function(){this.goScreen()},t.prototype.onGameplayResumeResult=function(){this.goBack()},t.Instance=null,i([y([cc.Integer])],t.prototype,"listNoteToNextStar",void 0),i([y(cc.Sprite)],t.prototype,"currentProgress",void 0),i([y(s.default)],t.prototype,"listNoteProgress",void 0),i([y(c.default)],t.prototype,"effectController",void 0),i([y(u.default)],t.prototype,"starController",void 0),i([y(cc.Layout)],t.prototype,"starLayout",void 0),i([y(cc.Label)],t.prototype,"scoreLable",void 0),i([y(cc.Label)],t.prototype,"reviveLable",void 0),i([y(cc.Node)],t.prototype,"light",void 0),i([y([cc.Sprite])],t.prototype,"status",void 0),i([y(cc.SpriteFrame)],t.prototype,"starSprite",void 0),i([y(cc.SpriteFrame)],t.prototype,"crownSprite",void 0),i([y(cc.Node)],t.prototype,"statusNode",void 0),i([y([cc.Widget])],t.prototype,"wedgetNeedDissable",void 0),i([y(p.default)],t.prototype,"gamemanager",void 0),i([y(cc.Node)],t.prototype,"leftNode",void 0),i([y(cc.Node)],t.prototype,"rightNode",void 0),n=i([g],t)}(cc.Component);n.default=v,cc._RF.pop()},{"../AudioManager":"AudioManager","../GM":"GM","../GameManager":"GameManager","../Gameplay/ProgressBar/Counter":"Counter","../Gameplay/ProgressBar/EffectController":"EffectController","../Gameplay/ProgressBar/NoteProgress":"NoteProgress","./GameplayController":"GameplayController","./StarController":"StarController"}],ResourcesManager:[function(e,t,n){"use strict";cc._RF.push(t,"a2ef6BjSSpKo6kJZ5Lt53QC","ResourcesManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./Utils/GameUtils"),l=e("./ConfigManager"),u=cc._decorator,p=u.ccclass,h=u.property,d=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=!1),void 0===n&&(n=!1),this.spriteFrame=e,this.isLoading=t,this.loadFailed=n},f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultAvatar=null,t.defaultFrame=null,t.spriteFramesMap=new Map,t}return r(t,e),t.prototype.getDefaultAvatar=function(){return this.defaultAvatar},t.prototype.getDefaultFrame=function(){return this.defaultFrame},t.prototype.loadAvatar=function(e){return a(this,void 0,Promise,function(){var t,n;return s(this,function(){return t=l.default.Instance.getAvatarConfig(e),n=t?t.url:null,[2,this.loadSpriteFrame(n,this.getDefaultAvatar())]})})},t.prototype.loadFrame=function(e){return a(this,void 0,Promise,function(){var t,n;return s(this,function(){return t=l.default.Instance.getFrameConfig(e),n=t?t.url:null,[2,this.loadSpriteFrame(n,this.getDefaultFrame())]})})},t.prototype.loadSpriteFrame=function(e,t){return a(this,void 0,Promise,function(){var n,o;return s(this,function(r){switch(r.label){case 0:return e?(null==(n=this.spriteFramesMap.get(e))?void 0:n.isLoading)?[4,c.default.waitUtil(function(){return!n.isLoading})]:[3,2]:[2,t];case 1:return r.sent(),[2,n.spriteFrame];case 2:if((null==n?void 0:n.loadFailed)||(null==n?void 0:n.spriteFrame))return[2,n.spriteFrame];n=new d(null,!0),this.spriteFramesMap.set(e,n),r.label=3;case 3:return r.trys.push([3,5,6,7]),o=n,[4,this.loadSpriteFrameFromURL(e)];case 4:return o.spriteFrame=r.sent(),[3,7];case 5:return r.sent(),n.loadFailed=!0,n.spriteFrame=t,[3,7];case 6:return n.isLoading=!1,this.spriteFramesMap.set(e,n),[7];case 7:return[2,n.spriteFrame]}})})},t.prototype.loadSpriteFrameFromURL=function(e){return new Promise(function(t,n){cc.assetManager.loadRemote(e,function(e,o){e?n(e):t(new cc.SpriteFrame(o))})})},i([h(cc.SpriteFrame)],t.prototype,"defaultAvatar",void 0),i([h(cc.SpriteFrame)],t.prototype,"defaultFrame",void 0),i([p],t)}(cc.Component);n.default=f,cc._RF.pop()},{"./ConfigManager":"ConfigManager","./Utils/GameUtils":"GameUtils"}],ResultSceneController:[function(e,t,n){"use strict";cc._RF.push(t,"8d290ZmZMxFbK5kj14+hC4d","ResultSceneController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ResultSceneController=void 0;var c=e("../AudioManager"),l=e("../Components/PointGroup"),u=e("../GameManager"),p=e("../Utils/GameUtils"),h=e("./BaseSceneController"),d=e("./GameplayController"),f=e("./MainController"),g=cc._decorator,y=g.ccclass,v=g.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.starGroup=null,t.crowGroup=null,t.songNameLabel=null,t.artistNameLabel=null,t.scoreLabel=null,t.newHighscoreNode=null,t.highScoreNode=null,t.highScoreLabel=null,t.homeButton=null,t.nextButton=null,t.botLayoutNode=null,t.replayButton=null,t.glowEffect=null,t.decorationNode=null,t.pointGroupWidget=null,t.midGroupWidget=null,t.leaderBoardNode=null,t.titleMoveTween=null,t.scoreTween=null,t.layoutBotTween=null,t.isInputLocked=!1,t}return r(t,e),t.prototype.onLoad=function(){this.initializeButtonListeners(),this.initializeGlowEffect()},t.prototype.onEnable=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},t.prototype.onDisable=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},t.prototype.showScene=function(){return a(this,void 0,Promise,function(){var e,t,n,o;return s(this,function(r){switch(r.label){case 0:return this.resetAnimations(),this.isInputLocked=!1,this.node.active=!0,e=d.default.Instance,t=e.request,n=e.result,o=t.songConfig,this.updateLabels(o,n),this.updateScoreDisplay(n),this.updateLayoutPositions(),this.leaderBoardNode.active=t.isSongChallenge,this.midGroupWidget.isAlignTop=t.isSongChallenge,this.pointGroupWidget.isAlignTop=t.isSongChallenge,t.isSongChallenge?(this.midGroupWidget.top=477,this.midGroupWidget.node.scale=1,this.pointGroupWidget.top=283,this.pointGroupWidget.node.scale=.7):(this.midGroupWidget.node.y=0,this.midGroupWidget.node.scale=1.4,this.pointGroupWidget.node.y=350,this.pointGroupWidget.node.scale=1),[4,this.animateScene()];case 1:return r.sent(),c.default.Instance.playResult(),[2]}})})},t.prototype.hideScene=function(){return a(this,void 0,Promise,function(){return s(this,function(){return this.node.active=!1,this.leaderBoardNode.active=!1,[2]})})},t.prototype.initializeButtonListeners=function(){this.homeButton.node.on("click",this.onClickHome.bind(this)),this.nextButton.node.on("click",this.onClickNext.bind(this)),this.replayButton.node.on("click",this.onClickReplay.bind(this))},t.prototype.initializeGlowEffect=function(){var e=cc.rotateBy(1,100),t=cc.repeatForever(e);this.glowEffect.runAction(t)},t.prototype.resetAnimations=function(){var e,t;null===(e=this.titleMoveTween)||void 0===e||e.stop(),null===(t=this.scoreTween)||void 0===t||t.stop(),this.titleMoveTween=null,this.scoreTween=null},t.prototype.updateLabels=function(e,t){this.songNameLabel.string=e.songName,this.artistNameLabel.string=e.artistName,this.scoreLabel.string="0",this.updateCrownAndStarDisplay(t),this.updateHighScoreDisplay(t,e)},t.prototype.updateCrownAndStarDisplay=function(e){e.crowns>0?(this.crowGroup.show(e.crowns),this.starGroup.hide(),this.setGlowEffectActive(!0)):e.stars>0?(this.crowGroup.hide(),this.starGroup.show(e.stars),this.setGlowEffectActive(!0)):(this.crowGroup.hide(),this.starGroup.show(0),this.setGlowEffectActive(!1))},t.prototype.setGlowEffectActive=function(e){this.glowEffect.active=e,this.decorationNode.active=e},t.prototype.updateHighScoreDisplay=function(e,t){if(this.newHighscoreNode.active=!e.isTutorial&&e.isHighScore,this.highScoreNode.active=!e.isTutorial&&!e.isHighScore,this.highScoreNode.active){var n=f.default.Instance.userDataService.getSongData(t.songId);this.highScoreLabel.string="BEST: "+n.highScore}},t.prototype.updateScoreDisplay=function(e){e.score>0&&this.animateScore(e.score)},t.prototype.updateLayoutPositions=function(){this.songNameLabel.node.position=cc.v3(0,this.songNameLabel.node.y),this.botLayoutNode.position=cc.v3(0,-300)},t.prototype.animateScene=function(){return a(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return d.default.Instance.request.songConfig.songName.length>20&&this.animateLongTitle(),[4,this.animateBottomLayout()];case 1:return e.sent(),[2]}})})},t.prototype.animateLongTitle=function(){var e=this.songNameLabel.node.y;this.titleMoveTween=cc.tween(this.songNameLabel.node).repeatForever(cc.tween().to(5,{position:cc.v3(-250,e)}).to(0,{position:cc.v3(250,e)})).start()},t.prototype.animateScore=function(e){var t=this;this.scoreTween=cc.tween({score:0}).to(.4,{score:e},{progress:function(e,n,o,r){var i=Math.floor(e+(n-e)*r);return t.scoreLabel.string=i.toString(),o}}).start()},t.prototype.animateBottomLayout=function(){return a(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,p.default.delay(.5)];case 1:return e.sent(),this.layoutBotTween=cc.tween(this.botLayoutNode).to(.3,{position:cc.v3(0,45)}).start(),[2]}})})},t.prototype.onKeyDown=function(e){switch(e.keyCode){case cc.macro.KEY.backspace:case cc.macro.KEY.escape:this.onClickHome();break;case cc.macro.KEY.enter:this.onClickNext();break;case cc.macro.KEY.space:this.onClickReplay()}},t.prototype.onClickHome=function(){this.handleButtonClick(function(){return u.default.Instance.resultToHome()})},t.prototype.onClickNext=function(){this.handleButtonClick(function(){return u.default.Instance.playNextSong()})},t.prototype.onClickReplay=function(){this.handleButtonClick(function(){return u.default.Instance.replaySong()},!0)},t.prototype.handleButtonClick=function(e,t){void 0===t&&(t=!1),t?c.default.Instance.playReplayButton():c.default.Instance.playButton(),this.isInputLocked||(this.isInputLocked=!0,e())},i([v(l.default)],t.prototype,"starGroup",void 0),i([v(l.default)],t.prototype,"crowGroup",void 0),i([v(cc.Label)],t.prototype,"songNameLabel",void 0),i([v(cc.Label)],t.prototype,"artistNameLabel",void 0),i([v(cc.Label)],t.prototype,"scoreLabel",void 0),i([v(cc.Node)],t.prototype,"newHighscoreNode",void 0),i([v(cc.Node)],t.prototype,"highScoreNode",void 0),i([v(cc.Label)],t.prototype,"highScoreLabel",void 0),i([v(cc.Button)],t.prototype,"homeButton",void 0),i([v(cc.Button)],t.prototype,"nextButton",void 0),i([v(cc.Node)],t.prototype,"botLayoutNode",void 0),i([v(cc.Button)],t.prototype,"replayButton",void 0),i([v(cc.Node)],t.prototype,"glowEffect",void 0),i([v(cc.Node)],t.prototype,"decorationNode",void 0),i([v(cc.Widget)],t.prototype,"pointGroupWidget",void 0),i([v(cc.Widget)],t.prototype,"midGroupWidget",void 0),i([v(cc.Node)],t.prototype,"leaderBoardNode",void 0),i([y],t)}(h.default);n.ResultSceneController=m,cc._RF.pop()},{"../AudioManager":"AudioManager","../Components/PointGroup":"PointGroup","../GameManager":"GameManager","../Utils/GameUtils":"GameUtils","./BaseSceneController":"BaseSceneController","./GameplayController":"GameplayController","./MainController":"MainController"}],Rotator:[function(e,t,n){"use strict";cc._RF.push(t,"4930b5cQblGe6iiJ4dku0ww","Rotator");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=-360,t}return r(t,e),t.prototype.update=function(e){this.node.angle+=this.speed*e},i([c(cc.Float)],t.prototype,"speed",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],RuntimeData:[function(e,t,n){"use strict";cc._RF.push(t,"7a82cekFPhCFIUJ38VedQY1","RuntimeData"),Object.defineProperty(n,"__esModule",{value:!0}),n.RuntimeData=void 0;n.RuntimeData=function(){this.currentSongUrl=null},cc._RF.pop()},{}],ScaleToFill:[function(e,t,n){"use strict";cc._RF.push(t,"551a3o14hBKYJoFVN608EU5","ScaleToFill");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Controller/GameplayController"),s=e("../GameManager"),c=cc._decorator,l=c.ccclass,u=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprites=[],t.bounds=null,t.minCam=cc.Vec3.ZERO,t.maxCam=cc.Vec3.ZERO,t.sizeViewPort=cc.Vec2.ZERO,t.fullScreen=!1,t.min=cc.Vec2.ZERO,t.max=cc.Vec2.ZERO,t.size=cc.Vec2.ZERO,t.originalScale=cc.Vec2.ONE,t}return r(t,e),t.prototype.start=function(){cc.view.on(s.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged.bind(this)),cc.view.on(a.default.EVENT_CAMERA_ORTHO_CHANGED,this.onCameraOrthoChanged.bind(this)),this.setupDefaultSize(),this.scale()},t.prototype.onDestroy=function(){cc.view.off(s.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged.bind(this)),cc.view.off(a.default.EVENT_CAMERA_ORTHO_CHANGED,this.onCameraOrthoChanged.bind(this))},t.prototype.onCanvasSizeChanged=function(){this.scale()},t.prototype.onCameraOrthoChanged=function(){this.scale()},t.prototype.setupDefaultSize=function(){if(0!==this.sprites.length){var e=this.sprites[0].node.getBoundingBox();this.min=cc.v2(e.xMin,e.yMin),this.max=cc.v2(e.xMax,e.yMax),this.size=cc.Vec2.ZERO;for(var t=1;t<this.sprites.length;t++){var n=this.sprites[t].node.getBoundingBox(),o=cc.v2(n.xMin,n.yMin),r=cc.v2(n.xMax,n.yMax);o.y<this.min.y&&(this.min.y=o.y),o.x<this.min.x&&(this.min.x=o.x),r.y>this.max.y&&(this.max.y=r.y),r.x>this.max.x&&(this.max.x=r.x)}this.size.x=Math.abs(this.max.x-this.min.x),this.size.y=Math.abs(this.max.y-this.min.y),this.originalScale=this.node.getScale(this.originalScale)}},t.prototype.scale=function(){this.sizeViewPort.x=this.maxCam.x-this.minCam.x+.1,this.sizeViewPort.y=this.maxCam.y-this.minCam.y+.1;var e=this.sizeViewPort.x*this.originalScale.x/this.size.x;e*this.size.y/this.originalScale.y<this.sizeViewPort.y&&(e=this.sizeViewPort.y*this.originalScale.y/this.size.y),this.fullScreen&&(e/=s.default.Instance.userPlayScale),this.node.scale=e,this.bounds=this.sprites[0].node.getBoundingBox(),console.log("scale background to fit: "+e)},i([u([cc.Sprite])],t.prototype,"sprites",void 0),i([u(cc.Rect)],t.prototype,"bounds",void 0),i([u(cc.Vec3)],t.prototype,"minCam",void 0),i([u(cc.Vec3)],t.prototype,"maxCam",void 0),i([u(cc.Vec2)],t.prototype,"sizeViewPort",void 0),i([u],t.prototype,"fullScreen",void 0),i([l],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../Controller/GameplayController":"GameplayController","../GameManager":"GameManager"}],SceneManager:[function(e,t,n){"use strict";cc._RF.push(t,"813faaq92BMGaWPAbZGQNO/","SceneManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./Controller/GamePlaySceneController"),l=e("./Controller/HomeSceneController"),u=e("./Controller/ProfileSceneController"),p=e("./Controller/ResultSceneController"),h=e("./Controller/TutorialSceneController"),d=cc._decorator,f=d.ccclass,g=d.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameplayCanvas=null,t.tutorialcanvas=null,t.homeCanvas=null,t.resultCanvas=null,t.profileCanvas=null,t.loadingCanvas=null,t.currentActive=null,t}var n;return r(t,e),n=t,t.prototype.onLoad=function(){n.Instance=this},t.prototype.start=function(){this.gameplayCanvas.node.active=!1,this.tutorialcanvas.node.active=!1,this.homeCanvas.node.active=!1,this.resultCanvas.node.active=!1,this.profileCanvas.node.active=!1,this.loadingCanvas.active=!0},t.prototype.showHome=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.activeScene(this.homeCanvas)];case 1:return e.sent(),[2]}})})},t.prototype.showGamePlay=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.activeScene(this.gameplayCanvas)];case 1:return e.sent(),[2]}})})},t.prototype.showTutorialScene=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.activeScene(this.tutorialcanvas)];case 1:return e.sent(),[2]}})})},t.prototype.showResult=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.activeScene(this.resultCanvas)];case 1:return e.sent(),[2]}})})},t.prototype.showProfile=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.activeScene(this.profileCanvas)];case 1:return e.sent(),[2]}})})},t.prototype.showLoading=function(){this.loadingCanvas.active=!0},t.prototype.hideLoading=function(){this.loadingCanvas.active=!1},t.prototype.activeScene=function(e){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.showLoading(),null==this.currentActive?[3,2]:[4,this.currentActive.hideScene()];case 1:t.sent(),this.currentActive=null,t.label=2;case 2:return[4,e.showScene()];case 3:return t.sent(),this.currentActive=e,this.hideLoading(),[2]}})})},t.Instance=null,i([g(c.default)],t.prototype,"gameplayCanvas",void 0),i([g(h.default)],t.prototype,"tutorialcanvas",void 0),i([g(l.default)],t.prototype,"homeCanvas",void 0),i([g(p.default)],t.prototype,"resultCanvas",void 0),i([g(u.default)],t.prototype,"profileCanvas",void 0),i([g(cc.Node)],t.prototype,"loadingCanvas",void 0),n=i([f],t)}(cc.Component);n.default=y,cc._RF.pop()},{"./Controller/GamePlaySceneController":"GamePlaySceneController","./Controller/HomeSceneController":"HomeSceneController","./Controller/ProfileSceneController":"ProfileSceneController","./Controller/ResultSceneController":"ResultSceneController","./Controller/TutorialSceneController":"TutorialSceneController"}],ShortTile:[function(e,t,n){"use strict";cc._RF.push(t,"6c5aa8uTa5INqXkX4GGAeRg","ShortTile");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Tile"),s=e("../GM"),c=cc._decorator,l=c.ccclass,u=(c.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.setup=function(t,n,o,r){e.prototype.setup.call(this,t,n,o,r)},t.prototype.update=function(){s.default.defines().isAutoPlay&&!this.isHit&&this.checkReachSyncLine()},i([l],t)}(a.default));n.default=u,cc._RF.pop()},{"../GM":"GM","./Tile":"Tile"}],SlideTile:[function(e,t,n){"use strict";cc._RF.push(t,"218046nzqlCF6d7Xm2LY8Mr","SlideTile");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,r++)o[r]=i[a];return o};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../Defines"),c=e("../Gameplay/ProgressBar/Counter"),l=e("../GM"),u=e("../Data/GameConfig"),p=e("./Tile"),h=e("../Utils/GameUtils"),d=e("../Defines"),f=cc._decorator,g=f.ccclass,y=f.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ctx=null,t.holdCtx=null,t.holdRendererSprite=null,t.holdRendererSpriteHeight=0,t.maskHoldRenderer=null,t.line=null,t.touchNode=null,t.isTest=!1,t.maskHoldRendererDebug=null,t.holdNodeFollow=null,t.auraSprite=null,t.blinkingCircle=null,t.holdNodePosition=null,t.meshRenderer=null,t.firstArrow=null,t.arrows=[],t.arrowsFX=[],t.scoreBonusLabel=null,t.isDebug=!1,t.noteLength=0,t.tileSizeX=0,t.tileSizeY=0,t.intSegLane=[],t.lane=0,t.linePoints=[],t.linesPointsRevert=[],t.isShouldUpdateEffect=!1,t.isEndTile=!1,t.endTouch=!1,t.listVertices=[],t.listIndices=[],t.listColors=[],t.noteData=new u.NoteData,t.gpc=null,t.OnTouchStart=null,t.OnTouchEnd=null,t.OnTouchCancel=null,t.noteIndex=-1,t.laneIndex=0,t.isDual=!1,t.endSliderLane=0,t.percentHold=0,t.duration=10,t.pointsPolygonCollider=[],t.heightTest=200,t.holdSpriteInfo=[],t.holdSpriteIndex=0,t.bonusScorePos=cc.Vec3.ZERO,t.score=0,t.maxScoreBonus=0,t.arrowPlayedFx=0,t.arrowsFXArr=[],t.isTutorial=!1,t._runUpdate=!0,t.setupReviveAnimation=!1,t.preventPlayingEffect=!0,t.isAuraScalePlaying=!1,t.auraScaleTween=null,t.scaleDownDuration=d.SlideTileDefines.scaleDownDuration,t.scaleDownVal=d.SlideTileDefines.scaleDownVal,t.scaleUpDuration=d.SlideTileDefines.scaleUpDuration,t.scaleUpVal=d.SlideTileDefines.scaleUpVal,t.scaleAuraTweenTag=d.SlideTileDefines.scaleAuraTweenTag,t.totalArrowActive=0,t}var n;return r(t,e),n=t,t.prototype.onLoad=function(){var e=cc.view.getCanvasSize();this.tileSizeX=e.width/cc.view.getScaleX()/l.default.defines().MAX_LANE,this.tileSizeY=l.default.defines().SHORT_TILE_HEIGHT;for(var t=0;t<this.arrowsFX.length;t++){this.arrowsFXArr[t]=[this.arrowsFX[t]];for(var n=0;n<this.arrowsFX[t].node.children.length;n++){var o=this.arrowsFX[t].node.children[n];this.arrowsFXArr[t].push(o.getComponent(cc.ParticleSystem))}}},t.prototype.start=function(){this.isTest&&this.setuptest()},t.prototype.setupListPoints=function(){var e=this.noteData,t=0;this.linePoints=[],this.linesPointsRevert=[];var n=this.laneIndex,o=this.isTest?this.heightTest:0,r=this.tileSizeX,i=-r/2;this.linePoints.push(new cc.Vec2(i,0)),this.linesPointsRevert.push(new cc.Vec2(this.linePoints[0].x+r,t));for(var a=0;a<this.intSegLane.length;a++){var s=[];s.push(this.linePoints[this.linePoints.length-1].clone()),s.push(this.linesPointsRevert[this.linesPointsRevert.length-1].clone());var c=(this.intSegLane[a]-n)*r+i;if(i=c,!this.isTest){var l=e.segmentMidi[a]*this.gpc.tickDuration;o=this.gpc.levelSpeed*l}t=o+t,n=this.intSegLane[a],this.linePoints.push(new cc.Vec2(c,t)),this.linesPointsRevert.push(new cc.Vec2(c+r,t)),s.push(this.linePoints[this.linePoints.length-1].clone()),this.createHoldSprite(s)}this.noteLength=Math.abs(t)},t.prototype.setup=function(t,n,o,r){e.prototype.setup.call(this,t,n,o,r),this.linePoints=[],this.linesPointsRevert=[],this.isShouldUpdateEffect=!1,this.intSegLane=[],this.percentHold=0,this.noteLength=0,this.lastTouch=cc.Vec2.ZERO,this.isEndTile=!1,this.endTouch=!1,this.holdSpriteInfo=[],this.holdSpriteIndex=0,this.holdRendererSprite.active=!1,this.holdRendererSpriteHeight=180,this.listVertices=[],this.listIndices=[],this.listColors=[],this.holdCtx.node.active=!0,null!==this.intSegLane&&0!==this.intSegLane.length||(this.intSegLane=this.noteData.segmentLane),this.isDebug&&this.maskHoldRendererDebug.setContentSize(8*this.tileSizeX,0),this.setupListPoints(),this.setupVertices(),this.setupArrows(),this.buildTile(),this.buildHoldSprite(),this.setUpHoldSpritePos(),this.setupAnimation(),this.setupScoreBonus()},t.prototype.setuptest=function(){this.laneIndex=0,this.intSegLane=[2,0,2],this.setupListPoints();var e=this.calculatorSkewX();this.maskHoldRenderer.setContentSize(8*this.tileSizeX,0),this.maskHoldRendererDebug.setContentSize(this.tileSizeX,0),this.maskHoldRendererDebug.skewX=e,this.holdRendererSprite.setContentSize(this.tileSizeX,0),this.holdRendererSprite.skewX=e,this.setSizeTouchNode(),this.node.targetOff(this),this.setUpTouchEvents(),this.buildHoldSprite(),this.setUpHoldSpritePos(),this.setupAnimation(),this.setupVertices(),this.setupArrows(),this.buildTile(),this.setupScoreBonus(),this.gpc={isPause:!1},this.isDebug=!0},t.prototype.setUpTouchEvents=function(){var e=this;this.isTest&&(this.touchNode.on(cc.Node.EventType.TOUCH_START,function(t){var n=e.ctx.node.convertToNodeSpaceAR(t.getLocation());cc.Intersection.pointInPolygon(n,e.pointsPolygonCollider)&&(e.lastTouch=n,e.isHit=!0,e.isShouldUpdateEffect=!0,e.preventPlayingEffect=!1,e.holdRendererSprite.active=!0,e.blinkingCircle.active=!0,e.auraSprite.active=!0,e.playScaleAuraSprite(e.scaleUpDuration,e.scaleUpVal))},this),this.touchNode.on(cc.Node.EventType.TOUCH_END,function(t){var n=e.ctx.node.convertToNodeSpaceAR(t.getLocation());cc.Intersection.pointInPolygon(n,e.pointsPolygonCollider),e._onTouchEnd(t)},this),this.touchNode.on(cc.Node.EventType.TOUCH_CANCEL,function(t){var n=e.ctx.node.convertToNodeSpaceAR(t.getLocation());cc.Intersection.pointInPolygon(n,e.pointsPolygonCollider),e._onTouchCancel(t)},this))},t.prototype.buildMesh=function(){var e=this.ctx;if(e.clear(),e.strokeColor=cc.Color.WHITE,e.fillColor=cc.Color.WHITE,e.lineWidth=0,this.pointsPolygonCollider=a(this.linePoints),0!==this.linePoints.length&&0!==this.linesPointsRevert.length){e.moveTo(this.linePoints[0].x,this.linePoints[0].y);for(var t=1;t<this.linePoints.length;t++){var n=this.linePoints[t];e.lineTo(n.x,n.y)}for(var o=this.linesPointsRevert.length-1;o>=0;o--)n=this.linesPointsRevert[o],e.lineTo(n.x,n.y),this.pointsPolygonCollider.push(n);e.close(),e.stroke(),this.buildHoldMesh()}},t.prototype.buildHoldMesh=function(){var e=this.holdCtx;if(e.clear(),e.strokeColor=cc.Color.WHITE,e.lineWidth=0,e.fillColor.fromHEX("#E9097B"),0!==this.linePoints.length&&0!==this.linesPointsRevert.length){e.moveTo(this.linePoints[0].x,this.linePoints[0].y);for(var t=1;t<this.linePoints.length;t++){var n=this.linePoints[t];e.lineTo(n.x,n.y)}for(var o=this.linesPointsRevert.length-1;o>=0;o--)n=this.linesPointsRevert[o],e.lineTo(n.x,n.y);e.close(),e.stroke(),e.fill()}},t.prototype.update=function(e){this.gpc&&this.gpc.gameStatus===s.GameStatus.PLAYING&&this._runUpdate&&(l.default.defines().isAutoPlay&&!1===this.isTest&&this.checkReachSyncLine()&&!this.isHit&&!1===this.isShouldUpdateEffect&&(n.countNote++,this.isShouldUpdateEffect=!0,this.isHit=!0,this.endTouch=!1,this.holdRendererSprite.active=!0),this.endTouch||this.isHit&&this.isShouldUpdateEffect&&this.updateProgress(e))},t.prototype.stopScaleUpAnimation=function(){},t.prototype.setSizeTouchNode=function(){this.touchNode.setPosition(this.linePoints[0]),this.touchNode.setContentSize(2*this.tileSizeX,this.noteLength)},t.prototype.doHitEffect=function(){this.endTouch||(this.isShouldUpdateEffect=!0)},t.prototype.updateProgress=function(e){if(!1!==this.isShouldUpdateEffect&&null!=this.gpc){var t,n=this.holdNodeFollow.height;n+=t=this.isTest?d.SlideTileDefines.HOLD_SIZE_ADDITION*e:this.gpc.getCurrentCameraSpeed()*this.gpc.smoothDeltaTime,this.isTutorial&&(this.holdRendererSpriteHeight+=t),this.checkSwitchHoldRender(n),this.lastTouch.y+=t;var o=n/this.noteLength;if(o=o>1?1:o,this.arrowPlayedFx<this.totalArrowActive&&o>=this.arrows[this.arrowPlayedFx].percent){for(var r=this.arrowsFXArr[this.arrowPlayedFx],i=0;i<r.length;i++)r[i].resetSystem();this.arrowPlayedFx++}if(n>=this.noteLength+d.SlideTileDefines.HOLD_SIZE_ADDITION)this.endHitEffect();else{this.holdRendererSprite.active=!0,this.percentHold=o,this.percentHold<1&&(this.isTutorial?this.holdRendererSprite.setContentSize(this.holdRendererSprite.getContentSize().width,this.holdRendererSpriteHeight):this.holdRendererSprite.setContentSize(this.holdRendererSprite.getContentSize().width,this.holdRendererSprite.getContentSize().height+t),this.holdNodeFollow.setContentSize(this.holdNodeFollow.getContentSize().width,this.percentHold*this.noteLength)),this.updateHoldRenderer();var a=this.auraSprite.position;a.y=this.holdRendererSprite.getContentSize().height,this.auraSprite.position=a,this.blinkingCircle.position=a,this.percentHold>=1&&(this.endHitEffect(),this.completeTile(),this.bonusScore())}}},t.prototype.updateHoldRenderer=function(){this.isDebug&&this.maskHoldRendererDebug.setContentSize(this.maskHoldRendererDebug.getContentSize().width,this.percentHold*this.noteLength)},t.prototype.cancelAllEffects=function(){this.isShouldUpdateEffect=!1,this.isHit&&(this.endTouch=!0),this.blinkingCircle.active=!1,this.isAuraScalePlaying||(this.auraScaleTween.removeSelf(),this.auraScaleTween=cc.tween(this.auraSprite).tag(this.scaleAuraTweenTag),this.playScaleAuraSprite(this.scaleDownDuration,this.scaleDownVal,!0),this.isAuraScalePlaying=!0)},t.prototype.endHitEffect=function(){this.isHit&&this.isShouldUpdateEffect&&(this.isShouldUpdateEffect=!1,this.endTouch=!0,this.blinkingCircle.active=!1,this.auraScaleTween.removeSelf(),this.auraScaleTween=cc.tween(this.auraSprite).tag(this.scaleAuraTweenTag),this.playScaleAuraSprite(this.scaleDownDuration,this.scaleDownVal,!0),this.isAuraScalePlaying=!0,this.holdRendererSprite.active=!1,this.holdCtx.node.active=!1,this.setAlpha(.5))},t.prototype.completeTile=function(){this.isShouldUpdateEffect=!1},t.prototype.contains=function(t,n){void 0===n&&(n=!0);var o=this.node.position,r=cc.v2(t.x-o.x,t.y-o.y);return n&&!cc.Intersection.pointInPolygon(r,this.pointsPolygonCollider)?null:e.prototype.contains.call(this,t,n)},t.prototype._onTouchStart=function(t,n){if(this.endTouch||this.isHit)return!1;if(!e.prototype._onTouchStart.call(this,t,n))return!1;if(!1===this.preventPlayingEffect){this.holdRendererSprite.active=!0;var o=this.touchStartPosition.y+d.SlideTileDefines.HOLD_SIZE_ADDITION,r=cc.size(this.holdRendererSprite.width,o);this.holdRendererSprite.setContentSize(r),this.holdNodeFollow.setContentSize(r),this.blinkingCircle.active=!0,this.auraSprite.active=!0,this.playScaleAuraSprite(this.scaleUpDuration,this.scaleUpVal)}return!0},t.prototype._onTouchEnd=function(t){this.holdNodeFollow.height<this.noteLength-50?this.setTileFalse():this.addScore(),e.prototype._onTouchEnd.call(this,t),this.cancelAllEffects()},t.prototype._onTouchCancel=function(t){e.prototype._onTouchCancel.call(this,t),this.cancelAllEffects()},t.prototype.processHit=function(e,t){this.isHit=!0,this.isHit&&(this.isHit=cc.Intersection.pointInPolygon(t,this.pointsPolygonCollider)),this.isHit&&(this.lastTouch=t,this.doHitEffect())},t.prototype.hit=function(){e.prototype.hit.call(this),this.doHitEffect()},t.prototype.GetCorrectEndLane=function(){return this.endSliderLane},t.prototype.checkReachSyncLine=function(){return e.prototype.checkReachSyncLine.call(this)},t.prototype.UpdateLanePos=function(e,t){this.laneIndex=e;var n=this.node.position;n.x=t,this.node.position=n,this.linePoints=[],this.linesPointsRevert=[],this.noteLength=0,this.setupListPoints(),this.buildMesh()},t.prototype.setTileFalse=function(){for(var e=[],t=cc.gfx,n=cc.Color.fromHEX(cc.Color.WHITE,"#777777"),o=cc.Color.fromHEX(cc.Color.WHITE,"#777777"),r=0;r<this.listVertices.length;r++){var i=r<this.listVertices.length/2?n:o;e.push(i)}this.meshRenderer.mesh.setVertices(t.ATTR_COLOR,e)},t.prototype.buildHoldSprite=function(){this.maskHoldRenderer.setContentSize(8*this.tileSizeX,0),this.holdRendererSprite.setContentSize(this.tileSizeX,0)},t.prototype.setUpHoldSpritePos=function(){var e=this.holdSpriteInfo[this.holdSpriteIndex];this.holdRendererSprite.setPosition(e.startPoint),this.holdRendererSprite.skewX=e.skew,this.blinkingCircle.skewX=-e.skew,this.auraSprite.skewX=-e.skew,this.holdRendererSprite.setContentSize(this.tileSizeX,0)},t.prototype.calculatorSkewX=function(){var e=this.tileSizeX,t=cc.Vec2.distance(this.linePoints[0],this.linePoints[this.linePoints.length-1]),n=cc.Vec2.distance(this.linesPointsRevert[0],this.linePoints[this.linePoints.length-1]);return 90-180*Math.acos((e*e+t*t-n*n)/(2*e*t))/Math.PI},t.prototype.createHoldSprite=function(e){var t={skew:this.calculatorSkewX2(e),startPoint:e[0],length:cc.Vec2.distance(e[0],new cc.Vec2(e[0].x,e[2].y))};if(this.holdSpriteInfo.push(t),!this.setupReviveAnimation){this.setupReviveAnimation=!0;var n=e[e.length-1].x-e[0].x;this.reviveAnimation.node.x=.13*n}},t.prototype.calculatorSkewX2=function(e){var t=this.tileSizeX,n=cc.Vec2.distance(e[0],e[2]),o=cc.Vec2.distance(e[1],e[2]);return 90-180*Math.acos((t*t+n*n-o*o)/(2*t*n))/Math.PI},t.prototype.checkSwitchHoldRender=function(e){e>this.holdSpriteInfo[this.holdSpriteIndex].length+this.holdSpriteInfo[this.holdSpriteIndex].startPoint.y&&this.holdSpriteIndex+1<this.holdSpriteInfo.length&&(this.maskHoldRenderer.setContentSize(this.maskHoldRenderer.getContentSize().width,e),this.holdSpriteIndex+=1,this.setUpHoldSpritePos())},t.prototype.playScaleAuraSprite=function(e,t,n){var o=this;void 0===n&&(n=!1),null!=this.auraScaleTween&&(this.auraScaleTween.stop(),this.auraScaleTween.to(e,{scale:t}).call(function(){!0===n&&(o.isAuraScalePlaying=!1,o.auraSprite.active=!1)}).start())},t.prototype.setupAnimation=function(){this.auraScaleTween=cc.tween(this.auraSprite).tag(this.scaleAuraTweenTag),this.auraSprite.active=!1,this.preventPlayingEffect=!0,this.isAuraScalePlaying=!1,this.blinkingCircle.active=!1},t.prototype.setupVertices=function(){for(var e=0;e<this.linePoints.length;e++){var t=this.linePoints[e],n=new cc.Vec3(t.x,t.y,0);this.listVertices.push(n);var o=this.linesPointsRevert[e],r=new cc.Vec3(o.x,o.y,0);this.listVertices.push(r)}for(e=0;e<this.listVertices.length-2;e++)this.listIndices.push(e),this.listIndices.push(e+1),this.listIndices.push(e+2);var i=cc.Color.fromHEX(cc.Color.WHITE,"#7736DF"),s=cc.Color.fromHEX(cc.Color.WHITE,"#B008AE");for(e=0;e<this.listVertices.length;e++){var c=e<this.listVertices.length/2?i:s;this.listColors.push(c)}if(this.pointsPolygonCollider=a(this.linePoints),0!==this.linePoints.length&&0!==this.linesPointsRevert.length){for(var l=this.linesPointsRevert.length-1;l>=0;l--){var u=this.linesPointsRevert[l];this.pointsPolygonCollider.push(u)}this.buildHoldMesh()}},t.prototype.resetArrows=function(){this.firstArrow.active=!1,this.firstArrow.angle=0,this.firstArrow.setPosition(cc.Vec3.ZERO);for(var e=0;e<this.arrows.length;e++){var t=this.arrows[e];t.active=!1,t.angle=0,t.percent=0,t.setPosition(cc.Vec3.ZERO),this.arrowsFX[e].node.active=!1}this.arrowPlayedFx=0},t.prototype.setupArrows=function(){this.resetArrows();for(var e,t,n=[],o=[],r=0;r<this.listVertices.length-1;r+=2){var i=(e=this.listVertices[r],t=this.listVertices[r+1],cc.Vec3.add(cc.Vec3.ZERO,e,t).divide(2));n.push(i)}this.bonusScorePos.set(n[n.length-1]),n[0]=cc.Vec3.lerp(n[0],n[0],n[1],.2),n[n.length-1]=cc.Vec3.lerp(n[n.length-1],n[n.length-2],n[n.length-1],.8);var a=h.default.LookAt(n[0],n[1]);for(this.firstArrow.setPosition(n[0]),this.firstArrow.angle=a.angle-90,this.firstArrow.active=!0,this.line.clear(),this.line.moveTo(n[0].x,n[0].y),r=1;r<n.length;r++){var s=n[r];this.line.lineTo(s.x,s.y)}for(this.line.stroke(),r=1;r<n.length;r++){var c=n[r-1],l=n[r],u=l.y-c.y,p=2,d=h.default.LookAt(c,l);u>800?p=4:u>600&&u<=800&&(p=3);for(var f=0;f<p-1;f++){var g=1/p*(f+1),y=cc.Vec3.ZERO,v={pos:y=cc.Vec3.lerp(y,c,l,g),rotation:d,t:g};o.push(v)}this.totalArrowActive=0;for(var m=0;m<o.length&&!(m>this.arrows.length-1);m++){var S=o[m],_=this.arrows[m];_.setPosition(S.pos),_.angle=S.rotation.angle-90,_.active=!0,_.percent=S.t,this.arrowsFX[m].node.setPosition(S.pos),this.arrowsFX[m].node.active=!0,this.totalArrowActive++}}},t.prototype.buildTile=function(){var e=this.meshRenderer.mesh?this.meshRenderer.mesh:new cc.Mesh,t=cc.gfx,n=new t.VertexFormat([{name:t.ATTR_POSITION,type:t.ATTR_TYPE_FLOAT32,num:3},{name:t.ATTR_UV0,type:t.ATTR_TYPE_FLOAT32,num:2},{name:t.ATTR_COLOR,type:t.ATTR_TYPE_UINT8,num:4,normalize:!0}]);e.init(n,this.listVertices.length,!0),e.setVertices(t.ATTR_POSITION,this.listVertices),e.setVertices(t.ATTR_COLOR,this.listColors),e.setIndices(this.listIndices,0,!0),this.meshRenderer.mesh=e,this.meshRenderer.node.setPosition(cc.Vec3.ZERO)},t.prototype.setAlpha=function(e){e*=255;var t=cc.gfx;this.listColors.forEach(function(t){t.a=e}),this.meshRenderer.mesh.setVertices(t.ATTR_COLOR,this.listColors)},t.prototype.setupScoreBonus=function(){if(null!=this.scoreBonusLabel){this.scoreBonusLabel.node.setPosition(this.bonusScorePos),this.scoreBonusLabel.node.active=!1;var e=Math.floor(this.noteLength/l.default.defines().SHORT_TILE_HEIGHT);this.score=e>=1?e:0,this.scoreBonusLabel.string="+ "+e.toString(),this.maxScoreBonus=this.score}},t.prototype.bonusScore=function(){this.score<=0||null==this.scoreBonusLabel||(this.scoreBonusLabel.node.active=!0,c.default.updateScore(this.score,"bonus"),this.score=0)},t.countNote=0,i([y(cc.Graphics)],t.prototype,"ctx",void 0),i([y(cc.Graphics)],t.prototype,"holdCtx",void 0),i([y(cc.Node)],t.prototype,"holdRendererSprite",void 0),i([y(cc.Node)],t.prototype,"maskHoldRenderer",void 0),i([y(cc.Graphics)],t.prototype,"line",void 0),i([y(cc.Node)],t.prototype,"touchNode",void 0),i([y(cc.Boolean)],t.prototype,"isTest",void 0),i([y(cc.Node)],t.prototype,"maskHoldRendererDebug",void 0),i([y(cc.Node)],t.prototype,"holdNodeFollow",void 0),i([y(cc.Node)],t.prototype,"auraSprite",void 0),i([y(cc.Node)],t.prototype,"blinkingCircle",void 0),i([y(cc.Node)],t.prototype,"holdNodePosition",void 0),i([y(cc.MeshRenderer)],t.prototype,"meshRenderer",void 0),i([y(cc.Node)],t.prototype,"firstArrow",void 0),i([y(cc.Node)],t.prototype,"arrows",void 0),i([y(cc.ParticleSystem)],t.prototype,"arrowsFX",void 0),i([y(cc.Label)],t.prototype,"scoreBonusLabel",void 0),n=i([g],t)}(p.default);n.default=v,cc._RF.pop()},{"../Data/GameConfig":"GameConfig","../Defines":"Defines","../GM":"GM","../Gameplay/ProgressBar/Counter":"Counter","../Utils/GameUtils":"GameUtils","./Tile":"Tile"}],SongChallengeManager:[function(e,t,n){"use strict";cc._RF.push(t,"11df0370YRP67rvPaJPEywU","SongChallengeManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./ConfigManager"),l=e("./Controller/MainController"),u=e("./Handlers/UnlockFrameBySongChallenge"),p=e("./SongListManager"),h=e("./Time"),d=e("./GameManager"),f=e("./LeaderBoardManager"),g=e("./BoolClass"),y=cc._decorator,v=y.ccclass,m=(y.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getLoadingComponentList=function(){var e=this;return[{resultRequire:[],resultList:[],executeFunction:function(){return e.init()}}]},t.prototype.init=function(){return a(this,void 0,void 0,function(){return s(this,function(){return d.GameLog.logStartInit("[SongChallengeManager] Starting song challenge initialization"),l.default.Instance.frameUnlockCheckers.push(new u.UnlockFrameBySongChallenge),d.GameLog.logInitSuccess("[SongChallengeManager] Initialized"),[2]})})},t.prototype.giveReward=function(e,t){return a(this,void 0,void 0,function(){var n,o,r,i,a;return s(this,function(){for(d.GameLog.log("[SongChallengeManager] Attempting to give reward for rank "+e),n=c.default.Instance.getFrameConfigs(),o=l.default.Instance.userDataService.getData(),r=0,i=Array.from(n.values());r<i.length;r++)if((a=i[r]).songChallengUnlock==e-1&&!l.default.Instance.isFrameLocked(a.frameId)&&!o.challengeData.frameUnlocked.includes(a.frameId))return o.challengeData.frameUnlocked.push(a.frameId),t.value=!0,d.GameLog.log("[SongChallengeManager] Unlocked frame "+a.frameId+" for rank "+e),[2];return d.GameLog.log("[SongChallengeManager] No reward given for rank "+e),[2]})})},t.prototype.checkResetChallenge=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return d.GameLog.log("[SongChallengeManager] Checking and resetting challenge"),e=new g.BoolClass(!1),[4,f.default.Instance.checkResetPeriod(f.default.LEADERBOARD_IDS.CHALLENGE,e)];case 1:return t.sent(),e.value?(d.GameLog.log("[SongChallengeManager] Challenge data changed, saving updates"),[4,l.default.Instance.userDataService.saveDataLocalAndServer()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.getCurrentSongToday=function(){var e;return a(this,void 0,Promise,function(){var t,n,o,r;return s(this,function(i){switch(i.label){case 0:return d.GameLog.log("[SongChallengeManager] Getting current song for today"),[4,p.default.Instance.getSongList()];case 1:return(null==(t=i.sent())?void 0:t.length)?(n=h.Time.getTimeBeginToDay(),o=this.seededRandom(n,0,t.length-1),r=(null===(e=t[o])||void 0===e?void 0:e.songId)||"",d.GameLog.log("[SongChallengeManager] Selected song for today: "+r),[2,r]):(d.GameLog.error("[SongChallengeManager] Song list is empty or invalid"),[2,""])}})})},t.prototype.getNextResetTime=function(){return f.default.Instance.getNextTimeReset(f.default.LEADERBOARD_IDS.CHALLENGE)},t.prototype.seededRandom=function(e,t,n){var o=1e4*Math.sin(e),r=Math.floor((o-Math.floor(o))*(n-t+1))+t;return d.GameLog.log("[SongChallengeManager] Generated seeded random number: "+r+" (seed: "+e+", range: "+t+"-"+n+")"),r},i([v],t)}(cc.Component));n.default=m,cc._RF.pop()},{"./BoolClass":"BoolClass","./ConfigManager":"ConfigManager","./Controller/MainController":"MainController","./GameManager":"GameManager","./Handlers/UnlockFrameBySongChallenge":"UnlockFrameBySongChallenge","./LeaderBoardManager":"LeaderBoardManager","./SongListManager":"SongListManager","./Time":"Time"}],SongItemView:[function(e,t,n){"use strict";cc._RF.push(t,"a80b4itHfdHrr3jySpb8rCg","SongItemView");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../Controller/MainController"),l=e("../AudioManager"),u=e("./SongPlayAnimation"),p=e("../GameEvent"),h=e("../SongChallengeManager"),d=e("../Time"),f=e("./LabelController"),g=cc._decorator,y=g.ccclass,v=g.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.highLightBackground=null,t.songNameLabel=null,t.artistNameLabel=null,t.defaultImage=null,t.maskIcons=[],t.iconImages=[],t.playButton=null,t.starIcons=[],t.crownIcons=[],t.starGroupNode=null,t.crowGroupNode=null,t.songPlayAnimation=null,t.labelController=null,t.labelControllerTag=null,t.songOfTheDayNode=null,t.songOfTheDayRefreshTime=null,t.songConfig=null,t.sessionLoad=0,t.isSongOfTheDay=!1,t}return r(t,e),t.prototype.onLoad=function(){var e;this.defaultImage.active=!0,this.maskIcons.forEach(function(e){return e.active=!1}),this.playButton.node.on("click",this.onClickPlay.bind(this)),null===(e=this.songPlayAnimation)||void 0===e||e.setOnClick(this.onClickPreview.bind(this))},t.prototype.onEnable=function(){cc.view.on(p.GameEvent.EVENT_REVIEW_SONG_STARTED,this.onReviewSongStarted,this)},t.prototype.onDisable=function(){this.sessionLoad++,null!=this.songOfTheDayNode&&(this.songOfTheDayNode.active=!1),this.isSongOfTheDay=!1,cc.view.off(p.GameEvent.EVENT_REVIEW_SONG_STARTED,this.onReviewSongStarted,this)},t.prototype.updateView=function(e){var t,n;return a(this,void 0,void 0,function(){var o,r,i;return s(this,function(){return this.songConfig=e,this.songNameLabel.string=this.truncateString(e.songName,20),this.artistNameLabel.string=e.artistName,this.isSongOfTheDay=e.songId==c.default.Instance.userDataService.getData().challengeData.challengeSongId,o=c.default.Instance.userDataService.getSongData(e.songId),this.defaultImage.active=!0,this.maskIcons.forEach(function(e){return e.active=!1}),this.loadCoverImage(e),this.updateStars(o.star),this.updateCrowns(o.crown),this.toggleGroups(o.crown),null===(t=this.labelController)||void 0===t||t.showLabel(e.difficulty),null===(n=this.labelControllerTag)||void 0===n||n.showLabel(e.tag),r=c.default.Instance.runtimeData.currentSongUrl,i=r===e.getMp3ReviewLink(),this.updateSongPlayAnimation(i),this.highLightBackground.active=i,null!=this.songOfTheDayNode&&(this.songOfTheDayNode.active=this.isSongOfTheDay),[2]})})},t.prototype.update=function(){if(this.isSongOfTheDay&&null!=this.songOfTheDayRefreshTime){var e=h.default.Instance.getNextResetTime()-d.Time.getCurrentOffsetTime();if(e>0){var t=Math.floor(e/3600).toString().padStart(2,"0"),n=Math.floor(e%3600/60).toString().padStart(2,"0"),o=Math.floor(e%60).toString().padStart(2,"0");this.songOfTheDayRefreshTime.string="End in "+t+":"+n+":"+o}else this.songOfTheDayRefreshTime.string="Refreshing soon"}},t.prototype.loadCoverImage=function(e){var t=this;this.sessionLoad++;var n=this.sessionLoad,o=e.getCoverImageLink();(null==o?void 0:o.trim())&&cc.assetManager.loadRemote(o,function(e,o){if(!e&&n===t.sessionLoad){t.defaultImage.active=!1;var r=new cc.SpriteFrame(o);t.iconImages.forEach(function(e){return e.spriteFrame=r}),t.maskIcons.forEach(function(e){return e.active=!0})}})},t.prototype.updateStars=function(e){this.starIcons.forEach(function(t,n){t.node.active=n<e})},t.prototype.updateCrowns=function(e){this.crownIcons.forEach(function(t,n){t.node.active=n<e})},t.prototype.toggleGroups=function(e){this.starGroupNode.active=e<=0,this.crowGroupNode.active=e>0},t.prototype.onClickPlay=function(){if(l.default.Instance.playButton(),this.songConfig){var e=new p.StartGameRequestEvent;e.songId=this.songConfig.songId,cc.view.emit(p.GameEvent.EVENT_START_GAME_REQUEST,e)}},t.prototype.onClickPreview=function(){var e=new p.StartReviewSongRequestEvent;e.url=this.songConfig.getMp3ReviewLink(),cc.view.emit(p.GameEvent.EVENT_START_REVIEW_SONG_REQUEST,e)},t.prototype.onReviewSongStarted=function(e){if(this.songConfig){var t=this.songConfig.getMp3ReviewLink()===e.url;this.updateSongPlayAnimation(t),this.highLightBackground.active=t}},t.prototype.updateSongPlayAnimation=function(e){var t,n;e?null===(t=this.songPlayAnimation)||void 0===t||t.on():null===(n=this.songPlayAnimation)||void 0===n||n.off()},t.prototype.truncateString=function(e,t){return e.length>t?e.substring(0,t-3)+"...":e},i([v(cc.Node)],t.prototype,"highLightBackground",void 0),i([v(cc.Label)],t.prototype,"songNameLabel",void 0),i([v(cc.Label)],t.prototype,"artistNameLabel",void 0),i([v(cc.Node)],t.prototype,"defaultImage",void 0),i([v([cc.Node])],t.prototype,"maskIcons",void 0),i([v([cc.Sprite])],t.prototype,"iconImages",void 0),i([v(cc.Button)],t.prototype,"playButton",void 0),i([v([cc.Sprite])],t.prototype,"starIcons",void 0),i([v([cc.Sprite])],t.prototype,"crownIcons",void 0),i([v(cc.Node)],t.prototype,"starGroupNode",void 0),i([v(cc.Node)],t.prototype,"crowGroupNode",void 0),i([v(u.default)],t.prototype,"songPlayAnimation",void 0),i([v(f.default)],t.prototype,"labelController",void 0),i([v(f.default)],t.prototype,"labelControllerTag",void 0),i([v(cc.Node)],t.prototype,"songOfTheDayNode",void 0),i([v(cc.Label)],t.prototype,"songOfTheDayRefreshTime",void 0),i([y],t)}(cc.Component);n.default=m,cc._RF.pop()},{"../AudioManager":"AudioManager","../Controller/MainController":"MainController","../GameEvent":"GameEvent","../SongChallengeManager":"SongChallengeManager","../Time":"Time","./LabelController":"LabelController","./SongPlayAnimation":"SongPlayAnimation"}],SongListManager:[function(e,t,n){"use strict";cc._RF.push(t,"eca91cNYo5LMKCPK0cwXFh6","SongListManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var l=e("./Data/GameConfig"),u=e("./Defines"),p=e("./NakamaManager"),h=e("./Components/EnhancedLoading"),d=e("./GameManager"),f=cc._decorator,g=f.ccclass,y=(f.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getLoadingComponentList=function(){var e=this;return[{resultRequire:[h.LoadingResultType.SESSION],resultList:[h.LoadingResultType.SONG_LIST_CONFIG],executeFunction:function(){return e.init()}}]},t.prototype.init=function(){return s(this,void 0,void 0,function(){var e,t,n;return c(this,function(o){switch(o.label){case 0:return d.GameLog.logStartInit("[SongListManager] Starting song list initialization"),[4,p.default.Instance.getStorageObject("system","song_list")];case 1:return e=o.sent(),this.songListConfig=new l.SongListConfig,t=this.songListConfig,[4,this.songListConfig.getJsonParser().parse(JSON.stringify(e.home))];case 2:return t.songList=o.sent(),this.tutorialSongListConfig=new l.SongListConfig,n=this.tutorialSongListConfig,[4,this.tutorialSongListConfig.getJsonParser().parse(JSON.stringify(e.tutorial))];case 3:return n.songList=o.sent(),d.GameLog.logInitSuccess("[SongListManager] Song list initialization complete"),[2]}})})},t.prototype.getSongConfig=function(e,t){return void 0===t&&(t=!1),s(this,void 0,Promise,function(){return c(this,function(n){switch(n.label){case 0:return[4,this.loadSongList(t)];case 1:return[2,n.sent().find(function(t){return t.songId===e})]}})})},t.prototype.loadSongList=function(e){return void 0===e&&(e=!1),s(this,void 0,Promise,function(){var t;return c(this,function(){return t=this.getSongListConfig(e),this.fixupSongList(t.songList),[2,t.songList]})})},t.prototype.loadLevelWithSongId=function(e,t){return void 0===t&&(t=!1),s(this,void 0,Promise,function(){var n;return c(this,function(o){switch(o.label){case 0:return[4,this.getSongConfig(e,t)];case 1:if(!(n=o.sent()))throw new Error("Song with ID "+e+" not found.");return[4,this.loadAndCloneLevel(n)];case 2:return[2,o.sent()]}})})},t.prototype.loadAndCloneLevel=function(e){return s(this,void 0,Promise,function(){var t;return c(this,function(n){switch(n.label){case 0:return null!=e.levelData?[3,2]:[4,this.getLevel(e)];case 1:t=n.sent(),e.levelData=t,n.label=2;case 2:return[2,JSON.parse(JSON.stringify(e.levelData))]}})})},t.prototype.loadSongWithId=function(e,t){return void 0===t&&(t=!1),s(this,void 0,Promise,function(){var n;return c(this,function(o){switch(o.label){case 0:return[4,this.getSongConfig(e,t)];case 1:if(!(n=o.sent()))throw new Error("Song with ID "+e+" not found.");return[2,n.getMp3Link()]}})})},t.prototype.getSongList=function(e){return void 0===e&&(e=!1),s(this,void 0,Promise,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.loadSongList(e)];case 1:return[2,t.sent()]}})})},t.prototype.splitStringToNumberArray=function(e){return e?e.split(";").map(function(e){return e.trim()}).filter(function(e){return e.length>0}).map(Number).filter(function(e){return!isNaN(e)}):[]},t.prototype.getSongListConfig=function(e){return e?this.tutorialSongListConfig:this.songListConfig},t.prototype.fixupSongList=function(e){e.forEach(function(e){void 0!==e.noteTimeUnit&&0!=e.noteTimeUnit||(e.noteTimeUnit=200)})},t.prototype.getLevel=function(e){return e.isAutoContent()?this.getNotesForAutoContent(e):this.getNotesAsync(e.getMidiLink())},t.prototype.getNotesAsync=function(e){return LevelReader.readLevelAllTracks(e).catch(function(e){throw console.error("Error loading notes:",e),e})},t.prototype.getNotesForAutoContent=function(e){var t=this,n=e.getMidiLink();return new Promise(function(e,o){var r=new XMLHttpRequest;r.open("GET",encodeURI(n),!0),r.responseType="arraybuffer",r.onload=function(){var n=r.response;LevelBotGenerator.ReadWithMetaAndEncrypt(n,!0).then(function(e){return t.processLevelBot(e)}).then(function(t){return e(t)}).catch(o)},r.send()})},t.prototype.processLevelBot=function(e){var t=this,n=[{notes:LevelBotGenerator.getVocals(e),midi:u.NoteLineInt.VOCALS},{notes:LevelBotGenerator.getMelody(e),midi:u.NoteLineInt.MELODY},{notes:LevelBotGenerator.getPeak(e),midi:u.NoteLineInt.PEAK},{notes:LevelBotGenerator.getBPMS(e),midi:u.NoteLineInt.BPM}];n.forEach(function(e){return e.notes.forEach(function(t){return t.midi=e.midi})});var o=[],r=[];n.slice(0,3).forEach(function(e){return t.combineNotes(o,r,e.notes,.2)}),this.doubleNotes(o,n[3].notes);var i=LevelBotGenerator.getNovelSegment(e).map(function(e){return e.time}),a=e.bpm(),s=60/a/96,c=1.6875*this.calculateTicksPerTile(o,42,s);return o.forEach(function(e){e.ticks=e.time/s,e.durationTicks=e.duration/s}),{notes:o,bpm:a,ppq:96,duration:0,difficulties:0,fullNotes:[],notesLineIndex:{},timeChangeColor:i,noteTimeUnit:c*s}},t.prototype.combineNotes=function(e,t,n,o){var r=n.map(function(e){return i(i({},e),{duration:Math.max(e.duration,o)})});r.sort(function(e,t){return t.power-e.power});for(var a=0,s=r;a<s.length;a++){var c=s[a];this.noteOverlapsCompletely(c,t)||(e.push(c),t.push({start:c.time,end:c.time+c.duration}))}return e},t.prototype.doubleNotes=function(e,t){var n=t.reduce(function(e,t){return e+(t.power||0)},0)/t.length;e.sort(function(e,t){return e.time-t.time}),t.sort(function(e,t){return e.time-t.time}),t.splice(0,t.length/2);for(var o=0,r=0,i=e;r<i.length;r++)for(var a=i[r];o<t.length&&t[o].time<=a.time;){var s=t[o];if((s.power||0)>n&&Math.abs(a.time-s.time)<=.05){a.forceDual=!0;break}o++}return e},t.prototype.noteOverlapsCompletely=function(e,t){for(var n=0,o=t;n<o.length;n++){var r=o[n],i=Math.abs(e.time-r.start)<.04,a=Math.abs(e.time+e.duration-r.end)<.04;if(i&&(e.time=r.start),a&&(e.duration=r.end-e.time),e.time<r.end&&e.time+e.duration>r.start)return!0;if(i||a)break}return!1},t.prototype.calculateTicksPerTile=function(e,t,n){for(var o=Number.MAX_VALUE,r=0;r<e.length-1;r++){var i=e[r].time/n,a=e[r+1].time/n-i;a>t&&a<o&&(o=a)}return o},t.prototype.passValidate=function(e){var t=[e.getMp3Link(),e.getMp3ReviewLink(),e.getMidiLink()];return e.dataAvailable(e.songId)&&t.every(function(t){return e.dataAvailable(t)})&&e.noteTimeUnit>0},a([g],t)}(cc.Component));n.default=y,cc._RF.pop()},{"./Components/EnhancedLoading":"EnhancedLoading","./Data/GameConfig":"GameConfig","./Defines":"Defines","./GameManager":"GameManager","./NakamaManager":"NakamaManager"}],SongPlayAnimation:[function(e,t,n){"use strict";cc._RF.push(t,"8bd09EMrwFHdIEMWmguwREN","SongPlayAnimation");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.idleRoot=null,t.playingRoot=null,t.sound1=null,t.sound2=null,t.sound3=null,t.sound4=null,t.playNote=null,t.OnClick=null,t}return r(t,e),t.prototype.onLoad=function(){this.playNote.on("click",this.onClick.bind(this))},t.prototype.start=function(){this.setupAnimation()},t.prototype.on=function(){this.toggleAnimation(!0)},t.prototype.off=function(){this.toggleAnimation(!1)},t.prototype.setOnClick=function(e){this.OnClick=e},t.prototype.onClick=function(){this.OnClick&&this.OnClick()},t.prototype.toggleAnimation=function(e){this.idleRoot.active=!e,this.playingRoot.active=e},t.prototype.setupAnimation=function(){this.animateNode(this.sound1,10,30,.5),this.animateNode(this.sound2,20,40,.5),this.animateNode(this.sound3,40,20,.5),this.animateNode(this.sound4,10,30,.5)},t.prototype.animateNode=function(e,t,n,o){e.height=t,cc.tween(e).repeatForever(cc.tween().to(o,{height:n}).to(o,{height:t})).start()},i([c(cc.Node)],t.prototype,"idleRoot",void 0),i([c(cc.Node)],t.prototype,"playingRoot",void 0),i([c(cc.Node)],t.prototype,"sound1",void 0),i([c(cc.Node)],t.prototype,"sound2",void 0),i([c(cc.Node)],t.prototype,"sound3",void 0),i([c(cc.Node)],t.prototype,"sound4",void 0),i([c(cc.Node)],t.prototype,"playNote",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],StarController:[function(e,t,n){"use strict";cc._RF.push(t,"c504fC5mBlGu5mhUd01gUuM","StarController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.star3D=null,t.crown3D=null,t.flairSprite=null,t.endPosArray=[],t.rotateVec=cc.v3(0,360,0),t.tiltRotateVec=cc.v3(0,0,-30),t.starTween=null,t.originalPos=cc.v3(0,0,0),t}return r(t,e),t.prototype.onLoad=function(){this.originalPos=this.star3D.position,this.star3D.active=!1,this.crown3D.active=!1,this.flairSprite.active=!1},t.prototype.play3dStarAnim=function(e,t){this.node.active=!0,this.star3D.position=this.originalPos,this.crown3D.position=this.originalPos,e<=2?(this.star3D.active=!0,this.crown3D.active=!1,this.mainTweenSetup(this.star3D,e,t)):(this.star3D.active=!1,this.crown3D.active=!0,this.mainTweenSetup(this.crown3D,e,t))},t.prototype.mainTweenSetup=function(e,t,n){var o=this,r=this.endPosArray[t].parent.convertToWorldSpaceAR(this.endPosArray[t].position);r=cc.Canvas.instance.node.convertToNodeSpaceAR(r);var i=cc.tween;this.starTween=i(e);var a=i(e).repeat(2,i(this.node).to(.5,{eulerAngles:this.rotateVec})),s=i(e).to(1,{scale:50}),c=i(e).to(.8,{position:r},{easing:"sineOut"}),l=i(e).to(1,{scale:20});i(e).to(.05,{eulerAngles:this.tiltRotateVec}),this.starTween.parallel(a,s).call(function(){return o.flairSprite.active=!0}).delay(.5).call(function(){return o.flairSprite.active=!1}).then(i(this.node).parallel(a,c,l)).call(n).start()},t.prototype.setInactive=function(){this.starTween&&this.starTween.stop(),this.star3D.active=!1,this.crown3D.active=!1,this.flairSprite.active=!1},i([c(cc.Node)],t.prototype,"star3D",void 0),i([c(cc.Node)],t.prototype,"crown3D",void 0),i([c(cc.Node)],t.prototype,"flairSprite",void 0),i([c([cc.Node])],t.prototype,"endPosArray",void 0),i([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],StartController:[function(e,t,n){"use strict";cc._RF.push(t,"222386GnnJNFrb49B3wcmRb","StartController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./GameplayController"),s=e("../Components/TileStart"),c=e("../Utils/GameUtils"),l=e("./GamePlaySceneController"),u=e("../Defines"),p=cc._decorator,h=p.ccclass,d=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tileStart=null,t}return r(t,e),t.prototype.onLoad=function(){},t.prototype.setup=function(){var e=a.default.Instance,t=cc.v2(c.default.getTileXByLane(1),e.syncLine.y-.5*e.tileSize.height);this.tileStart.setup(e.tileSize,t,e.syncLine,e.mainCamera),this.tileStart.OnStartGame=function(){e.gameStatus===u.GameStatus.LOADED&&l.default.Instance.onClickTileStart()},this.tileStart.node.active=!0},t.prototype.onStartGame=function(){this.tileStart.node.active=!1},i([d(s.default)],t.prototype,"tileStart",void 0),i([h],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Components/TileStart":"TileStart","../Defines":"Defines","../Utils/GameUtils":"GameUtils","./GamePlaySceneController":"GamePlaySceneController","./GameplayController":"GameplayController"}],ThemeController:[function(e,t,n){"use strict";cc._RF.push(t,"4b34cmQ1FVNXqYxu1o7JFNW","ThemeController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.SliceAnimRow=void 0;var c=e("./Particle2DControl"),l=e("../Controller/GameplayController"),u=e("../ThemeManager"),p=e("../GameManager"),h=e("../Controller/GamePlaySceneController"),d=e("../GameEvent"),f=cc._decorator,g=f.ccclass,y=f.property,v=function(){function e(){this.cols=[],this.dis=[]}return i([y([cc.Sprite])],e.prototype,"cols",void 0),i([y([cc.Float])],e.prototype,"dis",void 0),i([g("SliceAnimRow")],e)}();n.SliceAnimRow=v;var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mainSpr=null,t.secondSpr=null,t.decay=10,t.delay=0,t.squareAnimDuration=.35,t.listParticles=[],t.bgTransitionParticle=null,t.currentPhase=0,t.maxPhase=0,t.currentIndex=0,t.spriteFrames=[],t}return r(t,e),t.prototype.onLoad=function(){this.mainSpr.node.zIndex=1,this.secondSpr.node.zIndex=0},t.prototype.onEnable=function(){cc.view.on(l.default.EVENT_GAMEPLAY_INIT,this.onGameplayinit.bind(this)),cc.view.on(l.default.EVENT_GAMEPLAY_START_LOOP,this.onGameplayStartLoop.bind(this)),cc.view.on(l.default.EVENT_GAMEPLAY_UPDATED,this.onGameplayUpdated.bind(this)),cc.view.on(p.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged.bind(this)),cc.view.on(d.GameEvent.EVENT_USER_CHANGE_THEME,this.onUserChangeTheme.bind(this))},t.prototype.onDisable=function(){cc.view.off(l.default.EVENT_GAMEPLAY_INIT,this.onGameplayinit.bind(this)),cc.view.off(l.default.EVENT_GAMEPLAY_START_LOOP,this.onGameplayStartLoop.bind(this)),cc.view.off(l.default.EVENT_GAMEPLAY_UPDATED,this.onGameplayUpdated.bind(this)),cc.view.off(p.default.EVENT_CANVAS_SIZE_CHANGED,this.onCanvasSizeChanged.bind(this)),cc.view.off(d.GameEvent.EVENT_USER_CHANGE_THEME,this.onUserChangeTheme.bind(this))},t.prototype.onGameplayinit=function(){this.currentPhase=0,this.currentIndex=0,this.mainSpr.node.opacity=255,this.secondSpr.node.opacity=0,this.listParticles.forEach(function(e){e.stop()}),this.setDefaultBackground()},t.prototype.setDefaultBackground=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return h.default.Instance.loadingCounter++,[4,u.default.Instance.loadCurrentBackgrounds()];case 1:return e=t.sent(),this.updateBackground(e),h.default.Instance.loadingCounter--,[2]}})})},t.prototype.onGameplayStartLoop=function(){var e=l.default.Instance;this.currentIndex=0,e.arrManualTimeChangleBg[0]>0?this.runToPhase(e.arrManualChangeBgId[0]):this.runToPhase(0)},t.prototype.onGameplayUpdated=function(){var e=l.default.Instance;if(e.arrManualChangeBgId.length&&this.currentIndex<e.arrManualChangeBgId.length-1){var t=this.currentIndex+1,n=e.arrManualTimeChangleBg[t];if(e.currentLevelTime>=n){var o=e.arrManualChangeBgId[t];this.runToPhase(o),this.currentIndex=t}}},t.prototype.onCanvasSizeChanged=function(){return a(this,void 0,void 0,function(){return s(this,function(){return this.fillBackground(),[2]})})},t.prototype.onUserChangeTheme=function(e){return a(this,void 0,void 0,function(){return s(this,function(){return this.updateBackground(e.newFrames,.3),[2]})})},t.prototype.updateBackground=function(e,t){void 0===t&&(t=0),e&&0!==e.length?(this.spriteFrames=e,this.maxPhase=this.spriteFrames.length,(this.currentPhase<0||this.currentPhase>=this.maxPhase)&&(console.warn("Invalid currentPhase index: "+this.currentPhase+". Resetting to 0."),this.currentPhase=0),cc.Tween.stopAllByTarget(this.mainSpr),cc.Tween.stopAllByTarget(this.secondSpr),this.secondSpr.spriteFrame=this.mainSpr.spriteFrame,this.mainSpr.spriteFrame=this.spriteFrames[this.currentPhase],this.mainSpr.node.opacity=0,this.secondSpr.node.opacity=255,cc.tween(this.mainSpr.node).to(.5*t,{opacity:255},{easing:"sineInOut"}).start(),cc.tween(this.secondSpr.node).to(t,{opacity:0},{easing:"sineInOut"}).start(),this.fillBackground()):console.warn("Frames array is empty or null. Cannot update background.")},t.prototype.runToPhase=function(e){if(e>=this.maxPhase&&(e=0),e!==this.currentPhase){this.currentPhase=e;var t=this.listParticles[this.currentPhase%this.listParticles.length],n=this.listParticles[e%this.listParticles.length],o=this.spriteFrames[e];cc.Tween.stopAllByTarget(this.mainSpr),cc.Tween.stopAllByTarget(this.secondSpr),this.secondSpr.spriteFrame=this.mainSpr.spriteFrame,this.mainSpr.spriteFrame=o,this.mainSpr.node.opacity=0,this.secondSpr.node.opacity=255,cc.tween(this.mainSpr.node).to(.15,{opacity:255},{easing:"sineInOut"}).start(),cc.tween(this.secondSpr.node).to(.3,{opacity:0},{easing:"sineInOut"}).start(),t.stop(),n.play(),this.bgTransitionFX()}},t.prototype.bgTransitionFX=function(){this.bgTransitionParticle.stop(),this.bgTransitionParticle.play()},t.prototype.fillBackground=function(){var e=p.default.Instance.canvasSize;this.mainSpr.node.setContentSize(e),this.secondSpr.node.setContentSize(e)},i([y(cc.Sprite)],t.prototype,"mainSpr",void 0),i([y(cc.Sprite)],t.prototype,"secondSpr",void 0),i([y],t.prototype,"decay",void 0),i([y],t.prototype,"delay",void 0),i([y],t.prototype,"squareAnimDuration",void 0),i([y([c.default])],t.prototype,"listParticles",void 0),i([y(c.default)],t.prototype,"bgTransitionParticle",void 0),i([g],t)}(cc.Component);n.default=m,cc._RF.pop()},{"../Controller/GamePlaySceneController":"GamePlaySceneController","../Controller/GameplayController":"GameplayController","../GameEvent":"GameEvent","../GameManager":"GameManager","../ThemeManager":"ThemeManager","./Particle2DControl":"Particle2DControl"}],ThemeItem:[function(e,t,n){"use strict";cc._RF.push(t,"7f8c7CtSKhOJ6PLtYvUESl7","ThemeItem");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../AudioManager"),l=e("../Controller/GameplayController"),u=e("../GameEvent"),p=e("../ThemeManager"),h=cc._decorator,d=h.ccclass,f=h.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultIcon=null,t.spriteIcon=null,t.button=null,t.activeNode=null,t.loadingNode=null,t.loadingCircle=null,t}return r(t,e),t.prototype.onLoad=function(){this.button.node.on("click",this.onClick.bind(this)),cc.view.on(u.GameEvent.EVENT_USER_CHANGE_THEME,this.onUserChangeTheme.bind(this)),cc.view.on(u.GameEvent.EVENT_BACKGROUND_START_LOAD,this.onBackgroundStartLoad.bind(this)),cc.view.on(u.GameEvent.EVENT_BACKGROUND_END_LOAD,this.onBackgroundEndLoad.bind(this)),cc.view.on(l.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit.bind(this)),cc.view.on(l.default.EVENT_GAMEPLAY_START,this.onGameplayStart.bind(this))},t.prototype.onDestroy=function(){cc.view.off(u.GameEvent.EVENT_USER_CHANGE_THEME,this.onUserChangeTheme.bind(this)),cc.view.off(u.GameEvent.EVENT_BACKGROUND_START_LOAD,this.onBackgroundStartLoad.bind(this)),cc.view.off(u.GameEvent.EVENT_BACKGROUND_END_LOAD,this.onBackgroundEndLoad.bind(this)),cc.view.off(l.default.EVENT_GAMEPLAY_INIT,this.onGameplayInit.bind(this)),cc.view.off(l.default.EVENT_GAMEPLAY_START,this.onGameplayStart.bind(this))},t.prototype.init=function(e){this.configId=e,this.spriteIcon.spriteFrame=this.defaultIcon,this.choosingTheme=!0,this.loadIcon(e),this.updateLoadingBackground()},t.prototype.refresh=function(e){this.refreshActive(e),this.updateLoadingBackground()},t.prototype.onClick=function(){if(c.default.Instance.playButton(),null!=this.configId&&this.choosingTheme){var e=new u.UserRequestThemeEvent;e.themeId=this.configId,cc.view.emit(u.GameEvent.EVENT_USER_REQUEST_THEME,e)}},t.prototype.onUserChangeTheme=function(e){this.refreshActive(e.themeId)},t.prototype.onBackgroundStartLoad=function(e){e.themeId==this.configId&&this.activeLoadingCircle()},t.prototype.onBackgroundEndLoad=function(e){e.themeId==this.configId&&this.deActiveLoadingCircle()},t.prototype.onGameplayInit=function(){this.choosingTheme=!0},t.prototype.onGameplayStart=function(){this.choosingTheme=!1},t.prototype.updateLoadingBackground=function(){p.default.Instance.isBackgroundLoading(this.configId)?this.activeLoadingCircle():this.deActiveLoadingCircle()},t.prototype.loadIcon=function(e){return a(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return t=this.spriteIcon,[4,p.default.Instance.loadIcon(e)];case 1:return t.spriteFrame=n.sent(),[2]}})})},t.prototype.refreshActive=function(e){this.activeNode.active=e==this.configId},t.prototype.activeLoadingCircle=function(){this.loadingNode.active=!0,cc.Tween.stopAllByTarget(this.loadingCircle),cc.tween(this.loadingCircle).repeatForever(cc.tween().by(1,{angle:-360})).start()},t.prototype.deActiveLoadingCircle=function(){this.loadingNode.active=!1,cc.Tween.stopAllByTarget(this.loadingCircle)},i([f(cc.SpriteFrame)],t.prototype,"defaultIcon",void 0),i([f(cc.Sprite)],t.prototype,"spriteIcon",void 0),i([f(cc.Button)],t.prototype,"button",void 0),i([f(cc.Node)],t.prototype,"activeNode",void 0),i([f(cc.Node)],t.prototype,"loadingNode",void 0),i([f(cc.Node)],t.prototype,"loadingCircle",void 0),i([d],t)}(cc.Component);n.default=g,cc._RF.pop()},{"../AudioManager":"AudioManager","../Controller/GameplayController":"GameplayController","../GameEvent":"GameEvent","../ThemeManager":"ThemeManager"}],ThemeManager:[function(e,t,n){"use strict";cc._RF.push(t,"f3c747BV+JKhpj02fKvgm/m","ThemeManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./Components/EnhancedLoading"),l=e("./Controller/MainController"),u=e("./Data/GameConfig"),p=e("./GameEvent"),h=e("./GameManager"),d=e("./Utils/GameUtils"),f=cc._decorator,g=f.ccclass,y=(f.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.themeConfigs=[],t}var n;return r(t,e),n=t,t.prototype.getLoadingComponentList=function(){var e=this;return[{resultRequire:[],resultList:[],executeFunction:function(){return e.init()}},{resultRequire:[c.LoadingResultType.LOCAL_DATA],resultList:[],executeFunction:function(){return e.progressData()}}]},t.prototype.onEnable=function(){cc.view.on(p.GameEvent.EVENT_USER_REQUEST_THEME,this.onUserRequestTheme.bind(this))},t.prototype.onDisable=function(){cc.view.off(p.GameEvent.EVENT_USER_REQUEST_THEME,this.onUserRequestTheme.bind(this))},t.prototype.init=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return h.GameLog.logStartInit("[ThemeManager] Starting theme initialization"),[4,d.default.loadTextDataFromURL("game-resources/themes/config.json")];case 1:return e=t.sent(),this.themeConfigs=this.parse(e),this.loadBackgrounds(n.DEFAULT),h.GameLog.logInitSuccess("[ThemeManager] Theme initialization complete"),[2]}})})},t.prototype.progressData=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(){return h.GameLog.logStartInit("[ThemeManager] Progressing theme data"),null==(e=l.default.Instance.userDataService.getData()).currentTheme&&(e.currentTheme=n.DEFAULT),h.GameLog.logInitSuccess("[ThemeManager] Theme data progressed"),[2]})})},t.prototype.randomThemeAndChange=function(){if(this.themeConfigs.length>0){var e=this.themeConfigs[this.getRandomInt(0,this.themeConfigs.length-1)],t=new p.UserRequestThemeEvent;t.themeId=e.id,cc.view.emit(p.GameEvent.EVENT_USER_REQUEST_THEME,t)}},t.prototype.currentThemeData=function(){return l.default.Instance.userDataService.getData().currentTheme},t.prototype.loadBackgrounds=function(e){return a(this,void 0,Promise,function(){var t,n,o,r,i;return s(this,function(a){switch(a.label){case 0:return null==(t=this.themeConfigs.find(function(t){return t.id==e}))?[2,[]]:t.backgroundLoading?[4,d.default.waitUtil(function(){return!t.backgroundLoading})]:[3,2];case 1:a.sent(),a.label=2;case 2:return null!=t.backgrounds?[2,t.backgrounds.slice()]:(t.backgroundLoading=!0,(n=new p.BackgroundStartLoadEvent).themeId=e,cc.view.emit(p.GameEvent.EVENT_BACKGROUND_START_LOAD,n),o=t.backgroundNames.map(function(n,o){return new Promise(function(r,i){var a="game-resources/themes/"+e+"/"+n;cc.assetManager.loadRemote(a,function(e,n){if(e)return t.backgroundLoading=!1,void i(e);var a=new cc.SpriteFrame(n);r({index:o,spriteFrame:a})})})}),[4,Promise.all(o)]);case 3:return r=a.sent(),t.backgrounds=[],r.sort(function(e,t){return e.index-t.index}).forEach(function(e){t.backgrounds.push(e.spriteFrame)}),[4,d.default.delay(3e3)];case 4:return a.sent(),t.backgroundLoading=!1,(i=new p.BackgroundEndLoadEvent).success=!0,i.themeId=e,i.backgrounds=t.backgrounds.slice(),cc.view.emit(p.GameEvent.EVENT_BACKGROUND_END_LOAD,i),[2,t.backgrounds.slice()]}})})},t.prototype.loadAllIcons=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return e=this.themeConfigs.map(function(e,t){var n=e;if(null==n.icon)return new Promise(function(o,r){var i="game-resources/themes/"+n.id+"/"+n.iconName;cc.assetManager.loadRemote(i,function(n,i){if(n)r(n);else{var a=new cc.SpriteFrame(i);e.icon=a,o({index:t,spriteFrame:a})}})})}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},t.prototype.allThemeId=function(){return this.themeConfigs.map(function(e){return e.id})},t.prototype.isBackgroundLoading=function(e){var t=this.getThemeConfig(e);return null!=t&&t.backgroundLoading},t.prototype.loadIcon=function(e){return a(this,void 0,Promise,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return null==(t=this.getThemeConfig(e))?[2]:t.iconLoading?[4,d.default.waitUtil(function(){return!t.iconLoading})]:[3,2];case 1:o.sent(),o.label=2;case 2:return null!=t.icon?[2,t.icon]:(t.iconLoading=!0,[4,new Promise(function(e,n){var o="game-resources/themes/"+t.id+"/"+t.iconName;cc.assetManager.loadRemote(o,function(o,r){if(o)return t.iconLoading=!1,void n(o);var i=new cc.SpriteFrame(r);t.icon=i,e(i)})})]);case 3:return n=o.sent(),t.iconLoading=!1,[2,n]}})})},t.prototype.loadCurrentBackgrounds=function(){return a(this,void 0,Promise,function(){var e,t;return s(this,function(o){switch(o.label){case 0:return e=l.default.Instance.userDataService.getData(),t=this.themeConfigs.find(function(t){return t.id==e.currentTheme}),null!=e.currentTheme&&null!=t||(e.currentTheme=n.DEFAULT),[4,this.loadBackgrounds(e.currentTheme)];case 1:return[2,o.sent()]}})})},t.prototype.onUserRequestTheme=function(e){return a(this,void 0,void 0,function(){var t,n,o;return s(this,function(r){switch(r.label){case 0:return this.currentThemeRequest=e.themeId,t=this.currentThemeRequest,[4,this.loadBackgrounds(e.themeId)];case 1:return n=r.sent(),this.currentThemeRequest!=t?[2]:(l.default.Instance.userDataService.getData().currentTheme=e.themeId,(o=new p.UserChangeThemeEvent).newFrames=n,o.themeId=e.themeId,cc.view.emit(p.GameEvent.EVENT_USER_CHANGE_THEME,o),[2])}})})},t.prototype.parse=function(e){var t=this,n=JSON.parse(e),o=[];return n.map(function(e){var n=new u.ThemeConfig;n.id=e.id,n.backgroundNames=t.splitStringToStringArray(e.backgroundNames),n.iconName=e.iconName,o.push(n)}),o},t.prototype.splitStringToStringArray=function(e){return e?e.split(";").map(function(e){return e.trim()}).filter(function(e){return e.length>0}):[]},t.prototype.getRandomInt=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},t.prototype.getThemeConfig=function(e){return this.themeConfigs.find(function(t){return t.id==e})},t.DEFAULT="default",n=i([g],t)}(cc.Component));n.default=y,cc._RF.pop()},{"./Components/EnhancedLoading":"EnhancedLoading","./Controller/MainController":"MainController","./Data/GameConfig":"GameConfig","./GameEvent":"GameEvent","./GameManager":"GameManager","./Utils/GameUtils":"GameUtils"}],TileBase:[function(e,t,n){"use strict";cc._RF.push(t,"e8185rEUuhOorJ/D9fczZBA","TileBase");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator.ccclass,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),i([a],t)}(cc.Component);n.default=s,cc._RF.pop()},{}],TileManager:[function(e,t,n){"use strict";cc._RF.push(t,"da9692T42JOlqO/YmIY9PI1","TileManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Utils/KeyedDictionary"),s=e("./Components/Tile"),c=cc._decorator,l=c.ccclass,u=c.property,p=function(){function e(){this.id="",this.prefab=null,this.tiles=[],this.initPoolCount=20,this.pool=new cc.NodePool}return i([u(cc.String)],e.prototype,"id",void 0),i([u(cc.Prefab)],e.prototype,"prefab",void 0),i([u([cc.Node])],e.prototype,"tiles",void 0),i([u(cc.Integer)],e.prototype,"initPoolCount",void 0),i([l("TileInfos")],e)}(),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tilesInfo=[],t.tilesInfoMap=new a.KeyedDictionary,t}return r(t,e),t.prototype.onLoad=function(){this.initPools()},t.prototype.initPools=function(){var e=this;0!==this.tilesInfo.length&&this.tilesInfo.forEach(function(t){for(var n=0;n<t.initPoolCount;n++){var o=cc.instantiate(t.prefab),r=o.getComponent(s.default);r.isInPool=!0,r.type=t.id,o.x=-1e4,t.pool.put(o)}e.tilesInfoMap.add(t.id,t)})},t.prototype.getOrCreate=function(e,t){var n=this.tilesInfoMap.item(e),o=null,r=(o=n.pool.size()>0?n.pool._pool.splice(0,1)[0]:cc.instantiate(n.prefab)).getComponent(s.default);return r.isInPool=!1,r.type=e,r.node.active=!0,t.addChild(o),r},t.prototype.returnPool=function(e){var t=this.tilesInfoMap.item(e.type);e.node.x=-1e4,e.isInPool=!0,e.node.active=!1,t.pool.put(e.node)},i([u([p])],t.prototype,"tilesInfo",void 0),i([l],t)}(cc.Component);n.default=h,cc._RF.pop()},{"./Components/Tile":"Tile","./Utils/KeyedDictionary":"KeyedDictionary"}],TileStart:[function(e,t,n){"use strict";cc._RF.push(t,"b22e4An+kVJ452CFp6lNhS3","TileStart");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Tile"),s=cc._decorator,c=s.ccclass,l=s.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.startLB=null,t.debugUITime=null,t.reviveSprite=null,t.waitToStart=!1,t.OnStartGame=null,t}return r(t,e),t.prototype.setup=function(t,n,o,r){this.waitToStart=!1,e.prototype.setup.call(this,t,n,o,r)},t.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},t.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},t.prototype.checkReachSyncLine=function(){return!1},t.prototype.isTouchableOutOfBottomScreen=function(){return!1},t.prototype.onKeyDown=function(){this.waitToStart||(this.waitToStart=!0,this.startGame())},t.prototype._onTouchStart=function(){return!this.waitToStart&&(this.waitToStart=!0,this.startGame(),!0)},t.prototype.startGame=function(){var e=this;cc.tween(this.node).delay(.2).call(function(){e.node.x=-1e5,e.waitToStart=!1,null!=e.OnStartGame&&e.OnStartGame()}).start()},i([l(cc.Node)],t.prototype,"startLB",void 0),i([l({type:cc.Label,override:!0,visible:!1})],t.prototype,"debugUITime",void 0),i([l({type:cc.Sprite,override:!0,visible:!1})],t.prototype,"reviveSprite",void 0),i([c],t)}(a.default);n.default=u,cc._RF.pop()},{"./Tile":"Tile"}],Tile:[function(e,t,n){"use strict";cc._RF.push(t,"54285HMSfJOeIs76/qq2lk5","Tile");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Gameplay/ProgressBar/Counter"),s=e("../GM"),c=e("../Data/GameConfig"),l=e("../Defines"),u=cc._decorator,p=u.ccclass,h=u.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t.debugUITime=null,t.reviveAnimation=null,t.nodeHand=null,t.noteData=new c.NoteData,t.gpc=null,t.OnTouchStart=null,t.OnTouchEnd=null,t.OnTouchCancel=null,t.syncLine=null,t.camera=null,t.noteSize=cc.Size.ZERO,t.touchStartPosition=cc.Vec2.ZERO,t.cameraOrigin=cc.Vec2.ZERO,t.isHit=!1,t.isTouch=!1,t.isInPool=!1,t.touchId=-1,t.bottomOffsetY=0,t.touchableSizeY=0,t.noteIndex=-1,t.laneIndex=-1,t.isDual=!1,t.type="",t.endSliderLane=0,t.prize="",t.scaleTween=null,t.isPlayingScaleAnim=!1,t}return r(t,e),t.prototype.setSize=function(e){this.noteSize=e,this.node.width=e.width,this.node.height=e.height+240,null!=this.sprite&&this.sprite.node.setContentSize(e)},t.prototype.setup=function(e,t,n,o){this.setSize(e),this.node.position=cc.v3(t.x,t.y,this.node.z),this.syncLine=n,this.camera=o,this.nodeHand&&(t.x>0?this.nodeHand.scaleX=-1:this.nodeHand.scaleX=1),this.isHit=!1,this.node.opacity=255,this.touchId=l.TileDefines.touchID,this.isTouch=!1,this.touchStartPosition=cc.Vec2.ZERO,this.bottomOffsetY=.5*o.height+this.noteSize.height,this.touchableSizeY=.5*o.height+s.default.defines().SHORT_TILE_HEIGHT,this.cameraOrigin=cc.Vec2.ZERO,this.cameraOrigin.x=.5*this.camera.width,this.cameraOrigin.y=.5*this.camera.height,s.default.defines().IS_DEBUG_MODE?null!=this.debugUITime&&(this.debugUITime.node.active=!0,this.debugUITime.string=""+this.noteData.time.toFixed(2)):null!=this.debugUITime&&(this.debugUITime.node.active=!1)},t.prototype.getTopY=function(){return this.node.y+this.noteSize.height},t.prototype.getBottomY=function(){return this.node.y},t.prototype.doHitEffect=function(){this.node.opacity=50},t.prototype.hit=function(){if(!this.isHit){this.isHit=!0;var e=this.touchStartPosition.y,t=.5*s.default.defines().SHORT_TILE_HEIGHT,n=1*s.default.defines().SHORT_TILE_HEIGHT,o=this.syncLine.position,r=this.camera.convertToWorldSpaceAR(o);e<(o=this.node.convertToNodeSpaceAR(r)).y+t&&e>o.y-t?a.default.OnTileHit&&(a.default.OnTileHit("perfect",this.type),this.prize="prefect"):e<o.y+n&&e>o.y-n?a.default.OnTileHit&&(a.default.OnTileHit("great",this.type),this.prize="great"):a.default.OnTileHit&&(a.default.OnTileHit("cool",this.type),this.prize="cool"),this.doHitEffect(),this.node.position.y+s.default.defines().SHORT_TILE_HEIGHT/2===this.gpc.nodeHighScore.position.y&&this.onHighScore()}},t.prototype.onHighScore=function(){var e=this;cc.tween(this.gpc.nodeHighScore).to(.5,{position:cc.v3(0,this.gpc.nodeHighScore.position.y+.72*this.gpc.getCurrentCameraSpeed(),0),scale:1.7}).to(2,{position:cc.v3(0,this.gpc.nodeHighScore.position.y+2.72*this.gpc.getCurrentCameraSpeed(),0)}).to(1,{position:cc.v3(0,this.gpc.nodeHighScore.position.y+3.72*this.gpc.getCurrentCameraSpeed(),0),opacity:100}).call(function(){e.gpc.nodeHighScore.active=!1}).start();for(var t=0;t<5;t++)cc.tween(this.gpc.nodeHighScore.children[t]).to(.5,{opacity:255}).start();for(cc.tween(this.gpc.nodeHighScore.children[0]).to(4,{angle:600}).start(),cc.tween(this.gpc.nodeHighScore.children[1]).to(1.5,{scale:1.5}).to(1.5,{scale:.2}).to(1.5,{scale:1.5}).start(),cc.tween(this.gpc.nodeHighScore.children[2]).to(1.5,{scale:.2}).to(1.5,{scale:1.5}).to(1.5,{scale:.2}).start(),cc.tween(this.gpc.nodeHighScore.children[3]).to(1.5,{scale:.2}).to(1.5,{scale:1.5}).to(1.5,{scale:.2}).start(),cc.tween(this.gpc.nodeHighScore.children[4]).to(1.5,{scale:1.5}).to(1.5,{scale:.2}).to(1.5,{scale:1.5}).start(),t=1;t<3;t++)cc.tween(this.gpc.nodeHighScore.children[5].children[t]).to(.25,{opacity:0}).start();cc.tween(this.gpc.nodeHighScore.children[5].children[0]).to(.5,{opacity:255}).call(function(){a.default.score+=20}).start()},t.prototype.playScaleUpAnimation=function(){this.reviveAnimation&&(this.reviveAnimation.node.active=!0,this.reviveAnimation.play())},t.prototype.stopScaleUpAnimation=function(){this.reviveAnimation&&(this.reviveAnimation.stop(),this.reviveAnimation.node.active=!1,this.stopHand())},t.prototype.playHand=function(){var e=this;this.nodeHand&&(this.nodeHand.active=!0,this.schedule(function(){cc.tween(e.nodeHand).to(.5,{position:cc.v3(0,-50,0)}).to(.5,{position:cc.v3(0,-120,0)}).start()},.8))},t.prototype.stopHand=function(){this.nodeHand&&(this.nodeHand.active=!1)},t.prototype.getSyncPositionInMyParent=function(){var e=this.syncLine.position,t=this.camera.convertToWorldSpaceAR(e);return this.node.parent.convertToNodeSpaceAR(t)},t.prototype.isVisible=function(e){var t=e.y+.5*e.height+s.default.defines().SHORT_TILE_HEIGHT,n=e.x-.5*e.height;return this.node.y<=t&&this.node.x>=n},t.prototype.isVisibleWithNewY=function(e,t){return t<=e.y+.5*e.height+s.default.defines().SHORT_TILE_HEIGHT},t.prototype.isOutOfBottomScreen=function(e){var t=e-this.bottomOffsetY;return this.node.y<t},t.prototype.isTouchableOutOfBottomScreen=function(e){var t=e-this.touchableSizeY;return this.node.y<t},t.prototype.checkReachSyncLine=function(){var e=this.getSyncPositionInMyParent(),t=this.node.y+this.gpc.tileSize.height/2<e.y;return t&&s.default.defines().isAutoPlay&&this.gpc.gameStatus===l.GameStatus.PLAYING&&(this.hit(),null!=this.OnTouchStart&&this.OnTouchStart(this,!1)),t},t.prototype.contains=function(e,t){void 0===t&&(t=!0);var n=this.node.position,o=cc.v2(e.x-n.x,e.y-n.y);if(t){if(o.y>2*s.default.defines().SHORT_TILE_HEIGHT)return null;if(o.y<-.25*s.default.defines().SHORT_TILE_HEIGHT)return null}return o.x<-.5*this.node.width?null:o.x>.5*this.node.width?null:{localPosition:o}},t.prototype._onTouchStart=function(e,t){return this.stopHand(),this.isTouch?(console.log("isTouch"),!1):(-1===this.touchId||this.touchId===e||1===this.touchId)&&(this.touchId=e,this.touchStartPosition=t,null!=this.OnTouchStart&&this.OnTouchStart(this,!1),!0)},t.prototype._onTouchEnd=function(e){-1!==this.touchId&&this.touchId!==e||(this.touchId=l.TileDefines.touchID,this.isTouch=!1,null!=this.OnTouchEnd&&this.OnTouchEnd(this))},t.prototype._onTouchCancel=function(e){-1!==this.touchId&&this.touchId!==e.getID()||(this.touchId=l.TileDefines.touchID,this.isTouch=!1,null!=this.OnTouchCancel&&this.OnTouchCancel(this))},t.prototype.doReleaseTouch=function(){this.touchId=l.TileDefines.touchID,this.isTouch=!1},t.prototype.doHighlightEffect=function(){},t.prototype.GetCorrectEndLane=function(){return this.endSliderLane},t.prototype.UpdateLanePos=function(e,t){this.laneIndex=e;var n=this.node.position;n.x=t,this.node.position=n},t.prototype.updateLaneY=function(e){var t=this.node.position;t.y-=e,this.node.position=t},t.prototype.onResume=function(){this.isHit=!1,this.doReleaseTouch(),this.playScaleUpAnimation()},t.prototype.addScore=function(){var e=0;switch(this.prize){case"prefect":e=s.default.defines().SCORE_PERFECT;break;case"great":e=s.default.defines().SCORE_GREAT;break;case"cool":e=s.default.defines().SCORE_COOL}a.default.updateScore(e,this.prize)},i([h(cc.Sprite)],t.prototype,"sprite",void 0),i([h(cc.Label)],t.prototype,"debugUITime",void 0),i([h(cc.Animation)],t.prototype,"reviveAnimation",void 0),i([h(cc.Node)],t.prototype,"nodeHand",void 0),i([p],t)}(cc.Component);n.default=d,cc._RF.pop()},{"../Data/GameConfig":"GameConfig","../Defines":"Defines","../GM":"GM","../Gameplay/ProgressBar/Counter":"Counter"}],Time:[function(e,t,n){"use strict";cc._RF.push(t,"bb73cmSF91Eh6KecbCyRGs1","Time"),Object.defineProperty(n,"__esModule",{value:!0}),n.Time=void 0;var o=function(){function e(){}return e.getCurrentOffsetTime=function(){return this.convertUTCToOffset(this.getCurrentUTCTime())},e.getCurrentUTCTime=function(){return Math.floor(Date.now()/1e3)},e.convertUTCToOffset=function(t){return t+e.GMT_OFFSET},e.convertOffsetToUTC=function(t){return t-e.GMT_OFFSET},e.getTimeBeginToDay=function(){return e.getDayStartTime(0)},e.getTimeBeginThisWeek=function(){return e.getWeekStartTime(0)},e.getDayStartTime=function(t){var n=this.getCurrentOffsetTime();return n-n%e.ONE_DAY+t*e.ONE_DAY},e.getWeekStartTime=function(t,n){void 0===n&&(n=0);var o=this.getCurrentOffsetTime(),r=Math.floor(o/e.ONE_WEEK),i=o%e.ONE_WEEK,a=r*e.ONE_WEEK-3*e.ONE_DAY;return i>=4*e.ONE_DAY&&(a+=e.ONE_WEEK),a+t*e.ONE_DAY+n*e.ONE_WEEK},e.ONE_SECOND=1,e.ONE_MINUTE=60*e.ONE_SECOND,e.ONE_HOUR=60*e.ONE_MINUTE,e.ONE_DAY=24*e.ONE_HOUR,e.ONE_WEEK=7*e.ONE_DAY,e.ONE_MONTH=30*e.ONE_DAY,e.ONE_YEAR=365*e.ONE_DAY,e.GMT_OFFSET=0*e.ONE_HOUR,e}();n.Time=o,cc._RF.pop()},{}],ToolController:[function(e,t,n){"use strict";cc._RF.push(t,"7bbbeKPegtLO59NyEvxUalf","ToolController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Defines"),s=e("../GameManager"),c=e("../GM"),l=e("./GameplayController"),u=e("./InfoController"),p=cc._decorator,h=p.ccclass,d=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.activeAuto=null,t.activeSlide=null,t.activeFF=null,t.gpc=null,t.gameManager=null,t.info=null,t.setting=null,t.ffSlider=null,t.checkSlide=!1,t}var n;return r(t,e),n=t,t.prototype.start=function(){},t.prototype.onLoad=function(){n.instance=this},t.prototype.btnAuto=function(){c.default.defines().isAutoPlay?(c.default.defines().isAutoPlay=!1,this.activeAuto.string="Auto: false"):(c.default.defines().isAutoPlay=!0,this.activeAuto.string="Auto: true")},t.prototype.btnSlideNote=function(){this.gpc.gameStatus===a.GameStatus.LOADED&&("auto"===c.default.defines().ENABLE_SLIDER_TILE?(c.default.defines().ENABLE_SLIDER_TILE=!0,this.activeSlide.string="Slide: true"):!0===c.default.defines().ENABLE_SLIDER_TILE?(c.default.defines().ENABLE_SLIDER_TILE=!1,this.activeSlide.string="Slide: false"):!1===c.default.defines().ENABLE_SLIDER_TILE&&(c.default.defines().ENABLE_SLIDER_TILE="auto",this.activeSlide.string="Slide: auto"),this.clearData())},t.prototype.btnDebug=function(){c.default.defines().IS_DEBUG_MODE?(c.default.defines().IS_DEBUG_MODE=!1,this.ffSlider.active=!1,this.activeFF.string="Debug: false"):(c.default.defines().IS_DEBUG_MODE=!0,this.ffSlider.active=!0,this.activeFF.string="Debug: true")},t.prototype.btnTheme=function(){this.gpc.gameStatus,a.GameStatus.LOADED},t.prototype.btnClose=function(){this.setting.active=!1},t.prototype.clearData=function(){this.gpc.posDataTile=[],this.gpc.arrManualTimeChangleBg=[],this.gpc.arrManualChangeBgId=[]},t.instance=null,i([d(cc.Label)],t.prototype,"activeAuto",void 0),i([d(cc.Label)],t.prototype,"activeSlide",void 0),i([d(cc.Label)],t.prototype,"activeFF",void 0),i([d(l.default)],t.prototype,"gpc",void 0),i([d(s.default)],t.prototype,"gameManager",void 0),i([d(u.default)],t.prototype,"info",void 0),i([d(cc.Node)],t.prototype,"setting",void 0),i([d(cc.Node)],t.prototype,"ffSlider",void 0),n=i([h],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Defines":"Defines","../GM":"GM","../GameManager":"GameManager","./GameplayController":"GameplayController","./InfoController":"InfoController"}],ToolTipController:[function(e,t,n){"use strict";cc._RF.push(t,"37ae9O0Pa1BT5NdiuPPqMiD","ToolTipController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),n.ToolTipController=void 0;var a=e("./GameEvent"),s=e("./GameManager"),c=cc._decorator,l=c.ccclass,u=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rootNode=null,t.textLabel=null,t.backgroundPanel=null,t.hideTooltip=function(){t.rootNode.active=!1},t}return r(t,e),t.prototype.onLoad=function(){this.hideTooltip(),this.rootNode.on(cc.Node.EventType.TOUCH_START,this.hideTooltip,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.hideTooltip,this),cc.view.on(a.GameEvent.EVENT_SHOW_TOOLTIP_REQUEST,this.onShowTooltipRequest,this)},t.prototype.onDestroy=function(){this.rootNode.off(cc.Node.EventType.TOUCH_START,this.hideTooltip,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.hideTooltip,this),cc.view.off(a.GameEvent.EVENT_SHOW_TOOLTIP_REQUEST,this.onShowTooltipRequest,this)},t.prototype.showTooltip=function(e,t){var n=this,o=.8*s.default.Instance.canvasSize.width;this.textLabel.string=e,this.rootNode.active=!0,this.rootNode.opacity=1;var r=1;t.y>0?(this.textLabel.node.anchorY=1,this.backgroundPanel.anchorY=1,r=-1):(this.textLabel.node.anchorY=0,this.backgroundPanel.anchorY=0),this.textLabel.verticalAlign=cc.Label.VerticalAlign.CENTER,this.textLabel.horizontalAlign=cc.Label.HorizontalAlign.CENTER,this.textLabel.overflow=cc.Label.Overflow.RESIZE_HEIGHT,this.textLabel.string=e,this.scheduleOnce(function(){var e=n.textLabel.node.getContentSize();n.textLabel.node.position=new cc.Vec3(0,t.y+20*r/2,0),n.backgroundPanel.position=new cc.Vec3(0,t.y,0);var i=Math.min(e.width,o);n.textLabel.node.width=i,n.scheduleOnce(function(){var e=n.textLabel.node.getContentSize();n.backgroundPanel.setContentSize(i+20,e.height+20),n.rootNode.opacity=255})})},t.prototype.onShowTooltipRequest=function(e){this.showTooltip(e.text,e.position)},i([u(cc.Node)],t.prototype,"rootNode",void 0),i([u(cc.Label)],t.prototype,"textLabel",void 0),i([u(cc.Node)],t.prototype,"backgroundPanel",void 0),i([l("ToolTipManager")],t)}(cc.Component);n.ToolTipController=p,cc._RF.pop()},{"./GameEvent":"GameEvent","./GameManager":"GameManager"}],TutorialSceneController:[function(e,t,n){"use strict";cc._RF.push(t,"827fa30IMRBOJgQ1ZdhvLbD","TutorialSceneController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../Components/SongItemView"),l=e("../GameEvent"),u=e("../GameManager"),p=e("./BaseSceneController"),h=e("../SongListManager"),d=e("./MainController"),f=cc._decorator,g=f.ccclass,y=f.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.songItemPrefab=null,t.songListContainer=null,t.maxSongsToShow=4,t.loadingNode=null,t.loadSession=0,t}return r(t,e),t.prototype.onLoad=function(){this.allCreatedItem=[]},t.prototype.onEnable=function(){cc.view.on(l.GameEvent.EVENT_START_GAME_REQUEST,this.onStartGameRequest,this)},t.prototype.onDisable=function(){cc.view.off(l.GameEvent.EVENT_START_GAME_REQUEST,this.onStartGameRequest,this),this.loadSession++},t.prototype.showScene=function(){return a(this,void 0,void 0,function(){return s(this,function(){return this.node.active=!0,this.refresh(),[2]})})},t.prototype.hideScene=function(){return a(this,void 0,void 0,function(){return s(this,function(){return this.node.active=!1,this.songListContainer.removeAllChildren(),[2]})})},t.prototype.refresh=function(){return a(this,void 0,void 0,function(){var e,t,n,o,r,i=this;return s(this,function(a){switch(a.label){case 0:return this.loadingNode.active=!0,this.loadSession++,e=this.loadSession,this.songListContainer.removeAllChildren(),[4,h.default.Instance.getSongList(!0)];case 1:return t=a.sent(),this.loadSession!=e?[2]:(this.loadingNode.active=!1,null==t||0==t.length?[2]:((n=t.slice(0,this.maxSongsToShow)).forEach(function(e){var t=cc.instantiate(i.songItemPrefab),n=t.getComponent(c.default);n&&(n.updateView(e),i.songListContainer.addChild(t),i.allCreatedItem.push(n))}),n.length>0&&(o=this.selectSong(n),(r=new l.StartReviewSongRequestEvent).url=o.getMp3ReviewLink(),cc.view.emit(l.GameEvent.EVENT_START_REVIEW_SONG_REQUEST,r)),[2]))}})})},t.prototype.onStartGameRequest=function(e){u.default.Instance.loadGamePlay(e.songId,!0)},t.prototype.selectSong=function(e){var t=1e6,n=null;return e.forEach(function(e){var o=d.default.Instance.userDataService.getSongData(e.songId),r=o.star+o.crown;r<t&&(t=r,n=e)}),null==n&&e.length>0&&(n=e[0]),n},i([y(cc.Prefab)],t.prototype,"songItemPrefab",void 0),i([y(cc.Node)],t.prototype,"songListContainer",void 0),i([y],t.prototype,"maxSongsToShow",void 0),i([y(cc.Node)],t.prototype,"loadingNode",void 0),i([g],t)}(p.default);n.default=v,cc._RF.pop()},{"../Components/SongItemView":"SongItemView","../GameEvent":"GameEvent","../GameManager":"GameManager","../SongListManager":"SongListManager","./BaseSceneController":"BaseSceneController","./MainController":"MainController"}],UnlockFrameByLevelChecker:[function(e,t,n){"use strict";cc._RF.push(t,"7abbeCw44JEEK1FE4dnsa68","UnlockFrameByLevelChecker"),Object.defineProperty(n,"__esModule",{value:!0}),n.UnlockFrameByLevelChecker=void 0;var o=e("../ConfigManager"),r=e("../Controller/MainController"),i=function(){function e(){}return e.prototype.isFrameLocked=function(e){var t=o.default.Instance.getFrameConfig(e),n=o.default.Instance.getLevelConfigs(),i=Array.from(n.values()).reduce(function(e,t){return t.level>e.level?t:e});return!(t.levelUnlock>i.level)&&t.levelUnlock<=r.default.Instance.userDataService.getData().profile.level},e.prototype.getUnlockText=function(e){var t=o.default.Instance.getFrameConfig(e),n=o.default.Instance.getLevelConfigs(),r=Array.from(n.values()).reduce(function(e,t){return t.level>e.level?t:e});return t.levelUnlock<=r.level&&!this.isFrameLocked(e)?"You need to reach level "+t.levelUnlock+" to unlock":null},e}();n.UnlockFrameByLevelChecker=i,cc._RF.pop()},{"../ConfigManager":"ConfigManager","../Controller/MainController":"MainController"}],UnlockFrameBySongChallenge:[function(e,t,n){"use strict";cc._RF.push(t,"f788b2g2chMgaOGGBsYLxS5","UnlockFrameBySongChallenge"),Object.defineProperty(n,"__esModule",{value:!0}),n.UnlockFrameBySongChallenge=void 0;var o=e("../ConfigManager"),r=e("../Controller/MainController"),i=function(){function e(){}return e.prototype.isFrameLocked=function(e){return r.default.Instance.userDataService.getData().challengeData.frameUnlocked.includes(e)},e.prototype.getUnlockText=function(e){var t=o.default.Instance.getFrameConfig(e);return t.songChallengUnlock>=0&&!this.isFrameLocked(e)?"You need to reach Song Challenge rank "+(t.songChallengUnlock+1)+" to unlock":null},e}();n.UnlockFrameBySongChallenge=i,cc._RF.pop()},{"../ConfigManager":"ConfigManager","../Controller/MainController":"MainController"}],UserDataService:[function(e,t,n){"use strict";cc._RF.push(t,"1b1b5QltOtJM7oR/xDnJDSb","UserDataService");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.UserDataService=void 0;var i=e("../ConfigManager"),a=e("../Controller/MainController"),s=e("../Data/UserData"),c=e("../GameManager"),l=e("../LeaderBoardManager"),u=e("../NakamaManager"),p=function(){function e(){}return e.prototype.loadData=function(){return o(this,void 0,void 0,function(){var e,t,n;return r(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,a.default.Instance.dataStoragable.loadData()];case 1:return e=o.sent(),t=e?JSON.parse(e):new s.GameData,this.data=Object.assign(new s.GameData,t),[3,3];case 2:return n=o.sent(),c.GameLog.error("[UserDataService] Data load error",n),this.data=new s.GameData,[3,3];case 3:return this.fixData(),[2]}})})},e.prototype.saveData=function(){return o(this,void 0,void 0,function(){var e,t;return r(this,function(n){switch(n.label){case 0:e=JSON.stringify(this.data),c.GameLog.log("Saving data"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,a.default.Instance.dataStoragable.saveData(e)];case 2:return n.sent(),c.GameLog.log("Data saved"),[3,4];case 3:return t=n.sent(),c.GameLog.error("Failed to save data",t),[3,4];case 4:return[2]}})})},e.prototype.saveDataLocalAndServer=function(){return o(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return c.GameLog.log("[UserDataService] Saving data local and server"),[4,Promise.all([this.saveData(),this.saveDataToServer()])];case 1:return e.sent(),[2]}})})},e.prototype.saveDataToServer=function(){return o(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return c.GameLog.log("[UserDataService] Saving data to server"),[4,this.updateUserMetaDataToServer()];case 1:return e.sent(),[2]}})})},e.prototype.updateHighscore=function(e){return o(this,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:return(t=this.data).lastHighScore>=e?[2]:(t.lastHighScore=e,[4,this.saveData()]);case 1:return n.sent(),[4,a.default.Instance.highScoreSender.sendScore(e)];case 2:return n.sent(),[2]}})})},e.prototype.updateName=function(e){return o(this,void 0,Promise,function(){var t;return r(this,function(n){switch(n.label){case 0:return(t=this.data).profile.userName===e?[3,2]:(t.profile.userName=e,[4,this.saveDataLocalAndServer()]);case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.updateAvatar=function(e){return o(this,void 0,Promise,function(){var t;return r(this,function(n){switch(n.label){case 0:return(t=this.data).profile.avatarId===e?[3,2]:(t.profile.avatarId=e,[4,this.saveDataLocalAndServer()]);case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.updateFrame=function(e){return o(this,void 0,Promise,function(){var t;return r(this,function(n){switch(n.label){case 0:return(t=this.data).profile.frameId===e?[3,2]:(t.profile.frameId=e,[4,this.saveDataLocalAndServer()]);case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.endSong=function(e,t,n,o){var r=this.data.songDatas.find(function(t){return t.songId==e});null==r&&(r=new s.SongData(e),this.data.songDatas.push(r));var i=r.star,a=r.crown;r.crown=Math.max(r.crown,o),r.star=Math.max(r.star,n),r.highScore=Math.max(r.highScore,t),r.timePlayed++,this.expProgress(i,n,a,o),this.saveData()},e.prototype.updateUserMetaDataToServer=function(){return o(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return e=this.exportUserMetaData(),c.GameLog.log("[UserDataService] Updating user metadata to server: "+JSON.stringify(e)),[4,u.default.Instance.updateUserMetaData(this.data.server.nakamaId,e)];case 1:return t.sent(),[2]}})})},e.prototype.isHigherScore=function(e,t){var n=this.data.songDatas.find(function(t){return t.songId==e});return null==n?t>0:t>n.highScore},e.prototype.getData=function(){return this.data},e.prototype.getSongData=function(e){var t=this.data.songDatas.find(function(t){return t.songId==e});return null==t&&((t=new s.SongData(e)).songId=e,t.timePlayed=0,t.crown=0,t.star=0,t.highScore=0),t},e.prototype.saveTutorialPlayed=function(){return o(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return this.data.tutorialPlayed=!0,[4,this.saveData()];case 1:return e.sent(),[2]}})})},e.prototype.totalStars=function(){return this.data.songDatas.reduce(function(e,t){return e+t.star},0)},e.prototype.totalCrowns=function(){return this.data.songDatas.reduce(function(e,t){return e+t.crown},0)},e.prototype.getCurrentAvatarId=function(){return this.data.profile.avatarId},e.prototype.getCurrentFrameId=function(){return this.data.profile.frameId},e.prototype.fixData=function(){if(null!=this.data){if(null==this.data.songDatas&&(this.data.songDatas=[]),null==this.data.profile){var e=new s.ProfileData;e.new(),this.data.profile=e}null==this.data.server&&(this.data.server=new s.ServerData),null==this.data.challengeData&&(this.data.challengeData=new s.ChallengeData),null==this.data.leaderBoardData&&(this.data.leaderBoardData=new l.LeaderBoardData)}},e.prototype.expProgress=function(e,t,n,o){var r=this.data,i=0;i+=5*Math.min(e,t),t>e&&(i+=10*(t-e)),i+=10*Math.min(n,o),o>n&&(i+=20*(o-n)),c.GameLog.log("Gained Exp: "+i),r.profile.exp+=i,c.GameLog.log("Total Exp Before Level Calculation: "+r.profile.exp);var a=this.calculateNewLevel(r.profile.exp),s=a.newLevel,l=a.remainingExp;c.GameLog.log("New Level: "+s+", Remaining Exp: "+l),r.profile.exp=l,r.profile.level=s,c.GameLog.log("Updated Profile: Level: "+r.profile.level+", Exp: "+r.profile.exp)},e.prototype.calculateNewLevel=function(e){for(var t=this.data.profile.level,n=e;n>0;){var o=t+1,r=i.default.Instance.getLevelConfig(o);if(null==r)break;if(n<r.exp)break;n-=r.exp,t=o}return{newLevel:t,remainingExp:n}},e.prototype.exportUserMetaData=function(){return{level:this.data.profile.level,avatarId:this.data.profile.avatarId,frameId:this.data.profile.frameId,userName:this.data.profile.userName,leaderBoardData:l.default.Instance.exportLeaderBoardUserData()}},e}();n.UserDataService=p,cc._RF.pop()},{"../ConfigManager":"ConfigManager","../Controller/MainController":"MainController","../Data/UserData":"UserData","../GameManager":"GameManager","../LeaderBoardManager":"LeaderBoardManager","../NakamaManager":"NakamaManager"}],UserData:[function(e,t,n){"use strict";cc._RF.push(t,"59c7fMceSRDF5eiL2Y4dutg","UserData"),Object.defineProperty(n,"__esModule",{value:!0}),n.SongData=n.ProfileData=n.ChallengeData=n.ServerData=n.GameData=void 0;n.GameData=function(){this.tutorialPlayed=!1,this.songDatas=[],this.lastHighScore=0,this.currentTheme=null,this.profile=null,this.token=null,this.refreshToken=null,this.server=null,this.challengeData=null,this.leaderBoardData=null};n.ServerData=function(){this.nakamaId=""};n.ChallengeData=function(){this.frameUnlocked=[],this.challengeSongId=""};var o=function(){function e(){this.level=1,this.exp=0}return e.prototype.new=function(){this.userId=this.generateUserId(),this.userName=this.generateUserName(),this.avatarId="avatar_1",this.frameId="",this.level=1,this.exp=0},e.prototype.generateUserId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e.prototype.generateUserName=function(){return"User #"+Math.floor(1e9*Math.random())},e}();n.ProfileData=o;n.SongData=function(e){this.timePlayed=0,this.crown=0,this.star=0,this.highScore=0,this.songId=e},cc._RF.pop()},{}],UserProfileHeader:[function(e,t,n){"use strict";cc._RF.push(t,"e008bbpt51CHbGtVa9kVysC","UserProfileHeader");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../AudioManager"),l=e("../Controller/MainController"),u=e("../GameEvent"),p=e("../ResourcesManager"),h=cc._decorator,d=h.ccclass,f=h.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.userNameLabel=null,t.userLevelLabel=null,t.starsLabel=null,t.crownsLabel=null,t.avatarSprite=null,t.frameSprite=null,t.settingButton=null,t.avatarLoadSession=0,t.frameLoadSession=0,t}return r(t,e),t.prototype.onLoad=function(){this.settingButton.node.on("click",this.onClickSetting.bind(this))},t.prototype.onEnable=function(){this.refresh()},t.prototype.onDisable=function(){this.avatarLoadSession++,this.frameLoadSession++},t.prototype.refresh=function(){this.updateUserInfo()},t.prototype.updateUserInfo=function(){var e=l.default.Instance.userDataService.getData().profile;this.userNameLabel.string=e.userName,this.userLevelLabel.string=e.level.toString(),this.starsLabel.string=l.default.Instance.userDataService.totalStars().toString(),this.crownsLabel.string=l.default.Instance.userDataService.totalCrowns().toString(),this.loadAvatar(e.avatarId),this.loadFrame(e.frameId)},t.prototype.loadAvatar=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return this.avatarSprite.spriteFrame=p.default.Instance.getDefaultAvatar(),this.avatarLoadSession++,t=this.avatarLoadSession,[4,p.default.Instance.loadAvatar(e)];case 1:return n=o.sent(),t!=this.avatarLoadSession?[2]:(null!=n&&(this.avatarSprite.spriteFrame=n),[2])}})})},t.prototype.loadFrame=function(e){return a(this,void 0,void 0,function(){var t,n;return s(this,function(o){switch(o.label){case 0:return null==e||""==e?(this.frameSprite.node.active=!1,[2]):(this.frameSprite.node.active=!0,this.frameSprite.spriteFrame=p.default.Instance.getDefaultFrame(),this.frameLoadSession++,t=this.frameLoadSession,[4,p.default.Instance.loadFrame(e)]);case 1:return n=o.sent(),t!=this.frameLoadSession?[2]:(null!=n&&(this.frameSprite.spriteFrame=n),[2])}})})},t.prototype.onClickSetting=function(){c.default.Instance.playButton(),cc.view.emit(u.GameEvent.EVENT_OPEN_PROFILE_SCENE_REQUEST,new u.OpenProfileSceneRequestEvent)},i([f(cc.Label)],t.prototype,"userNameLabel",void 0),i([f(cc.Label)],t.prototype,"userLevelLabel",void 0),i([f(cc.Label)],t.prototype,"starsLabel",void 0),i([f(cc.Label)],t.prototype,"crownsLabel",void 0),i([f(cc.Sprite)],t.prototype,"avatarSprite",void 0),i([f(cc.Sprite)],t.prototype,"frameSprite",void 0),i([f(cc.Button)],t.prototype,"settingButton",void 0),i([d],t)}(cc.Component);n.default=g,cc._RF.pop()},{"../AudioManager":"AudioManager","../Controller/MainController":"MainController","../GameEvent":"GameEvent","../ResourcesManager":"ResourcesManager"}],VirtualScrollView:[function(e,t,n){"use strict";cc._RF.push(t,"ede05tRJjtOJaHbzRa1/rzh","VirtualScrollView");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../GameManager"),s=cc._decorator,c=s.ccclass,l=s.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.itemPrefabs=[],t.content=null,t.scrollView=null,t.topPadding=0,t.padding=0,t.itemHeights=[],t.itemPools=[],t.totalItems=0,t.items=null,t.updateItemCallback=null,t.createItemCallback=null,t.getPrefabIndexCallback=null,t.isInitialized=!1,t}return r(t,e),t.prototype.refresh=function(){this.onScrolling()},t.prototype.reset=function(){this.lastStartIndex=-1},t.prototype.setup=function(e){this.lastStartIndex=-1,this.totalItems=e,this.clearAllNode(),this.updateContentHeight(),this.onScrolling()},t.prototype.setUpdateItemCallback=function(e){this.updateItemCallback=e},t.prototype.setCreateItemCallBack=function(e){this.createItemCallback=e},t.prototype.setGetPrefabIndexCallback=function(e){this.getPrefabIndexCallback=e},t.prototype.initialize=function(){var e=this;if(!this.isInitialized){this.totalItems=0,this.itemHeights=this.itemPrefabs.map(function(t){return cc.instantiate(t).height+e.padding}),this.itemPools=this.itemPrefabs.map(function(){return new cc.NodePool});for(var t=0;t<this.itemPrefabs.length;t++){var n=cc.instantiate(this.itemPrefabs[t]);n.active=!1,this.itemPools[t].put(n),this.createItemCallback&&this.createItemCallback(n)}this.items=new Map,this.scrollView.node.on("scrolling",this.onScrolling,this),this.scrollView.node.on("resize",this.onScrolling,this),this.isInitialized=!0}},t.prototype.setWidgetScrollviewBottomAlign=function(e){var t=this.scrollView.node.getComponent(cc.Widget);t&&(t.bottom=e,t.updateAlignment());var n=this.content.parent.getComponent(cc.Widget);n&&n.updateAlignment()},t.prototype.clear=function(){this.clearAllNode()},t.prototype.clearAllNode=function(){var e=this;null!=this.items&&0!=this.items.size&&(this.items.forEach(function(t,n){var o=e.getPrefabIndex(n);e.itemPools[o].put(t)}),this.items.clear())},t.prototype.updateContentHeight=function(){for(var e=this.topPadding,t=0;t<this.totalItems;t++){var n=this.getPrefabIndex(t);e+=this.itemHeights[n]}this.content.height=e},t.prototype.onScrolling=function(){for(var e=this,t=this.scrollView.getScrollOffset().y,n=0,o=0,r=0;r<this.totalItems;r++)if((n+=this.itemHeights[this.getPrefabIndex(r)])>t){o=r;break}if(o=Math.max(0,o),this.lastStartIndex!==o){var i=o;for(n=t,r=o;r<this.totalItems&&(i=r+2,!((n+=this.itemHeights[this.getPrefabIndex(r)])>t+this.scrollView.node.height));r++);i=Math.min(i,this.totalItems);var s=new Set;for(r=o;r<i;r++)s.add(r);this.items.forEach(function(t,n){if(!s.has(n)){var o=e.getPrefabIndex(n);e.itemPools[o].put(t),t.active=!1,e.items.delete(n),a.GameLog.log("Deleted at index = "+n)}});var c=-this.topPadding;for(r=0;r<o;r++)c-=this.itemHeights[this.getPrefabIndex(r)];for(r=o;r<i;r++){var l=this.getPrefabIndex(r);if(!this.items.has(r)){var u=this.getItemFromPool(l);u.setPosition(0,c-this.itemHeights[l]/2),this.updateItemCallback&&this.updateItemCallback(u,r),u.active=!0,this.items.set(r,u)}c-=this.itemHeights[l]}this.lastStartIndex=o}},t.prototype.getItemFromPool=function(e){var t=null;return this.itemPools[e].size()>0?t=this.itemPools[e].get():(t=cc.instantiate(this.itemPrefabs[e]),this.createItemCallback&&this.createItemCallback(t)),t.parent||this.content.addChild(t),t},t.prototype.getPrefabIndex=function(e){return this.getPrefabIndexCallback?this.getPrefabIndexCallback(e):0},i([l([cc.Prefab])],t.prototype,"itemPrefabs",void 0),i([l(cc.Node)],t.prototype,"content",void 0),i([l(cc.ScrollView)],t.prototype,"scrollView",void 0),i([l],t.prototype,"topPadding",void 0),i([l],t.prototype,"padding",void 0),i([c],t)}(cc.Component);n.default=u,cc._RF.pop()},{"../GameManager":"GameManager"}],YoutubeManager:[function(e,t,n){"use strict";cc._RF.push(t,"cd4759crtVCmYYIyxOrouH9","YoutubeManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.YoutubeManager=void 0;var c=e("./Components/EnhancedLoading"),l=e("./Controller/MainController"),u=e("./GameManager"),p=cc._decorator,h=p.ccclass,d=(p.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.inPlayablesEnv=!1,t}return r(t,e),t.prototype.getLoadingComponentList=function(){var e=this;return[{resultRequire:[],resultList:[c.LoadingResultType.YOUTUBE_INIT],executeFunction:function(){return e.init()}}]},t.prototype.isInPlayableENV=function(){return this.inPlayablesEnv},t.prototype.init=function(){return a(this,void 0,void 0,function(){var e=this;return s(this,function(){return u.GameLog.logStartInit("[YoutubeManager] Initializing main handler"),this.inPlayablesEnv="undefined"!=typeof ytgame&&ytgame.IN_PLAYABLES_ENV,this.inPlayablesEnv?(l.default.Instance.pauseAndResumeable=this,l.default.Instance.audioEnableChangable=this,l.default.Instance.dataStoragable=this,l.default.Instance.gameReady=this,l.default.Instance.highScoreSender=this,ytgame.system.onPause(function(){u.GameLog.log("[YoutubeManager] Pause"),e.pauseFuction&&e.pauseFuction()}),ytgame.system.onResume(function(){u.GameLog.log("[YoutubeManager] Resume"),e.resumeFuction&&e.resumeFuction()}),ytgame.system.onAudioEnabledChange(function(t){u.GameLog.log("[YoutubeManager] Audio enabled change: "+t),e.audioEnableFunction&&e.audioEnableFunction(t)}),this.firstFrameReady(),u.GameLog.logInitSuccess("[YoutubeManager] Initialized"),[2]):(u.GameLog.logInitSuccess("[YoutubeManager] Not in playable env"),[2])})})},t.prototype.onPause=function(e){this.pauseFuction=e},t.prototype.onResume=function(e){this.resumeFuction=e},t.prototype.onAudioEnabledChange=function(e){this.audioEnableFunction=e},t.prototype.isAudioEnabled=function(){return ytgame.system.isAudioEnabled()},t.prototype.loadData=function(){return a(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,ytgame.game.loadData()];case 1:return[2,e.sent()]}})})},t.prototype.saveData=function(e){return a(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,ytgame.game.saveData(e)];case 1:return t.sent(),[2]}})})},t.prototype.firstFrameReady=function(){ytgame.game.firstFrameReady()},t.prototype.gameReady=function(){ytgame.game.gameReady()},t.prototype.sendScore=function(e){return a(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return u.GameLog.log("[YoutubeManager] Send score: "+e),[4,ytgame.engagement.sendScore({value:e})];case 1:return[2,t.sent()]}})})},i([h],t)}(cc.Component));n.YoutubeManager=d,cc._RF.pop()},{"./Components/EnhancedLoading":"EnhancedLoading","./Controller/MainController":"MainController","./GameManager":"GameManager"}],YtGame:[function(e,t){"use strict";cc._RF.push(t,"51bd4Tn9P1KlLuSslSJGHVB","YtGame"),cc._RF.pop()},{}],"particle-simulator":[function(e,t,n){"use strict";cc._RF.push(t,"498b9RC9DBMgru35uJywfij","particle-simulator"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t,n){if(t>n){var o=t;t=n,n=o}return e<t?t:e<n?e:n},r=function(e){return e*Math.PI/180};function i(e,t){void 0===t&&(t=e,e=null),this.get=null,this.count=0,this._pool=new Array(t),this._cleanup=e}i.prototype._get=function(){if(this.count>0){--this.count;var e=this._pool[this.count];return this._pool[this.count]=null,e}return null},i.prototype.put=function(e){var t=this._pool;if(this.count<t.length){if(this._cleanup&&!1===this._cleanup(e))return;t[this.count]=e,++this.count}},i.prototype.resize=function(e){e>=0&&(this._pool.length=e,this.count>e&&(this.count=e))};var a=cc.v2(0,0),s=cc.v2(),c=cc.v2(),l=cc.v2(),u=cc.v2(),p=function(){this.pos=cc.v2(0,0),this.startPos=cc.v2(0,0),this.color=cc.color(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.preciseColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=cc.v2(0,0),this.aspectRatio=1,this.dir=cc.v2(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0,this.timeLiveFx=0,this.timeOpacityFx=0},h=new i(function(e){e.pos.set(a),e.startPos.set(a),e.color._val=4278190080,e.deltaColor.r=e.deltaColor.g=e.deltaColor.b=0,e.deltaColor.a=255,e.size=0,e.deltaSize=0,e.rotation=0,e.deltaRotation=0,e.timeToLive=0,e.drawPos.set(a),e.aspectRatio=1,e.dir.set(a),e.radialAccel=0,e.tangentialAccel=0,e.angle=0,e.degreesPerSecond=0,e.radius=0,e.deltaRadius=0,e.timeLiveFx=0,e.timeOpacityFx=0},1024);h.get=function(){return this._get()||new p};var d=function(e){this.sys=e,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this._uvFilled=0,this._worldRotation=0,this.easing=cc.easing.sineOutIn,this.easingSmooth=cc.easing.smooth};function f(e){for(var t=0,n=e;n;)t+=n.angle,n=n.parent;return t}d.prototype.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},d.prototype.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var e=this.particles,t=0;t<e.length;++t)h.put(e[t]);e.length=0;var n=this.sys._assembler;n&&n._ia&&(n._ia._count=0)},d.prototype.emitParticle=function(e){var t=this.sys,n=o,i=h.get();this.particles.push(i),i.timeToLive=t.life+t.lifeVar*(Math.random()-.5)*2;var a,s,c,l,u=i.timeToLive=Math.max(0,i.timeToLive);i.pos.x=t.sourcePos.x+t.posVar.x*(Math.random()-.5)*2,i.pos.y=t.sourcePos.y+t.posVar.y*(Math.random()-.5)*2;var p=t._startColor,d=t._startColorVar,f=t._endColor,g=t._endColorVar;i.color.r=a=n(p.r+d.r*(Math.random()-.5)*2,0,255),i.color.g=s=n(p.g+d.g*(Math.random()-.5)*2,0,255),i.color.b=c=n(p.b+d.b*(Math.random()-.5)*2,0,255),i.color.a=l=n(p.a+d.a*(Math.random()-.5)*2,0,255);var y=i.color,v=i.preciseColor;v.r=y.r,v.g=y.g,v.b=y.b,v.a=y.a,i.deltaColor.r=(n(f.r+g.r*(Math.random()-.5)*2,0,255)-a)/u,i.deltaColor.g=(n(f.g+g.g*(Math.random()-.5)*2,0,255)-s)/u,i.deltaColor.b=(n(f.b+g.b*(Math.random()-.5)*2,0,255)-c)/u,i.deltaColor.a=(n(f.a+g.a*(Math.random()-.5)*2,0,255)-l)/u;var m=t.startSize+t.startSizeVar*(Math.random()-.5)*2;m=Math.max(0,m),i.size=m,i.startS=m;var S=0;t.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE?i.deltaSize=0:(S=t.endSize+t.endSizeVar*(Math.random()-.5)*2,S=Math.max(0,S),i.deltaSize=(S-m)/u),i.endSize=S;var _=t.startSpin+t.startSpinVar*(Math.random()-.5)*2,b=t.endSpin+t.endSpinVar*(Math.random()-.5)*2;i.rotation=_,i.deltaRotation=(b-_)/u,i.startPos.x=e.x,i.startPos.y=e.y,i.aspectRatio=t._aspectRatio||1;var T=r(t.angle+this._worldRotation+t.angleVar*(Math.random()-.5)*2);if(t.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY){var C=t.speed+t.speedVar*(Math.random()-.5)*2;i.dir.x=Math.cos(T),i.dir.y=Math.sin(T),i.dir.mulSelf(C),i.radialAccel=t.radialAccel+t.radialAccelVar*(Math.random()-.5)*2,i.tangentialAccel=t.tangentialAccel+t.tangentialAccelVar*(Math.random()-.5)*2,t.rotationIsDir&&(i.rotation=-180*Math.atan2(i.dir.y,i.dir.x)/Math.PI)}else{var E=t.startRadius+t.startRadiusVar*(Math.random()-.5)*2,w=t.endRadius+t.endRadiusVar*(Math.random()-.5)*2;i.radius=E,i.deltaRadius=t.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(w-E)/u,i.angle=T,i.degreesPerSecond=r(t.rotatePerS+t.rotatePerSVar*(Math.random()-.5)*2)}},d.prototype.updateUVs=function(e){var t=this.sys._assembler;if(t){var n=t.getBuffer();if(n&&this.sys._renderSpriteFrame){for(var o=4*t._vfmt._bytes/4,r=n._vData,i=this.sys._renderSpriteFrame.uv,a=e?0:this._uvFilled,s=this.particles.length,c=a;c<s;c++){var l=c*o;r[l+2]=i[0],r[l+3]=i[1],r[l+7]=i[2],r[l+8]=i[3],r[l+12]=i[4],r[l+13]=i[5],r[l+17]=i[6],r[l+18]=i[7]}this._uvFilled=s}}},d.prototype.updateParticleBuffer=function(e,t,n,o){var i=n._vData,a=n._uintVData,s=t.x,c=t.y,l=e.size,u=l,p=e.aspectRatio;p>1?u=l/p:l=u*p;var h=l/2,d=u/2;if(e.rotation){var f=-h,g=-d,y=h,v=d,m=-r(e.rotation),S=Math.cos(m),_=Math.sin(m);i[o]=f*S-g*_+s,i[o+1]=f*_+g*S+c,i[o+5]=y*S-g*_+s,i[o+6]=y*_+g*S+c,i[o+10]=f*S-v*_+s,i[o+11]=f*_+v*S+c,i[o+15]=y*S-v*_+s,i[o+16]=y*_+v*S+c}else i[o]=s-h,i[o+1]=c-d,i[o+5]=s+h,i[o+6]=c-d,i[o+10]=s-h,i[o+11]=c+d,i[o+15]=s+h,i[o+16]=c+d;a[o+4]=e.color._val,a[o+9]=e.color._val,a[o+14]=e.color._val,a[o+19]=e.color._val},d.prototype.step=function(e){e=e>cc.director._maxParticleDeltaTime?cc.director._maxParticleDeltaTime:e;var t=this.sys,n=t.node,o=this.particles,r=4*this.sys._assembler._vfmt._bytes/4,i=cc.ParticleSystem.PositionType;if(n._updateWorldMatrix(),t.positionType===i.FREE){this._worldRotation=f(n);var a=n._worldMatrix.m;s.x=a[12],s.y=a[13]}else t.positionType===i.RELATIVE?(this._worldRotation=n.angle,s.x=n.x,s.y=n.y):this._worldRotation=0;if(this.active&&t.emissionRate){var p=1/t.emissionRate;for(o.length<t.totalParticles&&(this.emitCounter+=e);o.length<t.totalParticles&&this.emitCounter>p;)this.emitParticle(s),this.emitCounter-=p;this.elapsed+=e,-1!==t.duration&&t.duration<this.elapsed&&t.stopSystem()}var d=t._assembler.getBuffer(),g=o.length;d.reset(),d.request(4*g,6*g),g>this._uvFilled&&this.updateUVs();for(var y=0;y<o.length;){c.x=c.y=l.x=l.y=u.x=u.y=0;var v=o[y];if(v.timeToLive-=e,v.timeToLive>0){if(t.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY){var m=u,S=c,_=l;(v.pos.x||v.pos.y)&&(S.set(v.pos),S.normalizeSelf()),_.set(S),S.mulSelf(v.radialAccel);var b=_.x;_.x=-_.y,_.y=b,_.mulSelf(v.tangentialAccel),m.set(S),m.addSelf(_),m.addSelf(t.gravity),m.mulSelf(e),v.dir.addSelf(m),m.set(v.dir),m.mulSelf(e),v.pos.addSelf(m)}else v.angle+=v.degreesPerSecond*e,v.radius+=v.deltaRadius*e,v.pos.x=-Math.cos(v.angle)*v.radius,v.pos.y=-Math.sin(v.angle)*v.radius;var T=v.preciseColor,C=v.deltaColor;T.r+=C.r*e,T.g+=C.g*e,T.b+=C.b*e,T.a+=C.a*e;var E=v.color;E.r=T.r,E.g=T.g,E.b=T.b,t.opacityInOutSpeed>0?v.opacityInOutDir?(v.timeOpacityFx-=e*t.opacityInOutSpeed,v.timeOpacityFx<=0&&(v.timeOpacityFx=0,v.opacityInOutDir=!1),E.a=v.timeOpacityFx/t.opacityInOutDuration/2*t._startColor.a):(v.timeOpacityFx+=e*t.opacityInOutSpeed,v.timeOpacityFx>=t.opacityInOutDuration/2&&(v.timeOpacityFx=t.opacityInOutDuration/2,v.opacityInOutDir=!0),E.a=v.timeOpacityFx/t.opacityInOutDuration/2*t._startColor.a):E.a=T.a,t.zoomInOutSpeed>0?(v.timeLiveFx+=e*t.zoomInOutSpeed,v.size=Math.abs(this.easing(v.timeLiveFx)/t.zoomInOutIntensity*v.startS)+v.endSize):v.size+=v.deltaSize*e,v.size<0&&(v.size=0),v.rotation+=v.deltaRotation*e;var w=c;w.set(v.pos),t.positionType!==i.GROUPED&&w.addSelf(v.startPos);var L=r*y;this.updateParticleBuffer(v,w,d,L),++y}else{var R=o[y];y!==o.length-1&&(o[y]=o[o.length-1]),h.put(R),o.length--}}t._assembler._ia._count=6*o.length,o.length>0?d.uploadData():this.active||this.readyToPlay||(this.finished=!0,t._finishedSimulation())},n.default=d,cc._RF.pop()},{}]},{},["IAudioEnabledChangable","IDataStoragable","IFirstFrameReady","IGameReady","IHighScoreSender","IParseSongListConfig","IPauseAndResumeable","IUnlockFrameChecker","AudioManager","BoolClass","AudioCustom","AvatarItem","AvatarTab","EnhancedLoading","FireflyEffect","FrameItem","FrameTab","HighlightNoteEffect","HoldTileEffect","LabelController","LeaderBoardItemView","LeaderBoardTab","LongTile","MainSongTab","MarqueeLayout","MenuToggle","MenuToggleItem","MutilResolutionAdapter","PCGameplayKeyboard","Particle2DControl","ParticleControl","InOutParticleSysytem","particle-simulator","PointGroup","ProfileNameTab","Rotator","ScaleToFill","ShortTile","SlideTile","SongItemView","SongPlayAnimation","ThemeController","ThemeItem","Tile","TileBase","TileStart","UserProfileHeader","VirtualScrollView","YtGame","ConfigManager","BackgroundController","BaseSceneController","CameraController","CosmeticController","FirestoreManager","GamePlaySceneController","GameplayController","HapticController","HeartController","HomeSceneController","InfoController","LoadingController","MainController","PCGameplayTutorialController","ProfileSceneController","ProgressBarControllers","ResultSceneController","StarController","StartController","ToolController","TutorialSceneController","GameConfig","GameData","UserData","Defines","FollowNode","GM","GameEvent","GameManager","DeadZone","GameplayResult","Counter","EffectController","NoteProgress","Convert","Countdown","Global","GenObs","GlobalDefines","DeviceSetting","GraphicsShowMesh","DefaultAudioEnabledChange","DefaultDataStoragable","DefaultFirstFrameReady","DefaultGameReady","DefaultHighScoreSender","DefaultPauseAndResume","FromJsonToSongConfig","FromTsvToSongConfig","RuntimeData","UnlockFrameByLevelChecker","UnlockFrameBySongChallenge","UserDataService","LeaderBoardManager","MusicPlayer","NakamaManager","PreviewSongManager","ProfileManager","ResourcesManager","SceneManager","SongChallengeManager","SongListManager","ThemeManager","TileManager","Time","ToolTipController","GameUtils","KeyedDictionary","NoteProgressController","YoutubeManager"]);