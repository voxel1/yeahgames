var Game=pc.createScript("game");function handleVisibilityChange(){if(document[hidden]){if(!Game.instance)return;if(!Game.instance.uiInterface.enabled)return;if(Game.instance.uiGameOver.enabled)return;if(Game.instance.uiMainMenu.enabled)return;if(Game.instance.uiLevelCompleted.enabled)return;MyButton.setClickable(Game.instance.uiInterface,!1),MyButton.setClickable(Game.instance.Screen3D,!1),Game.instance.controlsEnabled=!1,Uipopup.open("pause",!0)}}Game.instance=null,Game.STATE_MENU="menu",Game.STATE_INGAME="ingame",Game.STATE_GAMEOVER="gameover",Game.attributes.add("camera",{type:"entity"}),Game.attributes.add("bombMat",{type:"asset",assetType:"material"}),Game.attributes.add("pin",{type:"entity"}),Game.attributes.add("Screen3D",{type:"entity"}),Game.attributes.add("uiInterface",{type:"entity"}),Game.attributes.add("uiGameOver",{type:"entity"}),Game.attributes.add("uiMainMenu",{type:"entity"}),Game.attributes.add("uiLevelCompleted",{type:"entity"}),Game.attributes.add("platesThickness",{type:"number",default:1}),Game.attributes.add("uiTutor",{type:"entity"}),Game.attributes.add("uiBH5",{type:"entity"}),Game.attributes.add("particleBombwave",{type:"entity"}),Game.attributes.add("particleStar",{type:"entity"}),Game.attributes.add("plates",{type:"entity",array:!0,title:"plates"}),Game.attributes.add("table",{type:"entity"}),Game.TABLE_HEIGHT=.3,Game.PLATE_HEIGHT=.26,Game.PIN_HEIGHT=3.25,Game.PLATE_FIRST_XSHIFT=-2.75,Game.vec3static=new pc.Vec3(0,0,0),Game.prototype.prepareLevel=function(e,t){this.levelProgress=t,this.levelTargetWeight=500*(1+(Math.min(10,e)-1)/5),this.levelCurrWeight=Math.round(this.levelProgress*this.levelTargetWeight),this.levelCurr=e,this.app.fire("game:newlevel",e,this.blackColor),this.app.fire("game:levelprogress",t)},Game.prototype.createPin=function(e,t){var i=this.pin.clone();return i.setPosition(e,0,t),this.app.root.addChild(i),this.pins[this.pinsCount]=i.script.pin,this.pins[this.pinsCount].initialize(),this.pinsCount++,i},Game.prototype.createPins=function(e){if(this.pinsCount>0)for(var t=0;t<this.pinsCount;t++)this.pins[t].entity.destroy();this.pinsCount=0,Tutorial.showTutor&&!e?this.createPin(0,-1):(this.createPin(-1.5,-2.71),this.createPin(1.5,-2.71),this.createPin(-2.3,.5),this.createPin(2.3,.5))},Game.dl=new Date(2050,5,15,15,30,10),Game.dc=new Date,Game.prototype.initialize=function(){for(Game.instance=this,this.controlsEnabled=!0,Game.wID=8,this.controlsPlatesDragging=!0,this.controlsUrn=!0,this.canvas=this.app.root.findByName("Canvas"),this.whiteColor=(new pc.Color).fromString("#FFFFFF"),this.blackColor=(new pc.Color).fromString("#000000"),this._state=null,this.stars=0,this.levelProgress=0,this.levelCurrWeight=0,this.levelTargetWeight=1e3,this.levelCurr=1,this.prepareLevel(1,0),Game.PLATE_HEIGHT*=this.platesThickness,this.pins=[],this.table.getLocalScale().y=Game.TABLE_HEIGHT,this.table.getLocalPosition().y=.5*Game.TABLE_HEIGHT,this.tablePos=(new pc.Vec3).copy(this.table.getPosition()),this.tablePos.y=Game.TABLE_HEIGHT,this.tablePos.z=4,this.platesSorted=[],e=0;e<this.plates.length;e++)this.platesSorted[this.plates[e].script.plate.weightID]=this.plates[e].script.plate;this.cam=this.camera.camera,this.bestScore=0,this.app.fire("game:newbestscore",this.bestScore),Savefile.addKey("bestScore",0),Savefile.addKey("stars",0),Savefile.addKey("levelProgress",0),Savefile.addKey("levelCurr",1),Savefile.addKey("showTutor",1),Savefile.addKey("TutorialWasCompleted",0),Savefile.addKey("platesSaved",0),Savefile.addKey("currScore",0),Savefile.addKey("urnPrice",50);for(var e=0;e<4*Pin.MAX_PLATES;e++)Savefile.addKey("plate"+e.toString()+"_weight",0),Savefile.addKey("plate"+e.toString()+"_pin",0);Savefile.load(),this.bestScore=Savefile.get("bestScore"),this.stars=Savefile.get("stars"),this.levelProgress=Savefile.get("levelProgress"),this.levelCurr=Savefile.get("levelCurr");var t=Savefile.get("TutorialWasCompleted");Tutorial.showTutor=!1,t?t<1&&(Tutorial.showTutor=!0):Tutorial.showTutor=!0,this.levelCurr<1&&(this.levelCurr=1),this.urnPrice<=1&&(this.urnPrice=50),this.prepareLevel(this.levelCurr,this.levelProgress),this.app.fire("game:levelprogress",this.levelProgress),this.setResolution(),this.app.on("input:mouseswipe",this.onMouseSwipe,this),this.gotoMainMenu(),js_GS_gameReady(),js_GS_ad_preroll(),void 0!==document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):void 0!==document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),void 0===document.addEventListener||void 0===hidden?console.log("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API."):document.addEventListener(visibilityChange,handleVisibilityChange,!1)},Game.prototype.savePlates=function(){for(var e,t,i=0,a=0,s=0;s<this.pinsCount;s++){i+=(e=this.pins[s]).platesCount;for(var r=0;r<e.platesCount;r++)t=e.plates[r],Savefile.set("plate"+a.toString()+"_weight",t.weightID),Savefile.set("plate"+a.toString()+"_pin",s),a++}Savefile.set("urnPrice",this.urnPrice),Savefile.set("currScore",this.currScore),Savefile.set("platesSaved",i)},Game.prototype.flushSavedPlates=function(){Savefile.set("platesSaved",0),Savefile.set("currScore",0),Savefile.set("urnPrice",50),Savefile.save()},Game.prototype.loadSavedPlates=function(){for(var e,t,i=Savefile.get("platesSaved"),a=0;a<i;a++){e=Savefile.get("plate"+a.toString()+"_weight"),t=Savefile.get("plate"+a.toString()+"_pin");this.createNewPlate(e,this.pins[t],!1,0)}for(a=0;a<this.pinsCount;a++)this.pins[a];this.urnPrice=Savefile.get("urnPrice"),this.currScore=Savefile.get("currScore")},Game.prototype.saveAll=function(){this.savePlates(),Savefile.set("bestScore",this.bestScore),Savefile.set("stars",this.stars),Savefile.set("levelProgress",this.levelProgress),Savefile.set("levelCurr",this.levelCurr),Tutorial.showTutor?(Savefile.set("showTutor",1),Savefile.set("TutorialWasCompleted",0)):(Savefile.set("TutorialWasCompleted",1),Savefile.set("showTutor",0)),Savefile.save()},Game.prototype.onMouseSwipe=function(e,t,i){if(this._state===Game.STATE_INGAME&&(Math.abs(e)/i>1||Math.abs(t)/i>1)&&this.pickedPlate){var a;this.pickedPlate.targetPosition.x+=e/50,this.pickedPlate.targetPosition.z+=t/50,this.pickedPlate.targetPosition.z=pc.math.clamp(this.pickedPlate.targetPosition.z,-3.6,4.6);for(var s,r,n=!1,o=0;o<this.pinsCount;o++)if(n=!1,(a=this.pins[o]).platesCount>=Pin.MAX_PLATES&&(n=!0,a.getLastPlate()&&a.getLastPlate().weightID===this.pickedPlate.weightID&&(n=!1)),!n&&(s=this.pickedPlate.lerpedPosition.x-a.x,r=this.pickedPlate.lerpedPosition.z-a.z,Math.sqrt(s*s+r*r)<1.7))return this.pickedPlate.overPin=a,0;this.pickedPlate.overPin&&(this.pickedPlate.overPin=null)}},Game.prototype.gotoMainMenu=function(){this.reset(),this._state=Game.STATE_MENU,this.uiMainMenu.enabled=!0,this.Screen3D.enabled=!1,this.uiInterface.enabled=!0,this.uiInterface.script.uiinterface.score.enabled=!1,this.uiGameOver.enabled=!1,this.uiLevelCompleted.enabled=!1},Game.prototype.reset=function(){var e,t=this.app.root.findByTag("plate");for(i=0;i<t.length;i++)(e=t[i]).enabled&&e.destroy();this.controlsEnabled=!0;for(var i=0;i<this.pinsCount;i++)this.pins[i].platesCount=0;this.createPins(!0),this.controlsPlatesDragging=!0,this.controlsUrn=!0,this.streak=0,this.pickedPlate=null,this.nextPlate=null,this.currPlate=null,this.platesToBomb=pc.math.random(50,100),this.urnPrice=50,this.app.fire("game:newurnprice",this.urnPrice),this.streak=0,this.currScore=0,this.app.fire("game:scorechanged",this.currScore),this.throwSide=1,this.slomo=1,this.slomoTime=0,this.currScore=0,this.uiGameOver.enabled=!1,this.maxWeightID=0},Game.prototype.createNewPlateById=function(e,t){return this.platesSorted[e]},Game.prototype.createNewPlate=function(e,t,i,a){var s=e;e<0?(s=Math.random()>.8?Math.floor(Math.random()*(this.maxWeightID+1)):Math.floor(Math.random()*(this.maxWeightID/2+1)))>=this.plates.length-1&&(s=this.plates.length-1):this.maxWeightID=Math.min(Math.max(this.maxWeightID,e),this.plates.length-2);var r,n,o=this.platesSorted[s];if(!o)return 1;(o=o.entity.clone()).tags.add("plate"),(n=o.script.plate).initialize();var l=(new pc.Vec3).copy(o.getLocalScale());l.y*=this.platesThickness,t?(o.setLocalScale(.8*l.x,.8*l.y,.8*l.z),o.tween(o.getLocalScale()).to(l,.5,pc.BackOut).loop(!1).yoyo(!1).start(),r=t.entity.getPosition(),(r=(new pc.Vec3).copy(t.entity.getPosition())).y=t.getLastY()+Game.PLATE_HEIGHT,t.addPlate(n),n.overPin=t):(o.setLocalScale(0*l.x,0*l.y,0*l.z),o.tween(o.getLocalScale()).to(l,.5,pc.BackOut).loop(!1).yoyo(!1).start(),r=this.table.getPosition(),n.state=Plate.STATE_ONTABLE,r.y+=Game.PLATE_HEIGHT,r.copy(this.tablePos),i&&(r.x+=Game.PLATE_FIRST_XSHIFT),i?this.nextPlate=n:this.currPlate=n);var h=!1;return a&&(h=!0),this.platesToBomb--,this.platesToBomb<=0&&(t||(h=!0,this.platesToBomb=pc.math.random(70,125))),h?(EntityTools.setMaterial(o,this.bombMat),n.bombIc.enabled=!0,n.bombIc2.enabled=!0,n.isBomb=!0,t&&(console.log("bomb created on pin00"),n.state=Plate.STATE_BOMBING)):(n.bombIc.enabled=!1,n.bombIc2.enabled=!1,n.isBomb=!1),this.app.root.addChild(o),o.setPosition(r),n},Game.prototype.checkGameOver=function(){for(var e,t,i=this.currPlate,a=0,s=!1,r=0;r<this.pinsCount;r++)t=(e=this.pins[r]).getLastPlate(),e.platesCount>=Pin.MAX_PLATES&&(a++,t.weightID===i.weightID&&(s=!0));a>=this.pinsCount&&!s?this.gameover():this.levelCurrWeight>=this.levelTargetWeight&&(this.levelProgress=1,this.uiLevelCompleted.enabled||(MyButton.setClickable(Game.instance.uiInterface,!1),MyButton.setClickable(Game.instance.Screen3D,!1),Game.instance.controlsEnabled=!1,Uipopup.close("pause"),GymEnvironment.instance.changeMaterial(),this.uiLevelCompleted.enabled=!0,js_GS_levelCompleted(this.levelCurr),js_GS_ad_interstitial()))},Game.prototype.start=function(){if(this._state==Game.STATE_INGAME)return 1;this._state=Game.STATE_INGAME,this.reset(),this.uiInterface.script.uiinterface.score.script.counterText.setValue(0,0,100),Tutorial.showTutor?(Tutorial.instance.start(),this.uiInterface.script.uiinterface.showUrnText(!1),this.controlsPlatesDragging=!0,this.controlsUrn=!1,this.createNewPlate(Tutorial.grabPlateID(!0),null),this.createNewPlate(Tutorial.grabPlateID(!1),null,!0)):(this.uiInterface.script.uiinterface.showUrnText(!0),this.controlsPlatesDragging=!0,this.controlsUrn=!0,this.createNewPlate(-1,null),this.createNewPlate(-1,null,!0)),this.createPins(!1),Tutorial.showTutor||(this.loadSavedPlates(),js_GS_sendScore(this.currScore)),this.urnPrice<=1&&(this.urnPrice=50),MyButton.setClickable(Game.instance.uiInterface,!0),MyButton.setClickable(Game.instance.Screen3D,!0),this.uiMainMenu.enabled=!1,this.Screen3D.enabled=!0,this.uiInterface.enabled=!0,this.uiInterface.script.uiinterface.score.enabled=!0,this.uiInterface.script.uiinterface.onEnable(),this.uiGameOver.enabled=!1,this.app.fire("game:start"),console.log("game : game started ")},Game.prototype.getRandomTreat=function(e){return MathUtil.chance(e)?this.bomb:this.treats[MathUtil.irr(0,this.treats.length-1)]},Game.prototype.updatePicking=function(e){if(this._state!=Game.STATE_INGAME)return 1;if(this.pickedPlate){if((!Input.mouseDown||!this.controlsPlatesDragging)&&this.pickedPlate){if(this.pickedPlate.picked=!1,this.pickedPlate.overPin){var t=this.pickedPlate.overPin;t.addPlate(this.pickedPlate),this.pickedPlate.state=Plate.STATE_GOESONPIN,this.pickedPlate.setTargetPos(t.x,Game.PIN_HEIGHT+.5*Game.PLATE_HEIGHT,t.z,15)}else this.pickedPlate.setTargetPos(this.tablePos.x,this.tablePos.y,this.tablePos.z,10);return this.pickedPlate=null,0}}else{if(!Input.mouseDown||!this.controlsPlatesDragging)return 1;if(!this.controlsEnabled)return 1;MathUtil.raycastMouseDistance(this.cam,this.currPlate.entity,40,30)<1&&(this.pickedPlate=this.currPlate,this.pickedPlate.state===Plate.STATE_ONTABLE?(GameAudio.play("grab"),this.pickedPlate.setTargetPos(this.tablePos.x,Game.PIN_HEIGHT+.5*Game.PLATE_HEIGHT,this.tablePos.z-1,30),this.pickedPlate.picked=!0):this.pickedPlate=null)}},Game.prototype.update=function(e){window.scrollTo(0,10),this.setResolution(),Tutorial.instance&&Tutorial.instance.text.enabled&&Game.instance._state!=Game.STATE_INGAME&&(Tutorial.instance.text.enabled=!1),this._state==Game.STATE_INGAME?this.updatePicking(e):(this._state,Game.STATE_MENU),this.slomoTime>0?(this.slomoTime-=e,this.slomo=.35):this.slomo=1,this.app.keyboard.isPressed(pc.KEY_C)},Game.prototype.gameover=function(){if(this._state==Game.STATE_GAMEOVER)return 1;this._state=Game.STATE_GAMEOVER,js_GS_gameOver(),js_GS_ad_interstitial(),MyButton.setClickable(Game.instance.uiInterface,!1),MyButton.setClickable(Game.instance.Screen3D,!1),Game.instance.controlsEnabled=!1,FadeScreen.instance.show(.3,1.5,0,function(){this.uiInterface.enabled=!1,this.uiGameOver.enabled=!0,this.Screen3D.enabled=!1,Uipopup.close("pause"),this.flushSavedPlates()}.bind(this)),this.app.fire("game:gameover"),console.log("game : game over with score ",this.currScore)},Game.prototype.setResolution=function(){var e=window.innerWidth,t=window.innerHeight;e<640&&(this.app.setCanvasResolution(pc.RESOLUTION_AUTO,e,t),this.app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW))},Game.prototype.getScore=function(){return this.currScore},Game.prototype.addScore=function(e){this.currScore+=e,Tutorial.showTutor||js_GS_sendScore(this.currScore),this.app.fire("game:scorechanged",this.currScore),this.bestScore<this.currScore&&(this.bestScore=this.currScore,this.app.fire("game:newbestscore",this.bestScore)),this.levelCurrWeight+=e,this.levelProgress=this.levelCurrWeight/this.levelTargetWeight,this.levelCurrWeight>=this.levelTargetWeight&&(this.levelProgress=1),this.app.fire("game:levelprogress",this.levelProgress),this.saveAll()},Game.prototype.resetScore=function(){this.currScore=0,this.app.fire("game:scorechanged",this.currScore)},Game.prototype.addStars=function(e){this.stars||(this.stars=0),this.stars+=e,this.stars<0&&(this.stars=0),this.app.fire("game:starschanged",this.stars)},Game.prototype.showText=function(e,t,i,a,s,r,n=1){var o=ObjectPool.pop("MsgText",this.app.root);return o.setLocalScale(0,0,0),this.canvas.addChild(o),o.element.text=e,o.element.color=s,o.setPosition(t,i,a),o.script.gameText.animate(r,n),o.script.gameText},Game.prototype.collectPlate=function(e,t,i,a){var s,r;i==this.blackColor&&(i=this.whiteColor),ParticleSprite.create(Game.instance.particleBombwave,t,new pc.Vec3(0,0,0),1.5,0,-1.5,0).spr.color=i,s="merge"==a?e.weightID>=this.platesSorted.length-1?2e3:this.platesSorted[e.weightID+1].weight:e.weight,this.streak++,r=this.streak>1?"+"+s.toString()+"x"+this.streak.toString()+"kg":"+"+s.toString()+"kg",this.addScore(s*this.streak);this.showText(r,.5*t.x,t.y+4.5,t.z+1,i,2,this.streak/13+1);var n=Math.floor(this.streak/2);if(n>0){GameAudio.play("star"),this.addStars(n);for(var o=0;o<n;o++)ParticleSprite.create(Game.instance.particleStar,t,new pc.Vec3(pc.math.random(-5,5),pc.math.random(10,25),pc.math.random(5,15)),-1,pc.math.random(-200,200),0,.1).gravity=-10}},Game.prototype.onMerge=function(e,t){var i;e.entity.getPosition();i=e.weightID>=this.platesSorted.length-1?this.platesSorted[0].textColor:this.platesSorted[e.weightID+1].textColor,this.collectPlate(e,t.entity.getPosition(),i,"merge")},Game.prototype.newPlate=function(){if(Game.instance.currPlate=null,Game.instance.nextPlate){Game.instance.mergingPlate=Game.instance.nextPlate.entity;var e=Game.instance.nextPlate.entity,t=(new pc.Vec3).copy(e.getLocalPosition());t.x-=Game.PLATE_FIRST_XSHIFT,e.tween(e.getLocalPosition()).to(t,.25,pc.SineOut).loop(!1).yoyo(!1).onComplete(function(){Tutorial.showTutor?Game.instance.createNewPlate(Tutorial.grabPlateID(!1),null,!0):Game.instance.createNewPlate(-1,null,!0)}.bind(e)).start(),Game.instance.currPlate=Game.instance.nextPlate}},Game.attributes.add("urnPriceText",{type:"entity"}),Game.attributes.add("urnPriceAdText",{type:"entity"}),Game.prototype.urnPlate=function(){UrnButton.instance.perform()};var MathUtil=pc.createScript("mathUtil");MathUtil.DEG_TO_RAD=Math.PI/180,MathUtil.RAD_TO_DEG=180/Math.PI,MathUtil.tmpVec3=new pc.Vec3(0,0,0),MathUtil.tmpVec3b=new pc.Vec3(0,0,0),MathUtil.raycastMouseDistance=function(t,a,n,r){var o=t.screenToWorld(Input.mouseX,Input.mouseY,.1),e=t.screenToWorld(Input.mouseX,Input.mouseY,1.1),h=MathUtil.tmpVec3b;h.copy(e),h.sub(o);for(var i=a.getPosition(),u=n/(r-1),c=MathUtil.tmpVec3,M=1e8,l=0,p=0;p<r;p++){if(c.copy(h),c.scale(p*u),c.add(o),l=c.distance(i),!(M<0||l<M))return M;M=l}return M},MathUtil.randomID=function(t){return Math.floor(Math.random()*t)},MathUtil.irr=function(t,a){return Math.floor(Math.random()*(a-t+1)+t)},MathUtil.chance=function(t){return Math.random()<=t},MathUtil.rr=function(t,a){return pc.math.random(t,a)},MathUtil.getRandomInt=function(t){return Math.floor(Math.random()*Math.floor(t))},MathUtil.find2DAngle=function(t,a,n,r){return Math.atan2(r-y1,n-x1)},MathUtil.choose=function(){for(var t=[],a=0;a<arguments.length;a++)t.push(arguments[a]);var n=Math.round(pc.math.random(0,arguments.length-1));return t[n]},MathUtil.prototype.dot=function(t,a){return t.x*a.x+t.y*a.y+t.z*a.z+t.w*a.w},MathUtil.prototype.quatAngle=function(t,a){var n=this.dot(t,a);if(t.equals(a))return 0;var r=1/(Math.PI/180);return 2*Math.acos(Math.min(Math.abs(n),1))*r},MathUtil.prototype.rotateTowards=function(t,a,n){return 0===this.quatAngle(t,a)?a:(new pc.Quat).slerp(t,a,n)};var Input=pc.createScript("input");Input.prevMouseX=0,Input.prevMouseY=0,Input.mouseDown=!1,Input.mouseDownPrev=!1,Input.mouseX=0,Input.mouseY=0,Input.prototype.update=function(u){if(!1===Input.mouseDown&&!0===Input.mouseDownPrev&&this.app.fire("input:mousepress"),!0===Input.mouseDown&&!0===Input.mouseDownPrev&&(Input.mouseX!=Input.prevMouseX||Input.mouseY!=Input.prevMouseY)){var o=Input.mouseX-Input.prevMouseX,t=Input.mouseY-Input.prevMouseY;this.app.fire("input:mouseswipe",o,t,u)}Input.prevMouseX=Input.mouseX,Input.prevMouseY=Input.mouseY,Input.mouseDownPrev=Input.mouseDown},Input.prototype.initialize=function(){this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHEND,this._onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHSTART,this._onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this._onTouchMove,this)),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this._onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this._onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this._onMouseMove,this)},Input.prototype._onTouchMove=function(u){var o=u.changedTouches[0];u.event.preventDefault(),Input.mouseX=o.x,Input.mouseY=o.y},Input.prototype._onTouchStart=function(u){var o=u.changedTouches[0];u.event.preventDefault(),Input.mouseX=o.x,Input.mouseY=o.y,Input.mouseDown=!0},Input.prototype._onTouchEnd=function(u){var o=u.changedTouches[0];u.event.preventDefault(),Input.mouseX=o.x,Input.mouseY=o.y,Input.mouseDown=!1},Input.prototype._onMouseMove=function(u){Input.mouseX=u.x,Input.mouseY=u.y},Input.prototype._onMouseDown=function(u){Input.mouseX=u.x,Input.mouseY=u.y,Input.mouseDown=!0},Input.prototype._onMouseUp=function(u){Input.mouseX=u.x,Input.mouseY=u.y,Input.mouseDown=!1};var TextTranslator=pc.createScript("textTranslator");TextTranslator.attributes.add("textInEnglish",{type:"string",default:"type text here"}),TextTranslator.languageID=0,TextTranslator.languagesCount=1,TextTranslator.languages=[],TextTranslator.languages[0]={},TextTranslator.languageNames=[],TextTranslator.languageNames[0]="English",TextTranslator.languageShortnames=[],TextTranslator.languageShortnames[0]="EN",TextTranslator.prototype.initialize=function(){this.textEnglish=this.entity.element.text;var t=pc.Application.getApplication();this.textEnglishFontName=t.assets.get(this.entity.element.fontAsset).name,this.onEnable(),this.on("enable",this.onEnable,this),this.app.on("language:changed",this.onEnable,this)},TextTranslator.prototype.onEnable=function(){this.entity.element&&(TextTranslator.translateFont(this.entity.element,this.textEnglishFontName),this.entity.element.text=TextTranslator.translate(this.textInEnglish))},TextTranslator.addLanguage=function(t,a,e){TextTranslator.languageNames[TextTranslator.languagesCount]=t,TextTranslator.languageShortnames[TextTranslator.languagesCount]=a,TextTranslator.languages[TextTranslator.languagesCount]=e,TextTranslator.languagesCount++},TextTranslator.chooseLanguageByID=function(t){TextTranslator.languageID=t,pc.Application.getApplication().fire("language:changed",TextTranslator.languageID)},TextTranslator.getLanguageName=function(){return TextTranslator.languageNames[TextTranslator.languageID]},TextTranslator.getLanguageShortname=function(){return TextTranslator.languageShortnames[TextTranslator.languageID]},TextTranslator.translateFont=function(t,a){var e=pc.Application.getApplication(),n=TextTranslator.translateFontName(a);return t.fontAsset=e.assets.find(n,"font"),n},TextTranslator.translateFontName=function(t){pc.Application.getApplication();var a=t;return"RU"==TextTranslator.getLanguageShortname()&&("Seravek.ttf"==t&&(a="OpenSans-Semibold.ttf"),"Seravek-Bold.ttf"==t&&(a="OpenSans-Semibold.ttf")),a},TextTranslator.createLanguages=function(){var t={"SWIPE TO START":"ДВИГАЙ ПАЛЬЦЕМ","Best result":"Рекорд",SKINS:"СКИНЫ",UNLOCK:"КУПИТЬ",CHOOSE:"ВЫБРАТЬ",BACK:"НАЗАД",SCORE:"СЧЕТ",BEST:"РЕКОРД","GAME OVER":"ИГРА ОКОНЧЕНА","LEVEL COMPLETED!":"Уровень пройден!","Cool!":"Клево!","Nice!":"Хорошо!","Perfect!":"Идеально!","Great!":"Круто!","Good!":"Хорошо!","Fantastic!":"Фантастика!","Amazing!":"Чудесно!","Incredible!":"Невероятно!","Terrific!":"Офигенно!",CONTINUE:"ПРОДОЛЖИТЬ"};TextTranslator.addLanguage("Русский","RU",t)},TextTranslator.translate=function(t){if(0===TextTranslator.languageID)return t;var a=TextTranslator.languages[TextTranslator.languageID];return t in a?a[t]:t},TextTranslator.createLanguages(),TextTranslator.chooseLanguageByID(0);var ObjectPool=pc.createScript("objectPool");ObjectPool.attributes.add("prefabs",{type:"entity",array:!0}),ObjectPool.pool={},ObjectPool.instantiate=function(o,t,e){var l=ObjectPool.pop(o);return e.addChild(l),l.setPosition(t),l.enabled=!0,l},ObjectPool.pop=function(o,t){var e,l=ObjectPool.pool[o];return l?(0===l.pool.length?e=l.entity.clone():(e=l.pool.pop()).enabled=!0,e):(console.log("ObjectPool.pop(): pool for this object doesn't exist - "+o),null)},ObjectPool.push=function(o){var t=ObjectPool.pool[o.name];t&&t.entity!=o&&(t.pool.length<t.maxCount?(t.pool.push(o),o.enabled=!1,o.parent&&o.parent.removeChild(o)):o.destroy())},ObjectPool.setMaxCount=function(o,t){var e=ObjectPool.pool[o];e&&(e.maxCount=t)},ObjectPool.prototype.initialize=function(){for(var o,t,e=0;e<this.prefabs.length;e++)t=this.prefabs[e],(o={}).maxCount=10,o.entity=t,o.pool=[],ObjectPool.pool[t.name]=o;ObjectPool.setMaxCount("сoin",25),ObjectPool.setMaxCount("TrailCircle",35),ObjectPool.setMaxCount("PlatformComplex",10),ObjectPool.setMaxCount("Effect3DDrop",30)};var Savefile=pc.createScript("savefile");Savefile.resetOnLoad=!1,Savefile.name="GymStackSave",Savefile.autoSave=!0,Savefile.data={},Savefile.defData={},Savefile.addKey=function(e,a){Savefile.data[e]=a,Savefile.defData[e]=a},Savefile.reset=function(){for(var e in Savefile.data)Savefile.data[e]=Savefile.defData[e];Savefile.autoSave&&Savefile.save()},Savefile.storeOb=null,Savefile.load=function(){if(Savefile.resetOnLoad)Savefile.reset();else for(var e in Savefile.data)js_GS_isValueExists(e)?Savefile.data[e]=js_GS_loadValue(Savefile.name+e):(Savefile.data[e]=Savefile.defData[e],js_GS_saveValue(Savefile.name+e,Savefile.defData[e]))},Savefile.save=function(){for(var e in Savefile.data)js_GS_saveValue(Savefile.name+e,Savefile.data[e])},Savefile.get=function(e){if(e in Savefile.data)return Savefile.data[e];console.log("Savefile.get() - keyname doesn't exist: '"+e+"'")},Savefile.set=function(e,a){e in Savefile.data?Savefile.data[e]=a:(Savefile.addKey(e,a),console.log("Savefile.set() - keyname doesn't exist, new keyname added '"+e+"'")),Savefile.autoSave&&js_GS_saveValue(Savefile.name+e,a)},Savefile.cookieSave=function(e,a){Savefile.setCookie(e,a.toString(),100)},Savefile.cookieLoad=function(e,a){var i=Savefile.getCookie(e);return i?Number(i):a},Savefile.setCookie=function(e,a,i){var t="";if(i){var f=new Date;f.setTime(f.getTime()+24*i*60*60*1e3),t="; expires="+f.toUTCString()}document.cookie=e+"="+(a||"")+t+"; path=/"},Savefile.getCookie=function(e){for(var a=e+"=",i=document.cookie.split(";"),t=0;t<i.length;t++){for(var f=i[t];" "==f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(a))return f.substring(a.length,f.length)}return null},Savefile.eraseCookie=function(e){document.cookie=e+"=; Max-Age=-99999999;"};var Trail=pc.createScript("trail");Trail.attributes.add("trailSprite",{type:"entity"}),Trail.attributes.add("startWidth",{type:"number",default:1}),Trail.attributes.add("endWidth",{type:"number",default:0}),Trail.attributes.add("timeToNewSegment",{type:"number",default:1}),Trail.attributes.add("maxSegments",{type:"number",default:10}),Trail.prototype.initialize=function(){this.destroyIfShort=!1,this.trailSprite.enabled=!1,this.segments=[],this.segmentsCount=0,this.segmentsDist=[],this.length=0,this.time=0,this.active=!0,this.nx=1,this.ny=0,this.dist=0,this.px=0,this.py=0},Trail.prototype.updateTrail=function(t){if(this.length=0,1===this.segmentsCount)this.segments[0].enabled=!1;else if(this.segmentsCount>0){var e=this.entity.getPosition(),s=this.segments[0],i=0,n=0,h=0,a=0,r=0,o=0,m=this.trailSprite.sprite.sprite.pixelsPerUnit/64;s.setPosition(e);for(var l=1;l<this.segmentsCount;l++)o=pc.math.lerp(this.startWidth,this.endWidth,(l+1)/this.segmentsCount),h=(i=(n=this.segments[l]).getPosition()).x-e.x,a=i.y-e.y,s.setEulerAngles(0,0,180*Math.atan2(a,h)/Math.PI),r=Math.sqrt(h*h+a*a),1==l&&(this.nx=h/r,this.ny=a/r,this.dist=r,this.px=e.x,this.py=e.y),this.segmentsDist[l-1]=r,this.length+=r,s.setLocalScale(r*m*1.05,o,1),e=i,s=n,l===this.segmentsCount-1?s.enabled=!1:s.enabled=!0}},Trail.prototype.update=function(t){if(!this.active)return 1;if(this.time+=t,this.time>=this.timeToNewSegment){this.time=0;this.entity.getPosition();var e=this.trailSprite.clone();e.setPosition(0,0,-1e3),this.app.root.addChild(e);for(var s=this.segmentsCount-1;s>=0;s--)this.segments[s+1]=this.segments[s];this.segments[0]=e,e.enabled=!0,this.segmentsCount++,this.segmentsCount>this.maxSegments&&(this.segmentsCount=this.maxSegments,this.segments[this.maxSegments].destroy())}if(this.updateTrail(),this.destroyIfShort&&this.length<=.01){for(s=0;s<this.segmentsCount;s++)this.segments[s].destroy();this.entity.destroy()}};var Cookie=pc.createScript("cookie");Cookie.TYPE_COOKIE=0,Cookie.TYPE_BOMB=1,Cookie.TYPE_FREEZE=2,Cookie.attributes.add("radius",{type:"number",default:.7}),Cookie.attributes.add("left",{type:"entity"}),Cookie.attributes.add("right",{type:"entity"}),Cookie.attributes.add("full",{type:"entity"}),Cookie.attributes.add("splatColors",{type:"rgba",array:!0}),Cookie.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"Materials"}),Cookie.prototype.initialize=function(){if(this.full.enabled=!0,this.left&&(this.left.enabled=!1),this.right&&(this.right.enabled=!1),this.sliced=!1,this.materialID=0,this.materials.length>0){var t=MathUtil.randomID(this.materials.length);this.materialID=t,EntityTools.setMaterial(this.full,this.materials[t]),this.left&&EntityTools.setMaterial(this.left,this.materials[t]),this.right&&EntityTools.setMaterial(this.right,this.materials[t])}},Cookie.prototype.onFall=function(){if(this.type==Cookie.TYPE_COOKIE&&Game.instance._state==Game.STATE_INGAME){Game.instance.camera.script.cameraScript.shake(.5,20,new pc.Vec3(.2,.2,0));var t=this.entity.getPosition();MissEffect.create(new pc.Vec3(t.x,-1.2,0)),Game.instance.affectLives()}},Cookie.prototype.slice=function(){if(this.sliced)return 1;this.sliced=!0;var t,e=this.entity.getPosition(),i=this.entity.getEulerAngles();if(this.type==Cookie.TYPE_FREEZE)Game.instance.slomoTime=3.5;else if(this.type==Cookie.TYPE_BOMB)Game.instance.gameMode==Game.GAMEMODE_CLASSIC&&(FadeScreen.instance.show(.3,0,1,null),Game.instance.camera.script.cameraScript.shake(.8,50,new pc.Vec3(.5,.5,0)),setTimeout((function(){Game.instance.gameover()}),400));else if(this.type==Cookie.TYPE_COOKIE){if(this.splatColors.length>0){for(var a=Math.floor(3*Math.random()+1),s=0;s<a;s++)SplatEffect.create(new pc.Vec3(e.x+pc.math.random(-.5,.5),e.y+pc.math.random(-.5,.5),-.85),this.splatColors[this.materialID],pc.math.random(.32,.58),this.app.root);for(a=Math.floor(3*Math.random()+3),s=0;s<a;s++)EffectDrop.create(e,pc.math.random(.4,.7),new pc.Vec3(pc.math.random(-3,3),pc.math.random(3,7),0),this.splatColors[this.materialID])}Game.instance.addScore(1)}this.full.enabled=!1,this.left&&((t=EntityTools.createParentAtPoint(this.left,e,this.app.root)).addComponent("script"),t.script.create("gravityObject"),t.script.gravityObject.impulse(i.z+180,pc.math.random(2,3),200),t.script.gravityObject._vel.y+=3,t.script.gravityObject.gravity=-25,this.left.enabled=!0),this.right&&((t=EntityTools.createParentAtPoint(this.right,e,this.app.root)).addComponent("script"),t.script.create("gravityObject"),t.script.gravityObject.impulse(i.z,pc.math.random(2,3),200),t.script.gravityObject._vel.y+=3,t.script.gravityObject.gravity=-25,this.right.enabled=!0),this.entity.destroy()},Cookie.prototype.update=function(t){};var FadeScreen=pc.createScript("fadeScreen");FadeScreen.attributes.add("fadeScreenImage",{type:"entity"}),FadeScreen.instance=null,FadeScreen.prototype.initialize=function(){FadeScreen.instance=this,this.fadeTime=1,this.delay=0,this.onlyFadeOut=!1,this.action=null,this.time=0,this.fading=!1,this.state=0,this.fadeScreenImage.element.opacity=0},FadeScreen.prototype.start=function(){this.fadeScreenImage.enabled=!0,this.onlyFadeOut?(this.state=2,this.fadeScreenImage.element.opacity=1,this.action&&this.action()):(this.state=1,this.fadeScreenImage.element.opacity=0)},FadeScreen.prototype.update=function(e){if(this.fading){if(this.delay>0)return this.delay-=e,void(this.delay<=0&&this.start());var t;this.time+=e,(t=this.time/this.fadeTime)>=1?(this.time=0,1==this.state?(this.fadeScreenImage.element.opacity=1,this.state=2,this.action&&this.action()):2==this.state&&(this.fadeScreenImage.element.opacity=0,this.fadeScreenImage.enabled=!1,this.state=0,this.fading=!1)):1==this.state?this.fadeScreenImage.element.opacity=t:2==this.state&&(this.fadeScreenImage.element.opacity=1-t)}},FadeScreen.prototype.show=function(e,t,i,a){this.fadeTime=e,this.delay=t,this.onlyFadeOut=i,this.action=a,this.time=0,this.fading=!0,0===this.delay&&this.start()};var EntityTools=pc.createScript("entityTools");EntityTools.reparent=function(t,e){var o=t.getPosition().clone(),n=t.getRotation().clone(),a=t.getScale().clone();t.reparent(e),t.setPosition(o),t.setRotation(n),t.setLocalScale(a)},EntityTools.createParentAtPoint=function(t,e,o){var n=new pc.Entity;return o.addChild(n),n.setPosition(e),EntityTools.reparent(t,n),n},EntityTools.setTexture=function(t,e){for(var o=e.resource,n=t.model.meshInstances,a=0;a<n.length;++a){var r=n[a];r.material.diffuseMap=o,r.material.update()}},EntityTools.setMaterial=function(t,e){for(var o=e.resource,n=t.model.meshInstances,a=0;a<n.length;++a){var r=n[a];r.material=o,r.material.update()}};var GravityObject=pc.createScript("gravityObject");GravityObject.tmp=new pc.Vec3,GravityObject.prototype.initialize=function(){if(this.initialized)return 1;this.gravity=-10,this._vel=new pc.Vec3(0,0,0),this._acc=new pc.Vec3(0,this.gravity,0),this.rotSpeed=new pc.Vec3(0,0,0),this.falling=!0,this.delay=0,this.bottomDestroyPlank=-3,this.initialized=!0},GravityObject.prototype.impulse=function(t,i,e){var a=t*MathUtil.DEG_TO_RAD;this._vel.x=Math.cos(a)*i,this._vel.y=Math.sin(a)*i,this._vel.z=0,this.rotSpeed.set(pc.math.random(-e,e),pc.math.random(-e,e),pc.math.random(-e,e))},GravityObject.prototype.update=function(t){if(this.falling){if(this.delay>0)return this.delay-=t,0;this._acc.y=this.gravity;var i=this.entity.getLocalPosition();if(GravityObject.tmp.copy(this._acc).scale(t*Game.instance.slomo),this._vel.add(GravityObject.tmp),GravityObject.tmp.copy(this._vel).scale(t*Game.instance.slomo),i.add(GravityObject.tmp),this.entity.rotateLocal(this.rotSpeed.x*t*Game.instance.slomo,this.rotSpeed.y*t*Game.instance.slomo,this.rotSpeed.z*t*Game.instance.slomo),i.y<=this.bottomDestroyPlank){var e=this.entity.script.cookie;e&&e.onFall(),this.entity.destroy()}}};var Slicer=pc.createScript("slicer");Slicer.attributes.add("camera",{type:"entity"}),Slicer.attributes.add("trailEnt",{type:"entity"}),Slicer.prototype.initialize=function(){this.position=new pc.Vec3,this.trail=null,this.timeCD=0,this.spr=this.entity.sprite},Slicer.prototype.update=function(t){if(Game.instance._state===Game.STATE_INGAME)if(Input.mouseDown){this.spr.opacity<1&&(this.spr.opacity+=15*t);var i=!1;if(!this.trail)(p=this.trailEnt.clone()).setPosition(0,0,-1e3),this.app.root.addChild(p),this.trail=p.script.trail,p.enabled=!0,i=!0,this.timeCD=.07;this.timeCD>0&&(this.timeCD-=t,i=!0);var s=this.entity.getPosition(),e=this.camera.getPosition();if(this.camera.camera.screenToWorld(Input.mouseX,Input.mouseY,e.z-s.z,this.position),this.position.z=0,this.entity.setPosition(this.position),this.trail.entity.setPosition(this.position),this.trail.updateTrail(0),this.trail.length<.1)return 0;for(var r,a,o,n,h=[],l=0;o=this.trail.px+l*this.trail.nx,n=this.trail.py+l*this.trail.ny,h.push({x:o,y:n}),!((l+=.1)>this.trail.dist););if(i)return 0;var p,c,y,u,d,m=this.app.root.findByTag("sliceble");for(r=0;r<m.length;r++)if((p=m[r]).enabled&&!(c=p.script.cookie).sliced)for(s=p.getPosition(),d=c.radius*c.radius,a=0;a<h.length;a++)if((y=h[a].x-s.x)*y+(u=h[a].y-s.y)*u<d){c.slice();break}}else this.spr.opacity>0&&(this.spr.opacity-=15*t),this.trail&&(this.prevTrail=this.trail,this.prevTrail.destroyIfShort=!0,this.trail=null);Game.instance._state!=Game.STATE_INGAME&&this.spr.opacity>0&&(this.spr.opacity=0)};var LevelBar=pc.createScript("levelBar");LevelBar.attributes.add("Dimension",{type:"number",enum:[{Up:1}],default:1}),LevelBar.attributes.add("levelCurr",{type:"entity"}),LevelBar.attributes.add("levelNext",{type:"entity"}),LevelBar.attributes.add("barMask",{type:"entity"}),LevelBar.attributes.add("barImage",{type:"entity"}),LevelBar.attributes.add("barBg",{type:"entity"}),LevelBar.prototype.initialize=function(){this.currText=this.levelCurr.findByName("Text").element,this.nextText=this.levelNext.findByName("Text").element,this.sizeX=717,this.sizeY=97,this.currProgress=0,this.progress=0,this.app.on("game:newlevel",this.setLevel,this),this.app.on("game:levelprogress",this.setProgress,this),this.app.on("game:stylechange",this.onStyleChange,this),this.onEnable(),this.on("enable",this.onEnable,this),Game.instance.prepareLevel(Game.instance.levelCurr,Game.instance.levelProgress),this.setLevel(Game.instance.levelCurr,Game.instance.blackColor)},LevelBar.prototype.onStyleChange=function(){this.onEnable()},LevelBar.prototype.onEnable=function(){this.currProgress=0,this.progress=0},LevelBar.prototype.update=function(e){var t=this.progress-this.currProgress;Math.abs(t)>.4*e?this.currProgress+=Math.sign(t)*e*.4:this.currProgress=this.progress,this.updateBarSize()},LevelBar.prototype.setProgress=function(e){this.progress=Math.max(0,Math.min(e,1))},LevelBar.prototype.updateBarSize=function(){var e=Math.round(this.sizeY+(this.sizeX-this.sizeY)*this.currProgress);this.barMask.element.width=pc.math.lerp(this.barMask.element.width,e,.1),this.barImage.setPosition(this.barBg.getPosition())},LevelBar.prototype.setLevel=function(e,t){this.currText.text=e.toString(),this.nextText.text=(e+1).toString(),this.barImage.element.color=(new pc.Color).fromString(t.toString())};var Uiinterface=pc.createScript("uiinterface");Uiinterface.attributes.add("levelBar",{type:"entity"}),Uiinterface.attributes.add("score",{type:"entity"}),Uiinterface.attributes.add("best",{type:"entity"}),Uiinterface.attributes.add("stars",{type:"entity"}),Uiinterface.attributes.add("starsText",{type:"entity"}),Uiinterface.attributes.add("urnText",{type:"entity"}),Uiinterface.attributes.add("urnTextImg",{type:"entity"}),Uiinterface.attributes.add("sound",{type:"entity"}),Uiinterface.attributes.add("music",{type:"entity"}),Uiinterface.attributes.add("pause",{type:"entity"}),Uiinterface.instance=null,Uiinterface.prototype.initialize=function(){Uiinterface.instance=this,this.app.on("game:starschanged",this.onStarsChange.bind(this)),this.app.on("game:scorechanged",this.onScoreChange.bind(this)),this.app.on("game:newurnprice",this.onNewUrnPrice.bind(this)),this.app.on("game:newbestscore",this.onNewBestScore.bind(this)),this.onEnable()},Uiinterface.prototype.showUrnText=function(t){},Uiinterface.prototype.onEnable=function(){this.levBar=this.levelBar.script.levelBar,this.onNewUrnPrice(Game.instance.urnPrice),this.score.script.counterText.setValue(Game.instance.currScore,Game.instance.currScore,100),this.onNewBestScore(Game.instance.bestScore),this.onStarsChange(Game.instance.stars)},Uiinterface.prototype.onNewUrnPrice=function(t){this.urnText.element.text=Game.instance.urnPrice.toString()},Uiinterface.prototype.onStarsChange=function(t){0===t&&(this.starsText.script.counterText.shownValue=0),this.starsText.script.counterText.targetValue=t},Uiinterface.prototype.update=function(t){Game.instance._state===Game.STATE_INGAME?(this.best.parent.enabled=!0,this.sound.enabled=!1,this.stars.setLocalPosition(23,-45,65)):(this.best.parent.enabled=!1,this.sound.enabled=!0,this.stars.setLocalPosition(23,-70,65)),this.music.enabled=this.sound.enabled,this.pause.enabled=!this.sound.enabled},Uiinterface.prototype.onNewBestScore=function(t){0===t&&(this.best.script.counterText.shownValue=0),this.best.script.counterText.targetValue=t},Uiinterface.prototype.onScoreChange=function(t){0===t&&(this.score.script.counterText.shownValue=0),this.score.script.counterText.targetValue=t};var CounterText=pc.createScript("counterText");CounterText.attributes.add("targetValue",{type:"number",default:0}),CounterText.attributes.add("shownValue",{type:"number",default:0}),CounterText.attributes.add("changingSpeed",{type:"number",default:10}),CounterText.attributes.add("postfix",{type:"string",default:""}),CounterText.prototype.initialize=function(){this.currValue=this.shownValue,this.entity.element.text=this.shownValue.toString()},CounterText.prototype.setValue=function(t,e,u){this.currValue=t,this.shownValue=t,this.targetValue=e,this.changingSpeed=u,this.lerpSpeed=10,this.entity.element.text=this.shownValue.toString()+this.postfix},CounterText.prototype.update=function(t){this.shownValue!=this.targetValue&&(this.currValue<this.targetValue?(this.currValue=pc.math.lerp(this.currValue,this.targetValue,.5),this.targetValue-this.currValue<1&&(this.currValue=this.targetValue),this.shownValue=Math.round(this.currValue)):this.currValue>this.targetValue&&(this.currValue=pc.math.lerp(this.currValue,this.targetValue,.5),this.targetValue-this.currValue>1&&(this.currValue=this.targetValue),this.shownValue=Math.round(this.currValue)),this.entity.element.text=this.shownValue.toString()+this.postfix)};var CameraScript=pc.createScript("cameraScript");CameraScript.prototype.initialize=function(){this.landscapePos=(new pc.Vec3).copy(this.entity.getLocalPosition()),this.shakeTimeCurr=0,this.shakeTime=40,this.shaking=!1,this.shakesCount=1e3,this.shakeShiftTimer=0,this.shakeShiftCurr=new pc.Vec3(0,0,0),this.shakeShiftMax=new pc.Vec3(.3,.3,0),this.lerpSpeed=10,this.targetPos=new pc.Vec3(0,0,0),this.targetPos.copy(this.landscapePos)},CameraScript.prototype.shake=function(t,h,i){this.shakeTimeCurr=0,this.shakeTime=t,this.shaking=!0,this.shakesCount=h,this.shakeShiftTimer=0,this.shakeShiftMax.copy(i),this.shakeShiftCurr.set(pc.math.random(-this.shakeShiftMax.x,this.shakeShiftMax.x),pc.math.random(-this.shakeShiftMax.y,this.shakeShiftMax.y),pc.math.random(-this.shakeShiftMax.z,this.shakeShiftMax.z))},CameraScript.prototype.update=function(t){var h=this.entity.getLocalPosition();this.targetPos.copy(this.landscapePos),this.shaking&&(this.shakeTimeCurr+=t,this.shakeShiftTimer+=t,this.shakeShiftTimer>this.shakeTime/this.shakesCount&&(this.shakeShiftTimer=0,this.shakeShiftCurr.set(pc.math.random(-this.shakeShiftMax.x,this.shakeShiftMax.x),pc.math.random(-this.shakeShiftMax.y,this.shakeShiftMax.y),pc.math.random(-this.shakeShiftMax.z,this.shakeShiftMax.z))),this.shakeTimeCurr>=this.shakeTime&&(this.shaking=!1,this.shakeShiftCurr.set(0,0,0)),this.targetPos.add(this.shakeShiftCurr)),h.lerp(h,this.targetPos,this.lerpSpeed*t),this.entity.setLocalPosition(h)};var FullscreenImage=pc.createScript("fullscreenImage");FullscreenImage.getScreenComponentIteration=0,FullscreenImage.getScreenComponent=function(e){return FullscreenImage.getScreenComponentIteration++,FullscreenImage.getScreenComponentIteration>10?null:e.screen?e.screen:FullscreenImage.getScreenComponent(e.parent)},FullscreenImage.prototype.initialize=function(){FullscreenImage.getScreenComponentIteration=0,this.screenComponent=FullscreenImage.getScreenComponent(this.entity),this.updateSize(),window.addEventListener("resize",this.updateSize.bind(this))},FullscreenImage.prototype.updateSize=function(){var e=this.screenComponent.referenceResolution,n=this.screenComponent.scaleBlend,t=window.innerWidth,r=window.innerHeight;this.entity.element.width=pc.math.lerp(e.x,t/r*e.y,n),this.entity.element.height=pc.math.lerp(e.x*r/t,e.y,n)};var UigameOver=pc.createScript("uigameOver");UigameOver.attributes.add("score",{type:"entity"}),UigameOver.attributes.add("best",{type:"entity"}),UigameOver.prototype.initialize=function(){this.onEnable(),this.on("enable",this.onEnable,this)},UigameOver.prototype.onEnable=function(){this.score.element.text=Game.instance.currScore.toString()+" KG",this.best.element.text=Game.instance.bestScore.toString()+" KG"},UigameOver.prototype.update=function(e){};var MyButton=pc.createScript("myButton");MyButton.attributes.add("startScale",{type:"number",default:1}),MyButton.attributes.add("animScaleKoef",{type:"number",default:.2}),MyButton.attributes.add("actionName",{type:"string",default:"type name of action"}),MyButton.prototype.onClick=function(){switch(this.actionName){case"pause":MyButton.setClickable(Game.instance.uiInterface,!1),MyButton.setClickable(Game.instance.Screen3D,!1),Game.instance.controlsEnabled=!1,Uipopup.open("pause",!0);break;case"pauseContinue":MyButton.setClickable(Game.instance.uiInterface,!0),MyButton.setClickable(Game.instance.Screen3D,!0),Game.instance.controlsEnabled=!0,Uipopup.close("pause");break;case"pauseHome":Uipopup.close("pause"),js_GS_gameOver(),FadeScreen.instance.show(.5,0,0,(function(){MyButton.setClickable(Game.instance.uiInterface,!0),Game.instance.uiTutor.enabled=!1,Game.instance.gotoMainMenu()}));break;case"pauseRestart":Uipopup.close("pause"),Game.instance._state!=Game.STATE_GAMEOVER&&(Game.instance._state=Game.STATE_GAMEOVER,js_GS_gameOver()),FadeScreen.instance.show(.5,0,0,(function(){Game.instance.flushSavedPlates(),Game.instance.reset(),Game.instance.start()}));break;case"tutorialClaim":MyButton.setClickable(Game.instance.uiInterface,!0),MyButton.setClickable(Game.instance.Screen3D,!0),Game.instance.controlsEnabled=!0,Tutorial.instance.onMousePress();for(var e=0;e<20;e++)StarEffect.create(5);break;case"levelCompletedClaim":MyButton.setClickable(Game.instance.uiInterface,!0),MyButton.setClickable(Game.instance.Screen3D,!0),Game.instance.controlsEnabled=!0,Game.instance.prepareLevel(Game.instance.levelCurr+1,0),Game.instance.uiLevelCompleted.script.uiLevelCompleted.claim();for(e=0;e<20;e++)StarEffect.create(1);Game.instance.saveAll();break;case"gameOverContinue":FadeScreen.instance.show(.5,0,0,(function(){Game.instance.gotoMainMenu()}));break;case"gameUrnPlate":Game.instance.controlsUrn&&Game.instance.urnPlate();break;case"buyhtml5Contact":window.open("mailto:contact@buyhtml5.com");break;case"dagaevdevContact":window.open("mailto:dagaevdev@gmail.com");break;case"mainMenuPlay":FadeScreen.instance.show(.3,.1,!1,(function(){Game.instance.start()}));break;case"mainMenuArcade":FadeScreen.instance.show(.3,.1,!1,(function(){Game.instance.start(Game.GAMEMODE_CLASSIC)}));break;case"soundButton":GameAudio.switch(!GameAudio.mute);break;case"musicButton":GameAudio.switchMusic(!GameAudio.muteMus);break;case"backButtonInShop":ShopController.applySkin(Game.instance.ballModel,Game.instance.chosenSkinId),ShopController.instance.closeShop();break;case"leftButtonInShop":ShopController.instance.switchItem(-1);break;case"rightButtonInShop":ShopController.instance.switchItem(1);break;case"chooseButtonInShop":Game.instance.chosenSkinId=ShopController.instance.shownItemId,ShopController.applySkin(Game.instance.ballModel,Game.instance.chosenSkinId),ShopController.instance.closeShop();break;case"unlockButtonInShop":GameAudio.play("buyitem"),ShopController.instance.buyItem(ShopController.instance.shownItemId);break;case"continueButtonInScore":FadeScreen.instance.show(.5,.1,!1,(function(){this.app.fire("game:makereset",!1)}));break;case"shopButtonInScore":FadeScreen.instance.show(.3,.1,!1,(function(){Game.instance.uiShop.enabled=!0,Game.instance.uiScore.enabled=!1}));break;case"restartButtonInScore":FadeScreen.instance.show(.5,.1,!1,(function(){this.app.fire("game:makereset",!0)}));break;default:return 0}},MyButton.prototype.initialize=function(){this.button=this.entity.button,this.clickable=!0,this.animScaling=!0,this.mouseDown=!1,this.pressScaleX=1,this.pressScaleY=1,this.pressScaleXVel=0,this.entity.element.on("mousedown",this.onMouseDown,this),this.entity.element.on("mouseleave",this.onMouseLeave,this),this.entity.element.on("mouseup",this.onMouseLeave,this),this.entity.element.on("touchstart",this.onMouseDown,this),this.entity.element.on("touchend",this.onMouseLeave,this)},MyButton.prototype.onMouseDown=function(){1!=FadeScreen.instance.state&&(Game.instance.BH5&&"buyhtml5Contact"!=this.actionName||this.clickable&&(GameAudio.play("button"),MyButton.justPressed=!0,this.mouseDown=!0,this.onClick()))},MyButton.prototype.onMouseLeave=function(){this.mouseDown=!1},MyButton.prototype.postUpdate=function(e){MyButton.justPressed=!1},MyButton.prototype.update=function(e){this.animScaling?(this.mouseDown?(this.pressScaleX>1-this.animScaleKoef&&(this.pressScaleX=pc.math.lerp(this.pressScaleX,1-this.animScaleKoef,.5)),this.pressScaleY=this.pressScaleX):(this.pressScaleXVel+=20*(1-this.pressScaleX),this.pressScaleXVel*=.7,this.pressScaleX+=this.pressScaleXVel*e,this.pressScaleY=this.pressScaleX),this.entity.setLocalScale(this.pressScaleX*this.startScale,this.pressScaleY*this.startScale,1)):this.entity.setLocalScale(this.startScale,this.startScale,this.startScale)},MyButton.setClickable=function(e,t){for(var a,n=0;n<e.children.length;n++)(a=e.children[n]).script&&a.script.myButton&&(a.script.myButton.clickable=t),MyButton.setClickable(a,t)};var BackgroundCity2=pc.createScript("backgroundCity2");BackgroundCity2.prototype.initialize=function(){this.defScale=(new pc.Vec3).copy(this.entity.getLocalScale()),this.scale=(new pc.Vec3).copy(this.entity.getLocalScale())},BackgroundCity2.prototype.update=function(t){var e=window.innerWidth,i=window.innerHeight,c=Math.max(1.1,e/i*.7);this.scale.x=c*this.defScale.x,this.scale.z=c*this.defScale.z,this.entity.setLocalScale(this.scale)};var SplatEffect=pc.createScript("splatEffect");SplatEffect.color=new pc.Color,SplatEffect.create=function(t,e,i,o){var a=ObjectPool.instantiate("EffectSplat",t,o);a.sprite.color=e;var n=new pc.Vec3(i,i,i);return a.setLocalScale(n),a.sprite.frame=Math.floor(3*Math.random()),a.setEulerAngles(0,0,360*Math.random()),a},SplatEffect.prototype.initialize=function(){this.entity.sprite.stop(),this.time=0,this.onEnable(),this.on("enable",this.onEnable,this)},SplatEffect.prototype.onEnable=function(){this.entity.sprite.opacity=1,this.time=0},SplatEffect.prototype.update=function(t){this.time+=t,this.time>1.5&&(this.entity.sprite.opacity-=1*t),this.entity.sprite.opacity<=0&&ObjectPool.push(this.entity)};var EffectDrop=pc.createScript("effectDrop");EffectDrop.grav=new pc.Vec3(0,-16,0),EffectDrop.temp=new pc.Vec3(0,0,0),EffectDrop.create=function(t,e,i,p){var c=ObjectPool.instantiate("EffectDrop",t,Game.instance.app.root),o=c.script.effectDrop;return o.initialized||o.initialize(),o.vel.copy(i),o.size=e,c.enabled=!0,c.sprite.color=p,c},EffectDrop.prototype.initialize=function(){this.initialized=!0,this.vel=new pc.Vec3(0,0,0),this.damping=.01,this.size=1,this.onEnable(),this.on("enable",this.onEnable,this)},EffectDrop.prototype.onEnable=function(){},EffectDrop.prototype.update=function(t){if(EffectDrop.temp.copy(EffectDrop.grav),EffectDrop.temp.scale(t),this.vel.add(EffectDrop.temp),this.vel.scale(1-this.damping*t),EffectDrop.temp.copy(this.vel),EffectDrop.temp.scale(t),this.entity.translate(EffectDrop.temp),this.entity.getPosition().add(this.vel),this.size-=.4*t,this.size<=0)ObjectPool.push(this.entity);else{var e=pc.math.clamp(this.vel.length()/10,1,4);this.entity.setLocalScale(this.size,this.size,this.size*e)}};var GameText=pc.createScript("gameText");GameText.prototype.initialize=function(){this.hideDelay=1,this.fadeOpacity=!1},GameText.prototype.animate=function(t,e=1){this.hideAnimType=t,this.showTime=.3,this.appearTime=.3,this.hideTime=.2,this.hideDelay=this.appearTime+this.showTime,this.fadeOpacity=!1,this.entity.element.opacity=1,3==this.hideAnimType?this.entity.tween(this.entity.getLocalRotation()).to(new pc.Vec3(0,0,pc.math.random(-.1,.1)),this.appearTime,pc.BackOut).loop(!1).yoyo(!1).start():this.entity.setLocalRotation(0,0,0,1),this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(1*e,1*e,1*e),this.appearTime,pc.BackOut).loop(!1).yoyo(!1).start()},GameText.prototype.update=function(t){if(this.entity.translate(0,t,0),this.fadeOpacity&&(this.entity.element.opacity-=t/this.hideTime,this.entity.element.opacity<=0&&ObjectPool.push(this.entity),this.entity.translate(0,5*t,0)),this.hideDelay>0&&(this.hideDelay-=t,this.hideDelay<=0))if(1==this.hideAnimType||3==this.hideAnimType){var e=this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(0,0,0),this.hideTime,pc.BackIn).loop(!1).yoyo(!1).on("complete",(function(){ObjectPool.push(this.entity)}));3===this.hideAnimType&&this.entity.tween(this.entity.getLocalRotation()).to(new pc.Vec3(0,0,0),this.hideTime,pc.BackIn).loop(!1).yoyo(!1).start(),e.start()}else 2==this.hideAnimType&&(this.fadeOpacity=!0)};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},onUpdate:function(t){return this.on("update",t),this},onComplete:function(t){return this.on("complete",t),this},onLoop:function(t){return this.on("loop",t),this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var MissEffect=pc.createScript("missEffect");MissEffect.create=function(t){var e=ObjectPool.instantiate("EffectMiss",t,Game.instance.app.root);return e.script.missEffect.destroyDelay=1,e.setLocalScale(0,0,0),e.tween(e.getLocalScale()).to(new pc.Vec3(.65,.65,.65),.5,pc.BackOut).loop(!1).yoyo(!1).start(),e},MissEffect.prototype.initialize=function(){},MissEffect.prototype.update=function(t){this.destroyDelay>0&&(this.destroyDelay-=t,this.destroyDelay<=0&&this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(0,0,0),.3,pc.BackIn).loop(!1).yoyo(!1).onComplete((function(){ObjectPool.push(this.entity)})).start())};var Plate=pc.createScript("plate");Plate.STATE_NULL=0,Plate.STATE_ONTABLE=1,Plate.STATE_GOESONPIN=2,Plate.STATE_MOVINGONPIN=3,Plate.STATE_ONPIN=4,Plate.STATE_GOESTOURN=5,Plate.STATE_BOMBING=6,Plate.STATE_BOMBINGPREPARE=7,Plate.gravity=40,Plate.weights=[.5,1,2.5,5,10,25,50,100,200,500],Plate.attributes.add("weightID",{type:"number",default:0}),Plate.attributes.add("weight",{type:"number",default:1}),Plate.attributes.add("text",{type:"entity"}),Plate.attributes.add("bombIc",{type:"entity"}),Plate.attributes.add("bombIc2",{type:"entity"}),Plate.attributes.add("textColor",{type:"rgba",array:!1}),Plate.prototype.initialize=function(){if(this.initialized)return 1;this.initialized=!0,this.isBomb=!1,this.bombIc&&(this.bombIc.enabled=!1),this.bombIc2&&(this.bombIc2.enabled=!1),this.lerpedMaterial=this.entity.model.meshInstances[0].material.clone(),this.merging=!1,this.picked=!1,this.overPin=null,this.moveDelay=0,this.destroyed=!1,this.state||(this.state=Plate.STATE_NULL),this.targetPosition=new pc.Vec3(0,0,0),this.lerpedPosition=new pc.Vec3,this.lerpSpeed=0,this.velY=0},Plate.prototype.onPosAchieved=function(){if(this.state===Plate.STATE_ONTABLE)this.picked||(this.lerpSpeed=0);else if(this.state===Plate.STATE_GOESONPIN)this.lerpSpeed=0,this.state=Plate.STATE_MOVINGONPIN;else if(this.state===Plate.STATE_MOVINGONPIN)this.lerpSpeed=0,this.state=Plate.STATE_ONPIN,this.merging||GameAudio.play(MathUtil.choose("place1","place3")),this.merging=!1,this.checkMerge()||(Game.instance.newPlate(),Game.instance.streak=0,Game.instance.checkGameOver(),Game.instance.saveAll());else if(this.state===Plate.STATE_BOMBING){Game.instance.newPlate(),Game.instance.streak=0;var t=this.entity.getPosition();if(this.isTon){GameAudio.play("star"),Game.instance.addStars(10);for(e=0;e<10;e++)ParticleSprite.create(Game.instance.particleStar,t,new pc.Vec3(pc.math.random(-15,15),pc.math.random(10,25),pc.math.random(-5,15)),-1,pc.math.random(-200,200),0,.075).gravity=-10}else for(var e=0;e<9;e++)EffectDrop.create(t,pc.math.random(.5,1.2),new pc.Vec3(pc.math.random(-2,2),pc.math.random(5,9),pc.math.random(-2,2)),Game.instance.blackColor);this.overPin.platesCount=0,this.entity.destroy()}},Plate.prototype.checkMerge=function(){var t,e=this.overPin;if(!(e.platesCount>=2))return null;if((t=e.plates[e.platesCount-2]).weightID===this.weightID){GameAudio.playEx("merge",1+Game.instance.streak/7);var i=!1,s=!1;(t.isBomb||this.isBomb)&&(i=!0),this.weightID+1==Game.instance.plates.length-1&&(s=!0);var a=this.weightID+1;a>=Game.instance.plates.length&&(a=0),Game.instance.onMerge(this,t),this.overPin.platesCount-=2,t.destroyed=!0,t.state=Plate.STATE_MOVINGONPIN;var o=t;(t=Game.instance.createNewPlate(a,e,!0,i)).state=Plate.STATE_MOVINGONPIN,t.targetPosition.copy(t.entity.getPosition()),Game.instance.saveAll();var n=this.entity.model.meshInstances[0].material,l=t.entity.model.meshInstances[0].material;i&&this.isBomb&&(n=l);n.diffuse;var h=n.clone();if(t.moveDelay=.5,t.isBomb||(t.entity.model.meshInstances[0].material=h),o.isBomb||(o.entity.model.meshInstances[0].material=h),this.isBomb||(this.entity.model.meshInstances[0].material=h),h.update(),this.app.tween(h.diffuse).to(l.diffuse,.35,pc.Linear).loop(!1).yoyo(!1).onUpdate((function(t){h.update()})).start(),this.app.tween(h.emissive).to(l.emissive,.3,pc.Linear).loop(!1).yoyo(!1).onUpdate((function(t){h.update()})).start(),t.merging=!0,this.destroyed=!0,i||s){s&&(t.isTon=!0),this.state=Plate.STATE_MOVINGONPIN,t.state=Plate.STATE_BOMBINGPREPARE,GameAudio.play("boost");var r=(new pc.Vec3).copy(t.entity.getLocalScale());r.set(1.3*r.x,1.3*r.y,1.3*r.z),t.entity.tween(t.entity.getLocalScale()).to(r,.3,pc.SineOut).loop(!0).yoyo(!0).start()}else this.state=Plate.STATE_MOVINGONPIN;return t}return null},Plate.prototype.setTargetPos=function(t,e,i,s){this.targetPosition.set(t,e,i),this.lerpSpeed=s},Plate.prototype.update=function(t){if(this.state,Plate.STATE_ONTABLE,this.state===Plate.STATE_BOMBINGPREPARE){if(this.moveDelay>0)return this.moveDelay-=t,this.moveDelay<=0&&this.targetPosition.y>3.6&&(GameAudio.play("bombgo"),this.state=Plate.STATE_BOMBING,this.overPin.platesCount--),0;this.velY=7.5,this.targetPosition.y+=this.velY*t,this.targetPosition.y>3.8&&(this.moveDelay=.5),this.entity.setPosition(this.targetPosition)}if(this.state===Plate.STATE_BOMBING){this.velY=-14,this.targetPosition.y+=this.velY*t;var e=this.overPin.getLastY(),i=this.overPin.getLastPlate();return this.targetPosition.y<0*-Game.PLATE_HEIGHT&&null===i?this.onPosAchieved():this.targetPosition.y<e&&i&&(Game.instance.collectPlate(i,i.entity.getPosition(),Game.instance.blackColor,"bombed"),i.entity.destroy(),this.overPin.platesCount--),this.entity.setPosition(this.targetPosition),0}if(this.state===Plate.STATE_MOVINGONPIN){if(this.moveDelay>0)return this.moveDelay-=t,0;this.merging||this.destroyed?this.velY=-1.5:this.velY-=Plate.gravity*t,this.targetPosition.y+=this.velY*t;e=this.overPin.getLastY();if(this.targetPosition.y<e)return this.targetPosition.y=e,this.entity.setPosition(this.targetPosition),this.merging,this.destroyed?this.entity.destroy():this.onPosAchieved(),0;this.entity.setPosition(this.targetPosition)}if(this.lerpSpeed>0){var s=this.entity.getPosition();this.lerpedPosition.lerp(this.entity.getPosition(),this.targetPosition,Math.min(1,this.lerpSpeed*t)),s.distance(this.lerpedPosition)<.01?(this.entity.setPosition(this.targetPosition),this.onPosAchieved()):this.entity.setPosition(this.lerpedPosition)}};var Pin=pc.createScript("pin");Pin.MAX_PLATES=9,Pin.amount=pc.math.random(4499,4999),Pin.prototype.initialize=function(){if(this.initialized)return 1;this.initialized=!0;var t=this.entity.getPosition();this.x=t.x,this.z=t.z,this.lastPlateY=.5*-Game.PLATE_HEIGHT,this.plates=[],this.platesCount=0},Pin.prototype.getLastPlate=function(){return this.platesCount<=0?null:this.plates[this.platesCount-1]},Pin.prototype.getLastY=function(){return.5*Game.PLATE_HEIGHT+Game.PLATE_HEIGHT*this.platesCount},Pin.prototype.addPlate=function(t){this.plates[this.platesCount]=t,this.platesCount++},Pin.prototype.update=function(t){};var ParticleSprite=pc.createScript("particleSprite");ParticleSprite.tmp=new pc.Vec3,ParticleSprite.prototype.initialize=function(){this.initialized||(this.initialized=!0,this.spr=this.entity.sprite,this.alphaSpeed=0,this.scaleSpeed=0,this.angleSpeed=0,this.delay=0,this.gravity=0,this.velDamping=0,this._vel=new pc.Vec3(0,0,0),this._acc=new pc.Vec3(0,this.gravity,0))},ParticleSprite.prototype.update=function(t){if(this.delay>0)return this.delay-=t,0;this._acc.y=this.gravity;var e=this.entity.getLocalPosition();ParticleSprite.tmp.copy(this._acc).scale(t*Game.instance.slomo),this._vel.add(ParticleSprite.tmp);var i=1-this.velDamping;this._vel.x*=i,this._vel.y*=i,this._vel.z*=i,ParticleSprite.tmp.copy(this._vel).scale(t*Game.instance.slomo),e.add(ParticleSprite.tmp);var a=this.entity.getLocalScale().x;(a+=t*this.scaleSpeed)<0&&this.scaleSpeed<0?this.entity.destroy():this.entity.setLocalScale(a,a,a),this.spr.opacity+=this.alphaSpeed*t,this.spr.opacity<0&&this.entity.destroy(),this.entity.rotateLocal(0,0,this.angleSpeed*t)},ParticleSprite.create=function(t,e,i,a,s,p,c){var l=t.clone(),r=l.script.particleSprite;return r.initialize(),r._vel.copy(i),r.scaleSpeed=a,r.alphaSpeed=p,r.angleSpeed=s,r.velDamping=c,Game.instance.app.root.addChild(l),l.setPosition(e),l.enabled=!0,r};var UiLevelCompleted=pc.createScript("uiLevelCompleted");UiLevelCompleted.attributes.add("popup",{type:"entity"}),UiLevelCompleted.attributes.add("count",{type:"entity"}),UiLevelCompleted.prototype.initialize=function(){this.starsCount=20,this.onEnable(),this.on("enable",this.onEnable,this)},UiLevelCompleted.prototype.onEnable=function(){GameAudio.play("levelcompl"),this.popup.setLocalScale(0,0,0),this.starsCount=20,this.count.element.text=this.starsCount.toString()+" x",this.popup.tween(this.popup.getLocalScale()).to(new pc.Vec3(1,1,1),.65,pc.BackOut).loop(!1).yoyo(!1).start()},UiLevelCompleted.prototype.claim=function(){this.popup.tween(this.popup.getLocalScale()).to(new pc.Vec3(0,0,0),.4,pc.BackIn).loop(!1).yoyo(!1).onComplete((function(){Game.instance.uiLevelCompleted.enabled=!1})).start()},UiLevelCompleted.prototype.update=function(e){};var UimainMenu=pc.createScript("uimainMenu");UimainMenu.attributes.add("bestText",{type:"entity"}),UimainMenu.attributes.add("caption",{type:"entity"}),UimainMenu.prototype.initialize=function(){this.caption.tween(this.caption.getLocalScale()).to(new pc.Vec3(.55,.55,.55),1.5,pc.SineInOut).loop(!0).yoyo(!0).start(),this.onEnable(),this.on("enable",this.onEnable,this)},UimainMenu.prototype.onEnable=function(){this.bestText.element.text=Game.instance.bestScore.toString()+" KG"},UimainMenu.prototype.update=function(t){};var GameAudio=pc.createScript("gameAudio");GameAudio.instance=null,GameAudio.mute=!1,GameAudio.muteMus=!1,GameAudio.gsMute=!1,GameAudio.loopStep=0,GameAudio.appBlurred=!1,GameAudio.prototype.update=function(o){GameAudio.loopStep>0&&(GameAudio.loopStep+=1,js_isMobileOrTablet()?GameAudio.loopStep>=10&&(GameAudio.loopStep=-1,GameAudio.instance.snd2.play("loopSound")):(GameAudio.loopStep=-1,GameAudio.instance.snd2.play("loopSound")))},GameAudio.prototype.initialize=function(){GameAudio.instance=this,this.snd2=this.entity.children[0].sound,this.snd=this.entity.sound;this.snd2.slot("loopSound");this.app.on("input:mousepress",this.onMousePress)},GameAudio.prototype.onMousePress=function(){0===GameAudio.loopStep&&(GameAudio.loopStep=1)},GameAudio.switchMusic=function(o,e=!1){if(o||!GameAudio.gsMute||e){GameAudio.muteMus=o;var i=GameAudio.instance.snd2.slot("loopSound");GameAudio.muteMus?i.volume=2e-5:i.volume=.2}},GameAudio.switch=function(o,e=!1){(o||!GameAudio.gsMute||e)&&(GameAudio.mute=o,GameAudio.instance.snd.enabled=!GameAudio.mute)},GameAudio.play=function(o){GameAudio.instance&&(GameAudio.instance.snd.slot(o).pitch=1,GameAudio.instance.snd.play(o))},GameAudio.playEx=function(o,e){GameAudio.instance&&(GameAudio.instance.snd.slot(o).pitch=e,GameAudio.instance.snd.play(o))};var js_GS_gameIsReady=!1,GS_loggingEnabled=!0,GS_firstAudioSubSkipped=!0,GS_Testing=!1;function js_GS_saveValue(e,a){window.GameSnacks&&GameSnacks.storage.setItem(e,a)}function js_GS_loadValue(e){if(window.GameSnacks){return Number(GameSnacks.storage.getItem(e))}return null}function js_GS_isValueExists(e){if(window.GameSnacks){return null==Number(GameSnacks.storage.getItem(e))?0:1}return 0}function js_GS_gameReady(){if(js_GS_gameIsReady)return 0;js_GS_gameIsReady=!0,pc.app.mouse.disableContextMenu(),window.GameSnacks&&(GameSnacks.game.onPause((()=>{js_GS_eventCall("pause")})),GameSnacks.game.onResume((()=>{js_GS_eventCall("resume")})),GameSnacks.game.firstFrameReady(),GameSnacks.game.ready(),setTimeout((()=>{var e=!js_GS_isAudioEnabled();GameAudio.gsMute=e,GameAudio.switch(GameAudio.gsMute,!0),GameAudio.switchMusic(GameAudio.gsMute,!0),GameSnacks.audio.subscribe((e=>{GS_firstAudioSubSkipped?js_GS_eventCall("audio_switched",e):GS_firstAudioSubSkipped=!0}))}),200)),console.log("GameSnacks JS: game ready")}function js_GS_log(e){GS_loggingEnabled&&console.log(e)}function js_GS_eventCall(e,a=0){switch(js_GS_log("[EventHandler] GameSnacks JS event: "+e),e){case"audio_switched":if(!GameAudio.instance)return;GameAudio.gsMute=!a,GameAudio.switch(GameAudio.gsMute),GameAudio.switchMusic(GameAudio.gsMute),js_GS_log("[EventHandler] Audio switched event: param given is "+a.toString());break;case"pause":GameAudio.switch(!0),GameAudio.switchMusic(!0),js_GS_log("[EventHandler] Game paused");break;case"resume":GameAudio.switch(!1),GameAudio.switchMusic(!1),js_GS_log("[EventHandler] Game resumed");break;case"prerollsuccess":js_GS_log("[EventHandler] Preroll ad successfully completed");break;case"beforeReward":js_GS_log("[EventHandler] Ad Function found");break;case"adfail":window.GS_rewardFailCallback&&(window.GS_rewardFailCallback(),window.GS_rewardFailCallback=null),js_GS_log("[EventHandler] Ad failed to load or play");break;case"adreward":window.GS_rewardSuccessCallback&&(window.GS_rewardSuccessCallback(),window.GS_rewardSuccessCallback=null),js_GS_log("[EventHandler] Ad reward granted");break;case"adbreakdone":js_GS_log("[EventHandler] Ad break done")}}function js_GS_ad_reward_test1(e){}function js_GS_ad_reward_prepare(e,a){window.GS_rewardSuccessCallback=e,window.GS_rewardFailCallback=a,window.GameSnacks?GameSnacks.ad.break({type:"reward",name:"reward_placement",beforeAd:()=>{js_GS_eventCall("pause")},afterAd:()=>{js_GS_eventCall("resume")},beforeReward:e=>{window.GS_showAdFunction=e,js_GS_eventCall("beforeReward")},adDismissed:()=>{js_GS_eventCall("adfail")},adViewed:()=>{js_GS_eventCall("adreward")},adBreakDone:e=>{js_GS_eventCall("adbreakdone")}}):GS_Testing&&(window.GS_showAdFunction=()=>{console.log("test function"),js_GS_eventCall("adreward")},js_GS_eventCall("beforeReward")),js_GS_log("GameSnacks JS: ad reward prepare")}function js_GS_is_ad_reward_available(){return!!window.GS_showAdFunction}function js_GS_ad_reward(){window.GameSnacks?window.GS_showAdFunction&&(window.GS_showAdFunction(),window.GS_showAdFunction=null):GS_Testing&&(js_GS_eventCall("adreward"),window.GS_showAdFunction=null),js_GS_log("GameSnacks JS: ad reward")}function js_GS_ad_preroll(){}function js_GS_ad_interstitial(){window.GameSnacks&&GameSnacks.ad.break({type:"start",name:"game_interstitial",beforeAd:()=>{js_GS_eventCall("pause")},afterAd:()=>{js_GS_eventCall("resume")},adBreakDone:e=>{js_GS_eventCall("adbreakdone")}}),js_GS_log("GameSnacks JS: ad interstitial")}function js_GS_levelCompleted(e){window.GameSnacks&&GameSnacks.game.levelComplete(e),js_GS_log("GameSnacks JS: level complete "+e.toString())}function js_GS_sendScore(e){window.GameSnacks&&GameSnacks.score.update(e),js_GS_log("GameSnacks JS: score updated "+e.toString())}function js_GS_gameOver(){window.GameSnacks&&GameSnacks.game.gameOver(),js_GS_log("GameSnacks JS: game over")}function js_GS_isAudioEnabled(){return!!window.GameSnacks&&GameSnacks.audio.isEnabled()}function js_isIE(){var e=window.navigator.userAgent;return/MSIE|Trident/.test(e)}function js_isMobileOrTablet(){var e,a=!1;e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(a=!0);var n=navigator.maxTouchPoints||"ontouchstart"in document.documentElement,s=void 0!==window.orientation;return a||(n||s)}window.GS_rewardSuccessCallback=null,window.GS_rewardFailCallback=null,window.GS_showAdFunction=null;var GymEnvironment=pc.createScript("gymEnvironment");GymEnvironment.attributes.add("barbels",{type:"entity",array:!0,title:"barbels"}),GymEnvironment.attributes.add("walls",{type:"entity",array:!0,title:"walls"}),GymEnvironment.attributes.add("barbMat",{type:"asset",array:!0,assetType:"material"}),GymEnvironment.attributes.add("wallMat",{type:"asset",array:!0,assetType:"material"}),GymEnvironment.instance=null,GymEnvironment.prototype.initialize=function(){var t;for(GymEnvironment.instance=this,this.currID=0,this.matCount=this.barbMat.length,this.bMat=this.barbMat[0].resource.clone(),this.wMat=this.wallMat[0].resource.clone(),this.currD=this.bMat.diffuse.clone(),this.currE=this.bMat.emissive.clone(),t=0;t<this.barbels.length;t++)this.barbels[t].model.meshInstances[0].material=this.bMat;for(t=0;t<this.walls.length;t++)this.walls[t].model.meshInstances[0].material=this.wMat},GymEnvironment.prototype.changeMaterial=function(){this.currID++,this.currID>=this.matCount&&(this.currID=0);var t=this.barbMat[this.currID].resource,e=this.wallMat[this.currID].resource;this.app.tween(this.wMat.diffuse).to(e.diffuse,1,pc.Linear).loop(!1).yoyo(!1).onUpdate(function(t){this.wMat.update()}.bind(this)).start(),this.app.tween(this.wMat.emissive).to(e.emissive,1,pc.Linear).loop(!1).yoyo(!1).onUpdate(function(t){this.wMat.update()}.bind(this)).start(),this.app.tween(this.bMat.diffuse).to(t.diffuse,1,pc.Linear).loop(!1).yoyo(!1).onUpdate(function(t){this.bMat.update()}.bind(this)).start(),this.app.tween(this.bMat.emissive).to(t.emissive,1,pc.Linear).loop(!1).yoyo(!1).onUpdate(function(t){this.bMat.update()}.bind(this)).start()},GymEnvironment.prototype.update=function(t){this.app.keyboard.isPressed(pc.KEY_C)&&this.changeMaterial()};var Tutorial=pc.createScript("tutorial");Tutorial.showTutor=!0,Tutorial.tutCompl=!1,Tutorial.plateIDs=[2,2,2,1,5,0,0,-1,-1],Tutorial.currPlateID=0,Tutorial.wasCompleted=!1,Tutorial.attributes.add("finger1",{type:"entity"}),Tutorial.attributes.add("finger2",{type:"entity"}),Tutorial.attributes.add("popup",{type:"entity"}),Tutorial.attributes.add("text",{type:"entity"}),Tutorial.attributes.add("tapText",{type:"entity"}),Tutorial.grabPlateID=function(t){t&&(Tutorial.currPlateID=0);var e=Tutorial.plateIDs[Math.min(Tutorial.currPlateID,Tutorial.plateIDs.length-1)];return Tutorial.currPlateID++,6===Tutorial.currPlateID?(Game.instance.controlsPlatesDragging=!1,Game.instance.controlsUrn=!0,Tutorial.instance.text.element.text="TAP TO DESTROY PLATE",Tutorial.instance.finger1.enabled=!1,Tutorial.instance.finger2.enabled=!0):Tutorial.currPlateID>=Tutorial.plateIDs.length?(Game.instance.controlsPlatesDragging=!1,Game.instance.controlsUrn=!1,Tutorial.instance.text.enabled=!1,Tutorial.instance.finger1.enabled=!1,Tutorial.instance.finger2.enabled=!1,Tutorial.instance.popup.enabled=!0,Tutorial.tutCompl=!0,FadeScreen.instance.show(.4,0,1,null),GameAudio.play("levelcompl"),MyButton.setClickable(Game.instance.uiInterface,!1),MyButton.setClickable(Game.instance.Screen3D,!1),Game.instance.controlsEnabled=!1,Uipopup.close("pause")):(Game.instance.controlsPlatesDragging=!0,Game.instance.controlsUrn=!1,Tutorial.instance.finger1.enabled=!0,Tutorial.instance.finger2.enabled=!1,Tutorial.instance.text.element.text="DRAG TO MOVE PLATES"),e},Tutorial.instance=null,Tutorial.prototype.start=function(){this.finger1.enabled=!0,this.finger2.enabled=!1,this.popup.enabled=!1,this.text.enabled=!0,this.entity.enabled=!0,this.finger1.setLocalPosition(this.fingerStartPos),this.tweenTime=1,this.text.element.text="DRAG TO MOVE PLATES"},Tutorial.prototype.initialize=function(){Tutorial.instance=this,this.entity.enabled=!1,this.finger1.enabled=!1,this.finger2.enabled=!1,this.popup.enabled=!1,this.entity.enabled=!1,this.text.enabled=!1,this.fingerStartPos=(new pc.Vec3).copy(this.finger1.getLocalPosition()),this.finger2.tween(this.finger2.getLocalScale()).to(new pc.Vec3(1.2,1.2,1.2),.5,pc.SineOut).loop(!0).yoyo(!0).start(),this.tapText.tween(this.tapText.getLocalScale()).to(new pc.Vec3(1.2,1.2,1.2),.5,pc.SineOut).loop(!0).yoyo(!0).start()},Tutorial.prototype.onMousePress=function(){Tutorial.tutCompl&&Tutorial.showTutor&&(Tutorial.showTutor=!1,Tutorial.tutCompl=!1,FadeScreen.instance.show(.4,1.2,!1,(function(){Game.instance._state=Game.STATE_MENU,Game.instance.flushSavedPlates(),Game.instance.reset(),Game.instance.start(),Tutorial.instance.entity.enabled=!1})))},Tutorial.prototype.update=function(t){if(this.tweenTime-=t,this.tweenTime<=0){var e=this.finger1;e.setLocalPosition(this.fingerStartPos),e.tween(e.getLocalPosition()).to({x:0,y:900,z:0},1,pc.SineOut).yoyo(!1).start(),this.tweenTime=1.5}};var SoundButton=pc.createScript("soundButton");SoundButton.attributes.add("noSound",{type:"entity"}),SoundButton.prototype.initialize=function(){this.app.on("app:soundchanged",this.onSoundChange,this),this.onEnable(),this.on("enable",this.onEnable,this)},SoundButton.prototype.onSoundChange=function(n){this.noSound.enabled=n},SoundButton.prototype.update=function(n){this.noSound.enabled=GameAudio.mute},SoundButton.prototype.onEnable=function(){this.onSoundChange(GameAudio.mute)};var Uipopup=pc.createScript("uipopup");Uipopup.attributes.add("name",{type:"string",default:"Popup Name"}),Uipopup.popups=[],Uipopup.STATE_OPENING=1,Uipopup.STATE_OPENED=2,Uipopup.STATE_CLOSING=3,Uipopup.STATE_CLOSED=4,Uipopup.prototype.initialize=function(){Uipopup.popups.push(this),this.entity.enabled=!1,this.state=Uipopup.STATE_CLOSED},Uipopup.open=function(p,t){for(var o,i=0;i<Uipopup.popups.length;i++)(o=Uipopup.popups[i]).name==p?o.open():t&&o.close()},Uipopup.get=function(p){for(var t,o=0;o<Uipopup.popups.length;o++)if((t=Uipopup.popups[o]).name==p)return t;return null},Uipopup.close=function(p){for(var t,o=0;o<Uipopup.popups.length;o++)(t=Uipopup.popups[o]).name==p&&t.close()},Uipopup.prototype.open=function(){this.state==Uipopup.STATE_CLOSED&&(this.state=Uipopup.STATE_OPENING,this.entity.setLocalScale(0,0,0),this.entity.enabled=!0,this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(1,1,1),.45,pc.BackOut).loop(!1).yoyo(!1).onComplete(function(){this.state=Uipopup.STATE_OPENED}.bind(this)).start())},Uipopup.prototype.close=function(){this.state!=Uipopup.STATE_OPENED&&this.state!=Uipopup.STATE_OPENING||(this.state=Uipopup.STATE_CLOSING,this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(0,0,0),.4,pc.BackIn).loop(!1).yoyo(!1).onComplete(function(){this.state=Uipopup.STATE_CLOSED,this.entity.enabled=!1}.bind(this)).start())},Uipopup.prototype.update=function(p){};var StarEffect=pc.createScript("starEffect");StarEffect.attributes.add("stars",{type:"entity"}),StarEffect.instance=null,StarEffect.create=function(t){var e=StarEffect.instance.clone();return e.enabled=!0,StarEffect.instance.parent.addChild(e),e.script.starEffect.amount=t,e},StarEffect.scr=null,StarEffect.prototype.initialize=function(){if(!StarEffect.instance)return StarEffect.instance=this.entity,this.entity.enabled=!1,StarEffect.scr=this.entity.parent.screen,1;var t=pc.math.random(.9,1.5),e=350;this.delay=pc.math.random(.25,.8),this.entity.setLocalPosition(pc.math.random(-350,e),pc.math.random(-350,e),0);window.innerWidth,window.innerHeight;this.entity.setLocalScale(0,0,0),this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(t,t,t),this.delay,pc.BackOut).loop(!1).yoyo(!1).onComplete(function(){this.stars.getPosition();var t=pc.math.random(.15,.65);this.entity.tween(this.entity.getLocalPosition()).to(new pc.Vec3(1*-StarEffect.scr.resolution.x+10,1*StarEffect.scr.resolution.y-15,0),t,pc.CubicInOut).loop(!1).yoyo(!1).start(),this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(0,0,0),t+.15,pc.CubicInOut).loop(!1).yoyo(!1).onComplete(function(){GameAudio.play("star"),Game.instance.addStars(this.amount),this.entity.destroy()}.bind(this)).start()}.bind(this)).start()},StarEffect.prototype.update=function(t){};var TextIcon=pc.createScript("textIcon");TextIcon.attributes.add("iconSide",{type:"number",default:1,enum:[{left:1},{right:2}]}),TextIcon.attributes.add("icon",{type:"entity"}),TextIcon.attributes.add("spacing",{type:"number",default:20,title:"icon spacing"}),TextIcon.prototype.initialize=function(){},TextIcon.prototype.update=function(t){var e=0;e=1===this.iconSide?-(this.spacing+.5*this.entity.element.textWidth):this.spacing+.5*this.entity.element.textWidth,this.icon.setLocalPosition(e,0,0)};var ProgressBar=pc.createScript("progressBar");ProgressBar.attributes.add("percentText",{type:"entity"}),ProgressBar.attributes.add("progressImage",{type:"entity"}),ProgressBar.attributes.add("progressImageMaxWidth",{type:"number"}),ProgressBar.prototype.initialize=function(){this.setProgress(0),this.targValue=0},ProgressBar.prototype.setProgress=function(e){e=pc.math.clamp(e,0,1),this.targValue=e,this.progress=0;var r=pc.math.lerp(0,this.progressImageMaxWidth,e);this.progressImage.element.width=r,this.progressImage.element.rect.z=e,this.progressImage.element.rect=this.progressImage.element.rect},ProgressBar.prototype.showProgress=function(){var e=pc.math.lerp(0,this.progressImageMaxWidth,this.progress);this.progressImage.element.width=e,this.progressImage.element.rect.z=this.progress,this.progressImage.element.rect=this.progressImage.element.rect},ProgressBar.prototype.update=function(e){this.progress<=this.targValue&&(this.progress+=e,this.progress>this.targValue&&(this.progress=this.targValue),this.showProgress()),this.percentText&&(this.percentText.element.text=Math.round(100*this.progress).toString()+"%")};var MusicBut=pc.createScript("musicBut");MusicBut.attributes.add("noSound",{type:"entity"}),MusicBut.prototype.initialize=function(){this.onEnable(),this.on("enable",this.onEnable,this)},MusicBut.prototype.onSoundChange=function(t){this.noSound.enabled=t},MusicBut.prototype.update=function(t){this.noSound.enabled=GameAudio.muteMus},MusicBut.prototype.onEnable=function(){this.onSoundChange(GameAudio.muteMus)};var ReviveSystem=pc.createScript("reviveSystem");ReviveSystem.attributes.add("revivesCount",{type:"number",default:1}),ReviveSystem.attributes.add("countdownDuration",{type:"number",default:5}),ReviveSystem.attributes.add("countdownTextElement",{type:"entity"}),ReviveSystem.attributes.add("yesButton",{type:"entity"}),ReviveSystem.attributes.add("noButton",{type:"entity"}),ReviveSystem.instance=null,ReviveSystem.prototype.initialize=function(){this.currentCountdown=this.countdownDuration,this.yesCallback=null,this.noCallback=null,this.reviveElement=this.entity,this.reviveElement.enabled=!1,this.currentRevives=0,this.yesButton.script.myButton.actionName="reviveSystem_onYes",this.noButton.script.myButton.actionName="reviveSystem_onNo",this.countDownPause=!1,this.showRewardAdFunction=null,ReviveSystem.instance=this},ReviveSystem.prototype.resetRevivesCount=function(e){this.currentRevives=0,js_GS_ad_reward_prepare((()=>{ReviveSystem.instance.yesCallback&&ReviveSystem.instance.yesCallback(),ReviveSystem.instance.cleanup()}),(()=>{ReviveSystem.instance.noCallback&&ReviveSystem.instance.noCallback(),ReviveSystem.instance.cleanup()}))},ReviveSystem.prototype.showRevive=function(e,t=!1){js_GS_ad_reward_prepare((()=>{ReviveSystem.instance.yesCallback&&ReviveSystem.instance.yesCallback(),ReviveSystem.instance.cleanup()}),(()=>{ReviveSystem.instance.noCallback&&ReviveSystem.instance.noCallback(),ReviveSystem.instance.cleanup()})),this.yesCallback=e.onYes,this.noCallback=e.onNo,js_GS_is_ad_reward_available()||t?(this.currentRevives++,this.currentRevives>this.revivesCount?this.onNoPressed():(this.currentCountdown=this.countdownDuration,this.reviveElement.enabled=!0,this.startCountdown(),this.yesButton.script.myButton.clickable=!0)):(console.log("ReviveSystem : reward ad is not ready"),this.onNoPressed())},ReviveSystem.prototype.startCountdown=function(){this.updateCountdownText(),this.countDownPause=!1,this.countdownInterval=setInterval(function(){this.countDownPause||(this.currentCountdown>0?(this.currentCountdown--,this.updateCountdownText()):this.onCountdownComplete())}.bind(this),1e3)},ReviveSystem.prototype.updateCountdownText=function(){this.countdownTextElement&&(this.countdownTextElement.element.text=this.currentCountdown.toString())},ReviveSystem.prototype.onCountdownComplete=function(){clearInterval(this.countdownInterval),this.onNoPressed()},ReviveSystem.prototype.onYesPressed=function(){this.yesButton.script.myButton.clickable=!1,this.countDownPause=!0,js_GS_ad_reward()},ReviveSystem.prototype.onNoPressed=function(){this.noCallback&&this.noCallback(),this.cleanup()},ReviveSystem.prototype.cleanup=function(){clearInterval(this.countdownInterval),this.reviveElement.enabled=!1},ReviveSystem.prototype.update=function(e){};var Blinker=pc.createScript("blinker");Blinker.attributes.add("startOpacity",{type:"number",default:0}),Blinker.attributes.add("targetOpacity",{type:"number",default:1}),Blinker.attributes.add("blinkSpeed",{type:"number",default:1}),Blinker.attributes.add("delay",{type:"number",default:0}),Blinker.attributes.add("delayOnMin",{type:"number",default:0}),Blinker.attributes.add("loop",{type:"boolean",default:!0}),Blinker.prototype.initialize=function(){this.state=1,this.opacityStart=this.startOpacity,this.opacity=this.opacityStart,this.delay=this.delayOnMin+this.delay,this.count=-1},Blinker.prototype.update=function(t){this.delay>0?this.delay-=t:((this.loop||!this.loop&&this.count>0)&&(1==this.state?(this.opacity+=t*this.blinkSpeed,this.opacity>=this.targetOpacity&&(this.state=2,this.opacity=this.targetOpacity)):2==this.state&&(this.opacity-=t*this.blinkSpeed,this.opacity<=this.startOpacity&&(this.state=1,this.opacity=this.startOpacity,this.count>0&&this.count--,this.delay=this.delayOnMin))),this.entity.sprite?this.entity.sprite.opacity=this.opacity:this.entity.element.opacity=this.opacity)};var UrnButton=pc.createScript("urnButton");UrnButton.attributes.add("priceText",{type:"entity"}),UrnButton.attributes.add("adButton",{type:"entity"}),UrnButton.instance=null,UrnButton.prototype.initialize=function(){UrnButton.instance=this,this.updateState()},UrnButton.prototype.updateState=function(){Tutorial.showTutor?(this.priceText.enabled=!1,this.adButton.enabled=!1):Game.instance.stars>=Game.instance.urnPrice?(this.priceText.enabled=!0,this.adButton.enabled=!1):js_GS_is_ad_reward_available()?(this.priceText.enabled=!1,this.adButton.enabled=!0):(js_GS_ad_reward_prepare((()=>{UrnButton.instance.performSuccess()}),(()=>{})),this.priceText.enabled=!0,this.adButton.enabled=!1),this.timer=2},UrnButton.prototype.performSuccess=function(){if(Game.instance.currPlate){GameAudio.play("urn"),Game.instance.currPlate.state=Plate.STATE_GOESTOURN;var t=Game.instance.currPlate.entity,e=(new pc.Vec3).copy(t.getLocalPosition());e.z+=5,t.tween(t.getLocalPosition()).to(e,.5,pc.BackIn).loop(!1).yoyo(!1).onComplete(function(){Game.instance.currPlate.entity.destroy(),Game.instance.newPlate()}.bind(t)).start()}this.updateState()},UrnButton.prototype.perform=function(){if(Game.instance.currPlate){if(Game.instance.currPlate.state==Plate.STATE_GOESTOURN)return 1;if(this.adButton.enabled)js_GS_ad_reward();else{if(!Tutorial.showTutor){if(Game.instance.urnPrice>Game.instance.stars)return;Game.instance.addStars(-Game.instance.urnPrice),Game.instance.urnPrice=2*Game.instance.urnPrice,Game.instance.app.fire("game:newurnprice",Game.instance.urnPrice)}this.performSuccess()}this.updateState()}},UrnButton.prototype.update=function(t){this.timer-=t,this.timer<=0&&this.updateState()};